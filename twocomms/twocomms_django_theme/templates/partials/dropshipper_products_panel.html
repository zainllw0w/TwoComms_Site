{% load static %}
{% static 'img/placeholder.jpg' as ds_product_placeholder %}

<script>
  window.__dsPlaceholder = window.__dsPlaceholder || '{{ ds_product_placeholder }}';
</script>

<div class="ds-container ds-products-container">
  {# Заголовок #}
  <header style="
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 1px solid rgba(139,92,246,.2);
  ">
    <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 20px;">
      <div style="flex: 1; min-width: 300px;">
        <h1 style="
          font-size: 2.5rem;
          font-weight: 900;
          color: #f3f4f6;
          margin: 0 0 12px;
          letter-spacing: -0.02em;
          background: linear-gradient(135deg, #8b5cf6, #6366f1);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        ">Каталог TwoComms</h1>
        <p style="
          font-size: 1.1rem;
          color: rgba(229,231,235,.7);
          margin: 0;
          line-height: 1.6;
        ">Усі моделі готові до відправлення під вашим брендом</p>
      </div>
      
      <div style="display: flex; gap: 12px; align-items: center;">
        <a href="{% url 'orders:dropshipper_dashboard' %}" data-tab-link="main" style="
          background: rgba(255,255,255,.05);
          border: 1px solid rgba(255,255,255,.1);
          color: #e5e7eb;
          padding: 12px 24px;
          border-radius: 12px;
          text-decoration: none;
          font-weight: 700;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          transition: all 0.2s;
        " onmouseover="this.style.background='rgba(255,255,255,.1)'" onmouseout="this.style.background='rgba(255,255,255,.05)'">
          <i class="fas fa-home" aria-hidden="true"></i>
          <span>На головну</span>
        </a>
      </div>
    </div>
  </header>

  {# Фильтры и поиск в одной строке #}
  <form method="get"
        id="ds-product-filters"
        action="{% url 'orders:dropshipper_products' %}"
        style="
          background: linear-gradient(145deg, rgba(24,26,31,.98), rgba(18,20,24,.98));
          border: 1px solid rgba(139,92,246,.2);
          border-radius: 16px;
          padding: 24px;
          margin-bottom: 30px;
          box-shadow: 0 10px 30px rgba(0,0,0,.4);
        ">
    
    <div style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 16px; align-items: end;">
      {# Категория #}
      <div>
        <label style="
          display: block;
          font-size: 0.75rem;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 0.05em;
          color: rgba(229,231,235,.5);
          margin-bottom: 8px;
        ">Категорія</label>
        <div class="ds-select" style="position: relative;">
          <select name="category" style="
            width: 100%;
            background: rgba(255,255,255,.05);
            border: 1px solid rgba(255,255,255,.1);
            color: #e5e7eb;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
          " onfocus="this.style.background='rgba(255,255,255,.08)'; this.style.borderColor='rgba(139,92,246,.4)'" onblur="this.style.background='rgba(255,255,255,.05)'; this.style.borderColor='rgba(255,255,255,.1)'">
            <option value="">Всі категорії</option>
            {% for category in categories %}
              <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %} {% if category.disabled %}disabled{% endif %}>
                {{ category.name }}{% if category.disabled %} (скоро){% endif %}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      {# Поиск #}
      <div>
        <label style="
          display: block;
          font-size: 0.75rem;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 0.05em;
          color: rgba(229,231,235,.5);
          margin-bottom: 8px;
        ">Пошук</label>
        <div style="position: relative;">
          <i class="fas fa-search" aria-hidden="true" style="
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(229,231,235,.4);
            pointer-events: none;
          "></i>
          <input type="search" name="search" value="{{ search_query }}" placeholder="Назва або опис товару" style="
            width: 100%;
            background: rgba(255,255,255,.05);
            border: 1px solid rgba(255,255,255,.1);
            color: #e5e7eb;
            padding: 12px 16px 12px 44px;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.2s;
          " onfocus="this.style.background='rgba(255,255,255,.08)'; this.style.borderColor='rgba(139,92,246,.4)'" onblur="this.style.background='rgba(255,255,255,.05)'; this.style.borderColor='rgba(255,255,255,.1)'">
        </div>
      </div>

      {# Кнопки #}
      <div style="display: flex; gap: 8px;">
        <button type="submit" style="
          background: linear-gradient(135deg, #8b5cf6, #6366f1);
          border: none;
          color: white;
          padding: 12px 24px;
          border-radius: 10px;
          font-weight: 700;
          font-size: 0.95rem;
          cursor: pointer;
          transition: all 0.2s;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          white-space: nowrap;
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(139,92,246,.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
          <i class="fas fa-search" aria-hidden="true"></i>
          Знайти
        </button>
        
        {% if selected_category or search_query %}
          <a href="{% url 'orders:dropshipper_products' %}" style="
            background: rgba(239,68,68,.15);
            border: 1px solid rgba(239,68,68,.3);
            color: #f87171;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            white-space: nowrap;
          " onmouseover="this.style.background='rgba(239,68,68,.25)'" onmouseout="this.style.background='rgba(239,68,68,.15)'">
            <i class="fas fa-times" aria-hidden="true"></i>
            Скинути
          </a>
        {% endif %}
      </div>
    </div>
  </form>

  {# Инфо-блок #}
  <div style="
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding: 20px 24px;
    background: linear-gradient(135deg, rgba(139,92,246,.1), rgba(99,102,241,.1));
    border: 1px solid rgba(139,92,246,.2);
    border-radius: 12px;
  ">
    <div style="display: flex; align-items: center; gap: 12px;">
      <i class="fas fa-box-open" aria-hidden="true" style="font-size: 1.5rem; color: #8b5cf6;"></i>
      <div>
        <div style="font-size: 0.85rem; color: rgba(229,231,235,.6); font-weight: 600;">Всього товарів</div>
        <div style="font-size: 1.8rem; font-weight: 900; color: #c4b5fd;">{{ total_count|default:products|length }}</div>
      </div>
    </div>
    
    {% if search_query or selected_category %}
      <div style="
        background: rgba(139,92,246,.15);
        border: 1px solid rgba(139,92,246,.3);
        color: #c4b5fd;
        padding: 10px 20px;
        border-radius: 10px;
        font-size: 0.9rem;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      ">
        <i class="fas fa-filter" aria-hidden="true"></i>
        Фільтри активні
      </div>
    {% endif %}
  </div>

  {# Сетка товаров #}
  <div class="ds-products-grid-wrapper">
    {% if products %}
      <div class="ds-products-grid">
        {% for product in products %}
          {% include "partials/dropshipper_product_card.html" with product=product ds_product_placeholder=ds_product_placeholder %}
        {% endfor %}
      </div>
    {% else %}
      <div style="
        text-align: center;
        padding: 80px 40px;
        background: linear-gradient(145deg, rgba(24,26,31,.98), rgba(18,20,24,.98));
        border: 1px solid rgba(139,92,246,.2);
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,.4);
      ">
        <div style="
          width: 120px;
          height: 120px;
          margin: 0 auto 32px;
          background: linear-gradient(135deg, rgba(139,92,246,.15), rgba(99,102,241,.15));
          border: 2px solid rgba(139,92,246,.3);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <i class="fas fa-box-open" aria-hidden="true" style="font-size: 3.5rem; color: #8b5cf6;"></i>
        </div>
        
        <h3 style="
          font-size: 1.8rem;
          font-weight: 800;
          color: #f3f4f6;
          margin: 0 0 12px;
          letter-spacing: -0.02em;
        ">Товарів не знайдено</h3>
        
        <p style="
          font-size: 1.05rem;
          color: rgba(229,231,235,.6);
          margin: 0 0 32px;
          max-width: 500px;
          margin-left: auto;
          margin-right: auto;
          line-height: 1.6;
        ">Спробуйте змінити фільтри або зверніться до менеджера</p>
        
        <a href="https://t.me/twocomms" target="_blank" rel="noopener" style="
          background: linear-gradient(135deg, #8b5cf6, #6366f1);
          border: none;
          color: white;
          border-radius: 12px;
          padding: 16px 32px;
          font-weight: 700;
          font-size: 1.05rem;
          cursor: pointer;
          transition: all 0.3s;
          display: inline-flex;
          align-items: center;
          gap: 10px;
          box-shadow: 0 8px 20px rgba(139,92,246,.3);
          text-decoration: none;
        " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 30px rgba(139,92,246,.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(139,92,246,.3)'">
          <i class="fab fa-telegram" aria-hidden="true" style="font-size: 1.2rem;"></i>
          <span>Написати менеджеру</span>
        </a>
      </div>
    {% endif %}
  </div>
</div>

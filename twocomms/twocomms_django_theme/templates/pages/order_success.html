{% extends "base.html" %}
{% load static %}

{% block title %}–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ ‚Äî TwoComms{% endblock %}

{% block content %}
<section class="order-success-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="order-success-card">
          <div class="order-success-header">
            <div class="success-icon">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </div>
            <h1 class="order-success-title">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ!</h1>
            <div class="order-number">
              <span class="order-number-label">–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</span>
              <span class="order-number-value">{{ order_number }}</span>
            </div>
          </div>
          
          <div class="order-success-content">
            <div class="success-message">
              <h3>–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ–±—Ä–æ–±–∫—É</h3>
              <p>–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ —É—Ç–æ—á–Ω–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏.</p>
            </div>
            
            <div class="order-details">
              <h4>–î–µ—Ç–∞–ª—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</h4>
              <div class="order-info">
                <div class="info-row">
                  <span class="info-label">–ü–Ü–ë:</span>
                  <span class="info-value">{{ order.full_name }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                  <span class="info-value">{{ order.phone }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">–ú—ñ—Å—Ç–æ:</span>
                  <span class="info-value">{{ order.city }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–ü:</span>
                  <span class="info-value">{{ order.np_office }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">–°—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</span>
                  <span class="info-value">{{ order.total_sum }} –≥—Ä–Ω</span>
                </div>
                <div class="info-row">
                  <span class="info-label">–°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç–∏:</span>
                  <span class="info-value">{% if order.payment_status == 'paid' %}<span class="badge bg-success">–û–ø–ª–∞—á–µ–Ω–æ</span>{% else %}{{ order.get_payment_status_display|default:order.payment_status }}{% endif %}</span>
                </div>
              </div>
            </div>
            
            <div class="auth-suggestion">
              <div class="auth-suggestion-content">
                <h4>üîê –°—Ç–≤–æ—Ä—ñ—Ç—å –∞–∫–∞—É–Ω—Ç –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ</h4>
                <p>–ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å –∞–±–æ —É–≤—ñ–π–¥—ñ—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, —â–æ–±:</p>
                <ul class="auth-benefits">
                  <li>üìä –ù–∞–∫–æ–ø–∏—á—É–≤–∞—Ç–∏ –±–∞–ª–∏ –∑–∞ –ø–æ–∫—É–ø–∫–∏</li>
                  <li>üìà –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω—å</li>
                  <li>üíæ –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –ø–æ–∫—É–ø–æ–∫</li>
                  <li>üéÅ –û—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó</li>
                </ul>
                <div class="auth-buttons">
                  <a href="{% url 'login' %}" class="btn btn-primary">–£–≤—ñ–π—Ç–∏</a>
                  <a href="{% url 'register' %}" class="btn btn-outline-primary">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</a>
                </div>
                <div class="auth-note">
                  <small>–Ø–∫—â–æ –≤–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä—É—î—Ç–µ—Å—å, —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–≤'—è–∂–µ—Ç—å—Å—è –¥–æ –≤–∞—à–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É</small>
                </div>
              </div>
            </div>
            
            <div class="order-success-actions">
              <a href="{% url 'home' %}" class="btn btn-cta">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ –≥–æ–ª–æ–≤–Ω—É</a>
              <a href="{% url 'catalog' %}" class="btn btn-outline-light">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_js %}
<div id="purchase-payload"
     data-value="{{ order.total_sum|floatformat:2 }}"
     data-currency="UAH"
     data-contents='[{% for item in order.items.all %}{"id":"{{ item.product.id }}","quantity":{{ item.qty }}}{% if not forloop.last %},{% endif %}{% endfor %}]'>
</div>
<script>
try{
  var el=document.getElementById('purchase-payload');
  if(el && window.fbq){
    var value=parseFloat(el.dataset.value||'0');
    var currency=el.dataset.currency||'UAH';
    var contents=[]; try{ contents=JSON.parse(el.dataset.contents||'[]'); }catch(_){ contents=[]; }
    fbq('track','Purchase',{ value:value, currency:currency, contents:contents, content_type:'product' });
  }
}catch(e){}
</script>
{% endblock %}

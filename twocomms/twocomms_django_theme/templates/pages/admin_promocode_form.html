{% extends 'base.html' %}
{% load static %}

{% block title %}
  {% if mode == 'create' %}Створити промокод{% else %}Редагувати промокод{% endif %} — TwoComms
{% endblock %}

{% block content %}
<div class="promocode-form-section">
  <!-- Заголовок -->
  <div class="promocode-form-header">
    <div class="form-title-section">
      <h1 class="form-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        {% if mode == 'create' %}
          Створити новий промокод
        {% else %}
          Редагувати промокод {{ promocode.code }}
        {% endif %}
      </h1>
      <div class="form-subtitle">
        {% if mode == 'create' %}
          Заповніть дані для створення нового промокоду
        {% else %}
          Внесіть зміни до існуючого промокоду
        {% endif %}
      </div>
    </div>
    
    <!-- Кнопка возврата -->
    <div class="form-actions">
      <a href="{% url 'admin_promocodes' %}" class="back-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
        Назад до промокодів
      </a>
    </div>
  </div>

  <!-- Форма -->
  <div class="promocode-form-container">
    <form method="post" class="promocode-form">
      {% csrf_token %}
      
      <!-- Основные поля -->
      <div class="form-section">
        <h3 class="section-title">Основна інформація</h3>
      <div class="form-grid">
        <!-- Код промокода -->
        <div class="form-group">
          <label for="{{ form.code.id_for_label }}" class="form-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9.5 3A2.5 2.5 0 0 1 12 5.5c0 .88-.56 1.63-1.34 1.92l1.51 1.51c.56-.23 1.01-.84 1.01-1.51 0-.88-.72-1.6-1.6-1.6-.67 0-1.28.45-1.51 1.01L7.42 6.66C7.71 5.88 8.46 5.32 9.34 5.32A2.5 2.5 0 0 1 9.5 3z"/>
            </svg>
            Код промокоду
          </label>
          {{ form.code }}
          <div class="form-help">
            Залиште порожнім для автоматичної генерації коду
          </div>
          {% if form.code.errors %}
            <div class="form-error">{{ form.code.errors.0 }}</div>
          {% endif %}
        </div>

          <!-- Тип промокода -->
          <div class="form-group">
            <label for="{{ form.promo_type.id_for_label }}" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              Тип промокоду
            </label>
            {{ form.promo_type }}
            {% if form.promo_type.errors %}
              <div class="form-error">{{ form.promo_type.errors.0 }}</div>
            {% endif %}
          </div>

          <!-- Группа промокодов -->
          <div class="form-group" id="group-field">
            <label for="{{ form.group.id_for_label }}" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
              </svg>
              Група промокодів
            </label>
            {{ form.group }}
            <div class="form-help">
              Необов'язково. Для групових промокодів
            </div>
            {% if form.group.errors %}
              <div class="form-error">{{ form.group.errors.0 }}</div>
            {% endif %}
          </div>
        </div>

        <!-- Описание -->
        <div class="form-group">
          <label for="{{ form.description.id_for_label }}" class="form-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
            </svg>
            Опис промокоду
          </label>
          {{ form.description }}
          <div class="form-help">
            Необов'язково. Коротка інформація про промокод
          </div>
          {% if form.description.errors %}
            <div class="form-error">{{ form.description.errors.0 }}</div>
          {% endif %}
        </div>
      </div>

      <!-- Скидка -->
      <div class="form-section">
        <h3 class="section-title">Знижка</h3>
        <div class="form-grid">
          <!-- Тип скидки -->
          <div class="form-group">
            <label for="{{ form.discount_type.id_for_label }}" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            Тип знижки
          </label>
          {{ form.discount_type }}
          {% if form.discount_type.errors %}
            <div class="form-error">{{ form.discount_type.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Значение скидки -->
        <div class="form-group">
          <label for="{{ form.discount_value.id_for_label }}" class="form-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
            </svg>
            Значення знижки
          </label>
          {{ form.discount_value }}
          <div class="form-help">
            <span id="discount-help">Введіть відсоток або суму знижки</span>
          </div>
          {% if form.discount_value.errors %}
            <div class="form-error">{{ form.discount_value.errors.0 }}</div>
          {% endif %}
        </div>

          <!-- Минимальная сумма заказа -->
          <div class="form-group">
            <label for="{{ form.min_order_amount.id_for_label }}" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
              </svg>
              Мінімальна сума замовлення
            </label>
            {{ form.min_order_amount }}
            <div class="form-help">
              Необов'язково. Залиште порожнім якщо немає обмежень
            </div>
            {% if form.min_order_amount.errors %}
              <div class="form-error">{{ form.min_order_amount.errors.0 }}</div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Ограничения использования -->
      <div class="form-section">
        <h3 class="section-title">Обмеження використання</h3>
        <div class="form-grid">
        <!-- Максимальное количество использований -->
        <div class="form-group">
          <label for="{{ form.max_uses.id_for_label }}" class="form-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            Максимальна кількість використань
          </label>
          {{ form.max_uses }}
          <div class="form-help">
            Введіть 0 для необмеженого використання
          </div>
          {% if form.max_uses.errors %}
            <div class="form-error">{{ form.max_uses.errors.0 }}</div>
          {% endif %}
        </div>

          <!-- Период действия -->
          <div class="form-group">
            <label for="{{ form.valid_from.id_for_label }}" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
              </svg>
              Дійсний з
            </label>
            {{ form.valid_from }}
            <div class="form-help">
              Необов'язково. Дата початку дії промокоду
            </div>
            {% if form.valid_from.errors %}
              <div class="form-error">{{ form.valid_from.errors.0 }}</div>
            {% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.valid_until.id_for_label }}" class="form-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
              </svg>
              Дійсний до
            </label>
            {{ form.valid_until }}
            <div class="form-help">
              Необов'язково. Дата закінчення дії промокоду
            </div>
            {% if form.valid_until.errors %}
              <div class="form-error">{{ form.valid_until.errors.0 }}</div>
            {% endif %}
          </div>
        </div>

        <!-- Чекбоксы -->
        <div class="form-group checkbox-group">
          <div class="checkbox-wrapper">
            {{ form.one_time_per_user }}
            <label for="{{ form.one_time_per_user.id_for_label }}" class="checkbox-label">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
              Одноразове використання на користувача
            </label>
          </div>
          <div class="form-help">
            Кожен користувач зможе використати промокод тільки один раз
        </div>
      </div>

      <div class="form-group checkbox-group">
        <div class="checkbox-wrapper">
          {{ form.is_active }}
          <label for="{{ form.is_active.id_for_label }}" class="checkbox-label">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
            Активний промокод
          </label>
        </div>
        <div class="form-help">
          Неактивні промокоди не можуть використовуватися
          </div>
        </div>
      </div>

      <!-- Кнопки действий -->
      <div class="form-actions-bottom">
        <button type="submit" class="submit-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
          {% if mode == 'create' %}
            Створити промокод
          {% else %}
            Зберегти зміни
          {% endif %}
        </button>
        
        <a href="{% url 'admin_promocodes' %}" class="cancel-btn">
          Скасувати
        </a>
      </div>
    </form>
  </div>
</div>

<style>
.form-section {
  margin-bottom: 2.5rem;
  padding: 2rem;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.section-title {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}
</style>

<script>
// Обновление подсказки в зависимости от типа скидки
document.addEventListener('DOMContentLoaded', function() {
  const discountType = document.getElementById('{{ form.discount_type.id_for_label }}');
  const discountValue = document.getElementById('{{ form.discount_value.id_for_label }}');
  const discountHelp = document.getElementById('discount-help');
  const promoType = document.getElementById('{{ form.promo_type.id_for_label }}');
  const groupField = document.getElementById('group-field');
  
  function updateHelp() {
    const type = discountType.value;
    if (type === 'percentage') {
      discountHelp.textContent = 'Введіть відсоток знижки (наприклад: 15 для 15%)';
      discountValue.placeholder = '15';
    } else {
      discountHelp.textContent = 'Введіть суму знижки в гривнях (наприклад: 100)';
      discountValue.placeholder = '100';
    }
  }

  function updateGroupVisibility() {
    const type = promoType.value;
    if (type === 'grouped') {
      groupField.style.display = 'block';
    } else {
      groupField.style.display = 'none';
    }
  }
  
  discountType.addEventListener('change', updateHelp);
  promoType.addEventListener('change', updateGroupVisibility);
  updateHelp();
  updateGroupVisibility();
});
</script>
{% endblock %}

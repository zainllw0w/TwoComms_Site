{% extends 'base.html' %}
{% load static %}

{% block title %}–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Äî TwoComms{% endblock %}

{% block content %}
{% csrf_token %}
<div class="orders-page">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div class="orders-header">
    <div class="orders-header-content">
      <div class="orders-header-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
        </svg>
      </div>
      <div class="orders-header-text">
        <h1 class="orders-title">–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
        <p class="orders-subtitle">–í—ñ–¥—Å—Ç–µ–∂—É–π—Ç–µ —Å—Ç–∞—Ç—É—Å –≤–∞—à–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å</p>
      </div>
    </div>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
  <div class="orders-container">
    {% for o in orders %}
      <div class="order-card" data-order-id="{{ o.id }}">
        <!-- –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä -->
        <div class="order-sparks">
          <div class="order-spark order-spark-1"></div>
          <div class="order-spark order-spark-2"></div>
          <div class="order-spark order-spark-3"></div>
        </div>
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–∫–∞–∑–∞ -->
        <div class="order-header">
          <div class="order-header-row">
            <div class="order-number-container">
              <button class="order-number-btn" onclick="copyOrderNumber('{{ o.order_number }}')" data-order-number="{{ o.order_number }}">
                <div class="order-number-glow"></div>
                <div class="order-number-content">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                  <span class="order-number-text">#{{ o.order_number }}</span>
                  <svg class="copy-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                  </svg>
                </div>
              </button>
            </div>
            
            <div class="order-points-card">
              <div class="points-card-content">
                {% if o.status == 'done' %}
                  <div class="points-status earned">
                    <div class="points-amount">
                      <span>+{{ o.total_points|default:0 }}</span>
                      <div class="points-card-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                      </div>
                    </div>
                    <div class="points-label">–û—Ç—Ä–∏–º–∞–Ω–æ</div>
                  </div>
                {% else %}
                  <div class="points-status pending">
                    <div class="points-amount">
                      <span>{{ o.total_points|default:0 }}</span>
                      <div class="points-card-icon">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                      </div>
                    </div>
                    <div class="points-label">–û—á—ñ–∫—É—î—Ç—å—Å—è</div>
                  </div>
                {% endif %}
              </div>
            </div>
            
            <div class="order-date-card">
              <div class="date-card-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                </svg>
              </div>
              <div class="date-card-content">
                <div class="date-label">–û—Ñ–æ—Ä–º–ª–µ–Ω–æ</div>
                <div class="date-value">{{ o.created|date:"d.m.Y –æ H:i" }}</div>
              </div>
            </div>
          </div>
        </div>

        {% if o.status == 'new' %}
        <div class="featured-unified-block" style="margin:12px 16px 0 16px;">
          <div class="featured-content-unified" style="display:flex;align-items:flex-start;gap:12px;">
            <span class="featured-badge-compact" title="–í–∞–∂–ª–∏–≤–æ" aria-hidden="true" style="flex-shrink:0; display:inline-flex; align-items:center; justify-content:center;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
              </svg>
            </span>
            <div>
              <div class="featured-title-compact">–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ –æ–±—Ä–æ–±—Ü—ñ</div>
              <div class="featured-subtitle-compact">–û—á—ñ–∫—É–π—Ç–µ: –∑ –≤–∞–º–∏ –∑–≤'—è–∂–µ—Ç—å—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π. –ê–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ <strong>–æ–ø–ª–∞—Ç–∏—Ç–∏ –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑</strong> ‚Äî —Ç–∞–∫ –º–∏ –≤—ñ–¥–ø—Ä–∞–≤–∏–º–æ —à–≤–∏–¥—à–µ.</div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ -->
        <div class="order-delivery-compact">
          <div class="delivery-compact-item">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
            <span>{{ o.city }}, {{ o.np_office }}</span>
          </div>
          <div class="delivery-compact-item">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
            </svg>
            <span>{{ o.phone }}</span>
          </div>
          <div class="delivery-compact-item">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
            </svg>
            <span class="ttn-info">
              {% if o.tracking_number %}
                {{ o.tracking_number }}
                {% if o.shipment_status %}
                  <span class="shipment-status" title="–°—Ç–∞—Ç—É—Å –ø–æ—Å—ã–ª–∫–∏: {{ o.shipment_status }}">
                    üì¶ {{ o.shipment_status|truncatechars:30 }}
                  </span>
                {% endif %}
              {% else %}
                <span class="ttn-pending">–¢–¢–ù –æ—á—ñ–∫—É—î—Ç—å—Å—è</span>
              {% endif %}
            </span>
          </div>
        </div>

        <!-- –≠—Ç–∞–ø—ã —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ) -->
        <div class="order-status-track">
          <div class="status-step {% if o.status == 'new' %}active{% elif o.status in 'prep,ship,done' %}completed{% endif %}">
            <div class="status-step-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
            </div>
            <div class="status-step-label">–í –æ–±—Ä–æ–±—Ü—ñ</div>
          </div>
          
          <div class="status-connector {% if o.status in 'prep,ship,done' %}completed{% endif %}"></div>
          
          <div class="status-step {% if o.status == 'prep' %}active{% elif o.status in 'ship,done' %}completed{% endif %}">
            <div class="status-step-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
              </svg>
            </div>
            <div class="status-step-label">–ì–æ—Ç—É—î—Ç—å—Å—è</div>
          </div>
          
          <div class="status-connector {% if o.status in 'ship,done' %}completed{% endif %}"></div>
          
          <div class="status-step {% if o.status == 'ship' %}active{% elif o.status == 'done' %}completed{% endif %}">
            <div class="status-step-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
            </div>
            <div class="status-step-label">–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
          </div>
          
          <div class="status-connector {% if o.status == 'done' %}completed{% endif %}"></div>
          
          <div class="status-step {% if o.status == 'done' %}active{% endif %}">
            <div class="status-step-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </div>
            <div class="status-step-label">–û—Ç—Ä–∏–º–∞–Ω–æ</div>
          </div>
        </div>

        <!-- –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ -->
        <div class="order-items-section">
          <!-- –ê–Ω–∏–º–∞—Ü–∏—è –∫—Ä—É–∂–æ—á–∫–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ -->
          <div class="items-sparks">
            <div class="items-spark items-spark-1"></div>
            <div class="items-spark items-spark-2"></div>
            <div class="items-spark items-spark-3"></div>
            <div class="items-spark items-spark-4"></div>
          </div>
          
          <div class="order-items-header">
            <div class="order-items-title">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
              </svg>
              –¢–æ–≤–∞—Ä–∏ –≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ ({{ o.items.count }})
            </div>
          </div>
          
          <div class="order-items-list">
          {% for it in o.items.all %}
              <div class="order-item-card">
                <div class="order-item-image">
                  {% if it.color_variant and it.color_variant.images.exists %}
                    <img src="{{ it.color_variant.images.first.image.url }}" alt="{{ it.title }}" class="order-item-img">
                  {% elif it.product.main_image %}
                    <img src="{{ it.product.main_image.url }}" alt="{{ it.title }}" class="order-item-img">
                  {% else %}
                    <div class="order-item-placeholder">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                      </svg>
                    </div>
                  {% endif %}
                </div>
                
                <div class="order-item-content">
                  <div class="order-item-main">
                    <div class="order-item-title">{{ it.title }}</div>
                    <div class="order-item-specs">
                      <div class="order-item-spec">
                        <span class="spec-label">–†–æ–∑–º—ñ—Ä:</span>
                        <span class="spec-value">{{ it.size }}</span>
                      </div>
                      <div class="order-item-spec">
                        <span class="spec-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                        <span class="spec-value">{{ it.qty }} —à—Ç</span>
                      </div>
                      {% if it.color_variant %}
                      <div class="order-item-spec">
                        <span class="spec-label">–ö–æ–ª—ñ—Ä:</span>
                        <div class="order-item-color">
                          <span class="order-item-swatch" 
                                data-primary="{{ it.color_variant.color.primary_hex }}" 
                                data-secondary="{{ it.color_variant.color.secondary_hex|default:'' }}">
                          </span>
                          <span class="color-name">{{ it.color_variant.color.name }}</span>
                        </div>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                  
                  <div class="order-item-side">
                    <div class="order-item-price">{{ it.line_total }} –≥—Ä–Ω</div>
                    <div class="order-item-unit-price">{{ it.price }} –≥—Ä–Ω/—à—Ç</div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å–≤–æ–¥–∫–∞ -->
        <div class="order-summary-compact">
          {% if o.promo_code %}
            <div class="order-promo-compact">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <span>{{ o.promo_code.code }} (-{{ o.discount_amount }} –≥—Ä–Ω)</span>
            </div>
          {% endif %}
          
          <div class="order-payment-info">
            <div class="payment-method">
              <div class="payment-method-icon">
                {% if o.pay_type == 'full' %}
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
                  </svg>
                {% else %}
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                {% endif %}
              </div>
              <div class="payment-method-text">
                <div class="payment-method-label">
                  <span class="method-text">
                    {% if o.pay_type == 'full' %}
                      –ü–æ–≤–Ω–∞ –æ–ø–ª–∞—Ç–∞
                    {% else %}
                      –ß–∞—Å—Ç–∫–æ–≤–∞ –æ–ø–ª–∞—Ç–∞
                    {% endif %}
                  </span>
                  <button class="edit-method-btn" onclick="togglePaymentMethodEdit('{{ o.id }}')" title="–ó–º—ñ–Ω–∏—Ç–∏ —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                    </svg>
                  </button>
                </div>
                <div class="payment-status" id="payment-status-{{ o.id }}">
                  {% if o.payment_status == 'paid' %}
                    <span class="status-paid">–û–ø–ª–∞—á–µ–Ω–æ –ø–æ–≤–Ω—ñ—Å—Ç—é</span>
                  {% elif o.payment_status == 'partial' %}
                    <span class="status-partial">–í–Ω–µ—Å–µ–Ω–∞ –ø–µ—Ä–µ–¥–ø–ª–∞—Ç–∞</span>
                  {% elif o.payment_status == 'checking' %}
                    <span class="status-checking">–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ</span>
                  {% else %}
                    <span class="status-unpaid">–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ</span>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="payment-method-actions">
              <div class="payment-method-editor" id="payment-editor-{{ o.id }}" style="display: none;">
                <div class="editor-header">
                  <span class="editor-title">–ó–º—ñ–Ω–∏—Ç–∏ —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏</span>
                  <button class="close-editor-btn" onclick="closePaymentMethodEdit('{{ o.id }}')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                  </button>
                </div>
                <div class="editor-options">
                  <label class="option-item">
                    <input type="radio" name="payment-method-{{ o.id }}" value="partial" {% if o.pay_type == 'partial' %}checked{% endif %}>
                    <span class="option-label">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                      </svg>
                      –ß–∞—Å—Ç–∫–æ–≤–∞ –æ–ø–ª–∞—Ç–∞
                    </span>
                  </label>
                  <label class="option-item">
                    <input type="radio" name="payment-method-{{ o.id }}" value="full" {% if o.pay_type == 'full' %}checked{% endif %}>
                    <span class="option-label">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
                      </svg>
                      –ü–æ–≤–Ω–∞ –æ–ø–ª–∞—Ç–∞
                    </span>
                  </label>
                </div>
                <div class="editor-actions">
                  <button class="save-method-btn" onclick="savePaymentMethod('{{ o.id }}')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    –ó–±–µ—Ä–µ–≥—Ç–∏
                  </button>
                </div>
              </div>
              
              {% if o.payment_status != 'paid' and o.payment_status != 'checking' %}
                {% if o.pay_type == 'partial' %}
                  <button class="payment-btn payment-btn-partial" onclick="payPartial('{{ o.id }}')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    –í–Ω–µ—Å—Ç–∏ –ø–µ—Ä–µ–¥–ø–ª–∞—Ç—É
                  </button>
                {% else %}
                  <button class="payment-btn payment-btn-full" onclick="payFull('{{ o.id }}')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
                    </svg>
                    –û–ø–ª–∞—Ç–∏—Ç–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é
                  </button>
                {% endif %}
              {% endif %}
            </div>
          </div>
          
          <div class="order-final-compact">
            <span class="order-final-label">–†–∞–∑–æ–º:</span>
            <span class="order-final-amount">{{ o.total_sum }} –≥—Ä–Ω</span>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="orders-empty">
        <div class="orders-empty-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
          </svg>
        </div>
        <h2 class="orders-empty-title">–£ –≤–∞—Å —â–µ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å</h2>
        <p class="orders-empty-text">–ó—Ä–æ–±—ñ—Ç—å –ø–µ—Ä—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –π–æ–≥–æ —Ç—É—Ç</p>
        <a href="{% url 'home' %}" class="orders-empty-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–æ–∫—É–ø–æ–∫
        </a>
      </div>
    {% endfor %}
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã -->
<div class="payment-modal" id="payment-modal">
  <div class="payment-modal-overlay" onclick="closePaymentModal()"></div>
  <div class="payment-modal-content">
    <div class="payment-modal-header">
      <h3 class="payment-modal-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        –í–Ω–µ—Å–µ–Ω–Ω—è –ø–µ—Ä–µ–¥–ø–ª–∞—Ç–∏
      </h3>
      <button class="payment-modal-close" onclick="closePaymentModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>
    
    <div class="payment-modal-body">
      <div class="payment-instruction">
        <div class="instruction-header">
          <h4>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –ø–æ –≤–Ω–µ—Å–µ–Ω–Ω—é –ø–µ—Ä–µ–¥–ø–ª–∞—Ç–∏</h4>
          <p class="instruction-description">
            –ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ —É —Ä–æ–∑–º—ñ—Ä—ñ <strong>200 –≥—Ä–Ω</strong> –Ω–µ–æ–±—Ö—ñ–¥–Ω–∞ –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –∫–æ–º–ø–∞–Ω—ñ—ó —É –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –ø–æ—Å–∏–ª–∫–∞ –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞, –∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ –Ω–µ –∑–∞–±–µ—Ä–µ —ó—ó, –∞–±–æ —Ä–æ–∑–º—ñ—Ä –Ω–µ –ø—ñ–¥—ñ–π–¥–µ.
          </p>
        </div>
        
        <div class="order-number-section">
          <label>–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</label>
          <button class="order-number-copy" id="modal-order-number" onclick="copyOrderNumberFromModal()">
            <span class="order-number-text"></span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
            </svg>
          </button>
        </div>
        
        <div class="payment-details">
          <h5>–†–µ–∫–≤—ñ–∑–∏—Ç–∏ –¥–ª—è –æ–ø–ª–∞—Ç–∏:</h5>
          <div class="payment-details-grid">
            <div class="detail-item">
              <label>–û—Ç—Ä–∏–º—É–≤–∞—á:</label>
              <button class="copyable-text" onclick="copyToClipboard('–°–∏–Ω—ñ–ª–æ –ê—Ä—Ç–µ–º –í—ñ—Ç–∞–ª—ñ–π–æ–≤–∏—á')">
                –°–∏–Ω—ñ–ª–æ –ê—Ä—Ç–µ–º –í—ñ—Ç–∞–ª—ñ–π–æ–≤–∏—á
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
            </div>
            
            <div class="detail-item">
              <label>IBAN:</label>
              <button class="copyable-text" onclick="copyToClipboard('UA783220010000026200341393088')">
                UA783220010000026200341393088
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
            </div>
            
            <div class="detail-item">
              <label>–Ü–ü–ù/–Ñ–î–†–ü–û–£:</label>
              <button class="copyable-text" onclick="copyToClipboard('3490607272')">
                3490607272
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
            </div>
            
            <div class="detail-item">
              <label>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—É:</label>
              <button class="copyable-text" id="modal-payment-purpose" onclick="copyPaymentPurpose()">
                <span class="purpose-text"></span>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
            </div>
            
            <div class="payment-method-separator">
              <span>–ê–ë–û</span>
            </div>
            
            <div class="detail-item">
              <label>–ö–∞—Ä—Ç–∞ –ú–æ–Ω–æ–±–∞–Ω–∫:</label>
              <button class="copyable-text" onclick="copyToClipboard('4441111140615463')">
                4441111140615463
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <div class="payment-upload">
          <h5>–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å–∫—Ä—ñ–Ω—à–æ—Ç –æ–ø–ª–∞—Ç–∏:</h5>
          <p class="upload-description">
            –°–∫—Ä—ñ–Ω—à–æ—Ç –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≥–∞—Ä–∞–Ω—Ç—ñ–π —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –æ–ø–ª–∞—Ç–∏. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑—Ä–æ–±—ñ—Ç—å –∑–Ω—ñ–º–æ–∫ –µ–∫—Ä–∞–Ω—É –∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.
          </p>
          <div class="upload-area" id="upload-area">
            <input type="file" id="payment-screenshot" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
            <div class="upload-placeholder" onclick="document.getElementById('payment-screenshot').click()">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 7v2.99s-1.99.01-2 0V7h-3s.01-1.99 0-2h3V2h2v3h3v2h-3zm-3 4V8h-3V5H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8h-3zM5 19l3-4 2 3 3-4 4 5H5z"/>
              </svg>
              <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–∫—Ä—ñ–Ω—à–æ—Ç—É</p>
              <span>PNG, JPG –∞–±–æ JPEG (–º–∞–∫—Å. 5MB)</span>
            </div>
            <div class="upload-preview" id="upload-preview" style="display: none;">
              <img id="preview-image" src="" alt="Preview">
              <button class="remove-upload" onclick="removeUpload()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="payment-modal-footer">
      <button class="payment-confirm-btn" onclick="confirmPayment()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        –û–ø–ª–∞—Ç–∏–≤
      </button>
    </div>
  </div>
</div>

<script>
function copyOrderNumber(orderNumber) {
  // –ö–æ–ø–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
  navigator.clipboard.writeText(orderNumber).then(function() {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    showCopyNotification(orderNumber);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
    const button = event.target.closest('.order-number-btn');
    if (button) {
      button.classList.add('copied');
      setTimeout(() => {
        button.classList.remove('copied');
      }, 2000);
    }
  }).catch(function(err) {
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
    // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
    const textArea = document.createElement('textarea');
    textArea.value = orderNumber;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showCopyNotification(orderNumber);
  });
}

function showCopyNotification(orderNumber) {
  // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  const notification = document.createElement('div');
  notification.className = 'copy-notification';
  notification.innerHTML = `
    <div class="copy-notification-content">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
      </svg>
      <span>–ù–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #${orderNumber} —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!</span>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
  setTimeout(() => {
    notification.classList.add('show');
  }, 100);
  
  // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–ø–ª–∞—Ç—ã (–∑–∞–≥–ª—É—à–∫–∏)
function payPartial(orderId) {
  // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞ –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ data-order-number
  const orderContainer = document.querySelector(`[data-order-id="${orderId}"]`);
  const orderNumberBtn = orderContainer ? orderContainer.querySelector('[data-order-number]') : null;
  const orderNumber = orderNumberBtn ? orderNumberBtn.getAttribute('data-order-number') : `TWC${new Date().toISOString().slice(0,10).replace(/-/g,'')}N01`;
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  document.querySelector('#modal-order-number .order-number-text').textContent = orderNumber;
  document.querySelector('#modal-payment-purpose .purpose-text').textContent = orderNumber;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –∑–∞–∫–∞–∑–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  document.getElementById('payment-modal').setAttribute('data-order-id', orderId);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  document.getElementById('payment-modal').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function payFull(orderId) {
  alert('–§—É–Ω–∫—Ü—ñ—è –ø–æ–≤–Ω–æ—ó –æ–ø–ª–∞—Ç–∏ –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #' + orderId + ' –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –ø—ñ–∑–Ω—ñ—à–µ');
}

function payFull(orderId) {
  alert('–§—É–Ω–∫—Ü—ñ—è –ø–æ–≤–Ω–æ—ó –æ–ø–ª–∞—Ç–∏ –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è #' + orderId + ' –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –ø—ñ–∑–Ω—ñ—à–µ');
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
function togglePaymentMethodEdit(orderId) {
  const editor = document.getElementById('payment-editor-' + orderId);
  if (editor) {
    editor.style.display = 'block';
    editor.style.animation = 'editorSlideIn 0.3s ease-out';
  }
}

function closePaymentMethodEdit(orderId) {
  const editor = document.getElementById('payment-editor-' + orderId);
  if (editor) {
    editor.style.animation = 'editorSlideOut 0.3s ease-in';
    setTimeout(() => {
      editor.style.display = 'none';
    }, 300);
  }
}

function savePaymentMethod(orderId) {
  const selectedMethod = document.querySelector(`input[name="payment-method-${orderId}"]:checked`);
  if (!selectedMethod) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏');
    return;
  }
  
  const methodName = selectedMethod.value === 'full' ? '–ü–æ–≤–Ω–∞' : '–ß–∞—Å—Ç–∫–æ–≤–∞';
  
  if (confirm(`–í–∏ –¥—ñ–π—Å–Ω–æ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏ –Ω–∞ "${methodName} –æ–ø–ª–∞—Ç–∞"?`)) {
    // AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    const formData = new FormData();
    formData.append('order_id', orderId);
    formData.append('payment_method', selectedMethod.value);
    formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
    
    fetch('{% url "update_payment_method" %}', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        const paymentInfo = document.querySelector(`#payment-editor-${orderId}`).closest('.order-payment-info');
        const methodText = paymentInfo.querySelector('.method-text');
        const methodIcon = paymentInfo.querySelector('.payment-method-icon svg');
        const paymentBtn = paymentInfo.closest('.order-payment-info').querySelector('.payment-btn');
        
        if (methodText) {
          methodText.textContent = data.method_display;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
        if (methodIcon) {
          if (data.payment_method === 'full') {
            methodIcon.innerHTML = '<path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>';
          } else {
            methodIcon.innerHTML = '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>';
          }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã
        if (paymentBtn) {
          if (data.payment_method === 'partial') {
            paymentBtn.className = 'payment-btn payment-btn-partial';
            paymentBtn.innerHTML = `
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              –í–Ω–µ—Å—Ç–∏ –ø–µ—Ä–µ–¥–ø–ª–∞—Ç—É
            `;
            paymentBtn.onclick = () => payPartial(orderId);
          } else {
            paymentBtn.className = 'payment-btn payment-btn-full';
            paymentBtn.innerHTML = `
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
              </svg>
              –û–ø–ª–∞—Ç–∏—Ç–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é
            `;
            paymentBtn.onclick = () => payFull(orderId);
          }
        }
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
        closePaymentMethodEdit(orderId);
      } else {
        alert('–ü–æ–º–∏–ª–∫–∞: ' + (data.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ' + error.message);
    });
  }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã
function closePaymentModal() {
  document.getElementById('payment-modal').style.display = 'none';
  document.body.style.overflow = 'auto';
  removeUpload(); // –û—á–∏—â–∞–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
}

function copyOrderNumberFromModal() {
  const orderNumber = document.querySelector('#modal-order-number .order-number-text').textContent;
  copyToClipboard(orderNumber);
}

function copyPaymentPurpose() {
  const purpose = document.querySelector('#modal-payment-purpose .purpose-text').textContent;
  copyToClipboard(purpose);
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    showCopyNotification(text);
  }).catch(function(err) {
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
    // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showCopyNotification(text);
  });
}

function handleFileUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (5MB)
  if (file.size > 5 * 1024 * 1024) {
    alert('–§–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä: 5MB');
    return;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ñ–∞–π–ª–∞
  if (!file.type.startsWith('image/')) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    document.getElementById('preview-image').src = e.target.result;
    document.querySelector('.upload-placeholder').style.display = 'none';
    document.getElementById('upload-preview').style.display = 'block';
  };
  reader.readAsDataURL(file);
}

function removeUpload() {
  document.getElementById('payment-screenshot').value = '';
  document.querySelector('.upload-placeholder').style.display = 'block';
  document.getElementById('upload-preview').style.display = 'none';
  document.getElementById('preview-image').src = '';
}

function confirmPayment() {
  const file = document.getElementById('payment-screenshot').files[0];
  if (!file) {
    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å–∫—Ä—ñ–Ω—à–æ—Ç –æ–ø–ª–∞—Ç–∏');
    return;
  }
  
  const orderId = document.getElementById('payment-modal').getAttribute('data-order-id');
  if (!orderId) {
    alert('–ü–æ–º–∏–ª–∫–∞: –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ ID –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è');
    return;
  }
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
  const formData = new FormData();
  formData.append('order_id', orderId);
  formData.append('payment_screenshot', file);
  formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
  
  fetch('{% url "confirm_payment" %}', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
      const paymentStatus = document.querySelector(`#payment-status-${orderId}`);
      if (paymentStatus) {
        paymentStatus.textContent = '–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ';
        paymentStatus.className = 'payment-status status-checking';
      }
      
      alert('–î—è–∫—É—î–º–æ! –í–∞—à —Å–∫—Ä—ñ–Ω—à–æ—Ç –æ–ø–ª–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ. –°—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ "–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ".');
      closePaymentModal();
    } else {
      alert('–ü–æ–º–∏–ª–∫–∞: ' + (data.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞'));
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏: ' + error.message);
  });
}
</script>

<script>
// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è order-item-swatch
document.addEventListener('DOMContentLoaded', function() {
    const colorSwatches = document.querySelectorAll('.order-item-swatch');
    colorSwatches.forEach(function(swatch) {
        const primaryColor = swatch.getAttribute('data-primary');
        const secondaryColor = swatch.getAttribute('data-secondary');
        
        if (primaryColor) {
            swatch.style.setProperty('--primary-color', primaryColor);
        }
        if (secondaryColor) {
            swatch.style.setProperty('--secondary-color', secondaryColor);
        }
    });
});
</script>

{% endblock %}

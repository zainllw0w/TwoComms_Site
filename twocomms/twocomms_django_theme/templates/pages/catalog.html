{% extends "base.html" %}
{% load static %}
{% load cache %}

{% block title %}{% if category %}{{ category.name }} — TwoComms{% else %}Каталог одягу — TwoComms{% endif %}{% endblock %}

{% block description %}{% if category %}Купити {{ category.name|lower }} в TwoComms. Якісний стріт & мілітарі одяг з ексклюзивним дизайном. Швидка доставка по Україні.{% else %}Каталог стріт & мілітарі одягу TwoComms. Футболки, худі, лонгсліви з ексклюзивним дизайном. Якісний одяг з характером.{% endif %}{% endblock %}

{% block keywords %}{% if category %}{{ category.name|lower }}, {% endif %}стріт одяг, мілітарі одяг, футболки, худі, лонгсліви, TwoComms, ексклюзивний дизайн, якісний одяг, каталог одягу{% endblock %}

{% block og_type %}website{% endblock %}

{% block content %}
{% if category %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {"@type": "ListItem", "position": 1, "name": "Головна", "item": "{{ request.scheme }}://{{ request.get_host }}/"},
    {"@type": "ListItem", "position": 2, "name": "Каталог", "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'catalog' %}"},
    {"@type": "ListItem", "position": 3, "name": "{{ category.name }}", "item": "{{ request.scheme }}://{{ request.get_host }}{{ request.path }}"}
  ]
}
</script>
{% endif %}
<div class="row g-3 g-md-4">
  <aside class="col-12">
    <div class="d-flex flex-wrap gap-2 mb-3">
      <a href="{% url 'catalog' %}" class="btn btn-outline-light {% if not category %}active{% endif %} d-inline-flex align-items-center gap-2">
        <img src="{% static 'img/icons/all.svg' %}" width="18" height="18" alt="Усі товари"> Усі
      </a>
      {% for c in categories %}
        <a href="{% url 'catalog_by_cat' c.slug %}" class="btn btn-outline-light {% if category and category.id == c.id %}active{% endif %} d-inline-flex align-items-center gap-2">
          {% if c.icon %}
            <img src="{{ c.icon.url }}" width="18" height="18" alt="{{ c.name }}">
          {% else %}
            <img src="{% static 'img/icons/default.svg' %}" width="18" height="18" alt="Категорія">
          {% endif %}
          {{ c.name }}
        </a>
      {% endfor %}
    </div>
  </aside>

  {% if show_category_cards %}
    <section class="col-12">
      {% cache 1800 catalog_categories %}
        <div class="row g-3 g-md-4 row-cols-2 row-cols-md-3 row-cols-lg-4">
          {% for c in categories %}
            <div class="col">
              <a href="{% url 'catalog_by_cat' c.slug %}" class="card product glass hover-raise text-decoration-none text-body">
                <div class="ratio ratio-1x1 rounded-top-4 overflow-hidden bg-elevate">
                  {% if c.cover %}<img src="{{ c.cover.url }}" class="w-100 h-100 object-fit-cover" alt="{{ c.name }}">{% endif %}
                </div>
                <div class="card-body">
                  <div class="fw-semibold">{{ c.name }}</div>
                  <div class="text-secondary small">{{ c.products.count }} товарів</div>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
      {% endcache %}
    </section>
  {% else %}
    <section class="col-12">
      {% cache 600 catalog_products cat_slug %}
        <div class="row g-3 g-md-4 row-cols-2 row-cols-md-3 row-cols-lg-4" data-stagger-grid>
          {% for p in products %}
            <div class="product-card-wrap">
              {% cache 900 product_card p.id p.final_price p.discount_percent p.display_image.name p.category_id %}
                {% include "partials/product_card.html" with p=p stagger=True %}
              {% endcache %}
              {% if p.colors_preview %}
              <div class="product-card-dots">
                <span class="text-secondary small me-1">Кольори:</span>
                <div class="d-flex align-items-center gap-1">
                  {% for v in p.colors_preview %}
                    <span class="color-dot" 
                          title="{{ v.primary_hex }}{% if v.secondary_hex %}+{{ v.secondary_hex }}{% endif %}" 
                          style="--c1: {{ v.primary_hex }}; --c2: {{ v.secondary_hex|default:'' }};"
                          data-image-url="{{ v.first_image_url|default:'' }}"></span>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
            </div>
          {% empty %}
            <div class="text-secondary small">Немає товарів.</div>
          {% endfor %}
        </div>
      {% endcache %}
    </section>
  {% endif %}
</div>
{% endblock %}
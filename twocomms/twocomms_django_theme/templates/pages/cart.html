{% extends 'base.html' %}
{% load static %}
{% load math_filters %}
{% load responsive_images %}

{% block title %}–ö–æ—à–∏–∫ ‚Äî TwoComms{% endblock %}

{% block content %}
{% csrf_token %}

<!-- –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<div class="cart-page-sparks">
  <div class="cart-page-spark cart-page-spark-1"></div>
  <div class="cart-page-spark cart-page-spark-2"></div>
  <div class="cart-page-spark cart-page-spark-3"></div>
  <div class="cart-page-spark cart-page-spark-4"></div>
  <div class="cart-page-spark cart-page-spark-5"></div>
  <div class="cart-page-spark cart-page-spark-6"></div>
</div>

<div class="cart-page-container">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div class="cart-page-header">
    <div class="cart-page-header-icon">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
      </svg>
    </div>
    <div class="cart-page-header-content">
      <h1 class="cart-page-title">–ö–æ—à–∏–∫</h1>
      <p class="cart-page-subtitle">–í–∞—à—ñ –≤–∏–±—Ä–∞–Ω—ñ —Ç–æ–≤–∞—Ä–∏</p>
    </div>
    {% if items %}
    <button type="button" class="cart-clear-btn" onclick="cleanCart()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
      </svg>
      –û—á–∏—Å—Ç–∏—Ç–∏
    </button>
    {% endif %}
  </div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
  {% if messages %}
    {% for message in messages %}
      <div class="cart-message cart-message-{{ message.tags }}">
        <div class="cart-message-icon">
          {% if message.tags == 'success' %}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
          {% elif message.tags == 'error' %}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          {% else %}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
          {% endif %}
        </div>
        <div class="cart-message-text">{{ message }}</div>
        <button type="button" class="cart-message-close" onclick="this.parentElement.remove()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="cart-page-content">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å –∫–æ—Ä–∑–∏–Ω—ã -->
    <div class="cart-main-section">
      {% if items %}
        <div class="cart-items-background">
          <div class="cart-items-pattern"></div>
        </div>
        <div class="cart-items-container" id="cart-list">
          {% for it in items %}
            <div class="cart-item" data-cart-row data-key="{{ it.key }}" data-offer-id="{{ it.offer_id }}">
              <!-- –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä –¥–ª—è —Ç–æ–≤–∞—Ä–∞ -->
              <div class="cart-item-sparks">
                <div class="cart-item-spark cart-item-spark-1"></div>
                <div class="cart-item-spark cart-item-spark-2"></div>
                <div class="cart-item-spark cart-item-spark-3"></div>
              </div>
              
              <div class="cart-item-image">
                {% if it.color_variant and it.color_variant.images.exists %}
                  <img src="{{ it.color_variant.images.first.image.url }}" 
                       alt="{{ it.product.title }} - —Ç–æ–≤–∞—Ä —É –∫–æ—à–∏–∫—É TwoComms" 
                       class="cart-item-img"
                       width="80" height="80">
                {% elif it.product.main_image %}
                  <img src="{{ it.product.main_image.url }}" 
                       alt="{{ it.product.title }} - —Ç–æ–≤–∞—Ä —É –∫–æ—à–∏–∫—É TwoComms" 
                       class="cart-item-img"
                       width="80" height="80">
                {% else %}
                  {% static 'img/placeholder.jpg' as ph_url %}
                  <img src="{{ ph_url }}" 
                       alt="{{ it.product.title }} - —Ç–æ–≤–∞—Ä —É –∫–æ—à–∏–∫—É TwoComms" 
                       class="cart-item-img"
                       width="80" height="80">
                {% endif %}
                <div class="cart-item-image-glow"></div>
              </div>
              
              <div class="cart-item-info">
                <h3 class="cart-item-title">{{ it.product.title }}</h3>
                <div class="cart-item-details">
                  <div class="cart-item-detail">
                    <span class="cart-item-label">–†–æ–∑–º—ñ—Ä:</span>
                    <span class="cart-item-value">{{ it.size }}</span>
                  </div>
                  <div class="cart-item-detail">
                    <span class="cart-item-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                    <span class="cart-item-value">{{ it.qty }}</span>
                  </div>
                  {% if it.color_variant %}
                  <div class="cart-item-detail">
                    <span class="cart-item-label">–ö–æ–ª—ñ—Ä:</span>
                    <div class="cart-item-color d-flex align-items-center gap-2">
                      {% with p=it.color_variant.color.primary_hex s=it.color_variant.color.secondary_hex %}
                      <span class="cart-item-swatch swatch"
                            data-primary="{{ p }}"
                            data-secondary="{{ s|default:'' }}">
                      </span>
                      {% endwith %}
                      <span class="cart-item-color-name">{{ it.color_label|default:'‚Äî' }}</span>
                    </div>
                  </div>
                  {% endif %}
                </div>
                <div class="cart-item-price">
                  <span class="cart-item-price-label">–¶—ñ–Ω–∞:</span>
                  <span class="cart-item-price-value">{{ it.unit_price }} –≥—Ä–Ω</span>
                </div>
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–ª–∞—Ö -->
                <div class="cart-item-points">
                  <div class="cart-item-points-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  </div>
                  <span class="cart-item-points-text">
                    {% if it.product.points_reward %}
                      –ó–∞—Ä–æ–±–∏—Ç–µ {{ it.product.points_reward|multiply:it.qty }} –±–∞–ª—ñ–≤
                    {% else %}
                      –ë–∞–ª–∏ –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è
                    {% endif %}
                  </span>
                </div>
              </div>
              
              <div class="cart-item-actions">
                <div class="cart-item-total">
                  <span class="cart-item-total-label">–†–∞–∑–æ–º:</span>
                  <span class="cart-item-total-value">{{ it.line_total }} –≥—Ä–Ω</span>
                </div>
                <button type="button" class="cart-item-remove-btn" onclick="CartRemoveKey('{{ it.key }}', this); return false;" data-key="{{ it.key }}">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                  –í–∏–¥–∞–ª–∏—Ç–∏
                </button>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="cart-empty">
          <div class="cart-empty-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
          </div>
          <h2 class="cart-empty-title">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</h2>
          <p class="cart-empty-text">–î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –¥–æ –∫–æ—à–∏–∫–∞, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
          <a href="{% url 'home' %}" class="cart-empty-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–æ–∫—É–ø–æ–∫
          </a>
        </div>
      {% endif %}
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="cart-sidebar">
      {% if request.user.is_authenticated %}
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –î–æ—Å—Ç–∞–≤–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
        <div class="cart-sidebar-card">
          <div class="cart-sidebar-card-header">
            <div class="cart-sidebar-card-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
              </svg>
            </div>
            <h3 class="cart-sidebar-card-title">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
          </div>
          
          {% with prof=request.user.userprofile %}
          <form method="post" class="cart-sidebar-form" id="deliveryForm" novalidate>
            {% csrf_token %}
            <input type="hidden" name="form_type" value="update_profile" id="form_type_input">
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ü–Ü–ë *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="full_name" class="cart-form-input" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ"
                       value="{{ prof.full_name|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
              <div class="cart-form-input-wrapper">
                <input type="tel" name="phone" class="cart-form-input" placeholder="+380XXXXXXXXX"
                       value="{{ prof.phone|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ú—ñ—Å—Ç–æ *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="city" class="cart-form-input" placeholder="–ö–∏—ó–≤"
                       value="{{ prof.city|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è / –ü–æ—à—Ç–æ–º–∞—Ç –ù–ü *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="np_office" class="cart-form-input" placeholder="‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –∞–±–æ –∞–¥—Ä–µ—Å–∞ –ø–æ—à—Ç–æ–º–∞—Ç–∞"
                       value="{{ prof.np_office|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–∏–ø –æ–ø–ª–∞—Ç–∏ *</label>
              <div class="cart-form-input-wrapper">
                <select name="pay_type" class="cart-form-select" id="pay_type_auth" required aria-label="–¢–∏–ø –æ–ø–ª–∞—Ç–∏">
                  <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –æ–ø–ª–∞—Ç–∏</option>
                  <option value="online_full" {% if prof.pay_type == 'online_full' or prof.pay_type == 'full' %}selected{% endif %}>–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ (–ø–æ–≤–Ω–∞ —Å—É–º–∞)</option>
                  <option value="prepay_200" {% if prof.pay_type == 'prepay_200' or prof.pay_type == 'partial' %}selected{% endif %}>–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω (—Ä–µ—à—Ç–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ)</option>
                </select>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ -->
            <div class="cart-form-group">
              <button type="button" class="btn-contact-manager" id="contactManagerBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                  <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                  <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                </svg>
                üí¨ –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è?
              </button>
            </div>
            
            <button type="submit" class="cart-form-save-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
              –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
            </button>
          </form>
          {% endwith %}
        </div>
      {% else %}
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –î–æ—Å—Ç–∞–≤–∫–∞ –¥–ª—è –≥–æ—Å—Ç–µ–π -->
        <div class="cart-sidebar-card">
          <div class="cart-sidebar-card-header">
            <div class="cart-sidebar-card-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
              </svg>
            </div>
            <h3 class="cart-sidebar-card-title">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
            <a href="{% url 'login' %}" class="cart-auth-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
              </svg>
              –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
            </a>
          </div>
          
          <div class="cart-sidebar-card-hint">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            –©–æ–± –Ω–µ –≤–≤–æ–¥–∏—Ç–∏ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É ‚Äî –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —ñ –Ω–∞–∫–æ–ø–∏—á—É–π—Ç–µ –±–∞–ª–∏.
          </div>
          
          <form method="post" class="cart-sidebar-form" id="guest-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="guest_order">
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ü–Ü–ë *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="full_name" class="cart-form-input" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.full_name.errors %}
                <div class="cart-form-error">{{ guest_form.full_name.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
              <div class="cart-form-input-wrapper">
                <input type="tel" name="phone" class="cart-form-input" placeholder="+380XXXXXXXXX" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.phone.errors %}
                <div class="cart-form-error">{{ guest_form.phone.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ú—ñ—Å—Ç–æ *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="city" class="cart-form-input" placeholder="–ö–∏—ó–≤" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.city.errors %}
                <div class="cart-form-error">{{ guest_form.city.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è / –ü–æ—à—Ç–æ–º–∞—Ç –ù–ü *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="np_office" class="cart-form-input" placeholder="‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –∞–±–æ –∞–¥—Ä–µ—Å–∞ –ø–æ—à—Ç–æ–º–∞—Ç–∞" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.np_office.errors %}
                <div class="cart-form-error">{{ guest_form.np_office.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–∏–ø –æ–ø–ª–∞—Ç–∏ *</label>
              <div class="cart-form-input-wrapper">
                <select name="pay_type" class="cart-form-select" id="pay_type_guest" required aria-label="–¢–∏–ø –æ–ø–ª–∞—Ç–∏">
                  <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –æ–ø–ª–∞—Ç–∏</option>
                  <option value="online_full">–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ (–ø–æ–≤–Ω–∞ —Å—É–º–∞)</option>
                  <option value="prepay_200">–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω (—Ä–µ—à—Ç–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ)</option>
                </select>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.pay_type.errors %}
                <div class="cart-form-error">{{ guest_form.pay_type.errors.0 }}</div>
              {% endif %}
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ -->
            <div class="cart-form-group">
              <button type="button" class="btn-contact-manager" id="contactManagerBtnGuest">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                  <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                  <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                </svg>
                üí¨ –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è?
              </button>
            </div>
          </form>
        </div>
      {% endif %}

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –ü—Ä–æ–º–æ–∫–æ–¥ -->
      <div class="cart-sidebar-card">
        <div class="cart-sidebar-card-header">
          <div class="cart-sidebar-card-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
            </svg>
          </div>
          <h3 class="cart-sidebar-card-title">–ü—Ä–æ–º–æ–∫–æ–¥</h3>
          {% if applied_promo %}
            <span class="cart-promo-badge">–ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ</span>
          {% endif %}
        </div>
        
        {% if applied_promo %}
          <div class="cart-promo-applied">
            <div class="cart-promo-applied-content">
              <div class="cart-promo-applied-code">{{ applied_promo.code }}</div>
              <div class="cart-promo-applied-discount">–ó–Ω–∏–∂–∫–∞: {{ applied_promo.discount }} –≥—Ä–Ω</div>
            </div>
            <button type="button" class="cart-promo-remove-btn" onclick="removePromoCode()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
        {% else %}
          <div class="cart-promo-input-group">
            <div class="cart-promo-input-wrapper">
              <input type="text" id="promo-code-input" class="cart-promo-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥—É" maxlength="20">
              <div class="cart-promo-input-glow"></div>
            </div>
            <button type="button" class="cart-promo-apply-btn" onclick="applyPromoCode()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </button>
          </div>
          <div id="promo-message" class="cart-promo-message"></div>
        {% endif %}
      </div>

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
      <div class="cart-checkout-card">
        <div class="cart-checkout-header">
          <div class="cart-checkout-header-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <div class="cart-checkout-header-content">
            <h3 class="cart-checkout-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
            <p class="cart-checkout-subtitle">–ü—ñ–¥—Å—É–º–æ–∫ –≤–∞—à–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
          </div>
        </div>
        
        <div class="cart-checkout-summary">
          <div class="cart-summary-row">
            <span class="cart-summary-label">–¢–æ–≤–∞—Ä–∏ ({{ items|length }}):</span>
            <span class="cart-summary-value">{{ grand_total }} –≥—Ä–Ω</span>
          </div>
          
          {% if applied_promo %}
          <div class="cart-summary-row cart-summary-discount">
            <span class="cart-summary-label">
              <div class="cart-discount-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                –ó–Ω–∏–∂–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥—É
              </div>
            </span>
            <span class="cart-summary-value">-{{ applied_promo.discount }} –≥—Ä–Ω</span>
          </div>
          {% endif %}
          
          <div class="cart-summary-row cart-summary-total" id="pay-now-row">
            <span class="cart-summary-label" id="pay-now-label">–î–æ —Å–ø–ª–∞—Ç–∏:</span>
            <span class="cart-summary-value"
                  id="pay-now-amount"
                  data-total="{{ grand_total|floatformat:'2' }}"
                  data-prepay="200">{% if pay_now_amount %}{{ pay_now_amount }} –≥—Ä–Ω{% else %}{{ grand_total }} –≥—Ä–Ω{% endif %}</span>
          </div>
          <div class="cart-summary-row cart-summary-prepay d-none" id="prepay-remaining-row">
            <span class="cart-summary-label">–ó–∞–ª–∏—à–æ–∫ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ:</span>
            <span class="cart-summary-value" id="prepay-remaining-amount">{{ grand_total }} –≥—Ä–Ω</span>
          </div>
          <p class="cart-summary-note d-none" id="prepay-note">
            –¶–µ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –¥–ª—è –≤–∞—Å ‚Äî —Ä–µ—à—Ç—É —Å–ø–ª–∞—Ç–∏—Ç–µ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ.
          </p>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–ª–∞—Ö -->
        <div class="cart-points-summary">
          <div class="cart-points-header">
            <div class="cart-points-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <span class="cart-points-title">–ë–∞–ª–∏ –∑–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
          </div>
          
          {% if request.user.is_authenticated %}
            {% if total_points > 0 %}
              <div class="cart-points-earned">
                <span class="cart-points-amount">+{{ total_points }} –±–∞–ª—ñ–≤</span>
                <span class="cart-points-description">–±—É–¥–µ –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</span>
              </div>
            {% else %}
              <div class="cart-points-none">
                <span class="cart-points-text">–ë–∞–ª–∏ –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è</span>
              </div>
            {% endif %}
          {% else %}
            <div class="cart-points-guest">
              <div class="cart-points-guest-info">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <span>–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è</span>
              </div>
              <a href="{% url 'login' %}" class="cart-points-login-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
                </svg>
                –ê–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è
              </a>
            </div>
          {% endif %}
        </div>
        
        <div class="cart-delivery-info">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
          </svg>
          –î–æ—Å—Ç–∞–≤–∫–∞ –æ–ø–ª–∞—á—É—î—Ç—å—Å—è –∑–≥—ñ–¥–Ω–æ —Ç–∞—Ä–∏—Ñ—ñ–≤ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞.
        </div>

<div class="cart-checkout-actions">
  <!-- Monobank –æ–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ -->
  <div class="cart-monobank-container" data-mono-status-scope>
    <button type="button" id="monobank-pay-btn" class="cart-monobank-btn" data-monobank-pay-trigger="cart">
      <span class="cart-monobank-logo" aria-hidden="true">
        <span class="mono">mono</span><span class="dot">¬∑</span><span class="pay">pay</span>
      </span>
      <span class="cart-monobank-details">
        <span class="cart-monobank-text">–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é</span>
        <span class="cart-monobank-badges" aria-hidden="true">
          <span class="cart-monobank-badge cart-monobank-badge-gpay" role="presentation">
            <span class="badge-symbol">G</span>
            <span class="badge-text">Pay</span>
          </span>
          <span class="cart-monobank-badge cart-monobank-badge-apple" role="presentation">
            <span class="badge-symbol" aria-hidden="true">Ô£ø</span>
            <span class="badge-text">Pay</span>
          </span>
        </span>
      </span>
      <span class="cart-monobank-spinner" aria-hidden="true"></span>
    </button>
    <div id="monobank-pay-status" class="cart-monobank-status text-secondary" data-mono-checkout-status role="status" aria-live="polite"></div>
  </div>



          {% if request.user.is_authenticated %}
            <button type="button" class="cart-checkout-btn" id="placeOrderBtn" data-monobank-pay-trigger="cart">
              <div class="cart-checkout-btn-content">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                <span>–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
              </div>
              <div class="cart-checkout-btn-glow"></div>
            </button>
          {% else %}
            <button type="button" class="cart-checkout-btn cart-checkout-btn-guest" id="guestOrderBtn" data-monobank-pay-trigger="cart">
              <div class="cart-checkout-btn-content">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27–ª-5 4.87 1.18 6.88L12 17.77–ª-6.18 3.25–õ7 14.14 2 9.27–ª6.91-1.01L12 2z"/>
                </svg>
                <span>–ó–∞–º–æ–≤–∏—Ç–∏ —è–∫ –≥—ñ—Å—Ç—å</span>
              </div>
              <div class="cart-checkout-btn-glow"></div>
            </button>
          {% endif %}
          <div class="cart-checkout-note text-secondary mt-3">
            –ü—ñ—Å–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –º–µ–Ω–µ–¥–∂–µ—Ä –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É, —â–æ–± –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –¥–µ—Ç–∞–ª—ñ —Ç–∞ —É–∑–≥–æ–¥–∏—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫—É.
          </div>
        </div>


      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block modals %}
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (–í–ù–ï main –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!) -->
<div id="contactManagerModal" class="contact-modal-overlay" aria-hidden="true" role="dialog" aria-labelledby="contactModalTitle">
  <div class="contact-modal-container">
    <div class="contact-modal-header">
      <h3 id="contactModalTitle">üí¨ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è</h3>
      <button type="button" class="contact-modal-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">&times;</button>
    </div>
    <div class="contact-modal-body">
      <p style="margin-bottom: 1.5rem; color: #64748b; text-align: center;">–ó–∞–ª–∏—à—Ç–µ —Å–≤–æ—ó –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ, —ñ –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó</p>
      <form id="contactManagerForm">
        {% csrf_token %}
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalFullName">
            –ü–Ü–ë <span style="color: #e53e3e;">*</span>
          </label>
          <input 
            type="text" 
            id="contactModalFullName" 
            name="full_name" 
            class="contact-modal-input" 
            placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ü–Ü–ë" 
            required
            minlength="3"
          >
        </div>
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalPhone">
            –¢–µ–ª–µ—Ñ–æ–Ω <span style="color: #e53e3e;">*</span>
          </label>
          <input 
            type="tel" 
            id="contactModalPhone" 
            name="phone" 
            class="contact-modal-input" 
            placeholder="+380 XX XXX XX XX" 
            required
            pattern="[+]?[0-9\s\-\(\)]+"
          >
        </div>
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalTelegram">
            Telegram
          </label>
          <input 
            type="text" 
            id="contactModalTelegram" 
            name="telegram" 
            class="contact-modal-input" 
            placeholder="@username –∞–±–æ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É"
          >
          <div class="contact-modal-help-text">–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –∞–ª–µ –¥–æ–ø–æ–º–æ–∂–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è —à–≤–∏–¥—à–µ</div>
        </div>
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalWhatsApp">
            WhatsApp
          </label>
          <input 
            type="tel" 
            id="contactModalWhatsApp" 
            name="whatsapp" 
            class="contact-modal-input" 
            placeholder="+380 XX XXX XX XX"
            pattern="[+]?[0-9\s\-\(\)]+"
          >
          <div class="contact-modal-help-text">–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ</div>
        </div>
        
        <button type="submit" class="contact-modal-submit-btn">
          üì≤ –ó–≤'—è–∑–∞—Ç–∏—Å—è –∑—ñ –º–Ω–æ—é
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º, –ø—Ä–æ–º–æ–∫–æ–¥—ã –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ main.js
function initCartPage() {
    const guestForm = document.getElementById('guest-form');
    const deliveryForm = document.getElementById('deliveryForm');
    
    // ==================== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ü–ò–°–ö–ê –¢–û–í–ê–†–û–í ====================
    let cartUpdateInProgress = false;
    
    function refreshCartItems() {
        if (cartUpdateInProgress) return;
        cartUpdateInProgress = true;
        
        fetch('/cart/items/', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Cache-Control': 'no-cache'
            },
            cache: 'no-store'
        })
        .then(response => response.json())
        .then(data => {
            cartUpdateInProgress = false;
            if (data && data.ok && data.items) {
                updateCartItemsList(data);
                updateCartSummary(data);
                
                // –ö–†–ò–¢–ò–ß–ù–û: –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –æ–±–Ω–æ–≤–ª—è–µ–º —Å—É–º–º—É –æ–ø–ª–∞—Ç—ã
                // —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ prepay_200
                setTimeout(() => {
                    const payTypeSelect = document.getElementById('pay_type_auth') || document.getElementById('pay_type_guest');
                    if (payTypeSelect && typeof window.updatePaymentSummary === 'function') {
                        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º pay_type
                        window.updatePaymentSummary(payTypeSelect.value || 'online_full');
                    }
                }, 150);
            }
        })
        .catch(error => {
            cartUpdateInProgress = false;
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã:', error);
        });
    }
    
    function updateCartItemsList(data) {
        const cartListContainer = document.getElementById('cart-list');
        if (!cartListContainer) return;
        
        // –ï—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞
        if (!data.items || data.items.length === 0) {
            const emptyCart = document.querySelector('.cart-empty');
            if (!emptyCart) {
                // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                const mainSection = document.querySelector('.cart-main-section');
                if (mainSection) {
                    mainSection.innerHTML = `
                        <div class="cart-empty">
                            <div class="cart-empty-icon">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
                                </svg>
                            </div>
                            <h2 class="cart-empty-title">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</h2>
                            <p class="cart-empty-text">–î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –¥–æ –∫–æ—à–∏–∫–∞, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
                            <a href="{% url 'home' %}" class="cart-empty-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–æ–∫—É–ø–æ–∫
                            </a>
                        </div>
                    `;
                }
            }
            return;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
        let itemsHTML = '';
        const placeholderUrl = '{% static "img/placeholder.jpg" %}';
        data.items.forEach(item => {
            const imageUrl = item.image_url || placeholderUrl;
            const colorSwatch = item.color_variant_id ? `
                <div class="cart-item-detail">
                    <span class="cart-item-label">–ö–æ–ª—ñ—Ä:</span>
                    <div class="cart-item-color d-flex align-items-center gap-2">
                        <span class="cart-item-swatch swatch" data-primary="#000" data-secondary=""></span>
                        <span class="cart-item-color-name">${item.color_label || '‚Äî'}</span>
                    </div>
                </div>
            ` : '';
            
            itemsHTML += `
                <div class="cart-item" data-cart-row data-key="${item.key}" data-offer-id="${item.offer_id || ''}">
                    <div class="cart-item-sparks">
                        <div class="cart-item-spark cart-item-spark-1"></div>
                        <div class="cart-item-spark cart-item-spark-2"></div>
                        <div class="cart-item-spark cart-item-spark-3"></div>
                    </div>
                    <div class="cart-item-image">
                        <img src="${imageUrl}" 
                             alt="${item.product_title}" 
                             class="cart-item-img"
                             width="80" height="80">
                        <div class="cart-item-image-glow"></div>
                    </div>
                    <div class="cart-item-info">
                        <h3 class="cart-item-title">${item.product_title}</h3>
                        <div class="cart-item-details">
                            <div class="cart-item-detail">
                                <span class="cart-item-label">–†–æ–∑–º—ñ—Ä:</span>
                                <span class="cart-item-value">${item.size || '‚Äî'}</span>
                            </div>
                            <div class="cart-item-detail">
                                <span class="cart-item-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                                <span class="cart-item-value">${item.qty}</span>
                            </div>
                            ${colorSwatch}
                        </div>
                        <div class="cart-item-price">
                            <span class="cart-item-price-label">–¶—ñ–Ω–∞:</span>
                            <span class="cart-item-price-value">${item.unit_price.toFixed(2)} –≥—Ä–Ω</span>
                        </div>
                        ${item.points_reward > 0 ? `
                        <div class="cart-item-points">
                            <div class="cart-item-points-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </div>
                            <span class="cart-item-points-text">–ó–∞—Ä–æ–±–∏—Ç–µ ${item.points_reward * item.qty} –±–∞–ª—ñ–≤</span>
                        </div>
                        ` : ''}
                    </div>
                    <div class="cart-item-actions">
                        <div class="cart-item-total">
                            <span class="cart-item-total-label">–†–∞–∑–æ–º:</span>
                            <span class="cart-item-total-value">${item.line_total.toFixed(2)} –≥—Ä–Ω</span>
                        </div>
                        <button type="button" class="cart-item-remove-btn" onclick="CartRemoveKey('${item.key}', this); return false;" data-key="${item.key}">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                            –í–∏–¥–∞–ª–∏—Ç–∏
                        </button>
                    </div>
                </div>
            `;
        });
        
        const cartItemsBackground = document.querySelector('.cart-items-background');
        if (cartItemsBackground) {
            cartListContainer.innerHTML = itemsHTML;
        } else {
            // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
            const mainSection = document.querySelector('.cart-main-section');
            if (mainSection) {
                mainSection.innerHTML = `
                    <div class="cart-items-background">
                        <div class="cart-items-pattern"></div>
                    </div>
                    <div class="cart-items-container" id="cart-list">
                        ${itemsHTML}
                    </div>
                `;
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º checkout-payload –µ—Å–ª–∏ –µ—Å—Ç—å
        const checkoutPayload = document.getElementById('checkout-payload');
        if (checkoutPayload) {
            const idsJson = JSON.stringify(data.items.map(item => item.offer_id));
            const contentsJson = JSON.stringify(data.items.map(item => ({
                id: item.offer_id,
                quantity: item.qty,
                item_price: item.unit_price,
                item_name: item.product_title,
                item_category: item.product_category || '',
                brand: 'TwoComms'
            })));
            const totalValue = typeof data.grand_total === 'number' ? data.grand_total : (typeof data.total === 'number' ? data.total : 0);
            const numItems = data.items.reduce((acc, item) => acc + (item.qty || 0), 0);
            
            checkoutPayload.setAttribute('data-value', totalValue.toFixed(2));
            checkoutPayload.setAttribute('data-num-items', numItems);
            checkoutPayload.setAttribute('data-ids', encodeURIComponent(idsJson));
            checkoutPayload.setAttribute('data-contents', encodeURIComponent(contentsJson));
        }
    }
    
    function updateCartSummary(data) {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤–æ–¥–∫—É –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏
        const firstSummaryRow = document.querySelector('.cart-summary-row:first-child');
        if (firstSummaryRow) {
            const summaryValue = firstSummaryRow.querySelector('.cart-summary-value');
            if (summaryValue && data.subtotal !== undefined) {
                summaryValue.textContent = `${parseFloat(data.subtotal).toFixed(2)} –≥—Ä–Ω`;
            }
            
            const summaryLabel = firstSummaryRow.querySelector('.cart-summary-label');
            if (summaryLabel && data.items) {
                const match = summaryLabel.textContent.match(/–¢–æ–≤–∞—Ä–∏ \((\d+)\):/);
                if (match) {
                    summaryLabel.textContent = summaryLabel.textContent.replace(/\(\d+\)/, `(${data.items.length})`);
                }
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫ —Å–∫–∏–¥–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
        const discountRow = document.querySelector('.cart-summary-discount');
        if (data.discount !== undefined && data.discount > 0) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å–∫–∏–¥–∫–∏ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (!discountRow) {
                const summaryRows = document.querySelectorAll('.cart-checkout-summary .cart-summary-row');
                if (summaryRows.length > 0) {
                    const discountHtml = `
                        <div class="cart-summary-row cart-summary-discount">
                            <span class="cart-summary-label">
                                <div class="cart-discount-label">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                    </svg>
                                    –ó–Ω–∏–∂–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥—É
                                </div>
                            </span>
                            <span class="cart-summary-value">-${parseFloat(data.discount).toFixed(2)} –≥—Ä–Ω</span>
                        </div>
                    `;
                    summaryRows[0].insertAdjacentHTML('afterend', discountHtml);
                }
            } else {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±–ª–æ–∫
                const discountValue = discountRow.querySelector('.cart-summary-value');
                if (discountValue) {
                    discountValue.textContent = `-${parseFloat(data.discount).toFixed(2)} –≥—Ä–Ω`;
                }
            }
        } else {
            // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ —Å–∫–∏–¥–∫–∏ –µ—Å–ª–∏ —Å–∫–∏–¥–∫–∏ –Ω–µ—Ç
            if (discountRow) {
                discountRow.remove();
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º pay-now-amount —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º total (–ù–û –ù–ï –¢–ï–ö–°–¢ –Ω–∞–ø—Ä—è–º—É—é!)
        const payNowAmount = document.getElementById('pay-now-amount');
        if (payNowAmount) {
            // –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º Number —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            let totalValue = data.total !== undefined ? Number(parseFloat(data.total)) : 
                           (data.grand_total !== undefined ? Number(parseFloat(data.grand_total)) : 0);
            if (isNaN(totalValue)) totalValue = 0;
            
            // –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ data-total –∞—Ç—Ä–∏–±—É—Ç, –ù–ï —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é
            payNowAmount.setAttribute('data-total', totalValue.toFixed(2));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º paymentSummary –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã
            if (typeof window.paymentSummary !== 'undefined') {
                window.paymentSummary.total = totalValue;
            }
            
            // –ö–†–ò–¢–ò–ß–ù–û: –í–°–ï–ì–î–ê –≤—ã–∑—ã–≤–∞–µ–º updatePaymentSummary –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—É–º–º—ã
            // –û–Ω–∞ —Å–∞–º–∞ —Ä–µ—à–∏—Ç —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å: 200 –≥—Ä–Ω –ø—Ä–∏ prepay_200 –∏–ª–∏ –ø–æ–ª–Ω—É—é —Å—É–º–º—É
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º setTimeout —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ updatePaymentSummary –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ü–û–°–õ–ï –≤—Å–µ—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
            setTimeout(() => {
                const payTypeSelect = document.getElementById('pay_type_auth') || document.getElementById('pay_type_guest');
                if (payTypeSelect && typeof window.updatePaymentSummary === 'function') {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–∞
                    window.updatePaymentSummary(payTypeSelect.value || 'online_full');
                } else if (typeof window.updatePaymentSummary === 'function') {
                    // –ï—Å–ª–∏ —Å–µ–ª–µ–∫—Ç –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                    window.updatePaymentSummary('online_full');
                }
            }, 50);
        }
    }
    
    // –ö–†–ò–¢–ò–ß–ù–û: –°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ pay_type
    // –ü–æ—Ç–æ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è
    const payTypeSelect = document.getElementById('pay_type_auth') || document.getElementById('pay_type_guest');
    if (payTypeSelect && payTypeSelect.value && typeof window.updatePaymentSummary === 'function') {
        // –ï—Å–ª–∏ pay_type —É–∂–µ –≤—ã–±—Ä–∞–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É –î–û –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
        window.updatePaymentSummary(payTypeSelect.value);
        }
    
    // –ö–†–ò–¢–ò–ß–ù–û: –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ updatePaymentSummary –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–æ—Ä–∑–∏–Ω—ã
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    setTimeout(() => {
    refreshCartItems();
    }, 200);
    
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º CartRemoveKey –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    const originalCartRemoveKey = window.CartRemoveKey;
    window.CartRemoveKey = function(key, button) {
        if (originalCartRemoveKey) {
            originalCartRemoveKey(key, button);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç
        setTimeout(() => {
            refreshCartItems();
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏-–∫–æ—Ä–∑–∏–Ω—É –∏ —Å–≤–æ–¥–∫—É
            try { if(window.refreshMiniCart) window.refreshMiniCart(); } catch(_) {}
            try { if(window.refreshCartSummary) window.refreshCartSummary(); } catch(_) {}
        }, 300);
    };
    
    // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (—á–µ—Ä–µ–∑ CustomEvent)
    document.addEventListener('cartUpdated', function() {
        refreshCartItems();
    });
    
    // ==================== END –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï ====================
    
    // ==================== –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ö–ù–û–ü–ö–ò (–ü–†–ò–û–†–ò–¢–ï–¢ #1) ====================
    // –í–ê–ñ–ù–û: –≠—Ç–æ—Ç –∫–æ–¥ –î–û–õ–ñ–ï–ù –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø–µ—Ä–≤—ã–º, –ø–æ—ç—Ç–æ–º—É –æ–Ω –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ!
    
    // –ö–†–ò–¢–ò–ß–ù–û: –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –í–ù–ï try/catch —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–≥–¥–∞
    const placeOrderBtn = document.getElementById('placeOrderBtn');
      const guestOrderBtn = document.getElementById('guestOrderBtn');
      const activeOrderBtn = placeOrderBtn || guestOrderBtn;
      
      // –ù–∞—Ö–æ–¥–∏–º —Å–µ–ª–µ–∫—Ç pay_type (–ª–∏–±–æ auth, –ª–∏–±–æ guest)
      const payTypeAuthSelect = document.getElementById('pay_type_auth');
      const payTypeGuestSelect = document.getElementById('pay_type_guest');
      const activePayTypeSelect = payTypeAuthSelect || payTypeGuestSelect;
      
      const payNowAmountEl = document.getElementById('pay-now-amount');
      const payNowLabelEl = document.getElementById('pay-now-label');
      const prepayRemainingRow = document.getElementById('prepay-remaining-row');
      const prepayRemainingAmountEl = document.getElementById('prepay-remaining-amount');
      const prepayNoteEl = document.getElementById('prepay-note');
    
    try {
      const parseNumeric = (raw) => {
        if (raw == null) {
          return NaN;
        }
        // –ö–†–ò–¢–ò–ß–ù–û: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É, —É–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –∏ –Ω–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
        // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
        const cleaned = String(raw)
          .replace(/\u00A0/g, '')  // –ù–µ—Ä–∞–∑—Ä—ã–≤–Ω—ã–π –ø—Ä–æ–±–µ–ª
          .replace(/\s/g, '')      // –í—Å–µ –ø—Ä–æ–±–µ–ª—ã
          .replace(/,/g, '.')      // –ó–∞–ø—è—Ç—ã–µ –Ω–∞ —Ç–æ—á–∫–∏
          .replace(/[^\d.-]/g, ''); // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä, —Ç–æ—á–∫–∏ –∏ –º–∏–Ω—É—Å–∞
        const parsed = Number.parseFloat(cleaned);
        return Number.isFinite(parsed) ? parsed : NaN;
      };
      
      // –í–ê–ñ–ù–û: paymentSummary –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
      window.paymentSummary = {
        total: payNowAmountEl ? parseNumeric(payNowAmountEl.dataset.total || '0') : 0,
        prepay: payNowAmountEl ? parseNumeric(payNowAmountEl.dataset.prepay || '200') : 200
      };
      
      if (!Number.isFinite(window.paymentSummary.total)) {
        window.paymentSummary.total = 0;
      }
      if (!Number.isFinite(window.paymentSummary.prepay) || window.paymentSummary.prepay <= 0) {
        window.paymentSummary.prepay = 200;
      }
      
      // –°–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
      const paymentSummary = window.paymentSummary;
      
      function formatUAH(amount) {
        const normalized = Number.isFinite(amount) ? amount : 0;
        const opts = (Math.abs(normalized % 1) < 1e-9)
          ? {minimumFractionDigits: 0, maximumFractionDigits: 0}
          : {minimumFractionDigits: 2, maximumFractionDigits: 2};
        return normalized.toLocaleString('uk-UA', opts) + ' –≥—Ä–Ω';
      }
      
      function updatePaymentSummary(payType) {
        if (!payNowAmountEl) {
          console.warn('updatePaymentSummary: payNowAmountEl not found');
          return;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º paymentSummary.total –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ data-total —ç–ª–µ–º–µ–Ω—Ç–∞
        // –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞
        const currentTotalRaw = payNowAmountEl.dataset.total || '0';
        const currentTotal = parseNumeric(currentTotalRaw);
        if (window.paymentSummary) {
          window.paymentSummary.total = Number.isFinite(currentTotal) ? Number(currentTotal) : (window.paymentSummary.total || 0);
        }
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π paymentSummary
        const summary = window.paymentSummary || paymentSummary;
        
        const isPrepay = payType === 'prepay_200';
        // –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–µ –í–°–ï–ì–î–ê 200 –≥—Ä–Ω, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã
        // –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫, –ø—Ä–æ—Å—Ç–æ 200 –≥—Ä–Ω –µ—Å–ª–∏ prepay_200
        const payNow = isPrepay ? summary.prepay : summary.total;
        const remaining = isPrepay ? Math.max((summary.total || 0) - summary.prepay, 0) : 0;
        
        if (payNowLabelEl) {
          payNowLabelEl.textContent = isPrepay ? '–î–æ —Å–ø–ª–∞—Ç–∏ –∑–∞—Ä–∞–∑:' : '–î–æ —Å–ø–ª–∞—Ç–∏:';
        }
        
        // –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        // –î–ª—è prepay_200 –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º prepay –∑–Ω–∞—á–µ–Ω–∏–µ (200 –≥—Ä–Ω)
        const finalAmount = isPrepay ? summary.prepay : payNow;
        payNowAmountEl.textContent = formatUAH(finalAmount);
        
        // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê: –µ—Å–ª–∏ prepay_200, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ = 200
        if (isPrepay) {
          const currentText = payNowAmountEl.textContent.trim();
          const expectedText = formatUAH(summary.prepay).trim();
          if (currentText !== expectedText) {
            console.warn('updatePaymentSummary: prepay_200 but wrong amount detected, fixing...', currentText, '->', expectedText);
            payNowAmountEl.textContent = expectedText;
          }
        }
        
        if (prepayRemainingRow) {
          if (isPrepay) {
            prepayRemainingRow.classList.remove('d-none');
            if (prepayRemainingAmountEl) {
              prepayRemainingAmountEl.textContent = formatUAH(remaining);
            }
          } else {
            prepayRemainingRow.classList.add('d-none');
          }
        }
        
        if (prepayNoteEl) {
          prepayNoteEl.classList.toggle('d-none', !isPrepay);
        }
      }

      function updateOrderButtonText(payType) {
        const btn = activeOrderBtn;
        if (!btn) {
          return;
        }
        
        const btnTextSpan = btn.querySelector('span');
        if (!btnTextSpan) {
          return;
        }
        
        let newText = '';
        switch(payType) {
          case 'online_full':
            newText = '–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –æ–ø–ª–∞—Ç–∏';
            break;
          case 'prepay_200':
            newText = '–í–Ω–µ—Å—Ç–∏ –ø–µ—Ä–µ–¥–ø–ª–∞—Ç—É 200 –≥—Ä–Ω';
            break;
          default:
            newText = placeOrderBtn ? '–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è' : '–ó–∞–º–æ–≤–∏—Ç–∏ —è–∫ –≥—ñ—Å—Ç—å';
        }
        
        btnTextSpan.textContent = newText;
        updatePaymentSummary(payType);
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è pay_type
      if (activePayTypeSelect) {
        activePayTypeSelect.addEventListener('change', function() {
          updateOrderButtonText(this.value);
        });
        
        // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∏–∂–µ, –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è updatePaymentSummary
        // —á–µ—Ä–µ–∑ updateOrderButtonText –∏–ª–∏ updatePaymentSummary –Ω–∞–ø—Ä—è–º—É—é
      }
      
      // –ö–†–ò–¢–ò–ß–ù–û: –î–µ–ª–∞–µ–º updatePaymentSummary –≥–ª–æ–±–∞–ª—å–Ω–æ–π –í–ù–ï try/catch
      // —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞
    } catch (error) {
      // –¢–∏—Ö–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
      console.error('Error in payment summary initialization:', error);
    }
    
    // –ö–†–ò–¢–ò–ß–ù–û: –î–µ–ª–∞–µ–º updatePaymentSummary –≥–ª–æ–±–∞–ª—å–Ω–æ–π –í–ù–ï –±–ª–æ–∫–∞ try/catch
    // —á—Ç–æ–±—ã –æ–Ω–∞ –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ try –±–ª–æ–∫–µ
    if (typeof updatePaymentSummary === 'function') {
      window.updatePaymentSummary = updatePaymentSummary;
      
      // –ö–†–ò–¢–ò–ß–ù–û: –°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ pay_type
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤
      requestAnimationFrame(() => {
        if (activePayTypeSelect && activePayTypeSelect.value) {
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É –°–†–ê–ó–£ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
          console.log('Initial payment summary setup with pay_type:', activePayTypeSelect.value);
          updatePaymentSummary(activePayTypeSelect.value);
        } else {
          updatePaymentSummary('online_full');
        }
      });
      } else {
      console.error('updatePaymentSummary –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥.');
    }
    // ==================== END –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ö–ù–û–ü–ö–ò ====================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
    function setupFormValidation(form) {
        if (!form) return;
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–ª–µ–π —Å –æ—à–∏–±–∫–∞–º–∏
        const errorFields = form.querySelectorAll('.cart-form-error');
        errorFields.forEach(function(errorDiv) {
            const field = errorDiv.previousElementSibling?.querySelector('input, select');
            if (field) {
                field.classList.add('cart-form-input-error');
            }
        });
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(function(input) {
            input.addEventListener('blur', function() {
                validateField(this);
            });
            
            input.addEventListener('input', function() {
                // –£–±–∏—Ä–∞–µ–º –∫—Ä–∞—Å–Ω—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ
                if (this.classList.contains('cart-form-input-error')) {
                    this.classList.remove('cart-form-input-error');
                    const errorDiv = this.parentNode.parentNode.querySelector('.cart-form-error');
                    if (errorDiv) {
                        errorDiv.style.display = 'none';
                    }
                }
            });
        });
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function(e) {
            let isValid = true;
            let firstErrorField = null;
            
            inputs.forEach(function(input) {
                if (!validateField(input)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = input;
                    }
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                showError('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–ø—Ä–∞–≤—Ç–µ –ø–æ–º–∏–ª–∫–∏ –≤ —Ñ–æ—Ä–º—ñ');
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–µ—Ä–≤–æ–º—É –ø–æ–ª—é —Å –æ—à–∏–±–∫–æ–π
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                    firstErrorField.focus();
                }
            }
        });
    }
    
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫, –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ main.js
    (function highlightServerErrors(){
      [guestForm, deliveryForm].forEach(function(form){
        if(!form) return; form.querySelectorAll('.cart-form-error').forEach(function(err){
          var field = err.previousElementSibling && err.previousElementSibling.querySelector('input, select');
          if(field){ field.classList.add('cart-form-input-error'); }
        });
      });
    })();
    
    function validateField(field) {
        const value = field.value.trim();
        let isValid = true;
        let errorMessage = '';
        
        // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–µ –æ—à–∏–±–∫–∏
        field.classList.remove('cart-form-input-error');
        const existingError = field.parentNode.parentNode.querySelector('.cart-form-error');
        if (existingError) {
            existingError.style.display = 'none';
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        if (field.hasAttribute('required') && !value) {
            isValid = false;
            errorMessage = '–¶–µ –ø–æ–ª–µ –æ–±–æ–≤\'—è–∑–∫–æ–≤–µ';
        } else if (value) {
            // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
            if (field.name === 'full_name') {
                if (value.length < 3) {
                    isValid = false;
                    errorMessage = '–ü–Ü–ë –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 3 —Å–∏–º–≤–æ–ª–∏';
                } else if (!/[–∞-—è—ë—ñ—ó—î“ëa-z]/i.test(value)) {
                    isValid = false;
                    errorMessage = '–ü–Ü–ë –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏ –ª—ñ—Ç–µ—Ä–∏';
                }
            } else if (field.name === 'phone') {
                const phoneClean = value.replace(/[^\d+]/g, '');
                if (!phoneClean.startsWith('+380')) {
                    isValid = false;
                    errorMessage = '–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–≤–∏–Ω–µ–Ω –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑ +380';
                } else if (phoneClean.length !== 13) {
                    isValid = false;
                    errorMessage = '–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ 13 —Å–∏–º–≤–æ–ª—ñ–≤';
                }
            } else if (field.name === 'city') {
                if (value.length < 2) {
                    isValid = false;
                    errorMessage = '–ù–∞–∑–≤–∞ –º—ñ—Å—Ç–∞ –ø–æ–≤–∏–Ω–Ω–∞ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏';
                }
            } else if (field.name === 'np_office') {
                if (value.length < 1) {
                    isValid = false;
                    errorMessage = '–í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è';
                }
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å
        if (!isValid) {
            field.classList.add('cart-form-input-error');
            showFieldError(field, errorMessage);
        }
        
        return isValid;
    }
    
    function showFieldError(field, message) {
        // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—É—é –æ—à–∏–±–∫—É
        const existingError = field.parentNode.parentNode.querySelector('.cart-form-error');
        if (existingError) {
            existingError.textContent = message;
            existingError.style.display = 'block';
        } else {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –æ—à–∏–±–∫—É
            const errorDiv = document.createElement('div');
            errorDiv.className = 'cart-form-error';
            errorDiv.textContent = message;
            field.parentNode.parentNode.appendChild(errorDiv);
        }
    }
    
    function showError(message) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        const errorAlert = document.createElement('div');
        errorAlert.className = 'cart-message cart-message-error';
        errorAlert.innerHTML = `
          <div class="cart-message-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <div class="cart-message-text">${message}</div>
          <button type="button" class="cart-message-close" onclick="this.parentElement.remove()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        `;
        
        const container = document.querySelector('.cart-page-container');
        container.insertBefore(errorAlert, container.firstChild);
        
        // –£–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(function() {
            errorAlert.remove();
        }, 5000);
    }
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initCartPage);
} else {
  initCartPage();
}
</script>
{% if checkout_payload %}
<div id="checkout-payload"
     data-value="{{ checkout_payload_value|floatformat:2 }}"
     data-currency="UAH"
     data-num-items="{{ checkout_payload_num_items }}"
     data-ids="{{ checkout_payload_ids|urlencode }}"
     data-contents="{{ checkout_payload_contents|urlencode }}"
     style="display:none"></div>

<!-- –ú–æ–Ω–æ–±–∞–Ω–∫ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å -->
<script>
document.addEventListener('DOMContentLoaded', function(){
  try{
    var el = document.getElementById('checkout-payload');
    if(!el) return;
    var payload = (function(){
      var rawContents = el.dataset.contents ? decodeURIComponent(el.dataset.contents) : '[]';
      var rawIds = el.dataset.ids ? decodeURIComponent(el.dataset.ids) : '[]';
      var contents=[]; try{ contents = JSON.parse(rawContents||'[]'); }catch(_){ contents=[]; }
      var ids=[]; try{ ids = JSON.parse(rawIds||'[]'); }catch(_){ ids=[]; }
      var value = parseFloat(el.dataset.value||'0');
      var currency = el.dataset.currency||'UAH';
      var numItems = parseInt(el.dataset.numItems||String(contents.reduce(function(acc,item){return acc + (item.quantity||0);},0)||'0'),10);
      if(!numItems || Number.isNaN(numItems)){
        numItems = contents.reduce(function(acc,item){return acc + (item.quantity||0);},0) || ids.length;
      }
      return { contents: contents, content_ids: ids, content_type: 'product', value: value, currency: currency, num_items: numItems };
    })();
    document.querySelectorAll('.cart-checkout-btn').forEach(function(btn){
      if(btn._icBound) return; btn._icBound = true;
      btn.addEventListener('click', function(){
        try{ if(window.trackEvent){ window.trackEvent('InitiateCheckout', payload); } }catch(_){ }
      }, {passive:true});
    });
  }catch(_){ }
});
</script>

{% endif %}

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ -->
<div class="modal fade" id="promoAuthModal" tabindex="-1" aria-labelledby="promoAuthModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 16px; border: none; overflow: hidden;">
      <div class="modal-header" style="background: linear-gradient(135deg, var(--accent-color), #7c3aed); color: #fff; border: none; padding: 1.5rem;">
        <div class="d-flex align-items-center gap-3">
          <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; background: rgba(255, 255, 255, 0.2);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
            </svg>
          </div>
          <div>
            <h5 class="modal-title fw-bold mb-0" id="promoAuthModalLabel">–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—É</h5>
            <div class="small opacity-90">–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–Ω–∏–∂–∫–∏</div>
          </div>
        </div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä–∏—Ç–∏"></button>
      </div>
      <div class="modal-body" style="padding: 2rem;">
        <div class="mb-4 p-3 rounded-3" style="background: #f8f9fa;">
          <div class="d-flex gap-2 align-items-start">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="var(--accent-color)" style="flex-shrink: 0; margin-top: 2px;">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            <div class="small text-secondary">
              <strong>–ü—Ä–æ–º–æ–∫–æ–¥–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.</strong><br>
              –¶–µ –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–æ–±—ñ–≥–∞—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è–º.
            </div>
          </div>
        </div>
        
        <div class="d-grid gap-3">
          <a href="{% url 'social:begin' 'google-oauth2' %}?next={{ request.path }}" class="btn btn-lg d-flex align-items-center justify-content-center gap-2" style="background: #fff; border: 2px solid #e9ecef; color: #212529; border-radius: 12px; padding: 0.875rem;">
            <img src="{% static 'img/google.svg' %}" alt="Google" width="20" height="20">
            <span class="fw-semibold">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</span>
          </a>
          
          <div class="text-center text-secondary small">–∞–±–æ</div>
          
          <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-lg d-flex align-items-center justify-content-center gap-2" style="background: linear-gradient(135deg, var(--accent-color), #7c3aed); color: #fff; border: none; border-radius: 12px; padding: 0.875rem;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
            </svg>
            <span class="fw-semibold">–£–≤—ñ–π—Ç–∏ –≤ –∞–∫–∞—É–Ω—Ç</span>
          </a>
          
          <div class="text-center">
            <span class="text-secondary small">–©–µ –Ω–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É?</span>
            <a href="{% url 'register' %}?next={{ request.path }}" class="text-decoration-none fw-semibold small">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</a>
          </div>
        </div>
        
        <div class="mt-4 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(255,107,107,0.1), rgba(124,58,237,0.1)); border: 1px solid rgba(124,58,237,0.2);">
          <div class="d-flex gap-2">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="var(--accent-color)" style="flex-shrink: 0; margin-top: 2px;">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <div class="small">
              <strong class="d-block mb-1">–ü–µ—Ä–µ–≤–∞–≥–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:</strong>
              <ul class="mb-0 ps-3">
                <li>–ù–∞–∫–æ–ø–∏—á—É–π—Ç–µ –±–∞–ª–∏ –∑–∞ –ø–æ–∫—É–ø–∫–∏</li>
                <li>–û—Ç—Ä–∏–º—É–π—Ç–µ –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω—ñ –ø—Ä–æ–º–æ–∫–æ–¥–∏</li>
                <li>–®–≤–∏–¥–∫–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥—ñ–≤ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è applyPromoCode (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ main.js, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º)
  window.applyPromoCodeOriginal = window.applyPromoCode;
  
  window.applyPromoCode = function() {
    const promoInput = document.getElementById('promo-code-input');
    const promoMessage = document.getElementById('promo-message');
    
    if (!promoInput || !promoMessage) {
      return;
    }
    
    const code = promoInput.value.trim();
    
    if (!code) {
      promoMessage.textContent = '–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥—É';
      promoMessage.className = 'cart-promo-message cart-promo-message-error';
      promoMessage.style.display = 'block';
      return;
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
    fetch('{% url "apply_promo_code" %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      },
      body: 'promo_code=' + encodeURIComponent(code)
    })
    .then(response => response.json())
    .then(data => {
      if (data.success || data.ok) {
        // –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω –ø—Ä–æ–º–æ–∫–æ–¥
        promoMessage.textContent = data.message || '–ü—Ä–æ–º–æ–∫–æ–¥ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ!';
        promoMessage.className = 'cart-promo-message cart-promo-message-success';
        promoMessage.style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º UI –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (typeof updateCartSummary === 'function') {
          updateCartSummary({
            subtotal: data.total + (data.discount || 0), // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º subtotal –∏–∑ total + discount
            discount: data.discount || 0,
            total: data.total || 0,
            items: [] // –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ refreshCartItems
          });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥
        const promoInputGroup = document.querySelector('.cart-promo-input-group');
        const promoAppliedDiv = document.querySelector('.cart-promo-applied');
        const promoInput = document.getElementById('promo-code-input');
        
        if (promoInputGroup) {
          promoInputGroup.style.display = 'none';
        }
        if (promoAppliedDiv) {
          promoAppliedDiv.style.display = 'flex';
          const promoCodeEl = promoAppliedDiv.querySelector('.cart-promo-applied-code');
          const promoDiscountEl = promoAppliedDiv.querySelector('.cart-promo-applied-discount');
          if (promoCodeEl) {
            promoCodeEl.textContent = data.promo_code || code;
          }
          if (promoDiscountEl && data.discount) {
            promoDiscountEl.textContent = `–ó–Ω–∏–∂–∫–∞: ${parseFloat(data.discount).toFixed(2)} –≥—Ä–Ω`;
          }
        }
        if (promoInput) {
          promoInput.value = '';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        if (typeof refreshCartItems === 'function') {
          refreshCartItems();
        }
      } else if (data.auth_required) {
        // –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        promoMessage.textContent = data.message || data.error;
        promoMessage.className = 'cart-promo-message cart-promo-message-info';
        promoMessage.style.display = 'block';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const modal = new bootstrap.Modal(document.getElementById('promoAuthModal'));
        modal.show();
      } else {
        // –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
        promoMessage.textContent = data.error || data.message || '–ü–æ–º–∏–ª–∫–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—É';
        promoMessage.className = 'cart-promo-message cart-promo-message-error';
        promoMessage.style.display = 'block';
      }
    })
    .catch(error => {
      promoMessage.textContent = '–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
      promoMessage.className = 'cart-promo-message cart-promo-message-error';
      promoMessage.style.display = 'block';
    });
  };
  
  // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
  window.removePromoCodeOriginal = window.removePromoCode;
  
  window.removePromoCode = function() {
    const promoMessage = document.getElementById('promo-message');
    
    fetch('{% url "remove_promo_code" %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success || data.ok) {
        // –û–±–Ω–æ–≤–ª—è–µ–º UI –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (typeof updateCartSummary === 'function') {
          updateCartSummary({
            subtotal: data.subtotal || data.total || 0,
            discount: data.discount || 0,
            total: data.total || 0,
            items: [] // –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ refreshCartItems
          });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
        const promoAppliedDiv = document.querySelector('.cart-promo-applied');
        const promoInputGroup = document.querySelector('.cart-promo-input-group');
        const promoMessageEl = document.getElementById('promo-message');
        
        if (promoAppliedDiv) {
          promoAppliedDiv.style.display = 'none';
        }
        if (promoInputGroup) {
          promoInputGroup.style.display = 'flex';
        }
        if (promoMessageEl) {
          promoMessageEl.textContent = data.message || '–ü—Ä–æ–º–æ–∫–æ–¥ –≤–∏–¥–∞–ª–µ–Ω–æ';
          promoMessageEl.className = 'cart-promo-message cart-promo-message-success';
          promoMessageEl.style.display = 'block';
          setTimeout(() => {
            promoMessageEl.style.display = 'none';
          }, 3000);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        if (typeof refreshCartItems === 'function') {
          refreshCartItems();
        }
      } else {
        if (promoMessage) {
          promoMessage.textContent = data.error || '–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ–º–æ–∫–æ–¥—É';
          promoMessage.className = 'cart-promo-message cart-promo-message-error';
          promoMessage.style.display = 'block';
        }
      }
    })
    .catch(error => {
      if (promoMessage) {
        promoMessage.textContent = '–ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è';
        promoMessage.className = 'cart-promo-message cart-promo-message-error';
        promoMessage.style.display = 'block';
      }
    });
  };
  
  // ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–ò (–ö–ê–ö –í DROPSHIPPER) ====================
  const contactBtns = document.querySelectorAll('#contactManagerBtn, #contactManagerBtnGuest');
  const modal = document.getElementById('contactManagerModal');
  const modalClose = document.querySelector('.contact-modal-close');
  const modalForm = document.getElementById('contactManagerForm');
  
  // –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  function openContactModal() {
    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ —Ñ–æ—Ä–º—ã –¥–æ—Å—Ç–∞–≤–∫–∏
    const isAuth = document.getElementById('pay_type_auth') !== null;
    
    if (isAuth) {
      const fullNameInput = document.querySelector('[name="full_name"]');
      const phoneInput = document.querySelector('[name="phone"]');
      
      if (fullNameInput && fullNameInput.value) {
        document.getElementById('contactModalFullName').value = fullNameInput.value;
      }
      if (phoneInput && phoneInput.value) {
        document.getElementById('contactModalPhone').value = phoneInput.value;
      }
    } else {
      // –î–ª—è –≥–æ—Å—Ç–µ–π –∏–∑ guest-form
      const guestForm = document.getElementById('guest-form');
      if (guestForm) {
        const fullNameInput = guestForm.querySelector('[name="full_name"]');
        const phoneInput = guestForm.querySelector('[name="phone"]');
        
        if (fullNameInput && fullNameInput.value) {
          document.getElementById('contactModalFullName').value = fullNameInput.value;
        }
        if (phoneInput && phoneInput.value) {
          document.getElementById('contactModalPhone').value = phoneInput.value;
        }
      }
    }
    
    // –ö–†–ò–¢–ò–ß–ù–û: –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –Ω–∞ body –∫–æ—Ç–æ—Ä—ã–π —É–±–∏—Ä–∞–µ—Ç position: relative —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    // –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–º—É –æ–∫–Ω—É —Å position: fixed –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ viewport
    document.body.classList.add('contact-modal-open');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è CSS transition)
    setTimeout(() => {
      modal.classList.add('modal-active');
    }, 10);
  }
  
  // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  function closeContactModal() {
    // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
    modal.classList.remove('modal-active');
    
    // –ö–†–ò–¢–ò–ß–ù–û: –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å —Å body —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å position: relative –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º
    document.body.classList.remove('contact-modal-open');
    
    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ (300ms) –ø–µ—Ä–µ–¥ —Å–∫—Ä—ã—Ç–∏–µ–º
    setTimeout(() => {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }, 300);
  }
  
  // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
  contactBtns.forEach(btn => {
    btn.addEventListener('click', openContactModal);
  });
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
  if (modalClose) {
    modalClose.addEventListener('click', closeContactModal);
  }
  
  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª–∫–∏
  window.addEventListener('click', function(event) {
    if (event.target === modal) {
      closeContactModal();
    }
  });
  
  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Å–≤—è–∑–∏ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
  if (modalForm) {
    modalForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(modalForm);
      const submitBtn = modalForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      
      submitBtn.disabled = true;
      submitBtn.textContent = '–í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ...';
      
      fetch('{% url "contact_manager" %}', {
        method: 'POST',
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('‚úÖ –î—è–∫—É—î–º–æ! –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–≤\'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.');
          closeContactModal();
          modalForm.reset();
        } else {
          alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + (data.error || '–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑'));
        }
      })
      .catch(error => {
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
      })
      .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      });
    });
  }
});
</script>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–≤—è–∑–∏ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
<style>
.btn-contact-manager {
  width: 100%;
  padding: 14px 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-contact-manager:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.btn-contact-manager:active {
  transform: translateY(0);
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
/* ========== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–ò (–¢–ï–ú–ù–´–ô –î–ò–ó–ê–ô–ù –ö–ê–ö DROPSHIPPER) ========== */

/* –ö–†–ò–¢–ò–ß–ù–û: –£–±–∏—Ä–∞–µ–º position: relative —É –í–°–ï–• –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ */
/* –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–º—É –æ–∫–Ω—É —Å position: fixed –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ viewport, –∞ –Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
body.contact-modal-open,
body.contact-modal-open .cart-page-container,
body.contact-modal-open .cart-container,
body.contact-modal-open main,
body.contact-modal-open .container,
body.contact-modal-open .container-fluid,
body.contact-modal-open .container-xxl,
body.contact-modal-open [class*="container"] {
  position: static !important;
}

/* –£–±–∏—Ä–∞–µ–º –ø—Å–µ–≤–¥–æ—ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å position: fixed */
body.contact-modal-open .cart-page-container::before,
body.contact-modal-open .cart-page-container::after,
body.contact-modal-open .cart-container::before,
body.contact-modal-open .cart-container::after {
  display: none !important;
}

.contact-modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(10px);
  z-index: 10000;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.contact-modal-overlay.modal-active {
  opacity: 1;
}

.contact-modal-container {
  position: relative;
  background: linear-gradient(135deg, rgba(20,22,27,.98), rgba(14,16,22,.98));
  border: 1px solid rgba(255,255,255,.1);
  border-radius: 20px;
  max-width: 500px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 
    0 25px 60px rgba(0,0,0,.6),
    0 0 80px rgba(139, 92, 246, 0.15),
    inset 0 1px 0 rgba(255,255,255,.05);
  color: #e5e7eb;
  transform: scale(0.8);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.contact-modal-overlay.modal-active .contact-modal-container {
  transform: scale(1);
  opacity: 1;
}

/* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
.contact-modal-container::-webkit-scrollbar {
  width: 8px;
}

.contact-modal-container::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

.contact-modal-container::-webkit-scrollbar-thumb {
  background: rgba(139, 92, 246, 0.5);
  border-radius: 10px;
}

.contact-modal-container::-webkit-scrollbar-thumb:hover {
  background: rgba(139, 92, 246, 0.7);
}

.contact-modal-header {
  padding: 30px 30px 20px;
  border-bottom: 1px solid rgba(255,255,255,.08);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(180deg, rgba(139, 92, 246, 0.08) 0%, transparent 100%);
}

.contact-modal-header h3 {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
  color: #e5e7eb;
  text-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
}

.contact-modal-close {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  color: rgba(255, 255, 255, 0.6);
}

.contact-modal-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  transform: rotate(90deg);
  border-color: rgba(139, 92, 246, 0.5);
  box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
}

.contact-modal-body {
  padding: 30px;
}

.contact-modal-body > p {
  margin-bottom: 1.5rem;
  color: rgba(255, 255, 255, 0.6);
  text-align: center;
  font-size: 14px;
  line-height: 1.6;
}

.contact-modal-form-group {
  margin-bottom: 20px;
}

.contact-modal-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 12px;
}

.contact-modal-label span {
  color: #ef4444;
}

.contact-modal-input {
  width: 100%;
  padding: 14px 18px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 12px;
  font-size: 15px;
  transition: all 0.3s ease;
  background: rgba(255, 255, 255, 0.05);
  color: #e5e7eb;
  font-family: inherit;
}

.contact-modal-input:focus {
  outline: none;
  border-color: rgba(139, 92, 246, 0.6);
  background: rgba(255, 255, 255, 0.08);
  box-shadow: 
    0 0 0 3px rgba(139, 92, 246, 0.15),
    0 0 20px rgba(139, 92, 246, 0.2);
  transform: translateY(-1px);
}

.contact-modal-input::placeholder {
  color: rgba(255, 255, 255, 0.35);
}

.contact-modal-help-text {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.45);
  margin-top: 6px;
  font-style: italic;
}

.contact-modal-submit-btn {
  width: 100%;
  padding: 16px 24px;
  background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 
    0 4px 15px rgba(139, 92, 246, 0.4),
    0 0 30px rgba(139, 92, 246, 0.2);
  margin-top: 10px;
  position: relative;
  overflow: hidden;
}

.contact-modal-submit-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s;
}

.contact-modal-submit-btn:hover::before {
  left: 100%;
}

.contact-modal-submit-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 
    0 8px 25px rgba(139, 92, 246, 0.5),
    0 0 40px rgba(139, 92, 246, 0.3);
}

.contact-modal-submit-btn:active:not(:disabled) {
  transform: translateY(0);
}

.contact-modal-submit-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .contact-modal-container {
    border-radius: 20px 20px 0 0;
    max-height: 85vh;
    max-width: 100%;
  }
  
  .contact-modal-header {
    padding: 20px 20px 15px;
  }
  
  .contact-modal-header h3 {
    font-size: 20px;
  }
  
  .contact-modal-body {
    padding: 20px;
  }
  
  .contact-modal-input {
    padding: 12px 16px;
  }
  
  .contact-modal-submit-btn {
    padding: 14px 20px;
  }
}
</style>

{% endblock %}

{% extends 'base.html' %}
{% load static %}
{% load math_filters %}
{% load responsive_images %}

{% block title %}–ö–æ—à–∏–∫ ‚Äî TwoComms{% endblock %}

{% block content %}
{% csrf_token %}

<!-- –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<div class="cart-page-sparks">
  <div class="cart-page-spark cart-page-spark-1"></div>
  <div class="cart-page-spark cart-page-spark-2"></div>
  <div class="cart-page-spark cart-page-spark-3"></div>
  <div class="cart-page-spark cart-page-spark-4"></div>
  <div class="cart-page-spark cart-page-spark-5"></div>
  <div class="cart-page-spark cart-page-spark-6"></div>
</div>

<div class="cart-page-container"
     data-cart-items-url="{% url 'cart_items_api' %}"
     data-cart-summary-url="{% url 'cart_summary' %}"
     data-contact-url="{% url 'contact_manager' %}">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div class="cart-page-header">
    <div class="cart-page-header-icon">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
        <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
      </svg>
    </div>
    <div class="cart-page-header-content">
      <h1 class="cart-page-title">–ö–æ—à–∏–∫</h1>
      <p class="cart-page-subtitle">–í–∞—à—ñ –≤–∏–±—Ä–∞–Ω—ñ —Ç–æ–≤–∞—Ä–∏</p>
    </div>
    {% if items %}
    <button type="button" class="cart-clear-btn" onclick="cleanCart()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
      </svg>
      –û—á–∏—Å—Ç–∏—Ç–∏
    </button>
    {% endif %}
  </div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
  {% if messages %}
    {% for message in messages %}
      <div class="cart-message cart-message-{{ message.tags }}">
        <div class="cart-message-icon">
          {% if message.tags == 'success' %}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
          {% elif message.tags == 'error' %}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          {% else %}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
          {% endif %}
        </div>
        <div class="cart-message-text">{{ message }}</div>
        <button type="button" class="cart-message-close" onclick="this.parentElement.remove()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="cart-page-content">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å –∫–æ—Ä–∑–∏–Ω—ã -->
    <div class="cart-main-section">
      {% if items %}
        <div class="cart-items-background">
          <div class="cart-items-pattern"></div>
        </div>
        <div class="cart-items-container" id="cart-list" data-placeholder="{% static 'img/placeholder.jpg' %}">
          {% for it in items %}
            <div class="cart-item" data-cart-row data-key="{{ it.key }}" data-offer-id="{{ it.offer_id }}">
              <!-- –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å–∫—Ä –¥–ª—è —Ç–æ–≤–∞—Ä–∞ -->
              <div class="cart-item-sparks">
                <div class="cart-item-spark cart-item-spark-1"></div>
                <div class="cart-item-spark cart-item-spark-2"></div>
                <div class="cart-item-spark cart-item-spark-3"></div>
              </div>
              
              <div class="cart-item-image">
                {% if it.color_variant and it.color_variant.images.exists %}
                  <img src="{{ it.color_variant.images.first.image.url }}" 
                       alt="{{ it.product.title }} - —Ç–æ–≤–∞—Ä —É –∫–æ—à–∏–∫—É TwoComms" 
                       class="cart-item-img"
                       width="80" height="80">
                {% elif it.product.main_image %}
                  <img src="{{ it.product.main_image.url }}" 
                       alt="{{ it.product.title }} - —Ç–æ–≤–∞—Ä —É –∫–æ—à–∏–∫—É TwoComms" 
                       class="cart-item-img"
                       width="80" height="80">
                {% else %}
                  {% static 'img/placeholder.jpg' as ph_url %}
                  <img src="{{ ph_url }}" 
                       alt="{{ it.product.title }} - —Ç–æ–≤–∞—Ä —É –∫–æ—à–∏–∫—É TwoComms" 
                       class="cart-item-img"
                       width="80" height="80">
                {% endif %}
                <div class="cart-item-image-glow"></div>
              </div>
              
              <div class="cart-item-info">
                <h3 class="cart-item-title">{{ it.product.title }}</h3>
                <div class="cart-item-details">
                  <div class="cart-item-detail">
                    <span class="cart-item-label">–†–æ–∑–º—ñ—Ä:</span>
                    <span class="cart-item-value">{{ it.size }}</span>
                  </div>
                  <div class="cart-item-detail">
                    <span class="cart-item-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                    <span class="cart-item-value">{{ it.qty }}</span>
                  </div>
                  {% if it.color_variant %}
                  <div class="cart-item-detail">
                    <span class="cart-item-label">–ö–æ–ª—ñ—Ä:</span>
                    <div class="cart-item-color d-flex align-items-center gap-2">
                      {% with p=it.color_variant.color.primary_hex s=it.color_variant.color.secondary_hex %}
                      <span class="cart-item-swatch swatch"
                            data-primary="{{ p }}"
                            data-secondary="{{ s|default:'' }}">
                      </span>
                      {% endwith %}
                      <span class="cart-item-color-name">{{ it.color_label|default:'‚Äî' }}</span>
                    </div>
                  </div>
                  {% endif %}
                </div>
                <div class="cart-item-price">
                  <span class="cart-item-price-label">–¶—ñ–Ω–∞:</span>
                  <span class="cart-item-price-value">
                    {% if it.original_unit_price and it.original_unit_price > it.unit_price %}
                      <span class="cart-item-price-old">{{ it.original_unit_price|floatformat:2 }} –≥—Ä–Ω</span>
                    {% endif %}
                    <span class="cart-item-price-current">{{ it.unit_price|floatformat:2 }} –≥—Ä–Ω</span>
                  </span>
                </div>
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–ª–ª–∞—Ö -->
                <div class="cart-item-points">
                  <div class="cart-item-points-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  </div>
                  <span class="cart-item-points-text">
                    {% if it.product.points_reward %}
                      –ó–∞—Ä–æ–±–∏—Ç–µ {{ it.product.points_reward|multiply:it.qty }} –±–∞–ª—ñ–≤
                    {% else %}
                      –ë–∞–ª–∏ –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è
                    {% endif %}
                  </span>
                </div>
              </div>
              
                <div class="cart-item-actions">
                  <div class="cart-item-total">
                    <span class="cart-item-total-label">–†–∞–∑–æ–º:</span>
                    <span class="cart-item-total-value">{{ it.line_total|floatformat:2 }} –≥—Ä–Ω</span>
                  </div>
                <button type="button" class="cart-item-remove-btn" data-key="{{ it.key }}">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                  –í–∏–¥–∞–ª–∏—Ç–∏
                </button>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="cart-empty">
          <div class="cart-empty-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
          </div>
          <h2 class="cart-empty-title">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</h2>
          <p class="cart-empty-text">–î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –¥–æ –∫–æ—à–∏–∫–∞, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
          <a href="{% url 'home' %}" class="cart-empty-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–æ–∫—É–ø–æ–∫
          </a>
        </div>
      {% endif %}
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="cart-sidebar">
      {% if request.user.is_authenticated %}
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –î–æ—Å—Ç–∞–≤–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
        <div class="cart-sidebar-card">
          <div class="cart-sidebar-card-header">
            <div class="cart-sidebar-card-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
              </svg>
            </div>
            <h3 class="cart-sidebar-card-title">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
          </div>
          
          {% with prof=request.user.userprofile %}
          <form method="post" class="cart-sidebar-form" id="deliveryForm" novalidate>
            {% csrf_token %}
            <input type="hidden" name="form_type" value="update_profile" id="form_type_input">
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ü–Ü–ë *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="full_name" class="cart-form-input" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ"
                       value="{{ prof.full_name|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
              <div class="cart-form-input-wrapper">
                <input type="tel" name="phone" class="cart-form-input" placeholder="+380XXXXXXXXX"
                       value="{{ prof.phone|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ú—ñ—Å—Ç–æ *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="city" class="cart-form-input" placeholder="–ö–∏—ó–≤"
                       value="{{ prof.city|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è / –ü–æ—à—Ç–æ–º–∞—Ç –ù–ü *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="np_office" class="cart-form-input" placeholder="‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –∞–±–æ –∞–¥—Ä–µ—Å–∞ –ø–æ—à—Ç–æ–º–∞—Ç–∞"
                       value="{{ prof.np_office|default:'' }}" required>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–∏–ø –æ–ø–ª–∞—Ç–∏ *</label>
              <div class="cart-form-input-wrapper">
                <select name="pay_type" class="cart-form-select" id="pay_type_auth" required aria-label="–¢–∏–ø –æ–ø–ª–∞—Ç–∏">
                  <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –æ–ø–ª–∞—Ç–∏</option>
                  <option value="online_full">–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ (–ø–æ–≤–Ω–∞ —Å—É–º–∞)</option>
                  <option value="prepay_200">–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω (—Ä–µ—à—Ç–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ)</option>
                </select>
                <div class="cart-form-input-glow"></div>
              </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ -->
            <div class="cart-form-group">
              <button type="button" class="btn-contact-manager" id="contactManagerBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                  <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                  <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                </svg>
                üí¨ –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è?
              </button>
            </div>
            
            <button type="submit" class="cart-form-save-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
              –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
            </button>
          </form>
          {% endwith %}
        </div>
      {% else %}
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –î–æ—Å—Ç–∞–≤–∫–∞ –¥–ª—è –≥–æ—Å—Ç–µ–π -->
        <div class="cart-sidebar-card">
          <div class="cart-sidebar-card-header">
            <div class="cart-sidebar-card-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h4c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
              </svg>
            </div>
            <h3 class="cart-sidebar-card-title">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
            <a href="{% url 'login' %}" class="cart-auth-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z"/>
              </svg>
              –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
            </a>
          </div>
          
          <div class="cart-sidebar-card-hint">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            –©–æ–± –Ω–µ –≤–≤–æ–¥–∏—Ç–∏ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É ‚Äî –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —ñ –Ω–∞–∫–æ–ø–∏—á—É–π—Ç–µ –±–∞–ª–∏.
          </div>
          
          <form method="post" class="cart-sidebar-form" id="guest-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="guest_order">
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ü–Ü–ë *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="full_name" class="cart-form-input" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.full_name.errors %}
                <div class="cart-form-error">{{ guest_form.full_name.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
              <div class="cart-form-input-wrapper">
                <input type="tel" name="phone" class="cart-form-input" placeholder="+380XXXXXXXXX" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.phone.errors %}
                <div class="cart-form-error">{{ guest_form.phone.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="cart-form-group">
              <label class="cart-form-label">Email (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
              <div class="cart-form-input-wrapper">
                <input type="email" name="email" class="cart-form-input" placeholder="your@email.com">
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.email.errors %}
                <div class="cart-form-error">{{ guest_form.email.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–ú—ñ—Å—Ç–æ *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="city" class="cart-form-input" placeholder="–ö–∏—ó–≤" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.city.errors %}
                <div class="cart-form-error">{{ guest_form.city.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è / –ü–æ—à—Ç–æ–º–∞—Ç –ù–ü *</label>
              <div class="cart-form-input-wrapper">
                <input type="text" name="np_office" class="cart-form-input" placeholder="‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –∞–±–æ –∞–¥—Ä–µ—Å–∞ –ø–æ—à—Ç–æ–º–∞—Ç–∞" required>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.np_office.errors %}
                <div class="cart-form-error">{{ guest_form.np_office.errors.0 }}</div>
              {% endif %}
            </div>
            
            <div class="cart-form-group">
              <label class="cart-form-label">–¢–∏–ø –æ–ø–ª–∞—Ç–∏ *</label>
              <div class="cart-form-input-wrapper">
                <select name="pay_type" class="cart-form-select" id="pay_type_guest" required aria-label="–¢–∏–ø –æ–ø–ª–∞—Ç–∏">
                  <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –æ–ø–ª–∞—Ç–∏</option>
                  <option value="online_full">–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ (–ø–æ–≤–Ω–∞ —Å—É–º–∞)</option>
                  <option value="prepay_200">–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω (—Ä–µ—à—Ç–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ)</option>
                </select>
                <div class="cart-form-input-glow"></div>
              </div>
              {% if guest_form.pay_type.errors %}
                <div class="cart-form-error">{{ guest_form.pay_type.errors.0 }}</div>
              {% endif %}
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ -->
            <div class="cart-form-group">
              <button type="button" class="btn-contact-manager" id="contactManagerBtnGuest">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
                  <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                  <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                </svg>
                üí¨ –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è?
              </button>
            </div>
          </form>
        </div>
      {% endif %}

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –ü—Ä–æ–º–æ–∫–æ–¥ -->
      <div class="cart-sidebar-card">
        <div class="cart-sidebar-card-header">
          <div class="cart-sidebar-card-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
            </svg>
          </div>
          <h3 class="cart-sidebar-card-title">–ü—Ä–æ–º–æ–∫–æ–¥</h3>
          {% if applied_promo %}
            <span class="cart-promo-badge">–ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ</span>
          {% endif %}
        </div>
        
        {% if applied_promo %}
          <div class="cart-promo-applied">
            <div class="cart-promo-applied-content">
              <div class="cart-promo-applied-code">{{ applied_promo.code }}</div>
              <div class="cart-promo-applied-discount">–ó–Ω–∏–∂–∫–∞: {{ discount }} –≥—Ä–Ω</div>
            </div>
            <button type="button" class="cart-promo-remove-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
              </svg>
            </button>
          </div>
        {% else %}
          <div class="cart-promo-input-group">
            <div class="cart-promo-input-wrapper">
              <input type="text" id="promo-code-input" class="cart-promo-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥—É" maxlength="20">
              <div class="cart-promo-input-glow"></div>
            </div>
            <button type="button" class="cart-promo-apply-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </button>
          </div>
          <div id="promo-message" class="cart-promo-message"></div>
        {% endif %}
      </div>

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
      <div class="cart-checkout-card">
        <div class="cart-checkout-header">
          <div class="cart-checkout-header-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </div>
          <div class="cart-checkout-header-content">
            <h3 class="cart-checkout-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
            <p class="cart-checkout-subtitle">–ü—ñ–¥—Å—É–º–æ–∫ –≤–∞—à–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
          </div>
        </div>
        
        <div class="cart-checkout-summary" id="cart-summary">
          <div class="cart-summary-row">
            <span class="cart-summary-label" id="cart-items-label">–¢–æ–≤–∞—Ä–∏ ({{ items_total_qty|default:cart_count }}):</span>
            <span class="cart-summary-value" id="cart-subtotal-value">{{ original_subtotal|floatformat:2 }} –≥—Ä–Ω</span>
          </div>
          
          <div class="cart-summary-row cart-summary-site-discount {% if site_discount_total <= 0 %}d-none{% endif %}" id="cart-site-discount-row">
            <span class="cart-summary-label">–ó–Ω–∏–∂–∫–∞ –º–∞–≥–∞–∑–∏–Ω—É</span>
            <span class="cart-summary-value" id="cart-site-discount-value">-{{ site_discount_total|floatformat:2 }} –≥—Ä–Ω</span>
          </div>
          
          <div class="cart-summary-row cart-summary-discount {% if discount <= 0 %}d-none{% endif %}" id="cart-discount-row">
            <span class="cart-summary-label">
              <div class="cart-discount-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77–ª-6.18 3.25–õ7 14.14 2 9.27–ª6.91-1.01–õ12 2z"/>
                </svg>
                –ó–Ω–∏–∂–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥—É
              </div>
            </span>
            <span class="cart-summary-value" id="cart-discount-value">-{{ discount|floatformat:2 }} –≥—Ä–Ω</span>
          </div>
          
          <div class="cart-summary-row cart-summary-total" id="pay-now-row">
            <span class="cart-summary-label" id="pay-now-label">–î–æ —Å–ø–ª–∞—Ç–∏:</span>
            <span class="cart-summary-value"
                  id="pay-now-amount"
                  data-total="{{ total|floatformat:'2' }}"
                  data-prepay="200">{% if pay_now_amount %}{{ pay_now_amount|floatformat:2 }} –≥—Ä–Ω{% else %}{{ total|floatformat:2 }} –≥—Ä–Ω{% endif %}</span>
          </div>
          <div class="cart-summary-row cart-summary-prepay d-none" id="prepay-remaining-row">
            <span class="cart-summary-label">–ó–∞–ª–∏—à–æ–∫ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ:</span>
            <span class="cart-summary-value" id="prepay-remaining-amount">{{ total|floatformat:2 }} –≥—Ä–Ω</span>
          </div>
          <p class="cart-summary-note d-none" id="prepay-note">
            –¶–µ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –¥–ª—è –≤–∞—Å ‚Äî —Ä–µ—à—Ç—É —Å–ø–ª–∞—Ç–∏—Ç–µ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ.
          </p>
        </div>
        
        <div class="cart-savings-info {% if site_discount_total <= 0 and discount <= 0 %}d-none{% endif %}" id="cart-savings-info">
          <div class="cart-savings-line {% if site_discount_total <= 0 %}d-none{% endif %}" id="cart-savings-site">
            <span class="cart-savings-label">–ó–Ω–∏–∂–∫–∞ –≤—ñ–¥ TwoComms</span>
            <span class="cart-savings-amount" id="cart-savings-site-amount">{{ site_discount_total|floatformat:2 }} –≥—Ä–Ω</span>
          </div>
          <div class="cart-savings-line {% if discount <= 0 %}d-none{% endif %}" id="cart-savings-promo">
            <span class="cart-savings-label">
              –ü—Ä–æ–º–æ–∫–æ–¥ <span class="cart-savings-highlight" id="cart-savings-promo-code">{% if promo_code %}{{ promo_code.code }}{% endif %}</span>
            </span>
            <span class="cart-savings-amount" id="cart-savings-promo-amount">{{ discount|floatformat:2 }} –≥—Ä–Ω</span>
          </div>
          <div class="cart-savings-total {% if site_discount_total <= 0 and discount <= 0 %}d-none{% endif %}" id="cart-savings-total">
            <span class="cart-savings-label">–†–∞–∑–æ–º –≤–∏ –µ–∫–æ–Ω–æ–º–∏—Ç–µ</span>
            <span class="cart-savings-amount" id="cart-savings-total-amount">{{ total_savings|floatformat:2 }} –≥—Ä–Ω</span>
          </div>
        </div>
        
        <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –±–∞–ª–∏ -->
        <div class="cart-points-summary" id="cart-points-summary" data-authenticated="{{ request.user.is_authenticated|yesno:'1,0' }}">
          <div class="cart-points-header">
            <div class="cart-points-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27–ª-5 4.87 1.18 6.88–õ12 17.77–ª-6.18 3.25–õ7 14.14 2 9.27–ª6.91-1.01–õ12 2z"/>
              </svg>
            </div>
            <span class="cart-points-title">–ë–∞–ª–∏ –∑–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
          </div>
          <div class="cart-points-earned {% if total_points <= 0 %}d-none{% endif %}" id="cart-points-earned">
            <span class="cart-points-amount" id="cart-points-amount">+{{ total_points }} –±–∞–ª—ñ–≤</span>
            <span class="cart-points-description">–±—É–¥–µ –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É</span>
          </div>
          <div class="cart-points-none {% if total_points > 0 %}d-none{% endif %}" id="cart-points-none">
            <span class="cart-points-text">–ë–∞–ª–∏ –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è</span>
          </div>
          {% if not request.user.is_authenticated %}
          <div class="cart-points-guest" id="cart-points-guest">
            <div class="cart-points-guest-info">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2–≤6zm0-8h-2V7h2–≤2–∑"/>
              </svg>
              <span>–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è</span>
            </div>
            <a href="{% url 'login' %}" class="cart-points-login-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11 7L9.6 8.4–ª2.6 2.6H2v2h10.2–ª-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8–≤14–∑"/>
              </svg>
              –ê–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è
            </a>
          </div>
          {% endif %}
        </div>
        
        <div class="cart-delivery-info">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
          </svg>
          –î–æ—Å—Ç–∞–≤–∫–∞ –æ–ø–ª–∞—á—É—î—Ç—å—Å—è –∑–≥—ñ–¥–Ω–æ —Ç–∞—Ä–∏—Ñ—ñ–≤ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞.
        </div>

<div class="cart-checkout-actions">
  <!-- Monobank –æ–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ -->
  <div class="cart-monobank-container" data-mono-status-scope>
    <button type="button" id="monobank-pay-btn" class="cart-monobank-btn" data-monobank-pay-trigger="cart">
      <span class="cart-monobank-logo" aria-hidden="true">
        <span class="mono">mono</span><span class="dot">¬∑</span><span class="pay">pay</span>
      </span>
      <span class="cart-monobank-details">
        <span class="cart-monobank-text">–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–∫–æ—é</span>
        <span class="cart-monobank-badges" aria-hidden="true">
          <span class="cart-monobank-badge cart-monobank-badge-gpay" role="presentation">
            <span class="badge-symbol">G</span>
            <span class="badge-text">Pay</span>
          </span>
          <span class="cart-monobank-badge cart-monobank-badge-apple" role="presentation">
            <span class="badge-symbol" aria-hidden="true">Ô£ø</span>
            <span class="badge-text">Pay</span>
          </span>
        </span>
      </span>
      <span class="cart-monobank-spinner" aria-hidden="true"></span>
    </button>
    <div id="monobank-pay-status" class="cart-monobank-status text-secondary" data-mono-checkout-status role="status" aria-live="polite"></div>
  </div>



          {% if request.user.is_authenticated %}
            <button type="button" class="cart-checkout-btn" id="placeOrderBtn" data-monobank-pay-trigger="cart">
              <div class="cart-checkout-btn-content">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                <span>–û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
              </div>
              <div class="cart-checkout-btn-glow"></div>
            </button>
          {% else %}
            <button type="button" class="cart-checkout-btn cart-checkout-btn-guest" id="guestOrderBtn" data-monobank-pay-trigger="cart">
              <div class="cart-checkout-btn-content">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27–ª-5 4.87 1.18 6.88L12 17.77–ª-6.18 3.25–õ7 14.14 2 9.27–ª6.91-1.01L12 2z"/>
                </svg>
                <span>–ó–∞–º–æ–≤–∏—Ç–∏ —è–∫ –≥—ñ—Å—Ç—å</span>
              </div>
              <div class="cart-checkout-btn-glow"></div>
            </button>
          {% endif %}
          <div class="cart-checkout-note text-secondary mt-3">
            –ü—ñ—Å–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –º–µ–Ω–µ–¥–∂–µ—Ä –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –∑–∞ –≤–∫–∞–∑–∞–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É, —â–æ–± –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –¥–µ—Ç–∞–ª—ñ —Ç–∞ —É–∑–≥–æ–¥–∏—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫—É.
          </div>
        </div>


      </div>
    </div>
  </div>
</div>

<!-- Hidden element for checkout analytics payload -->
{% if checkout_payload %}
<div id="checkout-payload"
     data-contents="{{ checkout_payload_contents|urlencode }}"
     data-ids="{{ checkout_payload_ids|urlencode }}"
     data-value="{{ checkout_payload_value }}"
     data-currency="{{ checkout_payload.currency|default:'UAH' }}"
     data-num-items="{{ checkout_payload_num_items }}"
     style="display:none;"></div>
{% endif %}

{% endblock %}

{% block modals %}
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ (–í–ù–ï main –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è!) -->
<div id="contactManagerModal" class="contact-modal-overlay" aria-hidden="true" role="dialog" aria-labelledby="contactModalTitle">
  <div class="contact-modal-container">
    <div class="contact-modal-header">
      <h3 id="contactModalTitle">üí¨ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è</h3>
      <button type="button" class="contact-modal-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">&times;</button>
    </div>
    <div class="contact-modal-body">
      <p style="margin-bottom: 1.5rem; color: #64748b; text-align: center;">–ó–∞–ª–∏—à—Ç–µ —Å–≤–æ—ó –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ, —ñ –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó</p>
      <form id="contactManagerForm">
        {% csrf_token %}
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalFullName">
            –ü–Ü–ë <span style="color: #e53e3e;">*</span>
          </label>
          <input 
            type="text" 
            id="contactModalFullName" 
            name="full_name" 
            class="contact-modal-input" 
            placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ü–Ü–ë" 
            required
            minlength="3"
          >
        </div>
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalPhone">
            –¢–µ–ª–µ—Ñ–æ–Ω <span style="color: #e53e3e;">*</span>
          </label>
          <input 
            type="tel" 
            id="contactModalPhone" 
            name="phone" 
            class="contact-modal-input" 
            placeholder="+380 XX XXX XX XX" 
            required
            pattern="[+]?[0-9\s\-\(\)]+"
          >
        </div>
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalTelegram">
            Telegram
          </label>
          <input 
            type="text" 
            id="contactModalTelegram" 
            name="telegram" 
            class="contact-modal-input" 
            placeholder="@username –∞–±–æ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É"
          >
          <div class="contact-modal-help-text">–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –∞–ª–µ –¥–æ–ø–æ–º–æ–∂–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è —à–≤–∏–¥—à–µ</div>
        </div>
        
        <div class="contact-modal-form-group">
          <label class="contact-modal-label" for="contactModalWhatsApp">
            WhatsApp
          </label>
          <input 
            type="tel" 
            id="contactModalWhatsApp" 
            name="whatsapp" 
            class="contact-modal-input" 
            placeholder="+380 XX XXX XX XX"
            pattern="[+]?[0-9\s\-\(\)]+"
          >
          <div class="contact-modal-help-text">–û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ</div>
        </div>
        
        <button type="submit" class="contact-modal-submit-btn">
          üì≤ –ó–≤'—è–∑–∞—Ç–∏—Å—è –∑—ñ –º–Ω–æ—é
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.cart-savings-info {
  margin-top: 18px;
  padding: 14px 18px;
  background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
  border-radius: 14px;
  border: 1px solid rgba(79, 70, 229, 0.15);
  color: #1f2937;
  font-size: 14px;
  display: grid;
  row-gap: 10px;
  line-height: 1.4;
}

.cart-savings-line {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  font-weight: 500;
}

.cart-savings-total {
  margin-top: 6px;
  font-weight: 600;
  font-size: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  padding-top: 8px;
  border-top: 1px solid rgba(79, 70, 229, 0.12);
}

.cart-savings-amount {
  font-weight: 600;
  color: #2563eb;
}

.cart-savings-label {
  color: #4b5563;
  font-weight: 600;
}

.cart-savings-highlight {
  font-weight: 600;
  color: #111827;
}

.cart-item-price-old {
  text-decoration: line-through;
  color: #9ca3af;
  margin-right: 8px;
  font-weight: 500;
}

.cart-item-price-current {
  font-weight: 600;
}

.cart-points-icon {
  color: #f59e0b;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.cart-points-icon svg {
  width: 18px;
  height: 18px;
}

.btn-contact-manager {
  width: 100%;
  padding: 14px 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-contact-manager:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.btn-contact-manager:active {
  transform: translateY(0);
}

body.contact-modal-open,
body.contact-modal-open .cart-page-container,
body.contact-modal-open .cart-container,
body.contact-modal-open main,
body.contact-modal-open .container,
body.contact-modal-open .container-fluid,
body.contact-modal-open .container-xxl,
body.contact-modal-open [class*="container"] {
  position: static !important;
}

body.contact-modal-open .cart-page-container::before,
body.contact-modal-open .cart-page-container::after,
body.contact-modal-open .cart-container::before,
body.contact-modal-open .cart-container::after {
  display: none !important;
}

.contact-modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.85);
  backdrop-filter: blur(10px);
  z-index: 10000;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.contact-modal-overlay.modal-active {
  opacity: 1;
}

.contact-modal-container {
  position: relative;
  background: linear-gradient(135deg, rgba(20,22,27,.98), rgba(14,16,22,.98));
  border: 1px solid rgba(255,255,255,.1);
  border-radius: 20px;
  max-width: 500px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 
    0 25px 60px rgba(0,0,0,.6),
    0 0 80px rgba(139, 92, 246, 0.15),
    inset 0 1px 0 rgba(255,255,255,.05);
  color: #e5e7eb;
  transform: scale(0.8);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.contact-modal-overlay.modal-active .contact-modal-container {
  transform: scale(1);
  opacity: 1;
}

.contact-modal-container::-webkit-scrollbar {
  width: 8px;
}

.contact-modal-container::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

.contact-modal-container::-webkit-scrollbar-thumb {
  background: rgba(139, 92, 246, 0.5);
  border-radius: 10px;
}

.contact-modal-container::-webkit-scrollbar-thumb:hover {
  background: rgba(139, 92, 246, 0.7);
}

.contact-modal-header {
  padding: 30px 30px 20px;
  border-bottom: 1px solid rgba(255,255,255,.08);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: linear-gradient(180deg, rgba(139, 92, 246, 0.08) 0%, transparent 100%);
}

.contact-modal-header h3 {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
  color: #e5e7eb;
  text-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
}

.contact-modal-close {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  width: 36px;
  height: 36px;
  border-radius: 50%;
  font-size: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  color: rgba(255, 255, 255, 0.6);
}

.contact-modal-close:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  transform: rotate(90deg);
  border-color: rgba(139, 92, 246, 0.5);
  box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
}

.contact-modal-body {
  padding: 30px;
}

.contact-modal-body > p {
  margin-bottom: 1.5rem;
  color: rgba(255, 255, 255, 0.6);
  text-align: center;
  font-size: 14px;
  line-height: 1.6;
}

.contact-modal-form-group {
  margin-bottom: 20px;
}

.contact-modal-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 12px;
}

.contact-modal-label span {
  color: #ef4444;
}

.contact-modal-input {
  width: 100%;
  padding: 14px 18px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 12px;
  font-size: 15px;
  transition: all 0.3s ease;
  background: rgba(255, 255, 255, 0.05);
  color: #e5e7eb;
  font-family: inherit;
}

.contact-modal-input:focus {
  outline: none;
  border-color: rgba(139, 92, 246, 0.6);
  background: rgba(255, 255, 255, 0.08);
  box-shadow: 
    0 0 0 3px rgba(139, 92, 246, 0.15),
    0 0 20px rgba(139, 92, 246, 0.2);
  transform: translateY(-1px);
}

.contact-modal-input::placeholder {
  color: rgba(255, 255, 255, 0.35);
}

.contact-modal-help-text {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.45);
  margin-top: 6px;
  font-style: italic;
}

.contact-modal-submit-btn {
  width: 100%;
  padding: 16px 24px;
  background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 
    0 4px 15px rgba(139, 92, 246, 0.4),
    0 0 30px rgba(139, 92, 246, 0.2);
  margin-top: 10px;
  position: relative;
  overflow: hidden;
}

.contact-modal-submit-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s;
}

.contact-modal-submit-btn:hover::before {
  left: 100%;
}

.contact-modal-submit-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 
    0 8px 25px rgba(139, 92, 246, 0.5),
    0 0 40px rgba(139, 92, 246, 0.3);
}

.contact-modal-submit-btn:active:not(:disabled) {
  transform: translateY(0);
}

.contact-modal-submit-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

@media (max-width: 768px) {
  .contact-modal-container {
    border-radius: 20px 20px 0 0;
    max-height: 85vh;
    max-width: 100%;
  }
  
  .contact-modal-header {
    padding: 20px 20px 15px;
  }
  
  .contact-modal-header h3 {
    font-size: 20px;
  }
  
  .contact-modal-body {
    padding: 20px;
  }
  
  .contact-modal-input {
    padding: 12px 16px;
  }
  
  .contact-modal-submit-btn {
    padding: 14px 20px;
  }
}
</style>
{% endblock %}

{% block extra_js %}
{% endblock %}

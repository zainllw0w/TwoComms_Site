{% extends 'base.html' %}
{% load static %}
{% block title %}Запропонувати принт — TwoComms{% endblock %}
{% block content %}
<div class="print-hero admin-card p-3 p-md-4 position-relative overflow-hidden">
  <div class="sparkles" aria-hidden="true">
    <div class="spark s1"></div><div class="spark s2"></div><div class="spark s3"></div>
    <div class="spark s4"></div><div class="spark s5"></div><div class="spark s6"></div>
  </div>
  <div class="d-flex align-items-center gap-3">
    <div class="hero-logo">
      <img src="{% static 'img/logo.svg' %}" alt="TwoComms" class="logo-img">
    </div>
    <div class="flex-grow-1">
      <div class="badge rounded-pill hero-badge mb-2">
        <svg class="icon-anim" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        Запропонувати принт
      </div>
      <h1 class="h3 fw-bold mb-1">Поділись ідеєю — отримай винагороду</h1>
      <p class="mb-0 text-secondary small">Унікальні принти з брендовим написом або логотипом можуть принести <strong>бали</strong> або <strong>промокод 200–1000 грн</strong>.</p>
    </div>
    <div class="hero-actions">
      <a href="https://t.me/twocomms" target="_blank" rel="noopener" class="btn btn-gradient btn-sm">
        <svg class="icon-anim" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M9.04 15.28l-.38 5.34c.54 0 .78-.23 1.06-.5l2.55-2.44 5.29 3.85c.97.53 1.66.25 1.93-.9l3.5-16.38h.01c.31-1.46-.53-2.03-1.47-1.68L1.5 9.83C.08 10.38.1 11.21 1.25 11.56l5.35 1.67 12.42-7.84c.58-.36 1.12-.16.68.2"/></svg>
        Співпраця
      </a>
      {% if not request.user.is_authenticated %}
      <a class="btn btn-gradient btn-sm" href="{% url 'login' %}">Увійти</a>
      <a class="btn btn-ghost btn-sm" href="{% url 'register' %}">Реєстрація</a>
      {% endif %}
    </div>
  </div>
</div>

<div class="benefits-grid reveal my-4 my-md-5">
  <div class="row g-3 g-md-4">
    <div class="col-12 col-md-4">
      <div class="benefit-card h-100">
        <div class="benefit-icon">
          <svg class="icon-anim" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        </div>
        <div class="benefit-title">Промокод 200–1000 грн</div>
        <div class="benefit-text">Для унікальних принтів з брендовим написом або логотипом.</div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="benefit-card h-100">
        <div class="benefit-icon">
          <svg class="icon-anim" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
        </div>
        <div class="benefit-title">Бали до профілю</div>
        <div class="benefit-text">Накопичуйте бали і обмінюйте їх на знижки або добрі справи.</div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="benefit-card h-100">
        <div class="benefit-icon">
          <svg class="icon-anim" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2z"/></svg>
        </div>
        <div class="benefit-title">Зв’язок з нами</div>
        <div class="benefit-text">Вкажіть <a href="{% url 'profile_setup' %}">Telegram/Instagram</a> у профілі — ми зв’яжемось.</div>
      </div>
    </div>
  </div>
</div>

{% if request.user.is_authenticated %}
<div class="row g-4 align-items-stretch">
  <div class="col-12 col-lg-6">
    <div class="profile-card p-3 p-md-4 h-100 admin-card">
      <div class="admin-card-header">
        <div class="admin-card-title">
          <svg class="icon-anim" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l4 4H8l4-4zm0 16l-4-4h8l-4 4z"/></svg>
          Надіслати пропозицію принта
        </div>
        <div class="admin-chipset">
          <span class="chip chip-soft">JPEG/PNG/SVG</span>
          <span class="chip chip-soft">до 10 МБ</span>
          <span class="chip chip-accent">Антиспам 1 хв</span>
        </div>
      </div>
      {% if rate_limited %}
        <div class="alert alert-warning">Занадто часто. Спробуйте ще раз за хвилину.</div>
      {% endif %}
      {% if proposal_form and proposal_form.errors %}
        <div class="alert alert-danger">
          <strong>Помилка:</strong>
          <ul class="mb-0">
            {% for field, errs in proposal_form.errors.items %}
              {% for e in errs %}<li>{{ e }}</li>{% endfor %}
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      <form id="proposal-form" method="post" enctype="multipart/form-data" class="vstack gap-3" data-ajax="1">
        {% csrf_token %}

        <div id="dnd" class="dnd-zone">
          <div class="dnd-inner">
             <div class="dnd-icon">
               <svg class="icon-anim" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M19 15v4H5v-4H3v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4h-2zM11 8.414V20h2V8.414l3.293 3.293 1.414-1.414L12 4.586 6.293 10.293l1.414 1.414L11 8.414z"/></svg>
             </div>
            <div class="dnd-text">Перетягніть зображення сюди або натисніть для вибору</div>
            <input id="image-input" type="file" name="image" accept="image/*" class="dnd-input" />
          </div>
          <div id="preview" class="dnd-preview d-none">
            <img id="preview-img" alt="" />
            <button type="button" id="preview-reset" class="btn btn-ghost btn-sm">Очистити</button>
          </div>
        </div>

        <div>
          <label class="form-label">Або посилання на зображення</label>
          <input id="link-url" type="url" name="link_url" placeholder="https://..." class="form-control" />
        </div>

        <div>
          <label class="form-label">Опис / примітки</label>
          <textarea name="description" rows="4" class="form-control" placeholder="Опишіть ідею принта та деталі"></textarea>
          <small class="text-secondary">Вкажіть <a href="{% url 'profile_setup' %}">Telegram або Instagram у налаштуваннях профілю</a>, щоб ми могли зв’язатися.</small>
        </div>

        <div class="d-flex flex-wrap gap-2">
          <button type="submit" class="btn btn-gradient" id="submit-btn">Надіслати</button>
          <a href="https://t.me/twocomms" target="_blank" rel="noopener" class="btn btn-ghost">Співпраця для дизайнерів</a>
        </div>
      </form>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="profile-card p-3 p-md-4 h-100 admin-card">
      <div class="admin-card-header">
        <div class="admin-card-title">
          <svg class="icon-anim" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
          Мої принти на розгляді
        </div>
        <div class="admin-chipset">
          <span class="chip chip-soft">Останні 10</span>
        </div>
      </div>
      {% if proposals %}
      <div class="vstack gap-3">
        {% for p in proposals %}
        <div class="proposal-row">
          <div class="row align-items-center g-3">
            <div class="col-auto">
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="" class="rounded shadow-sm" style="width:64px;height:64px;object-fit:cover;" />
              {% else %}
                <div class="placeholder rounded" style="width:64px;height:64px;"></div>
              {% endif %}
            </div>
            <div class="col">
              <div class="small text-secondary">{{ p.created_at|date:"d.m.Y H:i" }}</div>
              <div class="d-flex align-items-center gap-2 flex-wrap">
                <span class="status-badge status-{{ p.status }}">{{ p.get_status_display }}</span>
                {% if p.awarded_points %}
                <span class="award-badge">
                  <svg class="icon-anim" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2з"/></svg>
                  +{{ p.awarded_points }} балів
                </span>
                {% endif %}
                {% if p.awarded_promocode %}
                <span class="promo-badge">Промокод: <code>{{ p.awarded_promocode.code }}</code> ({{ p.awarded_promocode.get_discount_display }})</span>
                {% endif %}
              </div>
              {% if p.description %}
                <div class="mt-1 small text-secondary">{{ p.description }}</div>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
        <div class="text-secondary">Поки немає заявок</div>
      {% endif %}
    </div>
  </div>
</div>
{% else %}
<div class="profile-card p-3 p-md-4 admin-card">
  <div class="admin-card-header">
    <div class="admin-card-title">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
      Авторизація потрібна
    </div>
  </div>
  <div class="alert alert-info mb-3">Авторизуйтеся, щоб мати можливість запропонувати принт та накопичувати бали.</div>
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-gradient" href="{% url 'login' %}">Увійти</a>
    <a class="btn btn-ghost" href="{% url 'register' %}">Зареєструватись</a>
    <a href="https://t.me/twocomms" target="_blank" rel="noopener" class="btn btn-ghost">Співпраця для дизайнерів</a>
  </div>
</div>
{% endif %}

<style>
/* Accent admin-like styles */
.btn-gradient{background:linear-gradient(135deg,var(--accent-color),#7c3aed); border:none; color:#fff; border-radius:12px; padding:.6rem 1rem; display:inline-flex; gap:.5rem; align-items:center; box-shadow:0 6px 24px rgba(124,58,237,.35);}
.btn-gradient:hover{filter:brightness(1.05); box-shadow:0 8px 28px rgba(124,58,237,.45)}
.btn-ghost{border:1px solid rgba(255,255,255,.2); color:var(--text-primary); border-radius:12px; padding:.6rem 1rem; background:transparent}
.btn-ghost:hover{background:rgba(255,255,255,.06)}

.admin-card{border:1px solid rgba(255,255,255,.08); border-radius:16px; background:linear-gradient(180deg, rgba(17,17,24,.7), rgba(10,10,16,.75)); backdrop-filter: blur(18px)}
.admin-card-header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px}
.admin-card-title{display:flex; align-items:center; gap:.5rem; font-weight:700}
.admin-chipset{display:flex; gap:.5rem; flex-wrap:wrap}
.chip{display:inline-flex; align-items:center; gap:.35rem; padding:.25rem .6rem; border-radius:999px; font-size:.85rem}
.chip-soft{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12)}
.chip-accent{background:linear-gradient(135deg, rgba(124,58,237,.2), rgba(124,58,237,.35)); color:#fff; border:1px solid rgba(124,58,237,.5)}

/* Print Hero Styles */
.print-hero{min-height:120px; background:linear-gradient(135deg, rgba(17,17,24,.8), rgba(10,10,16,.9)); border:1px solid rgba(124,58,237,.2);}
.hero-logo{flex-shrink:0; width:60px; height:60px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg, rgba(124,58,237,.1), rgba(124,58,237,.2)); border-radius:16px; border:1px solid rgba(124,58,237,.3);}
.logo-img{width:40px; height:40px; filter:brightness(1.2);}
.hero-actions{flex-shrink:0; display:flex; gap:.5rem; flex-wrap:wrap;}
.hero-actions .btn{font-size:.85rem; padding:.4rem .8rem;}

.hero-badge{background:linear-gradient(135deg,var(--accent-color),#7c3aed); color:#fff; display:inline-flex; align-items:center; gap:.4rem; font-size:.8rem; padding:.3rem .7rem;}
.sparkles{position:absolute; inset:0; pointer-events:none;}
.spark{position:absolute; width:4px; height:4px; background:radial-gradient(circle,#fff,rgba(255,255,255,.3)); border-radius:50%; animation:spark 8s linear infinite;}
.spark.s1{top:15%; left:10%; animation-delay:0s}
.spark.s2{top:25%; right:15%; animation-delay:2s}
.spark.s3{bottom:20%; left:20%; animation-delay:4s}
.spark.s4{bottom:15%; right:20%; animation-delay:6s}
.spark.s5{top:60%; left:50%; animation-delay:1s}
.spark.s6{top:40%; right:40%; animation-delay:3s}
@keyframes spark{0%{transform:translateY(0) scale(1); opacity:.6} 50%{transform:translateY(-6px) scale(1.2); opacity:.9} 100%{transform:translateY(0) scale(1); opacity:.4}}

/* Responsive adjustments */
@media (max-width: 768px) {
  .print-hero .d-flex{flex-direction:column; align-items:flex-start!important; gap:1rem!important;}
  .hero-logo{width:50px; height:50px;}
  .logo-img{width:32px; height:32px;}
  .hero-actions{width:100%; justify-content:flex-start;}
}

.benefit-card{border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; backdrop-filter: blur(18px); background:linear-gradient(180deg, rgba(17,17,24,.7), rgba(10,10,16,.75)); transition:transform .2s ease, box-shadow .2s ease}
.benefit-card:hover{transform:translateY(-2px); box-shadow:0 10px 30px rgba(0,0,0,.25)}
.benefit-icon{width:40px; height:40px; display:flex; align-items:center; justify-content:center; border-radius:10px; background:linear-gradient(135deg, var(--accent-color), #7c3aed); color:#fff; margin-bottom:.5rem}
.benefit-title{font-weight:700}
.benefit-text{color:var(--text-secondary)}

.dnd-zone{position:relative; border:1px dashed rgba(255,255,255,.3); border-radius:16px; padding:16px; background:rgba(255,255,255,.03)}
.dnd-zone.dragover{background:rgba(124,58,237,.08); border-color:var(--accent-color)}
.dnd-inner{position:relative; display:flex; gap:12px; align-items:center; justify-content:center; text-align:center; min-height:120px; cursor:pointer}
.dnd-icon{color:var(--accent-color); display:flex; align-items:center; justify-content:center; width:48px; height:48px; background:rgba(124,58,237,.1); border-radius:12px; flex-shrink:0}
.dnd-icon svg{width:24px; height:24px}
.dnd-text{color:var(--text-secondary)}
.dnd-input{position:absolute; inset:0; opacity:0; cursor:pointer; z-index:2}
.dnd-preview{display:flex; align-items:center; gap:12px; margin-top:12px}
.dnd-preview img{width:80px; height:80px; object-fit:cover; border-radius:10px; border:1px solid rgba(255,255,255,.1)}

.proposal-row{border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px; background:linear-gradient(180deg, rgba(17,17,24,.7), rgba(10,10,16,.75)); position:relative; overflow:hidden}
.proposal-row::after{content:""; position:absolute; inset:0; background:radial-gradient(600px 120px at top right, rgba(124,58,237,.1), transparent); pointer-events:none}
.status-badge{display:inline-flex; align-items:center; padding:.25rem .5rem; border-radius:999px; font-size:.85rem; border:1px solid rgba(255,255,255,.2)}
.status-pending{background:rgba(234,179,8,.15); color:#eab308; border-color:rgba(234,179,8,.3)}
.status-approved{background:rgba(34,197,94,.15); color:#22c55e; border-color:rgba(34,197,94,.3)}
.status-rejected{background:rgba(239,68,68,.15); color:#ef4444; border-color:rgba(239,68,68,.3)}
.award-badge{display:inline-flex; align-items:center; gap:.25rem; padding:.25rem .5rem; border-radius:8px; background:linear-gradient(135deg, var(--accent-color), #7c3aed); color:#fff}
.promo-badge{padding:.25rem .5rem; border-radius:8px; border:1px solid rgba(255,255,255,.2)}
.placeholder{background:rgba(255,255,255,.06); border:1px dashed rgba(255,255,255,.2)}

/* icon animation */
.icon-anim{transform-origin:center; animation:iconPulse 3s ease-in-out infinite}
@keyframes iconPulse{0%{transform:scale(1) rotate(0)} 50%{transform:scale(1.08) rotate(1deg)} 100%{transform:scale(1) rotate(0)}}
</style>

<script>
(function(){
  var dnd = document.getElementById('dnd');
  if(!dnd) return;
  var input = document.getElementById('image-input');
  var preview = document.getElementById('preview');
  var img = document.getElementById('preview-img');
  var reset = document.getElementById('preview-reset');
  var form = document.getElementById('proposal-form');
  var submitBtn = document.getElementById('submit-btn');
  function showPreview(file){
    if(!file) return;
    var reader = new FileReader();
    reader.onload = function(e){ img.src = e.target.result; preview.classList.remove('d-none'); };
    reader.readAsDataURL(file);
  }
  // Клик по зоне открывает файловый диалог
  dnd.addEventListener('click', function(){ input && input.click(); });

  input.addEventListener('change', function(){
    if(this.files && this.files[0]){ 
      showPreview(this.files[0]);
      // Показываем превью, но не отправляем автоматически
    }
  });
  reset.addEventListener('click', function(){ input.value = ''; preview.classList.add('d-none'); });
  dnd.addEventListener('dragover', function(e){ e.preventDefault(); dnd.classList.add('dragover'); });
  dnd.addEventListener('dragleave', function(){ dnd.classList.remove('dragover'); });
   dnd.addEventListener('drop', function(e){ e.preventDefault(); dnd.classList.remove('dragover'); var f=e.dataTransfer.files && e.dataTransfer.files[0]; if(f){ input.files = e.dataTransfer.files; showPreview(f); } });

  function submitFormAjax(){
    if(!form) return;
    
    // Проверяем, что есть файл или ссылка
    var hasFile = input.files && input.files[0];
    var hasLink = document.querySelector('input[name="link_url"]').value.trim();
    
    if(!hasFile && !hasLink) {
      showErrorMessage('Будь ласка, завантажте зображення або введіть посилання на зображення');
      return;
    }
    
    var submitBtn = document.getElementById('submit-btn');
    var originalText = submitBtn.textContent;
    submitBtn.textContent = 'Відправляємо...';
    submitBtn.disabled = true;
    
    var url = window.location.href;
    var data = new FormData(form);
    
    fetch(url, {
      method: 'POST',
      headers: {'X-Requested-With':'XMLHttpRequest'},
      body: data
    }).then(function(r){ return r.json(); }).then(function(res){
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
      
      if(res && res.ok && res.proposal){
        // Показываем сообщение об успехе
        showSuccessMessage('Принт успішно відправлено на розгляд!');
        
        // prepend в список заявок справа
        try{
          // Ищем список принтов в правой колонке
          var proposalsList = document.querySelector('.col-12.col-lg-6:last-child .vstack.gap-3');
          if(!proposalsList) {
            // Если список не найден, создаем его
            var rightColumn = document.querySelector('.col-12.col-lg-6:last-child .admin-card');
            if(rightColumn) {
              var existingList = rightColumn.querySelector('.vstack.gap-3');
              if(!existingList) {
                // Создаем новый список
                var newList = document.createElement('div');
                newList.className = 'vstack gap-3';
                rightColumn.appendChild(newList);
                proposalsList = newList;
              } else {
                proposalsList = existingList;
              }
            }
          }
          
          if(proposalsList){
            var row = document.createElement('div');
            row.className = 'proposal-row';
            var awardsHtml = '';
            if(res.proposal.awarded_points && res.proposal.awarded_points > 0) {
              awardsHtml += '<span class="award-badge"><svg class="icon-anim" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>+'+res.proposal.awarded_points+' балів</span>';
            }
            if(res.proposal.awarded_promocode) {
              awardsHtml += '<span class="promo-badge">Промокод: <code>'+res.proposal.awarded_promocode.code+'</code> ('+res.proposal.awarded_promocode.discount_display+')</span>';
            }
            
            row.innerHTML = '\
              <div class="row align-items-center g-3">\
                <div class="col-auto">' + (res.proposal.image_url ? ('<img src="'+res.proposal.image_url+'" class="rounded shadow-sm" style="width:64px;height:64px;object-fit:cover;" />') : '<div class="placeholder rounded" style="width:64px;height:64px;background:rgba(255,255,255,0.1);"></div>') + '</div>\
                <div class="col">\
                  <div class="small text-secondary">'+res.proposal.created_at+'</div>\
                  <div class="d-flex align-items-center gap-2 flex-wrap">\
                    <span class="status-badge status-'+res.proposal.status+'">'+res.proposal.status_display+'</span>\
                    ' + awardsHtml + '\
                  </div>\
                  ' + (res.proposal.description ? ('<div class="mt-1 small text-secondary">'+res.proposal.description+'</div>') : '') + '\
                </div>\
              </div>';
            proposalsList.prepend(row);
          }
        }catch(e){ console.error('Error adding proposal to list:', e); }
        
        // Очищаем форму
        form.reset();
        preview.classList.add('d-none');
        input.value = '';
      } else {
        console.warn('Submit error', res);
        alert('Помилка відправки: ' + (res.error || 'Невідома помилка'));
      }
    }).catch(function(err){ 
      submitBtn.textContent = originalText;
      submitBtn.disabled = false; 
      console.error(err);
      alert('Помилка відправки форми');
    });
  }
  
  function showSuccessMessage(message) {
    // Создаем уведомление
    var notification = document.createElement('div');
    notification.className = 'success-notification';
    notification.innerHTML = `
      <div class="notification-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        <span>${message}</span>
      </div>
    `;
    
    // Добавляем стили
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.95));
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
      z-index: 10000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Анимация появления
    setTimeout(() => {
      notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Удаляем через 4 секунды
    setTimeout(() => {
      notification.style.transform = 'translateX(100%)';
      setTimeout(() => {
        if(notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, 4000);
  }
  
  function showErrorMessage(message) {
    // Создаем уведомление об ошибке
    var notification = document.createElement('div');
    notification.className = 'error-notification';
    notification.innerHTML = `
      <div class="notification-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"/>
        </svg>
        <span>${message}</span>
      </div>
    `;
    
    // Добавляем стили
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
      z-index: 10000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Анимация появления
    setTimeout(() => {
      notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Удаляем через 5 секунд (ошибки показываем дольше)
    setTimeout(() => {
      notification.style.transform = 'translateX(100%)';
      setTimeout(() => {
        if(notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, 5000);
  }

  // Перехват обычной отправки формы
  form && form.addEventListener('submit', function(e){
    if(form.dataset.ajax){ e.preventDefault(); submitFormAjax(); }
  });
})();
</script>
{% endblock %}
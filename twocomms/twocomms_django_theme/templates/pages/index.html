{% extends "base.html" %}{% load static %}{% load cache %}{% load responsive_images %}

{% block title %}TwoComms — Стріт & Мілітарі Одяг | Головна{% endblock %}

{% block description %}TwoComms - магазин стріт & мілітарі одягу з ексклюзивним дизайном. Футболки, худі, лонгсліви з характером. Якісний одяг для сучасного стилю. Швидка доставка по Україні.{% endblock %}

{% block keywords %}стріт одяг, мілітарі одяг, футболки, худі, лонгсліви, TwoComms, ексклюзивний дизайн, якісний одяг, одяг з характером, стріт стиль, мілітарі стиль{% endblock %}

{% block og_type %}website{% endblock %}

{% block canonical %}
  {% if page_obj and page_obj.number > 1 %}
    {{ request.scheme }}://{{ request.get_host }}{{ request.path }}?page={{ page_obj.number }}
  {% else %}
    {{ request.scheme }}://{{ request.get_host }}{{ request.path }}
  {% endif %}
{% endblock %}

{% block pagination_links %}
  {% if page_obj and page_obj.has_previous %}
    <link rel="prev" href="{{ request.path }}?page={{ page_obj.previous_page_number }}">
  {% endif %}
  {% if page_obj and page_obj.has_next %}
    <link rel="next" href="{{ request.path }}?page={{ page_obj.next_page_number }}">
  {% endif %}
{% endblock %}

{% block extra_css %}
  {{ block.super }}
  <link rel="preload" href="{% static 'img/logo.svg' %}" as="image" fetchpriority="high">
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "TwoComms",
  "url": "{{ request.scheme }}://{{ request.get_host }}",
  "description": "Магазин стріт & мілітарі одягу з ексклюзивним дизайном",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ request.scheme }}://{{ request.get_host }}/search/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{% endblock %}

{% block content %}
{% cache 1800 hero_block %}
<section class="hero-section mb-4 mb-md-5 reveal">
  <!-- Фоновый логотип -->
  <div class="hero-logo-bg">
    {% static 'img/logo.svg' as hero_logo_url %}
    <img src="{{ hero_logo_url }}" alt="TwoComms логотип - стріт & мілітарі одяг" width="600" height="600" class="hero-logo-image" loading="eager" fetchpriority="high" decoding="sync">
  </div>
  
  <div class="hero-container row align-items-center g-4">
    <!-- Основной контент -->
    <div class="col-12 hero-content">
      <div class="hero-text-section">
        <h1 class="hero-title">
          <span class="hero-title-main">Стріт & мілітарі</span>
          <span class="hero-title-accent">одяг</span>
        </h1>
        <p class="hero-subtitle">Футболки, худі, лонгсліви. Дизайн з характером.</p>
        <div class="hero-actions">
          <a class="hero-btn-primary" href="{% url 'catalog' %}">
            <span>Перейти в каталог</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
            </svg>
          </a>
          <div class="hero-badge">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span>Ексклюзивний дизайн</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Декоративные элементы -->
    <div class="hero-decoration">
      <div class="hero-glow"></div>
      <div class="hero-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>
    </div>
  </div>
</section>
{% endcache %}
<section class="mb-4 mb-md-5 reveal" id="featured-section">
  <!-- Компактный блок опитування в стиле рекомендаций -->
  <div class="featured-unified-block survey-unified-block">
    <!-- Фоновые эффекты -->
    <div class="featured-bg-unified">
      <div class="featured-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>
      <div class="featured-glow"></div>
      <div class="featured-gradient-1"></div>
      <div class="featured-gradient-2"></div>
      <div class="featured-floating-logos">
              <div class="floating-logo logo-1">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - стріт & мілітарі одяг" width="14" height="14">
              </div>
              <div class="floating-logo logo-2">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - стріт & мілітарі одяг" width="12" height="12">
              </div>
              <div class="floating-logo logo-3">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - стріт & мілітарі одяг" width="16" height="16">
              </div>
      </div>
    </div>
    
    <!-- Заголовок с кнопкой сворачивания -->
    <div class="featured-header-unified">
      <div class="d-flex justify-content-between align-items-center">
        <div class="featured-title-compact">
          <div class="title-with-star-icon">
            <div class="featured-badge-compact">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <span>{{ survey_ui_home.badge_uk|default:"Опитування" }}</span>
            </div>
            <div class="featured-subtitle-compact">{{ survey_ui_home.title_uk|default:"Коротке опитування про PRINT" }}</div>
          </div>
          <div class="featured-accent-line"></div>
        </div>
        
        <!-- Кнопка сворачивания в центре -->
        <button class="featured-toggle-btn" id="featuredToggle" aria-label="Сховати або показати опитування" aria-expanded="false" aria-controls="featured-content">
          <div class="toggle-btn-content">
            <span class="toggle-text">Сховати</span>
            <div class="toggle-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 10l5 5 5-5z"/>
              </svg>
            </div>
          </div>
        </button>
        
        <div class="featured-spacer"></div>
      </div>
    </div>
    
    <!-- Скрываемый контент -->
    <div class="featured-content-unified" id="featured-content">
      <div class="featured-card-compact survey-card">
        <div class="survey-signal">
          <div class="survey-signal-ring">
            <svg width="38" height="38" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.49 2 2 5.92 2 11c0 2.52 1.09 4.78 2.86 6.38L4 22l4.06-2.2c1.2.33 2.49.5 3.94.5 5.51 0 10-3.92 10-9S17.51 2 12 2zm.1 14.4c-.62 0-1.1-.48-1.1-1.08 0-.63.48-1.12 1.1-1.12.64 0 1.14.49 1.14 1.12 0 .6-.5 1.08-1.14 1.08zm2.1-6.33c-.36.45-.84.74-1.25 1.03-.39.27-.63.53-.63 1.07v.3h-1.4v-.42c0-.86.4-1.38.96-1.78.3-.22.65-.43.91-.74.22-.26.33-.54.33-.87 0-.7-.59-1.16-1.35-1.16-.77 0-1.3.45-1.43 1.2l-1.48-.3c.2-1.34 1.43-2.3 2.95-2.3 1.65 0 2.86 1 2.86 2.44 0 .62-.16 1.14-.47 1.53z"/>
            </svg>
          </div>
          <div class="survey-signal-stack">
            <div class="survey-signal-pill">≈5 хв</div>
            <div class="survey-signal-pill">1 питання за раз</div>
            <div class="survey-signal-pill">Автозбереження</div>
          </div>
        </div>

        <div class="featured-info-compact survey-info">
          <h3 class="featured-title-compact-text survey-title">
            {{ survey_ui_home.title_uk|default:"Коротке опитування про PRINT" }}
          </h3>
          <p class="survey-subtitle">
            {{ survey_ui_home.subtitle_uk|default:"Відповідай на кілька коротких запитань (≈5 хв)." }}
          </p>
          <div class="survey-points">
            <div class="survey-point">Промокод на {{ survey_reward.amount_uah|default:200 }} грн після завершення</div>
            <div class="survey-point">Можна продовжити пізніше</div>
            <div class="survey-point">Без цифр прогресу</div>
          </div>
          <div class="survey-actions">
            <button
              type="button"
              class="featured-btn-compact survey-cta"
              data-survey-cta
              data-survey-key="{{ survey_key }}"
              data-survey-start-text="{{ survey_ui_home.cta_start_uk|default:'Пройти опитування' }}"
              data-survey-continue-text="{{ survey_ui_home.cta_continue_uk|default:'Продовжити опитування' }}"
              data-survey-authenticated="{% if request.user.is_authenticated %}1{% else %}0{% endif %}"
              data-login-url="{% url 'login' %}?next={{ request.path }}"
            >
              <span>{{ survey_cta_text }}</span>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
              </svg>
            </button>
          </div>
          <div class="survey-footnote">
            {{ survey_ui_home.note_uk|default:"Доступно лише для зареєстрованих користувачів. Відповіді зберігаються — можна продовжити пізніше." }}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% cache 1800 categories_block %}
<section class="mb-4 mb-md-5 reveal categories-section">
  <!-- Единый блок категорий без разделения -->
  <div class="categories-unified-block">
    <!-- Фоновые эффекты для всего блока -->
    <div class="categories-bg-unified">
      <div class="dark-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>
      <div class="dark-glow"></div>
      <div class="dark-gradient-1"></div>
      <div class="dark-gradient-2"></div>
      <div class="floating-logos">
        <div class="floating-logo logo-1">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="16" height="16">
        </div>
        <div class="floating-logo logo-2">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - декоративний" width="14" height="14">
        </div>
        <div class="floating-logo logo-3">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="18" height="18">
        </div>
        <div class="floating-logo logo-4">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="12" height="12">
        </div>
        <div class="floating-logo logo-5">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="15" height="15">
        </div>
      </div>
    </div>
    
    <!-- Заголовок с кнопкой сворачивания -->
    <div class="categories-header-unified">
      <div class="d-flex justify-content-between align-items-center">
        <div class="categories-title-compact">
          <div class="title-with-catalog-icon">
            <h2 class="categories-title-text">Категорії</h2>
            <a href="{% url 'catalog' %}" class="catalog-icon-mobile" aria-label="Перейти в каталог">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </a>
          </div>
          <div class="title-accent-line"></div>
        </div>
        
        <!-- Кнопка сворачивания в центре -->
        <button class="categories-toggle-btn" id="categoriesToggle" aria-label="Свернуть/развернуть категории">
          <div class="toggle-btn-content">
            <div class="toggle-icon">
              <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
              </svg>
            </div>
            <span class="toggle-text">Свернуть</span>
          </div>
          <div class="toggle-btn-glow"></div>
          <div class="toggle-btn-ripple"></div>
        </button>
        
        <a href="{% url 'catalog' %}" class="catalog-link-compact">
          <span class="catalog-text">Весь каталог</span>
          <svg class="catalog-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
          </svg>
        </a>
      </div>
    </div>

    <!-- Контейнер категорий (без отдельного фона) -->
    <div class="categories-content-unified" id="categoriesContainer">
      <div class="categories-grid-compact">
        <!-- Категории товаров -->
        {% for c in categories %}
        <a href="{% url 'catalog_by_cat' c.slug %}" class="category-card-compact" title="{{ c.name }}">
          <div class="card-bg-dark">
            <div class="card-glow-dark"></div>
            <div class="card-ripple-dark"></div>
          </div>
          <div class="card-content-compact">
            <div class="card-icon-compact">
              {% if c.icon %}
                <img src="{{ c.icon.url }}" width="24" height="24" alt="{{ c.name }} категорія - TwoComms" loading="lazy" decoding="async">
              {% else %}
                <img src="{% static 'img/icons/default.svg' %}" width="24" height="24" alt="{{ c.name }} категорія - TwoComms" loading="lazy" decoding="async">
              {% endif %}
            </div>
            <div class="card-text-compact">
              <span class="card-title-compact">{{ c.name }}</span>
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endcache %}
<section class="mb-4 mb-md-5 reveal" id="new-products-section">
  <div class="d-flex justify-content-between align-items-end mb-3">
    <h2 class="h5 mb-0">Новинки</h2>
  </div>
  
  <div class="row g-3 g-md-4 row-cols-2 row-cols-md-3 row-cols-lg-4" data-stagger-grid id="products-container" data-mobile-stagger="true">
    {% for p in products %}
    <div class="col product-card-wrap stagger-item reveal-stagger">
      {% cache 900 product_card p.id p.final_price p.discount_percent p.display_image.name p.category_id forloop.counter0 %}
        {% if forloop.counter0 < 2 %}
          {% include "partials/product_card.html" with p=p stagger=True eager=True %}
        {% else %}
          {% include "partials/product_card.html" with p=p stagger=True eager=False %}
        {% endif %}
      {% endcache %}
      {% if p.colors_preview %}
      <div class="product-card-dots">
        <span class="text-secondary small me-1">Кольори:</span>
        <div class="d-flex align-items-center gap-1">
          {% for v in p.colors_preview %}
            <span class="color-dot" 
                  title="{{ v.primary_hex }}{% if v.secondary_hex %}+{{ v.secondary_hex }}{% endif %}" 
                  style="--c1: {{ v.primary_hex }}; --c2: {{ v.secondary_hex|default:'' }};"
                  data-image-url="{{ v.first_image_url|default:'' }}"></span>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
    {% empty %}
    <div class="text-secondary small">Немає товарів.</div>
    {% endfor %}
  </div>
  
  {% if has_more_products %}
  <div class="text-center mt-4" id="load-more-container"
       data-total-pages="{{ paginator.num_pages }}"
       data-current-page="{{ page_obj.number }}">
    <button class="btn btn-outline-primary" id="load-more-btn" data-page="{{ page_obj.next_page_number }}">
      <span class="btn-text">Показати ще</span>
      <span class="btn-spinner d-none">
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        Завантаження...
      </span>
    </button>
    <noscript>
      <div class="mt-3">
        <a class="btn btn-outline-primary" href="?page={{ page_obj.next_page_number }}">Наступна сторінка</a>
      </div>
    </noscript>
  </div>
  {% endif %}
  
  {% if paginator.num_pages > 1 %}
  <div class="text-center mt-3" id="page-selector-container">
    <div class="d-flex justify-content-center align-items-center gap-3">
      <span class="text-muted small">Сторінка:</span>
      <select class="form-select form-select-sm" id="page-selector" style="width: auto;">
        {% for num in paginator.page_range %}
          <option value="{{ num }}" {% if page_obj.number == num %}selected{% endif %}>{{ num }}</option>
        {% endfor %}
      </select>
      <span class="text-muted small">з <span id="total-pages">{{ paginator.num_pages }}</span></span>
    </div>
  </div>

  <nav aria-label="Навігація по новинках" class="mt-3" data-total-pages="{{ paginator.num_pages }}">
    <ul class="pagination pagination-sm justify-content-center mb-0">
      <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
        <a class="page-link" href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% else %}#{% endif %}" rel="prev">Попередня</a>
      </li>
      {% for num in paginator.page_range %}
        <li class="page-item {% if num == page_obj.number %}active{% endif %}">
          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
      {% endfor %}
      <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
        <a class="page-link" href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% else %}#{% endif %}" rel="next">Наступна</a>
      </li>
    </ul>
  </nav>
  {% endif %}
</section>

<script>
  // Collapsible Featured и загрузка «Показать ещё» перенесены в main.js
</script>
{% endblock %}

{% block modals %}
  {{ block.super }}
  <div
    class="survey-modal"
    id="survey-modal"
    aria-hidden="true"
    data-button-next="{{ survey_ui_modal.button_next_uk|default:'Далі' }}"
    data-button-back="{{ survey_ui_modal.button_back_once_uk|default:'Повернутись на 1 крок' }}"
    data-button-close="{{ survey_ui_modal.button_close_uk|default:'Закрити' }}"
    data-button-skip="{{ survey_ui_modal.button_skip_uk|default:'Пропустити' }}"
    data-thanks-title="{{ survey_ui_modal.thanks_title_uk|default:'Дякуємо!' }}"
    data-thanks-text="{{ survey_ui_modal.thanks_text_uk|default:'Твій промокод готовий.' }}"
    data-copy-code="{{ survey_ui_modal.copy_code_uk|default:'Скопіювати код' }}"
  >
    <div class="survey-overlay" data-survey-close></div>
    <div class="survey-dialog" role="dialog" aria-modal="true" aria-labelledby="survey-modal-title">
      <button type="button" class="survey-close" data-survey-close aria-label="{{ survey_ui_modal.button_close_uk|default:'Закрити' }}">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>

      <div class="survey-header">
        <div class="survey-header-main">
          <div class="survey-badge">{{ survey_ui_home.badge_uk|default:"Опитування" }}</div>
          <h3 class="survey-modal-title" id="survey-modal-title">
            {{ survey_ui_modal.title_uk|default:"Коротке опитування про PRINT" }}
          </h3>
          <p class="survey-modal-subtitle">
            {{ survey_ui_modal.subtitle_uk|default:"Твої відповіді допоможуть покращити сайт." }}
          </p>
        </div>
        {% if survey_ui_modal.privacy_hint_uk %}
        <p class="survey-modal-privacy">{{ survey_ui_modal.privacy_hint_uk }}</p>
        {% endif %}
      </div>

      <div class="survey-body" id="survey-body">
        <div class="survey-loading">
          <div class="survey-spinner"></div>
          <div class="survey-loading-text">Завантаження…</div>
        </div>
      </div>

      <div class="survey-footer">
        <div class="survey-soft-hint" id="survey-soft-hint"></div>
        <div class="survey-actions-row">
          <button type="button" class="survey-btn survey-btn-ghost" data-survey-back>
            {{ survey_ui_modal.button_back_once_uk|default:"Повернутись на 1 крок" }}
          </button>
          <button type="button" class="survey-btn survey-btn-ghost" data-survey-skip>
            {{ survey_ui_modal.button_skip_uk|default:"Пропустити" }}
          </button>
          <button type="button" class="survey-btn survey-btn-primary" data-survey-next>
            {{ survey_ui_modal.button_next_uk|default:"Далі" }}
          </button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

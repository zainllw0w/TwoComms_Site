{% extends "base.html" %}{% load static %}{% load cache %}{% load responsive_images %}

{% block title %}TwoComms — Стріт & Мілітарі Одяг | Головна{% endblock %}

{% block description %}TwoComms - магазин стріт & мілітарі одягу з ексклюзивним дизайном. Футболки, худі, лонгсліви з характером. Якісний одяг для сучасного стилю. Швидка доставка по Україні.{% endblock %}

{% block keywords %}стріт одяг, мілітарі одяг, футболки, худі, лонгсліви, TwoComms, ексклюзивний дизайн, якісний одяг, одяг з характером, стріт стиль, мілітарі стиль{% endblock %}

{% block og_type %}website{% endblock %}

{% block canonical %}
  {% if page_obj and page_obj.number > 1 %}
    {{ request.scheme }}://{{ request.get_host }}{{ request.path }}?page={{ page_obj.number }}
  {% else %}
    {{ request.scheme }}://{{ request.get_host }}{{ request.path }}
  {% endif %}
{% endblock %}

{% block pagination_links %}
  {% if page_obj and page_obj.has_previous %}
    <link rel="prev" href="{{ request.path }}?page={{ page_obj.previous_page_number }}">
  {% endif %}
  {% if page_obj and page_obj.has_next %}
    <link rel="next" href="{{ request.path }}?page={{ page_obj.next_page_number }}">
  {% endif %}
{% endblock %}

{% block extra_css %}
  {{ block.super }}
  <link rel="preload" href="{% static 'img/logo.svg' %}" as="image" fetchpriority="high">
{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "TwoComms",
  "url": "{{ request.scheme }}://{{ request.get_host }}",
  "description": "Магазин стріт & мілітарі одягу з ексклюзивним дизайном",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ request.scheme }}://{{ request.get_host }}/search/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{% endblock %}

{% block content %}
{% cache 1800 hero_block %}
<section class="hero-section mb-4 mb-md-5 reveal">
  <div class="hero-container row align-items-center g-4">
    <!-- Фоновый логотип -->
    <div class="col-12 col-md-6 hero-logo-bg">
      {% static 'img/logo.svg' as hero_logo_url %}
      <img src="{{ hero_logo_url }}" alt="TwoComms логотип - стріт & мілітарі одяг" width="200" height="200" class="hero-logo-image" loading="eager" fetchpriority="high" decoding="sync">
    </div>
    
    <!-- Основной контент -->
    <div class="col-12 col-md-6 hero-content">
      <div class="hero-text-section">
        <h1 class="hero-title">
          <span class="hero-title-main">Стріт & мілітарі</span>
          <span class="hero-title-accent">одяг</span>
        </h1>
        <p class="hero-subtitle">Футболки, худі, лонгсліви. Дизайн з характером.</p>
        <div class="hero-actions">
          <a class="hero-btn-primary" href="{% url 'catalog' %}">
            <span>Перейти в каталог</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
            </svg>
          </a>
          <div class="hero-badge">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span>Ексклюзивний дизайн</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Декоративные элементы -->
    <div class="hero-decoration">
      <div class="hero-glow"></div>
      <div class="hero-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>
    </div>
  </div>
</section>
{% endcache %}
{% if featured %}
{% cache 1200 featured_block featured.id featured.final_price featured.discount_percent %}
<section class="mb-4 mb-md-5 reveal" id="featured-section">
  <!-- Компактный блок рекомендаций в стиле категорий -->
  <div class="featured-unified-block">
    <!-- Фоновые эффекты -->
    <div class="featured-bg-unified">
      <div class="featured-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>
      <div class="featured-glow"></div>
      <div class="featured-gradient-1"></div>
      <div class="featured-gradient-2"></div>
      <div class="featured-floating-logos">
              <div class="floating-logo logo-1">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - стріт & мілітарі одяг" width="14" height="14">
              </div>
              <div class="floating-logo logo-2">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - стріт & мілітарі одяг" width="12" height="12">
              </div>
              <div class="floating-logo logo-3">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - стріт & мілітарі одяг" width="16" height="16">
              </div>
      </div>
    </div>
    
    <!-- Заголовок с кнопкой сворачивания -->
    <div class="featured-header-unified">
      <div class="d-flex justify-content-between align-items-center">
        <div class="featured-title-compact">
          <div class="title-with-star-icon">
            <div class="featured-badge-compact">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <span>Рекомендовано</span>
            </div>
            <div class="featured-subtitle-compact">Найкращий вибір тижня</div>
          </div>
          <div class="featured-accent-line"></div>
        </div>
        
        <!-- Кнопка сворачивания в центре -->
        <button class="featured-toggle-btn" id="featuredToggle" aria-label="Свернуть/развернуть рекомендации" aria-expanded="false" aria-controls="featured-content">
          <div class="toggle-btn-content">
            <span class="toggle-text">Сховати</span>
            <div class="toggle-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 10l5 5 5-5z"/>
              </svg>
            </div>
          </div>
        </button>
        
        <div class="featured-spacer"></div>
      </div>
    </div>
    
    <!-- Скрываемый контент -->
    <div class="featured-content-unified" id="featured-content">
      <div class="featured-card-compact">
        <div class="featured-image-compact">
          {% if featured.display_image %}
            {% optimized_image featured.display_image.url featured.title|add:" - "|add:featured.category.name|add:" TwoComms" "featured-img" 400 400 %}
          {% else %}
            {% static 'img/placeholder.jpg' as ph_url %}
            <img
              src="{{ ph_url }}"
              class="featured-img"
              alt="{{ featured.title }} - рекомендуємий товар TwoComms"
              loading="lazy"
              decoding="async"
              width="400"
              height="400"
            >
          {% endif %}
          {% if featured.has_discount and featured.discount_percent %}
            <div class="featured-discount-compact">-{{ featured.discount_percent }}%</div>
          {% endif %}
        </div>
        
        <div class="featured-info-compact">
          <div class="featured-category-compact">{{ featured.category.name }}</div>
          <h3 class="featured-title-compact-text">{{ featured.title }}</h3>
          <div class="featured-price-compact">
            <span class="featured-price-current-compact">{{ featured.final_price }} грн</span>
            {% if featured.has_discount %}
              <span class="featured-price-old-compact">{{ featured.price }} грн</span>
            {% endif %}
          </div>
          <a href="{% url 'product' featured.slug %}" class="featured-btn-compact">
            <span>Переглянути</span>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
{% endcache %}
{% endif %}
{% cache 1800 categories_block %}
<section class="mb-4 mb-md-5 reveal categories-section">
  <!-- Единый блок категорий без разделения -->
  <div class="categories-unified-block">
    <!-- Фоновые эффекты для всего блока -->
    <div class="categories-bg-unified">
      <div class="dark-particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
      </div>
      <div class="dark-glow"></div>
      <div class="dark-gradient-1"></div>
      <div class="dark-gradient-2"></div>
      <div class="floating-logos">
        <div class="floating-logo logo-1">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="16" height="16">
        </div>
        <div class="floating-logo logo-2">
                <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип - декоративний" width="14" height="14">
        </div>
        <div class="floating-logo logo-3">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="18" height="18">
        </div>
        <div class="floating-logo logo-4">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="12" height="12">
        </div>
        <div class="floating-logo logo-5">
          <img src="{% static 'img/logo.svg' %}" alt="TwoComms логотип" width="15" height="15">
        </div>
      </div>
    </div>
    
    <!-- Заголовок с кнопкой сворачивания -->
    <div class="categories-header-unified">
      <div class="d-flex justify-content-between align-items-center">
        <div class="categories-title-compact">
          <div class="title-with-catalog-icon">
            <h2 class="categories-title-text">Категорії</h2>
            <a href="{% url 'catalog' %}" class="catalog-icon-mobile" aria-label="Перейти в каталог">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
            </a>
          </div>
          <div class="title-accent-line"></div>
        </div>
        
        <!-- Кнопка сворачивания в центре -->
        <button class="categories-toggle-btn" id="categoriesToggle" aria-label="Свернуть/развернуть категории">
          <div class="toggle-btn-content">
            <div class="toggle-icon">
              <svg class="toggle-arrow" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
              </svg>
            </div>
            <span class="toggle-text">Свернуть</span>
          </div>
          <div class="toggle-btn-glow"></div>
          <div class="toggle-btn-ripple"></div>
        </button>
        
        <a href="{% url 'catalog' %}" class="catalog-link-compact">
          <span class="catalog-text">Весь каталог</span>
          <svg class="catalog-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
          </svg>
        </a>
      </div>
    </div>

    <!-- Контейнер категорий (без отдельного фона) -->
    <div class="categories-content-unified" id="categoriesContainer">
      <div class="categories-grid-compact">
        <!-- Категории товаров -->
        {% for c in categories %}
        <a href="{% url 'catalog_by_cat' c.slug %}" class="category-card-compact" title="{{ c.name }}">
          <div class="card-bg-dark">
            <div class="card-glow-dark"></div>
            <div class="card-ripple-dark"></div>
          </div>
          <div class="card-content-compact">
            <div class="card-icon-compact">
              {% if c.icon %}
                <img src="{{ c.icon.url }}" width="24" height="24" alt="{{ c.name }} категорія - TwoComms" loading="lazy" decoding="async">
              {% else %}
                <img src="{% static 'img/icons/default.svg' %}" width="24" height="24" alt="{{ c.name }} категорія - TwoComms" loading="lazy" decoding="async">
              {% endif %}
            </div>
            <div class="card-text-compact">
              <span class="card-title-compact">{{ c.name }}</span>
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endcache %}
<section class="mb-4 mb-md-5 reveal" id="new-products-section">
  <div class="d-flex justify-content-between align-items-end mb-3">
    <h2 class="h5 mb-0">Новинки</h2>
  </div>
  
  <div class="row g-3 g-md-4 row-cols-2 row-cols-md-3 row-cols-lg-4" data-stagger-grid id="products-container" data-mobile-stagger="true">
    {% for p in products %}
    <div class="product-card-wrap stagger-item reveal-stagger">
      {% cache 900 product_card p.id p.final_price p.discount_percent p.display_image.name p.category_id forloop.counter0 %}
        {% if forloop.counter0 < 2 %}
          {% include "partials/product_card.html" with p=p stagger=True eager=True %}
        {% else %}
          {% include "partials/product_card.html" with p=p stagger=True eager=False %}
        {% endif %}
      {% endcache %}
      {% if p.colors_preview %}
      <div class="product-card-dots">
        <span class="text-secondary small me-1">Кольори:</span>
        <div class="d-flex align-items-center gap-1">
          {% for v in p.colors_preview %}
            <span class="color-dot" 
                  title="{{ v.primary_hex }}{% if v.secondary_hex %}+{{ v.secondary_hex }}{% endif %}" 
                  style="--c1: {{ v.primary_hex }}; --c2: {{ v.secondary_hex|default:'' }};"
                  data-image-url="{{ v.first_image_url|default:'' }}"></span>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
    {% empty %}
    <div class="text-secondary small">Немає товарів.</div>
    {% endfor %}
  </div>
  
  {% if has_more_products %}
  <div class="text-center mt-4" id="load-more-container"
       data-total-pages="{{ paginator.num_pages }}"
       data-current-page="{{ page_obj.number }}">
    <button class="btn btn-outline-primary" id="load-more-btn" data-page="{{ page_obj.next_page_number }}">
      <span class="btn-text">Показати ще</span>
      <span class="btn-spinner d-none">
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        Завантаження...
      </span>
    </button>
    <noscript>
      <div class="mt-3">
        <a class="btn btn-outline-primary" href="?page={{ page_obj.next_page_number }}">Наступна сторінка</a>
      </div>
    </noscript>
  </div>
  {% endif %}
  
  {% if paginator.num_pages > 1 %}
  <div class="text-center mt-3" id="page-selector-container">
    <div class="d-flex justify-content-center align-items-center gap-3">
      <span class="text-muted small">Сторінка:</span>
      <select class="form-select form-select-sm" id="page-selector" style="width: auto;">
        {% for num in paginator.page_range %}
          <option value="{{ num }}" {% if page_obj.number == num %}selected{% endif %}>{{ num }}</option>
        {% endfor %}
      </select>
      <span class="text-muted small">з <span id="total-pages">{{ paginator.num_pages }}</span></span>
    </div>
  </div>

  <nav aria-label="Навігація по новинках" class="mt-3" data-total-pages="{{ paginator.num_pages }}">
    <ul class="pagination pagination-sm justify-content-center mb-0">
      <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
        <a class="page-link" href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% else %}#{% endif %}" rel="prev">Попередня</a>
      </li>
      {% for num in paginator.page_range %}
        <li class="page-item {% if num == page_obj.number %}active{% endif %}">
          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
        </li>
      {% endfor %}
      <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
        <a class="page-link" href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% else %}#{% endif %}" rel="next">Наступна</a>
      </li>
    </ul>
  </nav>
  {% endif %}
</section>

<script>
  // Collapsible Featured и загрузка «Показать ещё» перенесены в main.js
</script>
{% endblock %}

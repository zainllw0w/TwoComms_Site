{% extends 'base.html' %}{% load static %}{% block title %}Кольори — {{ product.title }}{% endblock %}{% block content %}
<div class="row g-3 g-md-4">
  <div class="col-12 col-lg-4">
    <div class="card glass p-3 p-md-4">
      <h1 class="h6 fw-bold mb-3">Додати колір</h1>
      <form method="post" enctype="multipart/form-data" class="vstack gap-3">{% csrf_token %}
        <input type="hidden" name="action" value="add">
        <div>
          <label class="form-label">Вибрати з використаних</label>
          <select class="form-select bg-elevate" name="color_id">
            <option value="">— Вибрати —</option>
            {% for c in used_colors %}
              <option value="{{ c.id }}">{{ c.primary_hex }}{% if c.secondary_hex %}+{{ c.secondary_hex }}{% endif %}</option>
            {% endfor %}
          </select>
        </div>
        <div class="row g-2">
          <div class="col">
            <label class="form-label">Основний колір</label>
            <input type="color" class="form-control form-control-color" name="primary_hex" value="#000000">
          </div>
          <div class="col">
            <label class="form-label">Другий колір (опц.)</label>
            <input type="color" class="form-control form-control-color" name="secondary_hex" value="">
          </div>
        </div>
        <div>
          <label class="form-label">Порядок</label>
          <input type="number" class="form-control bg-elevate" name="order" value="0">
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="is_default" name="is_default">
          <label class="form-check-label" for="is_default">Зробити за замовчуванням</label>
        </div>
        <div>
          <label class="form-label">Фотографії (можна декілька)</label>
          <input type="file" class="form-control bg-elevate" name="images" multiple accept="image/*">
        </div>
        <div class="d-flex gap-2">
          <a href="/admin-panel/?section=catalogs" class="btn btn-outline-light">Назад</a>
          <button class="btn btn-cta">Додати</button>
        </div>
      </form>
    </div>
  </div>
  <div class="col-12 col-lg-8">
    <div class="card glass p-3 p-md-4">
      <h2 class="h6 fw-bold mb-3">Варіанти кольорів — {{ product.title }}</h2>
      <div class="vstack gap-3">
        {% for v in variants %}
          <div class="border rounded-4 p-3 bg-elevate">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center gap-2">
                <div class="rounded-circle overflow-hidden" style="width:26px;height:26px;border:1px solid rgba(255,255,255,.2)">
                  {% if v.color.secondary_hex %}
                    <div style="width:26px;height:26px;background: linear-gradient(90deg, {{ v.color.primary_hex }} 0 50%, {{ v.color.secondary_hex }} 50% 100%);"></div>
                  {% else %}
                    <div style="width:26px;height:26px;background: {{ v.color.primary_hex }}"></div>
                  {% endif %}
                </div>
                <div class="small">
                  <div class="fw-semibold">{{ v.color.primary_hex }}{% if v.color.secondary_hex %}+{{ v.color.secondary_hex }}{% endif %}</div>
                  {% if v.is_default %}<div class="badge text-bg-secondary">За замовчуванням</div>{% endif %}
                </div>
              </div>
              <form method="post" class="ms-2">{% csrf_token %}
                <input type="hidden" name="action" value="delete_variant">
                <input type="hidden" name="variant_id" value="{{ v.id }}">
                <button class="btn btn-sm btn-outline-light" onclick="return confirm('Видалити варіант?')">Видалити</button>
              </form>
            </div>
            {% if v.images.all %}
              <div class="d-flex flex-wrap gap-2 mt-2">
                {% for img in v.images.all %}
                  <div class="position-relative">
                    <img src="{{ img.image.url }}" class="rounded-3" style="width:88px;height:88px;object-fit:cover">
                    <form method="post" class="position-absolute top-0 end-0 m-1">{% csrf_token %}
                      <input type="hidden" name="action" value="delete_image">
                      <input type="hidden" name="image_id" value="{{ img.id }}">
                      <button class="btn btn-sm btn-outline-light">×</button>
                    </form>
                  </div>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        {% empty %}
          <div class="text-secondary small">Немає жодного варіанту кольору.</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% extends 'base.html' %}
{% load static %}

{% block title %}Групи промокодів — TwoComms{% endblock %}

{% block content %}
<div class="promo-groups-admin-section">
  <!-- Заголовок секции -->
  <div class="promo-groups-header">
    <div class="promo-groups-title-section">
      <h1 class="promo-groups-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="me-2">
          <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
        </svg>
        Управління групами промокодів
      </h1>
      <div class="promo-groups-subtitle">
        Групи промокодів дозволяють обмежити використання кількох кодів одним користувачем
      </div>
    </div>
    
    <!-- Кнопки действий -->
    <div class="promo-groups-actions">
      <a href="{% url 'admin_promocodes' %}" class="back-to-codes-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
        До промокодів
      </a>
      <a href="{% url 'admin_promo_group_create' %}" class="create-group-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Створити групу
      </a>
    </div>
  </div>

  <!-- Список групп -->
  <div class="promo-groups-list">
    {% if groups %}
      {% for group in groups %}
      <div class="promo-group-card {% if not group.is_active %}inactive{% endif %}">
        <!-- Заголовок группы -->
        <div class="group-header">
          <div class="group-info">
            <div class="group-name-section">
              <h3 class="group-name">{{ group.name }}</h3>
              {% if group.one_per_account %}
              <span class="group-badge one-per-account">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                1 на акаунт
              </span>
              {% endif %}
            </div>
            {% if group.description %}
            <p class="group-description">{{ group.description }}</p>
            {% endif %}
          </div>
          
          <div class="group-status">
            <div class="status-indicator {% if group.is_active %}active{% else %}inactive{% endif %}">
              {% if group.is_active %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Активна
              {% else %}
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
                Неактивна
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Статистика группы -->
        <div class="group-stats">
          <div class="stat-card">
            <div class="stat-icon codes">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ group.codes_count }}</div>
              <div class="stat-label">Промокодів</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon active">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ group.active_codes_count }}</div>
              <div class="stat-label">Активних</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon usages">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ group.total_usages|default:0 }}</div>
              <div class="stat-label">Використань</div>
            </div>
          </div>

          <div class="stat-card date">
            <div class="stat-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ group.created_at|date:"d.m.Y" }}</div>
              <div class="stat-label">Створено</div>
            </div>
          </div>
        </div>

        <!-- Действия -->
        <div class="group-actions">
          <a href="{% url 'admin_promocodes' %}?group={{ group.id }}" class="action-btn view">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
            </svg>
            Переглянути промокоди
          </a>

          <a href="{% url 'admin_promo_group_edit' group.id %}" class="action-btn edit">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
            Редагувати
          </a>

          <a href="{% url 'admin_promo_group_delete' group.id %}" class="action-btn delete" onclick="return confirm('Видалити групу {{ group.name }}? Промокоди залишаться, але втратять зв\'язок з групою.')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
            Видалити
          </a>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="no-groups">
        <div class="no-groups-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
          </svg>
        </div>
        <div class="no-groups-text">Поки що немає груп промокодів</div>
        <p class="no-groups-hint">Створіть групу для організації промокодів за кампаніями або джерелами</p>
        <a href="{% url 'admin_promo_group_create' %}" class="create-first-btn">
          Створити першу групу
        </a>
      </div>
    {% endif %}
  </div>
</div>

<style>
.promo-groups-admin-section {
  padding: 2rem;
  max-width: 1400px;
  margin: 0 auto;
}

.promo-groups-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 2.5rem;
  gap: 2rem;
}

.promo-groups-title {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  color: white;
}

.promo-groups-subtitle {
  color: rgba(255, 255, 255, 0.6);
  font-size: 0.95rem;
  max-width: 600px;
}

.promo-groups-actions {
  display: flex;
  gap: 1rem;
  flex-shrink: 0;
}

.back-to-codes-btn,
.create-group-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  text-decoration: none;
  transition: all 0.2s;
  font-weight: 500;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.back-to-codes-btn {
  background: rgba(255, 255, 255, 0.05);
  color: white;
}

.create-group-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.back-to-codes-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-2px);
  color: white;
}

.create-group-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  color: white;
}

.promo-groups-list {
  display: grid;
  gap: 1.5rem;
}

.promo-group-card {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 16px;
  padding: 2rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.2s;
}

.promo-group-card:hover {
  border-color: rgba(255, 255, 255, 0.2);
  transform: translateY(-2px);
}

.promo-group-card.inactive {
  opacity: 0.6;
}

.group-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1.5rem;
  gap: 2rem;
}

.group-name-section {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.5rem;
}

.group-name {
  font-size: 1.5rem;
  font-weight: 600;
  color: white;
  margin: 0;
}

.group-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.35rem 0.75rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
}

.group-badge.one-per-account {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
}

.group-description {
  color: rgba(255, 255, 255, 0.6);
  margin: 0;
  font-size: 0.95rem;
}

.status-indicator {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 500;
}

.status-indicator.active {
  background: rgba(34, 197, 94, 0.1);
  color: #22c55e;
}

.status-indicator.inactive {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

.group-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.stat-card {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.stat-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.stat-icon.codes {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stat-icon.active {
  background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
}

.stat-icon.usages {
  background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}

.stat-icon.date {
  background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: white;
  line-height: 1;
}

.stat-label {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 0.25rem;
}

.group-actions {
  display: flex;
  gap: 0.75rem;
  padding-top: 1.5rem;
  border-top: 1px solid rgba(255, 255, 255, 0.05);
}

.action-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  text-decoration: none;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.2s;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.action-btn.view {
  background: rgba(59, 130, 246, 0.1);
  color: #3b82f6;
}

.action-btn.edit {
  background: rgba(34, 197, 94, 0.1);
  color: #22c55e;
}

.action-btn.delete {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
}

.action-btn:hover {
  transform: translateY(-2px);
}

.no-groups {
  text-align: center;
  padding: 4rem 2rem;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 16px;
  border: 2px dashed rgba(255, 255, 255, 0.1);
}

.no-groups-icon {
  margin-bottom: 1.5rem;
  opacity: 0.3;
}

.no-groups-text {
  font-size: 1.5rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0.5rem;
}

.no-groups-hint {
  color: rgba(255, 255, 255, 0.5);
  margin-bottom: 2rem;
}

.create-first-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 2rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-weight: 500;
  transition: all 0.2s;
}

.create-first-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  color: white;
}
</style>
{% endblock %}


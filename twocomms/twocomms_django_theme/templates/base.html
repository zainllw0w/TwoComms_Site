{% load static %}
{% load cache %}
{% load seo_tags %}
{% load image_optimization %}
<!DOCTYPE html>
<html lang='uk' data-bs-theme='dark' {% if not debug %} data-ga-id="G-109EFTWM05" data-clarity-id="t7u94cvpqc"
  data-meta-pixel-id="823958313630148" {% endif %}
  data-tiktok-pixel-id="{% if TIKTOK_PIXEL_ID %}{{ TIKTOK_PIXEL_ID }}{% else %}D43L7DBC77UA61AHLTVG{% endif %}" {% if
  TIKTOK_TEST_EVENT_CODE %} data-tiktok-test-event-code="{{ TIKTOK_TEST_EVENT_CODE }}" {% endif %}>

<head>
  {% if not debug %}
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://connect.facebook.net">
  <link rel="dns-prefetch" href="https://connect.facebook.net">
  <link rel="preconnect" href="https://analytics.tiktok.com">
  <link rel="dns-prefetch" href="https://analytics.tiktok.com">
  <link rel="preconnect" href="https://www.clarity.ms">
  <link rel="dns-prefetch" href="https://www.clarity.ms">

  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5J55Z4S');</script>
  <!-- End Google Tag Manager -->

  <!-- Analytics Loader -->
  <script src="{% static 'js/analytics-loader.js' %}" defer></script>
  {% endif %}

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}TwoComms - Тактичне спорядження{% endblock %}</title>
  <meta name="description"
    content="{% block meta_description %}TwoComms - якісне тактичне спорядження та одяг для військових. Власне виробництво, перевірена якість.{% endblock %}">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/favicon/apple-touch-icon.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon/favicon-16x16.png' %}">
  <link rel="manifest" href="{% static 'img/favicon/site.webmanifest' %}">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=2.0.2">

  {% block extra_css %}{% endblock %}
</head>

<body class="d-flex flex-column min-vh-100">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5J55Z4S" height="0" width="0"
      style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- Header -->
  <header class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}">
        <img src="{% static 'img/logo.png' %}" alt="TwoComms Logo" height="40" class="me-2">
        <span class="fw-bold text-uppercase tracking-wider">TwoComms</span>
      </a>

      <button class="navbar-toggler border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu"
        aria-controls="mobileMenu" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}"
              href="{% url 'home' %}">Головна</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'catalog' %}active{% endif %}"
              href="{% url 'catalog' %}">Каталог</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'about' %}active{% endif %}"
              href="{% url 'about' %}">Про нас</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'contacts' %}active{% endif %}"
              href="{% url 'contacts' %}">Контакти</a>
          </li>
        </ul>

        <div class="d-flex align-items-center gap-3">
          <!-- Search -->
          <form class="d-flex" action="{% url 'search' %}" method="get">
            <div class="input-group input-group-sm">
              <input class="form-control bg-dark text-light border-secondary" type="search" name="q" placeholder="Пошук"
                aria-label="Search" value="{{ request.GET.q }}">
              <button class="btn btn-outline-secondary" type="submit">
                <i class="bi bi-search"></i>
              </button>
            </div>
          </form>

          <!-- Cart -->
          <a href="{% url 'view_cart' %}" class="btn btn-outline-light position-relative border-0">
            <i class="bi bi-cart3 fs-5"></i>
            <span
              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger cart-badge {% if not cart_count %}d-none{% endif %}">
              {{ cart_count|default:"0" }}
            </span>
          </a>

          <!-- User Menu -->
          {% if user.is_authenticated %}
          <div class="dropdown">
            <button class="btn btn-outline-light border-0 dropdown-toggle d-flex align-items-center gap-2" type="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle fs-5"></i>
              <span class="d-none d-lg-inline">{{ user.first_name|default:user.username }}</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark shadow">
              <li><a class="dropdown-item" href="{% url 'profile' %}"><i class="bi bi-person me-2"></i>Профіль</a></li>
              <li><a class="dropdown-item" href="{% url 'order_history' %}"><i
                    class="bi bi-clock-history me-2"></i>Історія замовлень</a></li>
              {% if user.is_staff %}
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="{% url 'admin:index' %}"><i
                    class="bi bi-speedometer2 me-2"></i>Адмін-панель</a></li>
              {% endif %}
              <li>
                <hr class="dropdown-divider">
              </li>
              <li>
                <form action="{% url 'logout' %}" method="post" class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item text-danger">
                    <i class="bi bi-box-arrow-right me-2"></i>Вийти
                  </button>
                </form>
              </li>
            </ul>
          </div>
          {% else %}
          <a href="{% url 'login' %}" class="btn btn-primary btn-sm px-3">Увійти</a>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Menu Offcanvas -->
  <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
    <div class="offcanvas-header border-bottom border-secondary">
      <h5 class="offcanvas-title d-flex align-items-center gap-2" id="mobileMenuLabel">
        <img src="{% static 'img/logo.png' %}" alt="Logo" height="30">
        TwoComms
      </h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body d-flex flex-column">
      <ul class="navbar-nav fs-5 mb-4">
        <li class="nav-item">
          <a class="nav-link py-3 border-bottom border-secondary {% if request.resolver_match.url_name == 'home' %}active{% endif %}"
            href="{% url 'home' %}">
            <i class="bi bi-house-door me-2"></i>Головна
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link py-3 border-bottom border-secondary {% if request.resolver_match.url_name == 'catalog' %}active{% endif %}"
            href="{% url 'catalog' %}">
            <i class="bi bi-grid me-2"></i>Каталог
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link py-3 border-bottom border-secondary {% if request.resolver_match.url_name == 'about' %}active{% endif %}"
            href="{% url 'about' %}">
            <i class="bi bi-info-circle me-2"></i>Про нас
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link py-3 border-bottom border-secondary {% if request.resolver_match.url_name == 'contacts' %}active{% endif %}"
            href="{% url 'contacts' %}">
            <i class="bi bi-telephone me-2"></i>Контакти
          </a>
        </li>
      </ul>

      <div class="mt-auto">
        {% if user.is_authenticated %}
        <div class="d-grid gap-2">
          <a href="{% url 'profile' %}" class="btn btn-outline-light btn-lg text-start">
            <i class="bi bi-person-circle me-2"></i>Профіль
          </a>
          <form action="{% url 'logout' %}" method="post" class="d-grid">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-lg text-start">
              <i class="bi bi-box-arrow-right me-2"></i>Вийти
            </button>
          </form>
        </div>
        {% else %}
        <div class="d-grid gap-2">
          <a href="{% url 'login' %}" class="btn btn-primary btn-lg">Увійти</a>
          <a href="{% url 'register' %}" class="btn btn-outline-light btn-lg">Реєстрація</a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Messages -->
  {% if messages %}
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    {% for message in messages %}
    <div class="toast align-items-center text-bg-{{ message.tags|default:'info' }} border-0 show" role="alert"
      aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          {{ message }}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Main Content -->
  <main class="flex-grow-1">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="bg-dark text-light py-5 mt-auto border-top border-secondary">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-4 col-md-6">
          <h5 class="text-uppercase mb-4 fw-bold text-primary">TwoComms</h5>
          <p class="text-secondary mb-4">
            Якісне тактичне спорядження та одяг для військових. Власне виробництво, перевірені матеріали та надійність у
            кожному шві.
          </p>
          <div class="d-flex gap-3">
            <a href="#" class="btn btn-outline-secondary rounded-circle p-2 lh-1">
              <i class="bi bi-instagram"></i>
            </a>
            <a href="#" class="btn btn-outline-secondary rounded-circle p-2 lh-1">
              <i class="bi bi-facebook"></i>
            </a>
            <a href="#" class="btn btn-outline-secondary rounded-circle p-2 lh-1">
              <i class="bi bi-telegram"></i>
            </a>
          </div>
        </div>

        <div class="col-lg-2 col-md-6">
          <h5 class="text-uppercase mb-4 fw-bold">Навігація</h5>
          <ul class="list-unstyled d-flex flex-column gap-2">
            <li><a href="{% url 'home' %}" class="text-secondary text-decoration-none hover-text-light">Головна</a></li>
            <li><a href="{% url 'catalog' %}" class="text-secondary text-decoration-none hover-text-light">Каталог</a>
            </li>
            <li><a href="{% url 'about' %}" class="text-secondary text-decoration-none hover-text-light">Про нас</a>
            </li>
            <li><a href="{% url 'contacts' %}" class="text-secondary text-decoration-none hover-text-light">Контакти</a>
            </li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-6">
          <h5 class="text-uppercase mb-4 fw-bold">Клієнтам</h5>
          <ul class="list-unstyled d-flex flex-column gap-2">
            <li><a href="{% url 'delivery' %}" class="text-secondary text-decoration-none hover-text-light">Доставка та
                оплата</a></li>
            <li><a href="{% url 'returns' %}" class="text-secondary text-decoration-none hover-text-light">Обмін та
                повернення</a></li>
            <li><a href="{% url 'privacy_policy' %}"
                class="text-secondary text-decoration-none hover-text-light">Політика
                конфіденційності</a></li>
            <li><a href="{% url 'terms_of_service' %}"
                class="text-secondary text-decoration-none hover-text-light">Умови
                використання</a></li>
          </ul>
        </div>

        <div class="col-lg-3 col-md-6">
          <h5 class="text-uppercase mb-4 fw-bold">Контакти</h5>
          <ul class="list-unstyled d-flex flex-column gap-3">
            <li class="d-flex gap-3 text-secondary">
              <i class="bi bi-geo-alt text-primary"></i>
              <span>м. Київ, Україна</span>
            </li>
            <li class="d-flex gap-3 text-secondary">
              <i class="bi bi-telephone text-primary"></i>
              <a href="tel:+380999999999" class="text-secondary text-decoration-none hover-text-light">+380 99 999 99
                99</a>
            </li>
            <li class="d-flex gap-3 text-secondary">
              <i class="bi bi-envelope text-primary"></i>
              <a href="mailto:info@twocomms.shop"
                class="text-secondary text-decoration-none hover-text-light">info@twocomms.shop</a>
            </li>
            <li class="d-flex gap-3 text-secondary">
              <i class="bi bi-clock text-primary"></i>
              <span>Пн-Пт: 9:00 - 18:00<br>Сб-Нд: Вихідний</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-top border-secondary mt-5 pt-4 text-center text-secondary">
        <p class="mb-0">&copy; {% now "Y" %} TwoComms. Всі права захищено.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/main.js' %}"></script>

  <script>
    // Инициализация тултипов
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    // Инициализация тостов
    const toastElList = document.querySelectorAll('.toast')
    const toastList = [...toastElList].map(toastEl => new bootstrap.Toast(toastEl))
  </script>

  <!-- TikTok Pixel загружается через analytics-loader.js для избежания дублирования -->

  <!-- Meta Pixel Code - оптимизированная загрузка -->
  <div id="am" {% if request.user.is_authenticated %} data-external-id="{{ request.user.id }}" {% if request.user.email
    %}data-em="{{ request.user.email|lower|escapejs }}" {% elif request.user.userprofile and
    request.user.userprofile.email %}data-em="{{ request.user.userprofile.email|lower|escapejs }}" {% endif %} {% if
    request.user.userprofile and request.user.userprofile.phone
    %}data-ph="{{ request.user.userprofile.phone|escapejs }}" {% endif %} {% if request.user.userprofile and
    request.user.userprofile.full_name %}data-fn="{{ request.user.userprofile.full_name|escapejs }}" {% else
    %}data-fn="{{ request.user.first_name|escapejs }} {{ request.user.last_name|escapejs }}" {% endif %} {% if
    request.user.userprofile and request.user.userprofile.city %}data-ct="{{ request.user.userprofile.city|escapejs }}"
    {% endif %} {% endif %} style="display:none"></div>
  <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=823958313630148&ev=PageView&noscript=1" /></noscript>
  <!-- End Meta Pixel Code -->
  {% block structured_data %}{% endblock %}

  <!-- Google Tag Manager -->
</body>

</html>
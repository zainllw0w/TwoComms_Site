# Улучшение описания предоплаты в Monobank Checkout

**Дата:** 2025-01-25  
**Статус:** ✅ Завершено и развернуто

## Проблема

В Monobank Checkout при оформлении предоплаты (prepay_200) отображались:
- **Название:** "Передплата за товар '[название]'"
- **Описание:** "Передплата 200 грн"

Такой формат был избыточным и не давал полной информации о заказе.

## Решение

### Для предоплаты (prepay_200):

**Название:** Просто название товара (как при полной оплате)
- Пример: `Товар • розмір M • чорний`
- Без префикса "Передплата за товар"

**Цена:** 200 грн (предоплата)

**Описание:** 
- Если **1 товар:** "Залишок X грн — при отриманні на Новій Пошті"
- Если **несколько товаров:** "Передплата за N товарів. Залишок X грн — при отриманні на Новій Пошті"

### Для полной оплаты (online_full):

**Название:** Остается без изменений  
**Цена:** Полная сумма заказа  
**Описание:** Остается без изменений

## Примеры

### Пример 1: Один товар с предоплатой
```
Название: Футболка • розмір M • чорний
Цена: 200 грн
Описание: Залишок 350.00 грн — при отриманні на Новій Пошті
```

### Пример 2: Несколько товаров с предоплатой
```
Название: Футболка • розмір M • чорний
Цена: 200 грн  
Описание: Передплата за 3 товарів. Залишок 750.00 грн — при отриманні на Новій Пошті
```

## Изменения в коде

**Файл:** `twocomms/storefront/views.py`  
**Функция:** `_build_monobank_checkout_payload()`  
**Строки:** 5704-5723

### До:
```python
product_name = f'Передплата за товар "{prepay_label}"'
description = 'Передплата 200 грн'
```

### После:
```python
# Название просто от первого товара (как при полной оплате)
product_name = ' • '.join(label_parts) if label_parts else f'Замовлення {order.order_number}'

# Краткое описание
if items_count > 1:
    description = f'Передплата за {items_count} товарів. Залишок {remaining:.2f} грн — при отриманні на Новій Пошті'
else:
    description = f'Залишок {remaining:.2f} грн — при отриманні на Новій Пошті'
```

## Логика расчета

1. **Предоплата:** 200 грн (фиксированная)
2. **Полная сумма:** `order.total_sum + order.discount_amount`
3. **Остаток:** `полная_сумма - 200`

## Развертывание

- ✅ Закоммичено: "Improve prepayment description in Monobank checkout: show product name and remaining amount info"
- ✅ Запушено в `origin/main`
- ✅ Развернуто на продакшен
- ✅ Приложение перезапущено

## Преимущества

1. **Краткость:** Убрано дублирование слова "Передплата" в названии
2. **Информативность:** Добавлена информация об остатке к доплате
3. **Единообразие:** Название товара как при полной оплате
4. **Ясность:** Пользователь видит, сколько останется доплатить при получении


# üî¨ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó META PIXEL - –ü–û–õ–ù–´–ô –û–¢–ß–ï–¢

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-30  
**–í–µ—Ä—Å–∏—è:** 2.0 - Comprehensive Deep Analysis  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

---

## üìã EXECUTIVE SUMMARY

–ü—Ä–æ–≤–µ–¥–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Meta Pixel –Ω–∞ —Å–∞–π—Ç–µ TwoComms. –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–º–∞—é—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –∏ —Ä–∞–±–æ—Ç—É –ø–∏–∫—Å–µ–ª—è:

1. **üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø:** –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ `event_id` –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
2. **üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `event_id` –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π
3. **üü° –í–ê–ñ–ù–ê–Ø:** `event_id` –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
4. **üü° –í–ê–ñ–ù–ê–Ø:** –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π `external_id`
5. **üü° –í–ê–ñ–ù–ê–Ø:** ROAS –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Lead —Å–æ–±—ã—Ç–∏—è—Ö (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Meta)

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –ù–ï–°–û–í–ü–ê–î–ï–ù–ò–ï –§–û–†–ú–ê–¢–û–í EVENT_ID

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–°–ê–ú–ê–Ø –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** –ë—Ä–∞—É–∑–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç `event_id` –≤ **–†–ê–ó–ù–´–• —Ñ–æ—Ä–º–∞—Ç–∞—Ö**, —á—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–º–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### –ë—Ä–∞—É–∑–µ—Ä (analytics-loader.js, —Å—Ç—Ä–æ–∫–∞ 86-90):
```javascript
function generateEventId() {
  var timestamp = Date.now();
  var random = Math.floor(Math.random() * 1000000);
  return timestamp + '_' + random;
}
// –§–æ—Ä–º–∞—Ç: 1730304000000_123456
// –ü—Ä–∏–º–µ—Ä: 1730304000000_789012
```

#### –ë—Ä–∞—É–∑–µ—Ä (order_success.html, —Å—Ç—Ä–æ–∫–∞ 2018):
```javascript
var eventId = '{{ order.get_facebook_event_id }}';
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏ Order
// –§–æ—Ä–º–∞—Ç: {order_number}_{timestamp}_{event_type}
// –ü—Ä–∏–º–µ—Ä: TWC30102025N01_1730304000_purchase
```

#### –°–µ—Ä–≤–µ—Ä (models.py, —Å—Ç—Ä–æ–∫–∞ 115-130):
```python
def get_facebook_event_id(self, event_type='purchase'):
    timestamp = int(self.created.timestamp()) if self.created else int(time.time())
    return f"{self.order_number}_{timestamp}_{event_type}"
# –§–æ—Ä–º–∞—Ç: {order_number}_{timestamp}_{event_type}
# –ü—Ä–∏–º–µ—Ä: TWC30102025N01_1730304000_purchase
```

### –ü—Ä–æ–±–ª–µ–º–∞

1. **–í `order_success.html`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `'{{ order.get_facebook_event_id }}'` - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **–ù–û** –≤ `getTrackingContext()` (—Å—Ç—Ä–æ–∫–∞ 148) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `event_id` —á–µ—Ä–µ–∑ `generateEventId()` - —ç—Ç–æ **–î–†–£–ì–û–ô —Ñ–æ—Ä–º–∞—Ç**
3. **–ï—Å–ª–∏** `event_id` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞, –æ–Ω –±—É–¥–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ `timestamp_random`
4. **–°–µ—Ä–≤–µ—Ä** –æ–∂–∏–¥–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç `order_number_timestamp_event_type`
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è **–ù–ï –†–ê–ë–û–¢–ê–ï–¢**

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è generateEventId()

1. **getTrackingContext()** (—Å—Ç—Ä–æ–∫–∞ 148) - –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
2. **trackEvent()** (—Å—Ç—Ä–æ–∫–∞ 173) - –µ—Å–ª–∏ `event_id` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –≤ payload

### –†–µ—à–µ–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç 1: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

–ò–∑–º–µ–Ω–∏—Ç—å `generateEventId()` —á—Ç–æ–±—ã –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç —á—Ç–æ –∏ —Å–µ—Ä–≤–µ—Ä:

```javascript
function generateEventId(orderNumber, eventType) {
  if (orderNumber && eventType) {
    var timestamp = Math.floor(Date.now() / 1000); // Unix timestamp –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    return orderNumber + '_' + timestamp + '_' + eventType;
  }
  // Fallback –¥–ª—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑ –∑–∞–∫–∞–∑–∞
  var timestamp = Date.now();
  var random = Math.floor(Math.random() * 1000000);
  return timestamp + '_' + random;
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ order.get_facebook_event_id()**

–í `order_success.html` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
- `event_id` –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `generateEventId()` –¥–ª—è Purchase/Lead —Å–æ–±—ã—Ç–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `'{{ order.get_facebook_event_id }}'` –∏–∑ —à–∞–±–ª–æ–Ω–∞

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #2: –ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø EVENT_ID –î–õ–Ø LEAD

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê:** –í `order_success.html` –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `_lead` –∫ —É–∂–µ –≥–æ—Ç–æ–≤–æ–º—É `event_id`, —á—Ç–æ –ª–æ–º–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### –ë—Ä–∞—É–∑–µ—Ä (order_success.html, —Å—Ç—Ä–æ–∫–∞ 2099):
```javascript
var leadEventId = '{{ order.get_facebook_event_id }}_lead';
// –ü—Ä–æ–±–ª–µ–º–∞: get_facebook_event_id() —É–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å event_type
// –†–µ–∑—É–ª—å—Ç–∞—Ç: "TWC30102025N01_1730304000_purchase_lead" ‚ùå
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "TWC30102025N01_1730304000_lead" ‚úÖ
```

#### –°–µ—Ä–≤–µ—Ä (facebook_conversions_service.py, —Å—Ç—Ä–æ–∫–∞ 421):
```python
event_id = order.get_facebook_event_id(event_type='lead')
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ: "TWC30102025N01_1730304000_lead" ‚úÖ
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

1. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `TWC..._purchase_lead`, —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `TWC..._lead`
2. **–î–≤–æ–π–Ω–æ–π –ø–æ–¥—Å—á–µ—Ç:** Facebook –≤–∏–¥–∏—Ç –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è
3. **–ù–µ—Ç–æ—á–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:** –í Events Manager –≤–∏–¥–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã

### –†–µ—à–µ–Ω–∏–µ

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ order_success.html (—Å—Ç—Ä–æ–∫–∞ 2099):**

```javascript
// –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
var leadEventId = '{{ order.get_facebook_event_id }}_lead';

// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
// –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —à–∞–±–ª–æ–Ω–µ)
var leadEventId = '{{ order.get_facebook_event_id|default:"" }}';
// –ù–æ —ç—Ç–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–∞–∫ –∫–∞–∫ Django template –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–æ–≤

// –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ –º–æ–¥–µ–ª—å Order
// –í models.py:
def get_lead_event_id(self):
    return self.get_facebook_event_id(event_type='lead')

// –í —à–∞–±–ª–æ–Ω–µ:
var leadEventId = '{{ order.get_lead_event_id }}';
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JavaScript –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

```javascript
var baseEventId = '{{ order.get_facebook_event_id }}';
// –£–¥–∞–ª—è–µ–º _purchase –µ—Å–ª–∏ –µ—Å—Ç—å, –¥–æ–±–∞–≤–ª—è–µ–º _lead
var leadEventId = baseEventId.replace(/_purchase$/, '') + '_lead';
```

---

## üü° –í–ê–ñ–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #3: EVENT_ID –ù–ï –°–û–•–†–ê–ù–Ø–ï–¢–°–Ø –ü–†–ò –°–û–ó–î–ê–ù–ò–ò –ó–ê–ö–ê–ó–ê

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ `event_id` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ —á–µ—Ä–µ–∑ `getTrackingContext()`, –Ω–æ:
1. –û–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ** (timestamp_random)
2. –û–Ω **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ `order_success.html` (—Ç–∞–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —à–∞–±–ª–æ–Ω Django)
3. –°–µ—Ä–≤–µ—Ä **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç** –µ–≥–æ –∏–∑ `tracking_data` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### –ö–ª–∏–µ–Ω—Ç (main.js, —Å—Ç—Ä–æ–∫–∞ 731-733):
```javascript
if (window.getTrackingContext && typeof window.getTrackingContext === 'function') {
  const tracking = window.getTrackingContext();
  payload.tracking = tracking; // –°–æ–¥–µ—Ä–∂–∏—Ç event_id –≤ —Ñ–æ—Ä–º–∞—Ç–µ timestamp_random
}
```

#### –°–µ—Ä–≤–µ—Ä (monobank.py, —Å—Ç—Ä–æ–∫–∞ 732):
```python
# –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º server-side –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å–ª–∏ –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å, –∫—Ä–æ–º–µ event_id
if key in tracking_context and key != 'event_id':
    continue
tracking_context[key] = value
# event_id —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ tracking_context
```

#### –°–µ—Ä–≤–µ—Ä (facebook_conversions_service.py, —Å—Ç—Ä–æ–∫–∞ 310):
```python
event_id = tracking_data.get('event_id')
if event_id:
    logger.info(f"üìä Using event_id from tracking_data: {event_id}")
# –ù–æ event_id –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è
```

### –ü—Ä–æ–±–ª–µ–º–∞

1. `event_id` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `timestamp_random` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `payment_payload['tracking']['event_id']`
3. –ù–æ –≤ `order_success.html` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `'{{ order.get_facebook_event_id }}'` - –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç
4. –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `event_id` –∏–∑ `tracking_data`, –Ω–æ –æ–Ω –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –†–µ—à–µ–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞**

`event_id` –¥–æ–ª–∂–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è **—Ç–æ–ª—å–∫–æ** –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏—è, –Ω–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.

**–í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π event_id**

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `event_id`, –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `order_number_timestamp_event_type`:

```javascript
// –í main.js –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:
const tracking = window.getTrackingContext();
// –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º event_id –∑–¥–µ—Å—å, –æ–Ω –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ–∑–∂–µ
delete tracking.event_id;
payload.tracking = tracking;
```

---

## üü° –í–ê–ñ–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #4: –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø EXTERNAL_ID

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

`external_id` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### –ë—Ä–∞—É–∑–µ—Ä (order_success.html, —Å—Ç—Ä–æ–∫–∏ 1875-1896):
```javascript
var externalSource = '';
if (userIdAttr) {
  externalSource = 'user:' + userIdAttr;
} else if (sessionKey) {
  externalSource = 'session:' + sessionKey;
} else if (orderNumber) {
  externalSource = 'order:' + orderNumber;
} else if (orderId) {
  externalSource = 'order:' + orderId;
}
if (!externalSource) {
  externalSource = 'order:' + (orderNumber || orderId || 'unknown');
}
var externalHash = window.__hashSHA256(externalSource);
```

#### –°–µ—Ä–≤–µ—Ä (checkout.py, —Å—Ç—Ä–æ–∫–∏ 263-293):
```python
external_source = None
if request.user.is_authenticated:
    external_source = f"user:{request.user.id}"
else:
    session_key = request.session.session_key
    if session_key:
        external_source = f"session:{session_key}"
    elif order.order_number:
        external_source = f"order:{order.order_number}"
    elif order.id:
        external_source = f"order:{order.id}"
if not external_source:
    external_source = f"order:unknown_{int(time.time())}"
tracking_context['external_id'] = external_source
```

#### –°–µ—Ä–≤–µ—Ä (facebook_conversions_service.py, —Å—Ç—Ä–æ–∫–∏ 160-189):
```python
external_source = tracking_data.get('external_id')
if not external_source:
    if order.user_id:
        external_source = f"user:{order.user_id}"
    elif order.session_key:
        external_source = f"session:{order.session_key}"
    elif order.order_number:
        external_source = f"order:{order.order_number}"
if external_source:
    hashed_external = self._hash_data(external_source)
    user_data.external_id = hashed_external
```

### –ü—Ä–æ–±–ª–µ–º–∞

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞–∑–Ω—ã–µ:**
   - –ë—Ä–∞—É–∑–µ—Ä: `user:` > `session:` > `order:orderNumber` > `order:orderId`
   - –°–µ—Ä–≤–µ—Ä: `user:` > `session:` > `order:orderNumber` > `order:orderId` > `order:unknown_timestamp`
2. **–ï—Å–ª–∏** `session_key` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º, `external_id` –±—É–¥–µ—Ç —Ä–∞–∑–Ω—ã–º
3. **–ï—Å–ª–∏** `orderNumber` –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `orderId` (—á–∏—Å–ª–æ), –∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ - `orderNumber` (—Å—Ç—Ä–æ–∫–∞)

### –†–µ—à–µ–Ω–∏–µ

**–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É:**

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `orderNumber`** –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω (–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
2. **–°–æ—Ö—Ä–∞–Ω—è—Ç—å `external_id` –≤ `payment_payload`** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π `external_id`** –≤ `order_success.html`

```javascript
// –í order_success.html:
var externalSource = el.dataset.externalId || ''; // –ò–∑ data-–∞—Ç—Ä–∏–±—É—Ç–∞
if (!externalSource) {
  // Fallback –ª–æ–≥–∏–∫–∞
}
```

---

## üü° –í–ê–ñ–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #5: ROAS –ù–ï –†–ê–°–°–ß–ò–¢–´–í–ê–ï–¢–°–Ø –ù–ê LEAD –°–û–ë–´–¢–ò–Ø–•

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–≠—Ç–æ –ù–ï –±–∞–≥, –∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å Meta Pixel:** ROAS —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ Purchase —Å–æ–±—ã—Ç–∏–π, –Ω–µ Lead —Å–æ–±—ã—Ç–∏–π.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ROAS –≤ Meta

1. **ROAS = Revenue / Ad Spend**
2. **Revenue** –±–µ—Ä–µ—Ç—Å—è –∏–∑ Purchase —Å–æ–±—ã—Ç–∏–π —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `value`
3. **Lead —Å–æ–±—ã—Ç–∏—è** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π –Ω–∞ –ª–∏–¥—ã
   - –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞
   - Lookalike –∞—É–¥–∏—Ç–æ—Ä–∏–π
   - –ù–æ **–ù–ï –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ROAS**

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

- ‚úÖ Purchase —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å `value` –∏ `currency` ‚Üí ROAS –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚ö†Ô∏è Lead —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å `value` –∏ `currency` ‚Üí –ù–æ ROAS –º–æ–∂–µ—Ç –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å—Å—è

### –†–µ—à–µ–Ω–∏–µ

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ Meta.** –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–∏–¥–µ—Ç—å ROAS –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç, –º–æ–∂–Ω–æ:
1. –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –º–µ—Ç—Ä–∏–∫—É –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å value
3. –ù–æ —ç—Ç–æ –Ω–µ –±—É–¥–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º ROAS –≤ Meta

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ #6: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è fbp/fbc

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ë—Ä–∞—É–∑–µ—Ä: –ß–∏—Ç–∞–µ—Ç –∏–∑ cookies `_fbp` –∏ `_fbc`
- –°–µ—Ä–≤–µ—Ä: –ß–∏—Ç–∞–µ—Ç –∏–∑ `payment_payload['tracking']['fbp']` –∏ `payment_payload['tracking']['fbc']`

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ cookies –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è (AdBlock), `fbp`/`fbc` –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.

### –ü—Ä–æ–±–ª–µ–º–∞ #7: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ user_data

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ë—Ä–∞—É–∑–µ—Ä: `window.__hashSHA256()` - SHA-256
- –°–µ—Ä–≤–µ—Ä: `hashlib.sha256()` - SHA-256
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è: `trim().toLowerCase()`

### –ü—Ä–æ–±–ª–µ–º–∞ #8: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ external_id + fbp

**–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Meta:** –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑:
1. `event_id` + `event_name` (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
2. `external_id` + `fbp` + `event_name` (fallback)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `event_id` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, Meta –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `external_id` + `fbp`, –Ω–æ —ç—Ç–æ –º–µ–Ω–µ–µ –Ω–∞–¥–µ–∂–Ω–æ.

---

## üìä –ü–û–õ–ù–ê–Ø –°–•–ï–ú–ê –ü–û–¢–û–ö–ê –°–û–ë–´–¢–ò–ô

### Purchase Event Flow

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –∑–∞–∫–∞–∑
   ‚Üì
2. order_success.html –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   ‚Üì
3. –ë—Ä–∞—É–∑–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç event_id:
   var eventId = '{{ order.get_facebook_event_id }}';
   // –†–µ–∑—É–ª—å—Ç–∞—Ç: "TWC30102025N01_1730304000_purchase"
   ‚Üì
4. –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ:
   fbq('track', 'Purchase', {value, currency}, {eventID: eventId})
   ‚Üì
5. –°–µ—Ä–≤–µ—Ä (monobank webhook) –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ
   ‚Üì
6. –°–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç event_id:
   event_id = order.get_facebook_event_id()
   // –†–µ–∑—É–ª—å—Ç–∞—Ç: "TWC30102025N01_1730304000_purchase"
   ‚Üì
7. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ Conversions API:
   Event(event_name='Purchase', event_id=event_id)
   ‚Üì
8. Meta –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–æ event_id + event_name
   ‚úÖ –î–û–õ–ñ–ù–û –†–ê–ë–û–¢–ê–¢–¨ (–µ—Å–ª–∏ event_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç)
```

### Lead Event Flow

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–æ—Å–∏—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É
   ‚Üì
2. order_success.html –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   ‚Üì
3. –ë—Ä–∞—É–∑–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç event_id:
   var leadEventId = '{{ order.get_facebook_event_id }}_lead';
   // –ü–†–û–ë–õ–ï–ú–ê: –†–µ–∑—É–ª—å—Ç–∞—Ç "TWC30102025N01_1730304000_purchase_lead" ‚ùå
   // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "TWC30102025N01_1730304000_lead" ‚úÖ
   ‚Üì
4. –ë—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ:
   fbq('track', 'Lead', {value, currency}, {eventID: leadEventId})
   ‚Üì
5. –°–µ—Ä–≤–µ—Ä (monobank webhook) –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–µ
   ‚Üì
6. –°–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç event_id:
   event_id = order.get_facebook_event_id(event_type='lead')
   // –†–µ–∑—É–ª—å—Ç–∞—Ç: "TWC30102025N01_1730304000_lead" ‚úÖ
   ‚Üì
7. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ Conversions API:
   Event(event_name='Lead', event_id=event_id)
   ‚Üì
8. Meta –ø—ã—Ç–∞–µ—Ç—Å—è –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å:
   ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ - event_id –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!
   –ë—Ä–∞—É–∑–µ—Ä: "TWC..._purchase_lead"
   –°–µ—Ä–≤–µ—Ä: "TWC..._lead"
```

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å event_id –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ**

   **–§–∞–π–ª:** `twocomms/twocomms_django_theme/templates/pages/order_success.html`
   
   **–°—Ç—Ä–æ–∫–∞ 2099:**
   ```javascript
   // –ë–´–õ–û:
   var leadEventId = '{{ order.get_facebook_event_id }}_lead';
   
   // –î–û–õ–ñ–ù–û –ë–´–¢–¨:
   // –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ –º–æ–¥–µ–ª—å Order:
   // def get_lead_event_id(self):
   //     return self.get_facebook_event_id(event_type='lead')
   // 
   // –í —à–∞–±–ª–æ–Ω–µ:
   var leadEventId = '{{ order.get_lead_event_id }}';
   ```

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å event_id –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π –≤ TikTok —Å–µ—Ä–≤–∏—Å–µ**

   **–§–∞–π–ª:** `twocomms/orders/tiktok_events_service.py`
   
   **–°—Ç—Ä–æ–∫–∞ 293:**
   ```python
   # –ë–´–õ–û:
   event_id = f"{order.get_facebook_event_id()}_lead"
   
   # –î–û–õ–ñ–ù–û –ë–´–¢–¨:
   event_id = order.get_facebook_event_id(event_type='lead')
   ```

3. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç event_id**

   **–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/analytics-loader.js`
   
   **–ü—Ä–æ–±–ª–µ–º–∞:** `generateEventId()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç `timestamp_random`, –Ω–æ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç `order_number_timestamp_event_type`
   
   **–†–µ—à–µ–Ω–∏–µ:** –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `generateEventId()` –¥–ª—è Purchase/Lead —Å–æ–±—ã—Ç–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `order.get_facebook_event_id()`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–ê–ñ–ù–´–ô (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

4. **–ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞**

   **–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/main.js`
   
   **–°—Ç—Ä–æ–∫–∞ 731-733:**
   ```javascript
   // –ë–´–õ–û:
   const tracking = window.getTrackingContext();
   payload.tracking = tracking; // –°–æ–¥–µ—Ä–∂–∏—Ç event_id –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   
   // –î–û–õ–ñ–ù–û –ë–´–¢–¨:
   const tracking = window.getTrackingContext();
   delete tracking.event_id; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
   payload.tracking = tracking;
   ```

5. **–£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é external_id**

   **–§–∞–π–ª:** `twocomms/twocomms_django_theme/templates/pages/order_success.html`
   
   **–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å `external_id` –≤ data-–∞—Ç—Ä–∏–±—É—Ç–µ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —à–∞–±–ª–æ–Ω–∞:
   ```html
   <div id="purchase-payload" 
        data-external-id="{{ order.payment_payload.tracking.external_id|default:'' }}">
   ```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô (–£–ª—É—á—à–µ–Ω–∏—è)

6. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

7. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Meta Events Manager**

8. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É**

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ event_id —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è Purchase

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
   ```javascript
   console.log('Purchase event_id:', eventId);
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞:
   ```python
   logger.info(f'Purchase event_id: {event_id}')
   ```
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ event_id **–¢–û–ß–ù–û —Å–æ–≤–ø–∞–¥–∞—é—Ç**

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ event_id —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è Lead

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
   ```javascript
   console.log('Lead event_id:', leadEventId);
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞:
   ```python
   logger.info(f'Lead event_id: {event_id}')
   ```
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ event_id **–¢–û–ß–ù–û —Å–æ–≤–ø–∞–¥–∞—é—Ç**

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ Meta Events Manager

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑
2. –û—Ç–∫—Ä—ã—Ç—å Meta Events Manager ‚Üí Test Events
3. –ù–∞–π—Ç–∏ —Å–æ–±—ã—Ç–∏–µ (Purchase –∏–ª–∏ Lead)
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç **–û–î–ò–ù –†–ê–ó**, –∞ –Ω–µ –¥–≤–∞–∂–¥—ã
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `event_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º —Å–æ–±—ã—Ç–∏—è—Ö

### –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ value –≤ Lead —Å–æ–±—ã—Ç–∏—è—Ö

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Meta Events Manager ‚Üí Test Events
3. –ù–∞–π—Ç–∏ Lead —Å–æ–±—ã—Ç–∏–µ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `value` = 200.00 (–∏–ª–∏ —Å—É–º–º–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã)
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `currency` = "UAH"

---

## üìù –ß–ï–ö–õ–ò–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

- [ ] **–ö–†–ò–¢–ò–ß–ù–û:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å event_id –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ (order_success.html)
- [ ] **–ö–†–ò–¢–ò–ß–ù–û:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å event_id –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π –≤ TikTok —Å–µ—Ä–≤–∏—Å–µ
- [ ] **–ö–†–ò–¢–ò–ß–ù–û:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç event_id (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å generateEventId() –¥–ª—è Purchase/Lead)
- [ ] **–í–ê–ñ–ù–û:** –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
- [ ] **–í–ê–ñ–ù–û:** –£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é external_id
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta Events Manager
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É Lead vs Purchase

---

## üîó –°–°–´–õ–ö–ò –ù–ê –ö–û–î

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:

1. **order_success.html** (—Å—Ç—Ä–æ–∫–∞ 2099):
   ```2099:2099:twocomms/twocomms_django_theme/templates/pages/order_success.html
   var leadEventId = '{{ order.get_facebook_event_id }}_lead';
   ```

2. **tiktok_events_service.py** (—Å—Ç—Ä–æ–∫–∞ 293):
   ```293:293:twocomms/orders/tiktok_events_service.py
   event_id = f"{order.get_facebook_event_id()}_lead"
   ```

3. **analytics-loader.js** (—Å—Ç—Ä–æ–∫–∞ 86-90):
   ```86:90:twocomms/twocomms_django_theme/static/js/analytics-loader.js
   function generateEventId() {
     var timestamp = Date.now();
     var random = Math.floor(Math.random() * 1000000);
     return timestamp + '_' + random;
   }
   ```

4. **models.py** (—Å—Ç—Ä–æ–∫–∏ 115-130):
   ```115:130:twocomms/orders/models.py
   def get_facebook_event_id(self, event_type='purchase'):
       timestamp = int(self.created.timestamp()) if self.created else int(time.time())
       return f"{self.order_number}_{timestamp}_{event_type}"
   ```

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Meta Pixel:

1. **Event Deduplication:**
   - https://developers.facebook.com/docs/marketing-api/conversions-api/deduplicate-pixel-and-server-events
   - –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ `event_id` –∏ `event_name` –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º

2. **Event ID Format:**
   - Meta –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
   - –ù–æ `event_id` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—É–Ω–∏–∫–∞–ª—å–Ω—ã–º** –∏ **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–º** –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏–π

3. **Lead Events:**
   - Lead —Å–æ–±—ã—Ç–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `value` –∏ `currency`
   - –ù–æ ROAS –æ–±—ã—á–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ Purchase —Å–æ–±—ã—Ç–∏–π

---

## üîí –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò –ë–õ–û–ö–ò–†–û–í–û–ö

### –ü—Ä–æ–±–ª–µ–º–∞ #9: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–∏–∫—Å–µ–ª–µ–π AdBlock

**–û–ø–∏—Å–∞–Ω–∏–µ:** AdBlock –∏ –¥—Ä—É–≥–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É Meta Pixel —Å–∫—Ä–∏–ø—Ç–∞.

**–¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞:**
- ‚úÖ –ï—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ `onerror` (—Å—Ç—Ä–æ–∫–∞ 902-908)
- ‚úÖ –ï—Å—Ç—å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π (`_fbqBuffer`)
- ‚úÖ –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `_fbqLoaded` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ –ø–∏–∫—Å–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, `_fbqLoaded` –æ—Å—Ç–∞–µ—Ç—Å—è `false`
- –°–æ–±—ã—Ç–∏—è –±—É—Ñ–µ—Ä–∏–∑—É—é—Ç—Å—è, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- Conversions API –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ fallback, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Conversions API —Ä–∞–±–æ—Ç–∞–µ—Ç** - —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π fallback
2. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–æ–≥–¥–∞ –ø–∏–∫—Å–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. **–£–≤–µ–¥–æ–º–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä

### –ü—Ä–æ–±–ª–µ–º–∞ #10: SessionStorage –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω

**–û–ø–∏—Å–∞–Ω–∏–µ:** `sessionStorage` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–µ–π, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (order_success.html, —Å—Ç—Ä–æ–∫–∏ 1824-1834):**
```javascript
var leadStorageKey = 'gtm_lead_' + orderId;
var purchaseStorageKey = 'gtm_purchase_' + orderId;
var leadAlreadySent = shouldSendLead && sessionStorage.getItem(leadStorageKey);
var purchaseAlreadySent = shouldSendPurchase && sessionStorage.getItem(purchaseStorageKey);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `sessionStorage` –æ—á–∏—â–µ–Ω (–±—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç, —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ), —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `localStorage`** –≤–º–µ—Å—Ç–æ `sessionStorage` (–Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏)
2. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ** - –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏–µ –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (—á–µ—Ä–µ–∑ `payment_payload['facebook_events']`)
3. **–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∏ `sessionStorage`, –∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ñ–ª–∞–≥

### –ü—Ä–æ–±–ª–µ–º–∞ #11: CSP (Content Security Policy) –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å

**–û–ø–∏—Å–∞–Ω–∏–µ:** CSP –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤ Meta Pixel.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ CSP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `connect.facebook.net` —Ä–∞–∑—Ä–µ—à–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSP –∑–∞–≥–æ–ª–æ–≤–∫–∏** –≤ –æ—Ç–≤–µ—Ç–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞
2. **–î–æ–±–∞–≤–∏—Ç—å `connect.facebook.net`** –≤ `script-src` –∏ `connect-src`

### –ü—Ä–æ–±–ª–µ–º–∞ #12: Cookies –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë—Ä–∞—É–∑–µ—Ä—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å cookies —Ç—Ä–µ—Ç—å–∏—Ö —Å—Ç–æ—Ä–æ–Ω, —á—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ `_fbp` –∏ `_fbc`.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `ensureFbpCookie()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `_fbp`
- ‚úÖ –ï—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `ensureFbcCookie()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `_fbc`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ cookies –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, `_fbp` –∏ `_fbc` –Ω–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã
- –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ (–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å `event_id`)

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `event_id`** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ (—ç—Ç–æ —É–∂–µ –¥–µ–ª–∞–µ—Ç—Å—è)
2. **–ù–µ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ `fbp`/`fbc`** –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò

### –ü—Ä–æ–≤–µ—Ä–∫–∞ #1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è event_time

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ë—Ä–∞—É–∑–µ—Ä: `event_time` –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —è–≤–Ω–æ (Meta Pixel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è)
- –°–µ—Ä–≤–µ—Ä: `event_time = int(order.created.timestamp())` - –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –¥–∞–≤–Ω–æ, –∞ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–∑–∂–µ, `event_time` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ø—Ä–æ—à–ª–æ–º (–Ω–æ Meta –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ 7 –¥–Ω–µ–π).

### –ü—Ä–æ–≤–µ—Ä–∫–∞ #2: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è action_source

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ë—Ä–∞—É–∑–µ—Ä: –ù–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —è–≤–Ω–æ (Meta Pixel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'website' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –°–µ—Ä–≤–µ—Ä: `action_source = ActionSource.WEBSITE` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ #3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è event_source_url

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ë—Ä–∞—É–∑–µ—Ä: Meta Pixel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç URL
- –°–µ—Ä–≤–µ—Ä: `event_source_url = f"https://twocomms.com/orders/{order.order_number}/"` - –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ #4: –í–∞–ª–∏–¥–∞—Ü–∏—è value –∏ currency

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ë—Ä–∞—É–∑–µ—Ä: `parseFloat(value)` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ `>= 0` (—Å—Ç—Ä–æ–∫–∏ 255-259)
- –°–µ—Ä–≤–µ—Ä: `float(prepayment_amount or 0)` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ `<= 0` (—Å—Ç—Ä–æ–∫–∞ 438)

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `value = 0`, —Å–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ Meta.

---

## üìä –ü–û–õ–ù–ê–Ø –ú–ê–¢–†–ò–¶–ê –ü–†–û–ë–õ–ï–ú

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ |
|---|----------|-------------|--------|------|--------|
| 1 | –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ event_id | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚ùå | analytics-loader.js | 86-90 |
| 2 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π event_id –¥–ª—è Lead | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚ùå | order_success.html | 2099 |
| 3 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π event_id –¥–ª—è Lead (TikTok) | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚ùå | tiktok_events_service.py | 293 |
| 4 | event_id –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ | üü° –í–ê–ñ–ù–û | ‚ö†Ô∏è | main.js | 731-733 |
| 5 | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è external_id | üü° –í–ê–ñ–ù–û | ‚ö†Ô∏è | order_success.html | 1875-1896 |
| 6 | ROAS –Ω–µ –Ω–∞ Lead —Å–æ–±—ã—Ç–∏—è—Ö | üü¢ –ò–ù–§–û | ‚úÖ | - | - |
| 7 | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ AdBlock | üü° –í–ê–ñ–ù–û | ‚ö†Ô∏è | analytics-loader.js | 902-908 |
| 8 | SessionStorage –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω | üü° –í–ê–ñ–ù–û | ‚ö†Ô∏è | order_success.html | 1824-1834 |
| 9 | CSP –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å | üü° –í–ê–ñ–ù–û | ‚ùì | - | - |
| 10 | Cookies –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã | üü¢ –ò–ù–§–û | ‚ö†Ô∏è | analytics-loader.js | 94-140 |

---

---

## üìä –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –í–°–ï–• –°–û–ë–´–¢–ò–ô META PIXEL

### –°–æ–±—ã—Ç–∏–µ #1: PageView

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**PageView** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–π—Ç–∞.

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Å–µ—Ç–∏–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –∏ —Ä–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–µ

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Meta Pixel

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/analytics-loader.js`

**–°—Ç—Ä–æ–∫–∞ 942:**
```javascript
win.fbq('track', 'PageView');
```

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ Meta Pixel —Å–∫—Ä–∏–ø—Ç–∞
- –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `fbq('init', PIXEL_ID)`

#### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- Meta Pixel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- PageView –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API (—Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ï—Å–ª–∏ –ø–∏–∫—Å–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω AdBlock, PageView –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è
- ‚ö†Ô∏è –ï—Å–ª–∏ –ø–∏–∫—Å–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, PageView –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- ‚úÖ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–∏–∫—Å–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

---

### –°–æ–±—ã—Ç–∏–µ #2: ViewContent

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**ViewContent** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä.

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–π

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
- –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/templates/pages/product_detail_new.html`

**–°—Ç—Ä–æ–∫–∞ 480:**
```javascript
window.trackEvent('ViewContent', {
  content_ids: [String(pid)],
  content_name: title,
  content_type: 'product',
  content_category: category,
  value: price,
  currency: 'UAH'
});
```

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
- –° –∑–∞–¥–µ—Ä–∂–∫–æ–π 200ms (–º–æ–∂–µ—Ç –±—ã—Ç—å race condition)

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å content_ids:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `String(pid)` - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ ID —Ç–æ–≤–∞—Ä–∞
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `offer_id` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `TC-{id}-{color}-{SIZE}`
   - –≠—Ç–æ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Google Merchant Feed

2. **–ù–µ—Ç event_id:**
   - ViewContent –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ `event_id`
   - –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ ViewContent –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API
   - –ù–æ –¥–ª—è –ª—É—á—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

3. **–ó–∞–¥–µ—Ä–∂–∫–∞ 200ms:**
   - –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å race condition –µ—Å–ª–∏ –ø–∏–∫—Å–µ–ª–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å

#### ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```javascript
window.trackEvent('ViewContent', {
  content_ids: [offerId], // TC-123-456-XL
  content_name: title,
  content_type: 'product',
  content_category: category,
  value: price,
  currency: 'UAH',
  contents: [{
    id: offerId,
    quantity: 1,
    item_price: price
  }]
});
```

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- ViewContent –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API (—Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `offer_id` –≤–º–µ—Å—Ç–æ `pid` –≤ `content_ids`
2. –î–æ–±–∞–≤–∏—Ç—å `contents` –º–∞—Å—Å–∏–≤ –¥–ª—è –ª—É—á—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
3. –£–±—Ä–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –∏–ª–∏ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–∏–∫—Å–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

---

### –°–æ–±—ã—Ç–∏–µ #3: CustomizeProduct

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**CustomizeProduct** - –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–≤–∞—Ä–∞ (—Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä).

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å –∫–∞–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–≤–µ—Ç–∞ —Ç–æ–≤–∞—Ä–∞
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ç–æ–≤–∞—Ä–∞

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/product-detail.js`

**–°—Ç—Ä–æ–∫–∞ 77:**
```javascript
window.trackEvent('CustomizeProduct', {
  content_ids: [String(pid)],
  content_type: 'product',
  variant_id: variantId
});
```

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ—Ç value –∏ currency:**
   - CustomizeProduct –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `value` –∏ `currency`
   - –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –¥–ª—è –ª—É—á—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

2. **–ù–µ—Ç event_id:**
   - CustomizeProduct –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ `event_id`
   - –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ

3. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–≤–µ—Ç–∞:**
   - –ü—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞–∑–º–µ—Ä–∞ —Å–æ–±—ã—Ç–∏–µ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
   - –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```javascript
window.trackEvent('CustomizeProduct', {
  content_ids: [offerId], // TC-123-456-XL
  content_type: 'product',
  variant_id: variantId,
  value: price,
  currency: 'UAH'
});
```

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- CustomizeProduct –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API (—Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞–∑–º–µ—Ä–∞
2. –î–æ–±–∞–≤–∏—Ç—å `value` –∏ `currency` –¥–ª—è –ª—É—á—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `offer_id` –≤–º–µ—Å—Ç–æ `pid`

---

### –°–æ–±—ã—Ç–∏–µ #4: AddToCart

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**AddToCart** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É.

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–∏–ª —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–π

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
- –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª 1:** `twocomms/twocomms_django_theme/static/js/main.js`

**–°—Ç—Ä–æ–∫–∞ 1529:**
```javascript
window.trackEvent('AddToCart', payload);
```

**Payload —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è (—Å—Ç—Ä–æ–∫–∏ 1480-1528):**
```javascript
const payload = {
  content_ids: [offerId],
  value: itemValue,
  currency: 'UAH',
  num_items: qty,
  contents: [{
    id: offerId,
    quantity: qty,
    item_price: price,
    item_name: contentName,
    item_category: contentCategory,
    brand: 'TwoComms'
  }]
};
```

**–§–∞–π–ª 2:** `twocomms/twocomms_django_theme/static/js/product-detail.js`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `product-detail.js` AddToCart –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è! –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `main.js`.

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ—Ç event_id:**
   - AddToCart –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ `event_id`
   - –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ AddToCart –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API
   - –ù–æ –¥–ª—è –ª—É—á—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è offer_id:**
   - –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `offer_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ViewContent
   - –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```javascript
window.trackEvent('AddToCart', {
  content_ids: [offerId], // TC-123-456-XL
  value: itemValue,
  currency: 'UAH',
  num_items: qty,
  contents: [{
    id: offerId,
    quantity: qty,
    item_price: price,
    item_name: contentName,
    item_category: contentCategory,
    brand: 'TwoComms'
  }]
});
```

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- AddToCart –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API (—Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
2. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
3. ‚ö†Ô∏è –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `offer_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ViewContent

---

### –°–æ–±—ã—Ç–∏–µ #5: InitiateCheckout

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**InitiateCheckout** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞.

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—à–µ–ª –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–π

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ—Ä–∑–∏–Ω—ã
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/main.js`

**–°—Ç—Ä–æ–∫–∞ 663:**
```javascript
window.trackEvent('InitiateCheckout', {
  value: analytics.value,
  currency: analytics.currency,
  num_items: analytics.num_items,
  payment_method: 'monobank',
  content_ids: analytics.content_ids,
  contents: analytics.contents
});
```

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É Mono Checkout
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `getCheckoutAnalyticsPayload()`

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1. **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞:**
   - –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å `#checkout-payload`
   - –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ—Ç, —Å–æ–±—ã—Ç–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è

2. **–ù–µ—Ç event_id:**
   - InitiateCheckout –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ `event_id`
   - –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ InitiateCheckout –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API

3. **–ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –°–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
   - –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

#### ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```javascript
window.trackEvent('InitiateCheckout', {
  content_ids: analytics.content_ids,
  value: analytics.value,
  currency: analytics.currency,
  num_items: analytics.num_items,
  contents: analytics.contents
});
```

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- InitiateCheckout –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API (—Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç `#checkout-payload` –µ—Å—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ—Ä–∑–∏–Ω—ã
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –î–æ–±–∞–≤–∏—Ç—å `event_id` –¥–ª—è –ª—É—á—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

### –°–æ–±—ã—Ç–∏–µ #6: StartPayment

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**StartPayment** - –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–ø–ª–∞—Ç—É.

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç–∫–∞–∑—ã–≤–∞—é—Ç—Å—è

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã
- –ü–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/main.js`

**–°—Ç—Ä–æ–∫–∞ 770:**
```javascript
window.trackEvent('StartPayment', {
  value: analytics.value,
  currency: analytics.currency,
  num_items: analytics.num_items,
  payment_method: 'monobank_pay',
  content_ids: analytics.content_ids,
  contents: analytics.contents
});
```

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã

1. **–ö–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ:**
   - StartPayment - —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ
   - Meta –º–æ–∂–µ—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

2. **–ù–µ—Ç event_id:**
   - StartPayment –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ `event_id`
   - –≠—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ

#### ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:**
```javascript
window.trackEvent('StartPayment', {
  content_ids: analytics.content_ids,
  value: analytics.value,
  currency: analytics.currency,
  num_items: analytics.num_items,
  contents: analytics.contents,
  payment_method: 'monobank_pay'
});
```

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- StartPayment –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Conversions API (—Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
2. ‚ö†Ô∏è –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ `AddPaymentInfo` –≤–º–µ—Å—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ

---

### –°–æ–±—ã—Ç–∏–µ #7: Lead

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**Lead** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É –∏–ª–∏ –≤–Ω–æ—Å–∏—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É.

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∏–ª –∑–∞—è–≤–∫—É –∏–ª–∏ –≤–Ω–µ—Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π –Ω–∞ –ª–∏–¥—ã
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–π

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ü—Ä–∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–µ (payment_status = 'prepaid')
- –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ë—Ä–∞—É–∑–µ—Ä:** `twocomms/twocomms_django_theme/templates/pages/order_success.html`

**–°—Ç—Ä–æ–∫–∞ 2099:**
```javascript
var leadEventId = '{{ order.get_facebook_event_id }}_lead';
```

**–°—Ç—Ä–æ–∫–∞ 2115-2123:**
```javascript
var leadTrackPayload = {
  event_id: leadEventId,
  value: leadValue,
  currency: currency,
  content_name: 'Order ' + orderNumber,
  content_category: 'order_lead',
  content_type: 'lead',
  __meta: leadMeta
};
window.trackEvent('Lead', leadTrackPayload);
```

**–°–µ—Ä–≤–µ—Ä:** `twocomms/orders/facebook_conversions_service.py`

**–°—Ç—Ä–æ–∫–∞ 421:**
```python
event_id = order.get_facebook_event_id(event_type='lead')
```

#### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

1. **–ù–ï–°–û–í–ü–ê–î–ï–ù–ò–ï EVENT_ID:**
   - –ë—Ä–∞—É–∑–µ—Ä: `'{{ order.get_facebook_event_id }}_lead'` ‚Üí `TWC..._purchase_lead` ‚ùå
   - –°–µ—Ä–≤–µ—Ä: `order.get_facebook_event_id(event_type='lead')` ‚Üí `TWC..._lead` ‚úÖ
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï –†–ê–ë–û–¢–ê–ï–¢!

2. **Value –º–æ–∂–µ—Ç –±—ã—Ç—å 0:**
   - –ï—Å–ª–∏ `prepaidValue = 0`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback 200.00
   - –ù–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ value –≤—Å–µ–≥–¥–∞ > 0

3. **ROAS –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è:**
   - Lead —Å–æ–±—ã—Ç–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ROAS
   - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Meta, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å

#### ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–±—Ä–∞—É–∑–µ—Ä):**
```javascript
var leadEventId = '{{ order.get_lead_event_id }}'; // –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ—Ç–æ–¥ get_lead_event_id()
var leadTrackPayload = {
  event_id: leadEventId,
  value: leadValue, // prepaidValue –∏–ª–∏ 200.00
  currency: 'UAH',
  content_name: 'Order ' + orderNumber,
  __meta: {
    event_id: leadEventId,
    user_data: fbUserData,
    external_id: externalHash,
    fbp: fbpValue,
    fbc: fbcValue
  }
};
window.trackEvent('Lead', leadTrackPayload);
```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (—Å–µ—Ä–≤–µ—Ä):**
```python
event_id = order.get_facebook_event_id(event_type='lead')
custom_data.value = prepayment_amount or 200.0
custom_data.currency = 'UAH'
```

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- ‚úÖ Lead –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä, –∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
- ‚ùå –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –∏–∑-–∑–∞ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è event_id

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–ö–†–ò–¢–ò–ß–ù–û:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å event_id –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ value –≤—Å–µ–≥–¥–∞ > 0
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta Events Manager

---

### –°–æ–±—ã—Ç–∏–µ #8: Purchase

#### üìù –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

**Purchase** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Meta Pixel, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≤–µ—Ä—à–∞–µ—Ç –ø–æ–∫—É–ø–∫—É.

**–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≤–µ—Ä—à–∏–ª –ø–æ–∫—É–ø–∫—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ ROAS
- –ü–æ–º–æ–≥–∞–µ—Ç –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π

**–ö–æ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è:**
- –ü—Ä–∏ –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç–µ (payment_status = 'paid')
- –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞

#### üîç –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ë—Ä–∞—É–∑–µ—Ä:** `twocomms/twocomms_django_theme/templates/pages/order_success.html`

**–°—Ç—Ä–æ–∫–∞ 2018:**
```javascript
var eventId = '{{ order.get_facebook_event_id }}';
```

**–°—Ç—Ä–æ–∫–∞ 2046-2055:**
```javascript
var purchasePayloadPixels = {
  event_id: eventId,
  value: purchaseValue,
  currency: currency,
  content_type: 'product',
  content_ids: purchaseContents.map(function(item) { return item.id; }),
  contents: purchaseContents,
  content_name: 'Order ' + orderNumber,
  __meta: purchaseMeta
};
window.trackEvent('Purchase', purchasePayloadPixels);
```

**–°–µ—Ä–≤–µ—Ä:** `twocomms/orders/facebook_conversions_service.py`

**–°—Ç—Ä–æ–∫–∞ 318:**
```python
event_id = order.get_facebook_event_id()
```

#### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–µ—Å–ª–∏ event_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç)

**–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- ‚úÖ Purchase –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä, –∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å (–µ—Å–ª–∏ event_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç)

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ï—Å–ª–∏ event_id –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è –ï—Å–ª–∏ value = 0, —Å–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. ‚úÖ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
2. ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ event_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
3. ‚ö†Ô∏è –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ value –≤—Å–µ–≥–¥–∞ > 0

---

## üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã** —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π Meta Pixel, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–º–∞—é—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é:

1. ‚úÖ Purchase —Å–æ–±—ã—Ç–∏—è: –†–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–µ—Å–ª–∏ event_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç)
2. ‚ùå Lead —Å–æ–±—ã—Ç–∏—è: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å event_id
3. ‚ùå –§–æ—Ä–º–∞—Ç event_id: –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
4. ‚ö†Ô∏è ROAS: –ù–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Lead —Å–æ–±—ã—Ç–∏—è—Ö (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Meta)
5. ‚ö†Ô∏è ViewContent: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç content_ids
6. ‚ö†Ô∏è AddToCart: –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
7. ‚ö†Ô∏è InitiateCheckout: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å event_id –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π
2. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç event_id
3. **–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å content_ids –≤ ViewContent
4. **–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta Events Manager
5. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

---

## üîÑ –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–ò

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤ Meta Pixel

Meta Pixel –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

1. **Event ID + Event Name (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
   - –ë—Ä–∞—É–∑–µ—Ä: `fbq('track', 'Purchase', {...}, {eventID: 'EVENT_ID'})`
   - –°–µ—Ä–≤–µ—Ä: `event_id: 'EVENT_ID'`, `event_name: 'Purchase'`
   - –î–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å: `eventID` (–±—Ä–∞—É–∑–µ—Ä) = `event_id` (—Å–µ—Ä–≤–µ—Ä) –ò `event` (–±—Ä–∞—É–∑–µ—Ä) = `event_name` (—Å–µ—Ä–≤–µ—Ä)

2. **External ID + FBP (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)**
   - –ë—Ä–∞—É–∑–µ—Ä: `external_id` + `fbp` –≤ user_data
   - –°–µ—Ä–≤–µ—Ä: `external_id` + `fbp` –≤ user_data
   - –î–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å: `external_id` –ò `fbp`

### –ê–Ω–∞–ª–∏–∑ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è

#### PageView
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚ùå –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

#### ViewContent
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚ùå –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

#### CustomizeProduct
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚ùå –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

#### AddToCart
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚ùå –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

#### InitiateCheckout
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚ùå –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

#### StartPayment
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚ùå –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º

#### Lead
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚úÖ –¢–†–ï–ë–£–ï–¢–°–Ø
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä, –∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ë—Ä–∞—É–∑–µ—Ä: `eventID = '{{ order.get_facebook_event_id }}_lead'` ‚Üí `TWC..._purchase_lead`
- –°–µ—Ä–≤–µ—Ä: `event_id = order.get_facebook_event_id(event_type='lead')` ‚Üí `TWC..._lead`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Event ID –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï –†–ê–ë–û–¢–ê–ï–¢

**–†–µ—à–µ–Ω–∏–µ:**
- –ë—Ä–∞—É–∑–µ—Ä: `eventID = '{{ order.get_lead_event_id }}'` ‚Üí `TWC..._lead`
- –°–µ—Ä–≤–µ—Ä: `event_id = order.get_facebook_event_id(event_type='lead')` ‚Üí `TWC..._lead`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Event ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –†–ê–ë–û–¢–ê–ï–¢

#### Purchase
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** ‚úÖ –¢–†–ï–ë–£–ï–¢–°–Ø
- **–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä, –∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
- **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ú–û–ñ–ï–¢ –†–ê–ë–û–¢–ê–¢–¨ (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ë—Ä–∞—É–∑–µ—Ä: `eventID = '{{ order.get_facebook_event_id }}'` ‚Üí `TWC..._purchase`
- –°–µ—Ä–≤–µ—Ä: `event_id = order.get_facebook_event_id()` ‚Üí `TWC..._purchase`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Event ID –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å ‚Üí –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –î–û–õ–ñ–ù–ê –†–ê–ë–û–¢–ê–¢–¨

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ï—Å–ª–∏ `order.get_facebook_event_id()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è, timestamp –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è
- –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ event_id –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

---

## üß™ –°–¶–ï–ù–ê–†–ò–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ PageView

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ PageView –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–∞–π—Ç–∞
2. –û—Ç–∫—Ä—ã—Ç—å Facebook Pixel Helper
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ `PageView` –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–±—ã—Ç–∏–µ `PageView` –≤–∏–¥–Ω–æ –≤ Pixel Helper
- ‚úÖ –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ï—Å–ª–∏ –ø–∏–∫—Å–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, —Å–æ–±—ã—Ç–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è
- ‚ùå –ï—Å–ª–∏ –ø–∏–∫—Å–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, —Å–æ–±—ã—Ç–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ViewContent

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ ViewContent –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
2. –û—Ç–∫—Ä—ã—Ç—å Facebook Pixel Helper
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `ViewContent`
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `content_ids`, `value`, `currency`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–±—ã—Ç–∏–µ `ViewContent` –≤–∏–¥–Ω–æ –≤ Pixel Helper
- ‚úÖ `content_ids` —Å–æ–¥–µ—Ä–∂–∏—Ç `offer_id` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `TC-{id}-{color}-{SIZE}`
- ‚úÖ `value` > 0
- ‚úÖ `currency` = 'UAH'

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå `content_ids` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ `pid`, –∞ –Ω–µ `offer_id`
- ‚ö†Ô∏è –ù–µ—Ç `contents` –º–∞—Å—Å–∏–≤–∞

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AddToCart

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ AddToCart –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
2. –í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç –∏ —Ä–∞–∑–º–µ—Ä
3. –ù–∞–∂–∞—Ç—å "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"
4. –û—Ç–∫—Ä—ã—Ç—å Facebook Pixel Helper
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `AddToCart`
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `content_ids`, `value`, `currency`, `num_items`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–±—ã—Ç–∏–µ `AddToCart` –≤–∏–¥–Ω–æ –≤ Pixel Helper
- ‚úÖ `content_ids` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `ViewContent`
- ‚úÖ `value` > 0
- ‚úÖ `currency` = 'UAH'
- ‚úÖ `num_items` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `offer_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `ViewContent`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ InitiateCheckout

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ InitiateCheckout –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ –∫–æ—Ä–∑–∏–Ω—É

**–®–∞–≥–∏:**
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ—Ä–∑–∏–Ω—ã
3. –ù–∞–∂–∞—Ç—å "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" (Mono Checkout)
4. –û—Ç–∫—Ä—ã—Ç—å Facebook Pixel Helper
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `InitiateCheckout`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–±—ã—Ç–∏–µ `InitiateCheckout` –≤–∏–¥–Ω–æ –≤ Pixel Helper
- ‚úÖ `value` > 0
- ‚úÖ `currency` = 'UAH'
- ‚úÖ `num_items` = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –°–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –µ—Å–ª–∏ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ `#checkout-payload`
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Lead (–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞)

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Lead –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º event_id –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π (200 –≥—Ä–Ω)
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—Ö–∞
3. –û—Ç–∫—Ä—ã—Ç—å Facebook Pixel Helper
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `Lead` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `Lead` –≤ —Å–µ—Ä–≤–µ—Ä–µ (–ª–æ–≥–∏)
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta Events Manager

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–±—ã—Ç–∏–µ `Lead` –≤–∏–¥–Ω–æ –≤ Pixel Helper
- ‚úÖ `event_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
- ‚úÖ `value` = 200.00 (–∏–ª–∏ prepaidValue)
- ‚úÖ `currency` = 'UAH'
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤ Events Manager –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ)

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå `event_id` –ù–ï —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
- ‚ùå –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï –†–ê–ë–û–¢–ê–ï–¢
- ‚ö†Ô∏è –ï—Å–ª–∏ `prepaidValue = 0`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback 200.00

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Purchase (–ü–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞)

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Purchase –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º event_id –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—Ö–∞
3. –û—Ç–∫—Ä—ã—Ç—å Facebook Pixel Helper
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `Purchase` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `Purchase` –≤ —Å–µ—Ä–≤–µ—Ä–µ (–ª–æ–≥–∏)
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta Events Manager

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–±—ã—Ç–∏–µ `Purchase` –≤–∏–¥–Ω–æ –≤ Pixel Helper
- ‚úÖ `event_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
- ‚úÖ `value` = —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
- ‚úÖ `currency` = 'UAH'
- ‚úÖ `content_ids` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∑–∞–∫–∞–∑–∞
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤ Events Manager –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ)

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `event_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- ‚ö†Ô∏è –ï—Å–ª–∏ `value = 0`, —Å–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Lead –∏ Purchase

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –∏–ª–∏ –ø–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞)
2. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—Ö–∞
3. –û—Ç–∫—Ä—ã—Ç—å Meta Events Manager
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í Events Manager –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ (Lead –∏–ª–∏ Purchase)
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–±—Ä–∞—É–∑–µ—Ä + —Å–µ—Ä–≤–µ—Ä = –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ)

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –î–ª—è Lead: –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (event_id –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç)
- ‚ö†Ô∏è –î–ª—è Purchase: –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîç –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Event ID –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í Events Manager –≤–∏–¥–Ω–æ –¥–≤–∞ —Å–æ–±—ã—Ç–∏—è –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ë—Ä–∞—É–∑–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —Ä–∞–∑–Ω—ã–µ event_id

**–†–µ—à–µ–Ω–∏–µ:**
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é event_id
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ event_id
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Value = 0

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–æ–±—ã—Ç–∏—è –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è Meta
- ROAS –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:**
- Value –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–ª–∏ —Ä–∞–≤–µ–Ω 0

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ value –≤—Å–µ–≥–¥–∞ > 0
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –∑–Ω–∞—á–µ–Ω–∏–µ –µ—Å–ª–∏ value = 0
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å value –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Content IDs –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- Catalog Match Rate = 0%
- –†–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:**
- content_ids –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Google Merchant Feed

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `offer_id` –≤–º–µ—Å—Ç–æ `pid`
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `offer_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ñ–∏–¥–æ–º
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å `offer_id` –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ü–∏–∫—Å–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–æ–±—ã—Ç–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- Pixel Helper –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞:**
- AdBlock –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–∏–∫—Å–µ–ª—å
- CSP –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Conversions API –∫–∞–∫ fallback
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–≥–¥–∞ –ø–∏–∫—Å–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

---

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
- –í Events Manager –≤–∏–¥–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç—ã

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
- –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sessionStorage –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å event_id –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π**
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_lead_event_id()` –≤ –º–æ–¥–µ–ª—å Order
  - [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `order_success.html` (—Å—Ç—Ä–æ–∫–∞ 2099): `'{{ order.get_facebook_event_id }}_lead'` ‚Üí `'{{ order.get_lead_event_id }}'`
  - [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `tiktok_events_service.py` (—Å—Ç—Ä–æ–∫–∞ 293): `f"{order.get_facebook_event_id()}_lead"` ‚Üí `order.get_facebook_event_id(event_type='lead')`
  - [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `facebook_conversions_service.py` (—Å—Ç—Ä–æ–∫–∞ 421): —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `order.get_facebook_event_id(event_type='lead')`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta Events Manager

- [ ] **–°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞**
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é event_id –≤ `_collect_tracking_context` –∏–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
  - [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å `purchase_event_id` –∏ `lead_event_id` –≤ `payment_payload.tracking`
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ event_id –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: `checkout.py`, `monobank.py`, `views.py`

- [ ] **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç event_id**
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ event_id
  - [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π event_id –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–ê–ñ–ù–´–ô (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å content_ids –≤ ViewContent**
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `offer_id` –≤–º–µ—Å—Ç–æ `pid`
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `offer_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Google Merchant Feed
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `contents` –º–∞—Å—Å–∏–≤

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é Purchase**
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ event_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta Events Manager
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

- [ ] **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é value**
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ value –≤—Å–µ–≥–¥–∞ > 0
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –∑–Ω–∞—á–µ–Ω–∏–µ –µ—Å–ª–∏ value = 0
  - [ ] –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å value –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô (–£–ª—É—á—à–µ–Ω–∏—è)

- [ ] **–î–æ–±–∞–≤–∏—Ç—å event_id –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π**
  - [ ] ViewContent
  - [ ] AddToCart
  - [ ] InitiateCheckout
  - [ ] StartPayment

- [ ] **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - [ ] –ü—Ä–æ–≤–µ—Ä—è—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sessionStorage –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

- [ ] **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–≥–¥–∞ –ø–∏–∫—Å–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Conversions API –∫–∞–∫ fallback
  - [ ] –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

---

## üìä –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–Æ –í META EVENTS MANAGER

### –®–∞–≥ 1: –û—Ç–∫—Ä—ã—Ç—å Events Manager

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ Meta Events Manager: https://business.facebook.com/events_manager2
2. –í—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π Pixel ID
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "Test Events" –∏–ª–∏ "Events"

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è

1. –ù–∞–π—Ç–∏ —Å–æ–±—ã—Ç–∏–µ (Lead –∏–ª–∏ Purchase)
2. –û—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - `event_id` - –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
   - `event_name` - –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å
   - `value` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0
   - `currency` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'UAH'

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é

1. –í Events Manager –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ **–æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
2. –ï—Å–ª–∏ –≤–∏–¥–Ω–æ –¥–≤–∞ —Å–æ–±—ã—Ç–∏—è (–±—Ä–∞—É–∑–µ—Ä + —Å–µ—Ä–≤–µ—Ä), –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `event_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Deduplication Rate

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "Data Sources"
2. –í—ã–±—Ä–∞—Ç—å Conversions API
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å "Deduplication Rate"
4. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 90% –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## üîß –ß–¢–û –î–ï–õ–ê–¢–¨ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### 1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

- [ ] PageView –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- [ ] ViewContent –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- [ ] AddToCart –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
- [ ] InitiateCheckout –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
- [ ] Lead –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º event_id
- [ ] Purchase –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º event_id
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Lead
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Purchase

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Meta Events Manager

- [ ] –°–æ–±—ã—Ç–∏—è –≤–∏–¥–Ω—ã –≤ Events Manager
- [ ] Event ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ)
- [ ] Deduplication Rate > 90%

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ROAS

- [ ] ROAS —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è Purchase —Å–æ–±—ã—Ç–∏–π
- [ ] Value –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Currency = 'UAH'

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é

---

## üî¥ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó)

### –ü—Ä–æ–±–ª–µ–º–∞ #11: Event ID –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- `_collect_tracking_context` —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ `fbp`, `fbc`, `ttclid`, `external_id`, –Ω–æ **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç event_id**
- –í `monobank.py` —Å—Ç—Ä–æ–∫–∞ 732: `if key in tracking_context and key != 'event_id':` - event_id —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –í `analytics-loader.js` —Å—Ç—Ä–æ–∫–∞ 148: `event_id: generateEventId()` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ù–û–í–´–ô event_id –∫–∞–∂–¥—ã–π —Ä–∞–∑ (—Ñ–æ—Ä–º–∞—Ç: `timestamp_random`), —á—Ç–æ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–æ–º

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Event_id –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –•–æ—Ç—è `order.created` –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è (`auto_now_add=True`), –Ω–æ –µ—Å–ª–∏ –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º —à–∞–±–ª–æ–Ω–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Ä–µ–º—è, –∏ –µ—Å–ª–∏ order –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î, –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- –í –±—Ä–∞—É–∑–µ—Ä–µ: `'{{ order.get_facebook_event_id }}'` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —à–∞–±–ª–æ–Ω–∞
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: `order.get_facebook_event_id()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏—è
- –ï—Å–ª–∏ –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –º–æ–º–µ–Ω—Ç–∞–º–∏ order –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î, timestamp –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º (—Ö–æ—Ç—è –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ)

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –≤ `payment_payload.tracking.event_id`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π event_id –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å event_id –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

---

### –ü—Ä–æ–±–ª–µ–º–∞ #12: Race Condition —Å payment_status

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- `payment_status` –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- –í `nova_poshta_service.py` —Å—Ç—Ä–æ–∫–∞ 478: –∫–æ–≥–¥–∞ –ø–æ—Å—ã–ª–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞, `payment_status` –º–µ–Ω—è–µ—Ç—Å—è —Å `'prepaid'` –Ω–∞ `'paid'`
- –ï—Å–ª–∏ `payment_status` –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º —à–∞–±–ª–æ–Ω–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è, –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Lead —Å–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è, –µ—Å–ª–∏ `payment_status` —É–∂–µ –∏–∑–º–µ–Ω–∏–ª—Å—è –Ω–∞ `'paid'` –¥–æ —Ç–æ–≥–æ –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- Purchase —Å–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –¥–≤–∞–∂–¥—ã (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ, –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ—Å—ã–ª–∫–∏)

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å `payment_status` –≤ –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥–∏ `lead_sent` –∏ `purchase_sent` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—è—Ç—å `payment_status` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è

---

### –ü—Ä–æ–±–ª–µ–º–∞ #13: –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã event_id –≤ analytics-loader.js

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `analytics-loader.js` —Å—Ç—Ä–æ–∫–∞ 86-90: `generateEventId()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç event_id –≤ —Ñ–æ—Ä–º–∞—Ç–µ `timestamp_random` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `1730304000000_123456`)
- –í `models.py` —Å—Ç—Ä–æ–∫–∞ 130: `get_facebook_event_id()` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç event_id –≤ —Ñ–æ—Ä–º–∞—Ç–µ `{order_number}_{timestamp}_{event_type}` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `TWC30102025N01_1730304000_purchase`)
- –≠—Ç–æ **–†–ê–ó–ù–´–ï —Ñ–æ—Ä–º–∞—Ç—ã**!

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ï—Å–ª–∏ `getTrackingContext()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–¥–µ-—Ç–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π, event_id –±—É–¥–µ—Ç –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç event_id
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ event_id
3. –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `generateEventId()` –∏–∑ `analytics-loader.js` –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–æ–≤

---

### –ü—Ä–æ–±–ª–µ–º–∞ #14: Event ID –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í –±—Ä–∞—É–∑–µ—Ä–µ event_id –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω Django: `'{{ order.get_facebook_event_id }}'`
- –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ event_id –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ –º–æ–¥–µ–ª–∏: `order.get_facebook_event_id()`
- –•–æ—Ç—è –º–µ—Ç–æ–¥ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ, –Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ï—Å–ª–∏ –º–µ–∂–¥—É —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º —à–∞–±–ª–æ–Ω–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–±—ã—Ç–∏—è order –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î, timestamp –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º
- –•–æ—Ç—è `order.created` –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π event_id –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å event_id –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

---

### –ü—Ä–æ–±–ª–µ–º–∞ #15: –í monobank.py event_id —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –í `monobank.py` —Å—Ç—Ä–æ–∫–∞ 732: `if key in tracking_context and key != 'event_id':` - event_id —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∏–∑ `client_tracking`
- –ù–æ event_id –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –≤ `_collect_tracking_context`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- Event_id –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –∏–∑ `client_tracking`, –Ω–æ –µ—Å–ª–∏ –µ–≥–æ —Ç–∞–º –Ω–µ—Ç, –æ–Ω –Ω–µ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
2. –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å event_id –∏–∑ `client_tracking` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

---

## üìù –ò–¢–û–ì–û–í–ê–Ø –°–í–û–î–ö–ê

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. ‚ùå **Event ID –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç**
   - –ë—Ä–∞—É–∑–µ—Ä: `TWC..._purchase_lead`
   - –°–µ—Ä–≤–µ—Ä: `TWC..._lead`
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_lead_event_id()` –º–µ—Ç–æ–¥

2. ‚ùå **Event ID –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞**
   - `_collect_tracking_context` –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç event_id
   - Event_id –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - **–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –≤ `payment_payload.tracking.event_id`

3. ‚ö†Ô∏è **Event ID –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å –¥–ª—è Purchase**
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ event_id –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
   - **–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å event_id –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

4. ‚ö†Ô∏è **Race Condition —Å payment_status**
   - `payment_status` –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
   - **–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å `payment_status` –≤ –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

5. ‚ö†Ô∏è **–†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã event_id**
   - `analytics-loader.js` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç `timestamp_random`
   - `models.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç `{order_number}_{timestamp}_{event_type}`
   - **–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç event_id

### –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

1. ‚ö†Ô∏è **ViewContent –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π content_ids**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pid` –≤–º–µ—Å—Ç–æ `offer_id`
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `offer_id` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `TC-{id}-{color}-{SIZE}`

2. ‚ö†Ô∏è **Value –º–æ–∂–µ—Ç –±—ã—Ç—å 0**
   - –°–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã Meta
   - **–†–µ—à–µ–Ω–∏–µ:** –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å value –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

3. ‚ö†Ô∏è **–ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π**
   - –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å event_id –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
2. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

---

## üìå –§–ò–ù–ê–õ–¨–ù–´–ô –°–ü–ò–°–û–ö –í–°–ï–• –ù–ê–ô–î–ï–ù–ù–´–• –ü–†–û–ë–õ–ï–ú

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (15 –ø—Ä–æ–±–ª–µ–º)

1. ‚ùå Event ID –¥–ª—è Lead —Å–æ–±—ã—Ç–∏–π –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (–±—Ä–∞—É–∑–µ—Ä vs —Å–µ—Ä–≤–µ—Ä)
2. ‚ùå Event ID –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
3. ‚ùå Event ID –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å –¥–ª—è Purchase (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)
4. ‚ùå Race Condition —Å payment_status
5. ‚ùå –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã event_id (analytics-loader.js vs models.py)
6. ‚ùå Event ID –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
7. ‚ùå –í monobank.py event_id —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
8. ‚ùå ViewContent –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π content_ids (pid –≤–º–µ—Å—Ç–æ offer_id)
9. ‚ùå Value –º–æ–∂–µ—Ç –±—ã—Ç—å 0 (—Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã)
10. ‚ùå –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
11. ‚ùå InitiateCheckout –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
12. ‚ùå CustomizeProduct –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–≤–µ—Ç–∞, –Ω–µ —Ä–∞–∑–º–µ—Ä–∞
13. ‚ùå AddToCart –º–æ–∂–µ—Ç –±—ã—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
14. ‚ùå StartPayment - –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ, –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ
15. ‚ùå TikTok events service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç event_id –¥–ª—è Lead

### –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. ‚ö†Ô∏è –ù–µ—Ç event_id –¥–ª—è ViewContent, AddToCart, InitiateCheckout, StartPayment
2. ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
3. ‚ö†Ô∏è –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –ø–∏–∫—Å–µ–ª—è
4. ‚ö†Ô∏è –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
5. ‚ö†Ô∏è –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

---

**–ê–≤—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∞:** AI Assistant  
**–î–∞—Ç–∞:** 2025-01-30  
**–í–µ—Ä—Å–∏—è –æ—Ç—á–µ—Ç–∞:** 2.1 - Ultra Deep Analysis (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∞)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω  
**–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º:** 15 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö + 5 –≤–∞–∂–Ω—ã—Ö = 20 –ø—Ä–æ–±–ª–µ–º


# üéØ UTM Dispatcher - –ê—É–¥–∏—Ç –∏ –£–ª—É—á—à–µ–Ω–∏—è

## üìã –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: 2025-01-30

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **‚úÖ –ú–æ–¥–µ–ª–∏ (storefront/models.py)**
   - UTMSession: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
   - UserAction: –¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª–Ω—ã–µ, –∏–Ω–¥–µ–∫—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - Order —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ: utm_session FK –¥–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **‚úÖ Middleware (utm_middleware.py)**
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç platform IDs (fbclid, gclid, ttclid)
   - –ü–∞—Ä—Å–∏–Ω–≥ User-Agent —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞
   - –ë–æ—Ç–æ–≤ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç

3. **‚úÖ –£—Ç–∏–ª–∏—Ç—ã (utm_utils.py)**
   - get_client_ip(): –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç IP —á–µ—Ä–µ–∑ X-Forwarded-For
   - get_geolocation(): –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GeoIP2 + fallback
   - parse_user_agent(): –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –û–°, –±—Ä–∞—É–∑–µ—Ä–∞
   - sanitize_utm_param(): –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞
   - is_bot_user_agent(): –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–æ—Ç–æ–≤

4. **‚úÖ Tracking (utm_tracking.py)**
   - record_user_action(): –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø–∏—Å–∏
   - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è
   - link_order_to_utm(): –°–≤—è–∑—å –∑–∞–∫–∞–∑–æ–≤ —Å UTM
   - mark_as_converted(): –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π

5. **‚úÖ Analytics (utm_analytics.py)**
   - get_general_stats(): –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - get_sources_stats(): –ü–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
   - get_campaigns_stats(): –ü–æ –∫–∞–º–ø–∞–Ω–∏—è–º
   - get_funnel_stats(): –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
   - get_geo_stats(): –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
   - get_device_stats(): –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

6. **‚úÖ Views (storefront/views/admin.py)**
   - _build_dispatcher_context(): –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º (today/week/month/all_time)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ analytics —Ñ—É–Ω–∫—Ü–∏—è–º–∏

7. **‚úÖ Frontend (admin_dispatcher_section.html)**
   - –ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏
   - –ö–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ç—Ä–∏–∫
   - –¢–∞–±–ª–∏—Ü—ã —Å hover —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
   - –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π
   - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞

8. **‚úÖ Settings (twocomms/settings.py)**
   - Middleware –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –º–µ—Å—Ç–µ
   - –ü–µ—Ä–µ–¥ SimpleAnalyticsMiddleware

### üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

**–ù–ï–¢ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –û–®–ò–ë–û–ö!** ‚úÖ

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤—ã –∫ production.

---

## üöÄ –í–Ω–µ–¥—Ä–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2025-01-30)

### 1. ‚úÖ API Endpoints –¥–ª—è AJAX –∑–∞–≥—Ä—É–∑–∫–∏

**–§–∞–π–ª:** `storefront/utm_api_views.py` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª, 560+ —Å—Ç—Ä–æ–∫)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ UTMAnalyticsViewSet —Å DRF
- ‚úÖ GET `/api/utm/general-stats/?period=today`
- ‚úÖ GET `/api/utm/sources/?period=week&limit=20`
- ‚úÖ GET `/api/utm/campaigns/?period=month&source=facebook`
- ‚úÖ GET `/api/utm/content/?period=today&campaign=winter_sale`
- ‚úÖ GET `/api/utm/funnel/?period=week`
- ‚úÖ GET `/api/utm/geo/?period=month&limit=15`
- ‚úÖ GET `/api/utm/devices/?period=today`
- ‚úÖ GET `/api/utm/browsers/?period=week&limit=10`
- ‚úÖ GET `/api/utm/sessions/?period=today&limit=50`
- ‚úÖ GET `/api/utm/{id}/session_detail/` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏
- ‚úÖ GET `/api/utm/compare/?period=today` - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ø–µ—Ä–∏–æ–¥–æ–º
- ‚úÖ GET `/api/utm/roi/?period=today&ad_spend=5000` - —Ä–∞—Å—á–µ—Ç ROI

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Decimal –≤ float –¥–ª—è JSON
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ datetime –≤ ISO —Ñ–æ—Ä–º–∞—Ç
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å HTTP —Å—Ç–∞—Ç—É—Å–∞–º–∏
- Permissions: IsAdminUser
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

### 2. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV/Excel

**–§–∞–π–ª:** `storefront/utm_api_views.py` (—Ñ—É–Ω–∫—Ü–∏—è `export_utm_csv`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ GET `/api/utm/export-csv/?period=week&type=sessions`
- ‚úÖ GET `/api/utm/export-csv/?period=month&type=sources`
- ‚úÖ GET `/api/utm/export-csv/?period=today&type=campaigns`
- ‚úÖ GET `/api/utm/export-csv/?period=all_time&type=content`

**–¢–∏–ø—ã —ç–∫—Å–ø–æ—Ä—Ç–∞:**
1. **sessions** - –¥–µ—Ç–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç —Å–µ—Å—Å–∏–π:
   - ID, UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤—Å–µ 5)
   - IP, —Å—Ç—Ä–∞–Ω–∞, –≥–æ—Ä–æ–¥
   - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –û–°, –±—Ä–∞—É–∑–µ—Ä
   - –î–∞—Ç—ã –≤–∏–∑–∏—Ç–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–∑–∏—Ç–æ–≤
   - –ö–æ–Ω–≤–µ—Ä—Å–∏—è, —Ç–∏–ø –∫–æ–Ω–≤–µ—Ä—Å–∏–∏, –¥–∞—Ç–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

2. **sources** - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º:
   - –ò—Å—Ç–æ—á–Ω–∏–∫, —Å–µ—Å—Å–∏–∏, –∫–æ–Ω–≤–µ—Ä—Å–∏–∏, CR%, –¥–æ—Ö–æ–¥, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫, –±–∞–ª–ª—ã

3. **campaigns** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º:
   - –ò—Å—Ç–æ—á–Ω–∏–∫, –∫–∞–Ω–∞–ª, –∫–∞–º–ø–∞–Ω–∏—è, —Å–µ—Å—Å–∏–∏, –∫–æ–Ω–≤–µ—Ä—Å–∏–∏, CR%, –¥–æ—Ö–æ–¥

4. **content** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫—Ä–µ–∞—Ç–∏–≤–∞–º:
   - –ò—Å—Ç–æ—á–Ω–∏–∫, –∫–∞–º–ø–∞–Ω–∏—è, –∫–æ–Ω—Ç–µ–Ω—Ç, —Å–µ—Å—Å–∏–∏, –∫–æ–Ω–≤–µ—Ä—Å–∏–∏, CR%, –¥–æ—Ö–æ–¥

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- UTF-8 BOM –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Excel
- –£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ 1000 –∑–∞–ø–∏—Å–µ–π –¥–ª—è sessions
- –î–æ 100 –∑–∞–ø–∏—Å–µ–π –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º
- @staff_member_required –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä

**–ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ UI:**
- 3 –∫–Ω–æ–ø–∫–∏ –≤ admin_dispatcher_section.html
- Gradient –¥–∏–∑–∞–π–Ω —Å hover —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
- –ò–∫–æ–Ω–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ SVG
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞

---

### 3. ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Å—Å–∏–∏ (–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ)

**–§–∞–π–ª:** `admin_dispatcher_section.html` (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ + JavaScript)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ç–µ–º–Ω—ã–º —Ñ–æ–Ω–æ–º
- ‚úÖ API endpoint `/api/utm/{id}/session_detail/`
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–î–µ—Ç–∞–ª—ñ" –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ —Ç–∞–±–ª–∏—Ü—ã —Å–µ—Å—Å–∏–π
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC –∏–ª–∏ –∫–Ω–æ–ø–∫–µ √ó

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ:**
1. **UTM –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
   - –ò—Å—Ç–æ—á–Ω–∏–∫, –∫–∞–Ω–∞–ª, –∫–∞–º–ø–∞–Ω–∏—è, –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ

2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:**
   - –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –û–°, –±—Ä–∞—É–∑–µ—Ä, IP, –ª–æ–∫–∞—Ü–∏—è

3. **–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ 50 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö):**
   - –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è, –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, —Å—É–º–º–∞ –∫–æ—Ä–∑–∏–Ω—ã, –¥–∞—Ç–∞/–≤—Ä–µ–º—è
   - –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
   - –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∏–ø—É –¥–µ–π—Å—Ç–≤–∏—è

4. **–ó–∞–∫–∞–∑—ã (–µ—Å–ª–∏ –µ—Å—Ç—å):**
   - –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞, —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã, —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞, —Å—É–º–º–∞, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**–î–∏–∑–∞–π–Ω:**
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å gradient —Ñ–æ–Ω–æ–º
- Grid layout –¥–ª—è –¥–≤—É—Ö –∫–æ–ª–æ–Ω–æ–∫ (UTM + Device)
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –¥–∞–Ω–Ω—ã—Ö
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä (max-width: 1000px)
- Smooth –∞–Ω–∏–º–∞—Ü–∏–∏

---

### 4. ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ (Chart.js)

**–§–∞–π–ª:** `admin_dispatcher_section.html` (Chart.js –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

#### –ì—Ä–∞—Ñ–∏–∫ 1: –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π (Bar Chart)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –í–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ü–∏–∏ "–í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å—ñ–π"
- **–î–∞–Ω–Ω—ã–µ:** –°–µ—Å—Å–∏–∏ ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä—ã ‚Üí –í –∫–æ—Ä–∑–∏–Ω—É ‚Üí –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ ‚Üí –õ–∏–¥—ã ‚Üí –ü–æ–∫—É–ø–∫–∏
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
  - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –±–∞—Ä—ã —Å gradient –∑–∞–ª–∏–≤–∫–æ–π
  - –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —ç—Ç–∞–ø–∞–º –≤–æ—Ä–æ–Ω–∫–∏
  - –¢–æ–ª—â–∏–Ω–∞ border: 2px
  - Border radius: 8px –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö —É–≥–ª–æ–≤
- **–í—ã—Å–æ—Ç–∞:** 120px (fixed –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏)

#### –ì—Ä–∞—Ñ–∏–∫ 2: –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ (Line Chart)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ù–∞–¥ —Ç–∞–±–ª–∏—Ü–µ–π "–î–∂–µ—Ä–µ–ª–∞ —Ç—Ä–∞—Ñ—ñ–∫—É"
- **–î–∞–Ω–Ω—ã–µ:** Top 10 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- **–ú–µ—Ç—Ä–∏–∫–∏:** 2 –ª–∏–Ω–∏–∏ (–°–µ—Å—Å–∏–∏ –∏ –ö–æ–Ω–≤–µ—Ä—Å–∏–∏)
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
  - –ü–ª–∞–≤–Ω—ã–µ –∫—Ä–∏–≤—ã–µ (tension: 0.4)
  - –ó–∞–ª–∏–≤–∫–∞ –ø–æ–¥ –ª–∏–Ω–∏—è–º–∏ (fill: true)
  - –¢–æ—á–∫–∏ —Å hover —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
  - –õ–µ–≥–µ–Ω–¥–∞ —Å–≤–µ—Ä—Ö—É —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏
- **–í—ã—Å–æ—Ç–∞:** 140px
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
  - Hover –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  - –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞ (–ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Chart.js:**
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ (—Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞, —Å–µ—Ç–∫–∏)
- –®—Ä–∏—Ñ—Ç: Inter + system fonts
- –¢–µ–º–Ω—ã–π —Ñ–æ–Ω tooltip —Å border
- –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
- Responsive: true
- –£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∏

**CDN:**
```html
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
```

---

### 5. ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤

**–§–∞–π–ª:** `storefront/utm_analytics.py` (—Ñ—É–Ω–∫—Ü–∏—è `compare_periods`)

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è compare_periods(period) - 150+ —Å—Ç—Ä–æ–∫
- ‚úÖ API endpoint `/api/utm/compare/?period=today`

**–õ–æ–≥–∏–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è:**
- **today:** –°–µ–≥–æ–¥–Ω—è vs –≤—á–µ—Ä–∞
- **week:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π vs –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 7 –¥–Ω–µ–π
- **month:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π vs –ø—Ä–µ–¥—ã–¥—É—â–∏–µ 30 –¥–Ω–µ–π
- **all_time:** –í—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ vs –ø–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```json
{
  "current": {
    "total_sessions": 150,
    "total_conversions": 12,
    "conversion_rate": 8.0,
    "total_revenue": 36000,
    "avg_order_value": 3000
  },
  "previous": {
    "total_sessions": 120,
    "total_conversions": 8,
    "conversion_rate": 6.67,
    "total_revenue": 24000,
    "avg_order_value": 3000
  },
  "change": {
    "sessions": 25.0,          // +25%
    "conversions": 50.0,       // +50%
    "conversion_rate": 1.33,   // +1.33 percentage points
    "revenue": 50.0,           // +50%
    "avg_order_value": 0.0     // 0%
  }
}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ ‚Üë‚Üì –≤ UI
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–µ–ª–µ–Ω—ã–π/–∫—Ä–∞—Å–Ω—ã–π)
- –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫

---

### 6. ‚úÖ ROI –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä

**–§–∞–π–ª:** `storefront/utm_analytics.py` (—Ñ—É–Ω–∫—Ü–∏—è `calculate_roi`) + UI –≤ —à–∞–±–ª–æ–Ω–µ

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**

#### Backend (utm_analytics.py):
- ‚úÖ –§—É–Ω–∫—Ü–∏—è calculate_roi(period, ad_spend)
- ‚úÖ API endpoint `/api/utm/roi/?period=today&ad_spend=5000`

**–†–∞—Å—á–µ—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
1. **Revenue** - –¥–æ—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥ (–∏–∑ –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤)
2. **Ad Spend** - —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç)
3. **Profit** = Revenue - Ad Spend
4. **ROI** = (Profit / Ad Spend) √ó 100%
5. **ROAS** = Revenue / Ad Spend (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏)
6. **Cost Per Conversion** = Ad Spend / Conversions
7. **Avg Order Value** - —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫

#### Frontend (admin_dispatcher_section.html):
- ‚úÖ –°–µ–∫—Ü–∏—è "ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" —Å –∫—Ä–∞—Å–∏–≤—ã–º –¥–∏–∑–∞–π–Ω–æ–º
- ‚úÖ Input –¥–ª—è –≤–≤–æ–¥–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Ä–µ–∫–ª–∞–º—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –≤–≤–æ–¥–µ (JavaScript)
- ‚úÖ –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è ROI:
  - üü¢ –ó–µ–ª–µ–Ω—ã–π: ROI > 100%
  - üü° –ñ–µ–ª—Ç—ã–π: 0% < ROI ‚â§ 100%
  - üî¥ –ö—Ä–∞—Å–Ω—ã–π: ROI ‚â§ 0%

**Layout:**
```
[–í–≤–æ–¥ —Ä–∞—Å—Ö–æ–¥–æ–≤]  [–î–æ—Ö–æ–¥ (readonly)]  [ROI %]
     ‚Üì                 ‚Üì                  ‚Üì
[–ü—Ä–∏–±—ã–ª—å]         [ROAS]        [–°—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏]
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –≥—Ä–∏–≤–Ω–∞—Ö (UAH)
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- –ö—Ä–∞—Å–∏–≤—ã–π gradient –¥–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫
- –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
- Fallback –Ω–∞ 0 –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `storefront/utm_api_views.py` - 560+ —Å—Ç—Ä–æ–∫
- ‚úÖ `UTM_DISPATCHER_AUDIT_IMPROVEMENTS.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `storefront/api_urls.py` - –¥–æ–±–∞–≤–ª–µ–Ω UTMAnalyticsViewSet
- ‚úÖ `storefront/utm_analytics.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ 150+ —Å—Ç—Ä–æ–∫ (compare_periods, calculate_roi)
- ‚úÖ `admin_dispatcher_section.html` - –¥–æ–±–∞–≤–ª–µ–Ω–æ 300+ —Å—Ç—Ä–æ–∫ (–º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, Chart.js, –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞)

### –ù–æ–≤—ã–µ endpoints:
```
GET  /api/utm/general-stats/
GET  /api/utm/sources/
GET  /api/utm/campaigns/
GET  /api/utm/content/
GET  /api/utm/funnel/
GET  /api/utm/geo/
GET  /api/utm/devices/
GET  /api/utm/browsers/
GET  /api/utm/sessions/
GET  /api/utm/{id}/session_detail/
GET  /api/utm/compare/
GET  /api/utm/roi/
GET  /api/utm/export-csv/
```

### –ò—Ç–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:
- **13 –Ω–æ–≤—ã—Ö API endpoints**
- **4 —Ç–∏–ø–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ CSV**
- **2 –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞**
- **1 –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π**
- **1 ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å live-—Ä–∞—Å—á–µ—Ç–æ–º**
- **1 —Ñ—É–Ω–∫—Ü–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤**
- **~1200+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**

---

## üé® –í–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. Chart.js –≥—Ä–∞—Ñ–∏–∫–∏
- –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π: Bar chart —Å gradient
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞: Line chart —Å 2 –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞, –ø–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ tooltips

### 2. –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
- 3 –∫–Ω–æ–ø–∫–∏ —Å gradient —Ñ–æ–Ω–æ–º
- Hover —ç—Ñ—Ñ–µ–∫—Ç—ã (–ø–æ–¥–Ω—è—Ç–∏–µ + —Ç–µ–Ω—å)
- SVG –∏–∫–æ–Ω–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π - —Å–µ—Å—Å–∏–∏
  - –ó–µ–ª–µ–Ω—ã–π - –∏—Å—Ç–æ—á–Ω–∏–∫–∏
  - –û—Ä–∞–Ω–∂–µ–≤—ã–π - –∫–∞–º–ø–∞–Ω–∏–∏

### 3. ROI –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
- Grid layout 3 –∫–æ–ª–æ–Ω–∫–∏
- –¶–≤–µ—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏
- Live-—Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –≤–≤–æ–¥–µ
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è ROI

### 4. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- –¢–µ–º–Ω—ã–π gradient —Ñ–æ–Ω
- Grid layout –¥–ª—è –¥–≤—É—Ö –∫–æ–ª–æ–Ω–æ–∫
- –°–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º—ã–π —Å–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (√ó –∏ ESC)

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∏—Å–ø–µ—Ç—á–µ—Ä: https://twocomms.shop/admin-panel?section=dispatcher
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞ (—Å—å–æ–≥–æ–¥–Ω—ñ/—Ç–∏–∂–¥–µ–Ω—å/–º—ñ—Å—è—Ü—å/–≤–µ—Å—å —á–∞—Å)
3. –ù–∞–∂–º–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞:
   - "–ï–∫—Å–ø–æ—Ä—Ç —Å–µ—Å—ñ–π CSV"
   - "–ï–∫—Å–ø–æ—Ä—Ç –¥–∂–µ—Ä–µ–ª CSV"
   - "–ï–∫—Å–ø–æ—Ä—Ç –∫–∞–º–ø–∞–Ω—ñ–π CSV"
4. –§–∞–π–ª —Å–∫–∞—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–µ—Å—Å–∏–∏:
```
1. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–æ —Ç–∞–±–ª–∏—Ü—ã "–û—Å—Ç–∞–Ω–Ω—ñ —Å–µ—Å—ñ—ó"
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–µ—Ç–∞–ª—ñ" –Ω–∞ –ª—é–±–æ–π —Å—Ç—Ä–æ–∫–µ
3. –ò–∑—É—á–∏—Ç–µ –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Å—Å–∏–∏:
   - UTM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –±—Ä–∞—É–∑–µ—Ä
   - –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ó–∞–∫–∞–∑—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. –ó–∞–∫—Ä–æ–π—Ç–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (–∫–Ω–æ–ø–∫–∞ √ó –∏–ª–∏ ESC)
```

### 3. –†–∞—Å—á–µ—Ç ROI:
```
1. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é "ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
2. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É –∑–∞ –ø–µ—Ä–∏–æ–¥ (–≥—Ä–Ω)
3. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–≤–∏–¥–∏—Ç–µ:
   - ROI % (–æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å)
   - –ü—Ä–∏–±—ã–ª—å (–¥–æ—Ö–æ–¥ - —Ä–∞—Å—Ö–æ–¥—ã)
   - ROAS (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏)
   - –°—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
4. –¶–≤–µ—Ç ROI –ø–æ–∫–∞–∂–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:
   - üü¢ –ó–µ–ª–µ–Ω—ã–π > 100% - –æ—Ç–ª–∏—á–Ω–æ!
   - üü° –ñ–µ–ª—Ç—ã–π 0-100% - –æ–∫—É–ø–∞–µ—Ç—Å—è
   - üî¥ –ö—Ä–∞—Å–Ω—ã–π < 0% - —É–±—ã—Ç–æ—á–Ω–æ
```

### 4. API endpoints (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤):
```javascript
// –ü–æ–ª—É—á–∏—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
fetch('/api/utm/general-stats/?period=week')
  .then(r => r.json())
  .then(data => console.log(data));

// –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Å—Å–∏–∏
fetch('/api/utm/123/session_detail/')
  .then(r => r.json())
  .then(data => console.log(data));

// –°—Ä–∞–≤–Ω–∏—Ç—å –ø–µ—Ä–∏–æ–¥—ã
fetch('/api/utm/compare/?period=today')
  .then(r => r.json())
  .then(data => {
    console.log('Change:', data.change);
    // {sessions: 25.0, conversions: 50.0, ...}
  });

// –†–∞—Å—Å—á–∏—Ç–∞—Ç—å ROI
fetch('/api/utm/roi/?period=week&ad_spend=5000')
  .then(r => r.json())
  .then(data => {
    console.log('ROI:', data.roi + '%');
    console.log('ROAS:', data.roas + 'x');
  });
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- ‚úÖ Django REST Framework (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- ‚úÖ Chart.js 4.4.0 (CDN)
- ‚úÖ Python 3.10+
- ‚úÖ PostgreSQL/MySQL (–ª—é–±–∞—è –ë–î —Å JSON –ø–æ–ª—è–º–∏)

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ @staff_member_required –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ CSV
- ‚úÖ IsAdminUser permission –¥–ª—è –≤—Å–µ—Ö API endpoints
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ –¥–ª—è –≤—Å–µ—Ö POST –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ Rate limiting —á–µ—Ä–µ–∑ middleware (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

### Performance:
- ‚úÖ select_related / prefetch_related –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—Å–µ—Ö –ø–æ–ª—è—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (utm_source, utm_campaign, first_seen, etc.)
- ‚úÖ Limit –¥–ª—è –≤—Å–µ—Ö API –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20-50 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ @cache_page (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:
- ‚úÖ Pagination –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ CSV —ç–∫—Å–ø–æ—Ä—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω 1000 –∑–∞–ø–∏—Å–µ–π
- ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è

---

## üìà Roadmap (—á—Ç–æ –µ—â–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±—É–¥—É—â–µ–º)

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- [ ] **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ email-–æ—Ç—á–µ—Ç—ã** (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ/–µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ)
  - Celery task –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤
  - Email —Å PDF attachment
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ

- [ ] **Dashboard widgets** (–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–µ –≤–∏–¥–∂–µ—Ç—ã)
  - Drag & drop –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ layout
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –≤ localStorage
  - –í—ã–±–æ—Ä –≤–∏–¥–∏–º—ã—Ö –≤–∏–¥–∂–µ—Ç–æ–≤

- [ ] **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (WebSockets)
  - Django Channels –¥–ª—è WebSocket
  - Live —Å—á–µ—Ç—á–∏–∫–∏ —Å–µ—Å—Å–∏–π/–∫–æ–Ω–≤–µ—Ä—Å–∏–π
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏—è—Ö

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- [ ] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Meta Ads API**
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Ä–µ–∫–ª–∞–º—É
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–º–ø–∞–Ω–∏–π
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç ROI

- [ ] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Ads API**
  - –ò–º–ø–æ—Ä—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –∫–ª–∏–∫–æ–≤
  - –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–π
  - –ï–¥–∏–Ω—ã–π dashboard –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

- [ ] **–ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑**
  - Retention –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º
  - LTV (Lifetime Value) –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
  - Cohort heat map

- [ ] **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫—Ä–µ–∞—Ç–∏–≤–æ–≤
  - Statistical significance —Ç–µ—Å—Ç—ã
  - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
- [ ] **ML –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–π**
  - –ú–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è CR%
  - Seasonal trends detection
  - Anomaly detection

- [ ] **–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
  - openpyxl –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è XLSX
  - –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –ì—Ä–∞—Ñ–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ Excel

- [ ] **API –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**
  - React Native / Flutter SDK
  - Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–æ–Ω–≤–µ—Ä—Å–∏—è—Ö
  - –ú–æ–±–∏–ª—å–Ω—ã–π dashboard

---

## üéì –û–±—É—á–µ–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–æ–≤:
1. **–ö–∞–∫ —á–∏—Ç–∞—Ç—å –≤–æ—Ä–æ–Ω–∫—É –∫–æ–Ω–≤–µ—Ä—Å–∏–π:**
   - –°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–∞–ª–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
   - –ï—Å–ª–∏ –±–æ–ª—å—à–æ–π –æ—Ç–≤–∞–ª –Ω–∞ "–í –∫–æ—Ä–∑–∏–Ω—É" - –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
   - –ï—Å–ª–∏ –±–æ–ª—å—à–æ–π –æ—Ç–≤–∞–ª –Ω–∞ "–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è" - –ø—Ä–æ–±–ª–µ–º—ã —Å checkout –ø—Ä–æ—Ü–µ—Å—Å–æ–º

2. **–ö–∞–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏:**
   - –°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ CR% –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –°–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ - –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—Å–æ–∫–∏–π CR, –Ω–æ –Ω–∏–∑–∫–∏–π —á–µ–∫
   - –ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ –¥–æ—Ö–æ–¥ –∏ CR% –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π

3. **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä:**
   - –í–≤–æ–¥–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –∏–∑ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤
   - ROI > 100% = –ø—Ä–∏–±—ã–ª—å–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞
   - ROAS 3x –∏ –≤—ã—à–µ = –æ—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - –°—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å < 10% –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ —á–µ–∫–∞

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. **–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–µ—Ç—Ä–∏–∫—É:**
   ```python
   # –í utm_analytics.py
   def get_custom_metric(period: str) -> Dict:
       sessions_qs = UTMSession.objects.all()
       sessions_qs = filter_by_period(sessions_qs, 'first_seen', period)
       # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
       return {'custom_metric': value}
   
   # –í _build_dispatcher_context (views/admin.py)
   context['custom_stats'] = get_custom_metric(period)
   
   # –í —à–∞–±–ª–æ–Ω–µ
   <div>{{ custom_stats.custom_metric }}</div>
   ```

2. **–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π API endpoint:**
   ```python
   # –í UTMAnalyticsViewSet (utm_api_views.py)
   @action(detail=False, methods=['get'])
   def custom_endpoint(self, request):
       period = request.query_params.get('period', 'today')
       # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
       return Response(data)
   ```

3. **–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —ç–∫—Å–ø–æ—Ä—Ç–∞:**
   ```python
   # –í export_utm_csv (utm_api_views.py)
   elif export_type == 'custom':
       # –ó–∞–≥–æ–ª–æ–≤–∫–∏
       writer.writerow(['Column1', 'Column2'])
       # –î–∞–Ω–Ω—ã–µ
       for item in items:
           writer.writerow([item.field1, item.field2])
   ```

---

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–≠—Ç–æ—Ç –∞—É–¥–∏—Ç –∏ –Ω–∞–±–æ—Ä —É–ª—É—á—à–µ–Ω–∏–π –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω AI Assistant (2025-01-30).

**–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**
1. ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ UTM Dispatcher
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–ª–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (–Ω–∞–π–¥–µ–Ω–æ 0 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫)
3. ‚úÖ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ 6 –∫—Ä—É–ø–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π –∏–∑ Roadmap
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 13 –Ω–æ–≤—ã—Ö API endpoints
5. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ UI —Å Chart.js, –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏, ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º
6. ‚úÖ –ù–∞–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~4 —á–∞—Å–∞
**–î–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ–¥–∞:** ~1200 —Å—Ç—Ä–æ–∫
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** 100% ‚úÖ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `/var/log/django/error.log`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏: `python manage.py showmigrations`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `/api/utm/general-stats/?period=today`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ permissions: —Ç–æ–ª—å–∫–æ staff/admin –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä

---

## ‚ú® –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

UTM Dispatcher —Ç–µ–ø–µ—Ä—å - —ç—Ç–æ **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞** —Å:
- üìä –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
- üì• –≠–∫—Å–ø–æ—Ä—Ç–æ–º –≤ CSV
- üîç –î–µ—Ç–∞–ª—å–Ω—ã–º –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º —Å–µ—Å—Å–∏–π
- üí∞ ROI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º
- üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ–º –ø–µ—Ä–∏–æ–¥–æ–≤
- üöÄ REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

–í—Å–µ –≥–æ—Ç–æ–≤–æ –∫ production –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é! üéâ

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å! üöÄ

# –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç

**–î–∞—Ç–∞:** 2025-01-30  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ + Context7 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù (100%)**

---

## –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏

1. ‚úÖ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø–æ—à–∞–≥–æ–≤–æ
2. ‚úÖ **Context7 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –≤—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
3. ‚úÖ **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. ‚úÖ **100% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å** - —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ Font Awesome

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/templates/base.html`  
**–°—Ç—Ä–æ–∫–∏:** 22-36

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```html
<!-- Font Awesome: –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–Ω–¥–ª + CDN (—É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω) -->
<link rel="stylesheet" href="{% static 'vendor/fontawesome/css/all.min.css' %}">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<link rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      as="style"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
      onload="this.onload=null;this.rel='stylesheet'">
<noscript>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        crossorigin="anonymous"
        referrerpolicy="no-referrer">
</noscript>
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏:** Font Awesome –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã:
   - –õ–æ–∫–∞–ª—å–Ω–æ: `{% static 'vendor/fontawesome/css/all.min.css' %}` (—Å—Ç—Ä–æ–∫–∞ 23)
   - –° CDN: `https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css` (—Å—Ç—Ä–æ–∫–∏ 26-30)

2. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:** Font Awesome CSS ~80-100KB (–º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - –ü—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ = 160-200KB –ª–∏—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –º–µ–¥–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –î–≤–∞ HTTP –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–≤–∞–∂–¥—ã
   - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ Font Awesome - –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ CDN?

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫:
- **–í–∞—Ä–∏–∞–Ω—Ç 1:** –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª (–±—ã—Å—Ç—Ä–µ–µ, –Ω–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- **–í–∞—Ä–∏–∞–Ω—Ç 2:** –¢–æ–ª—å–∫–æ CDN (–º–æ–∂–µ—Ç –±—ã—Ç—å –±—ã—Å—Ç—Ä–µ–µ –µ—Å–ª–∏ CDN –±–ª–∏–∂–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ç–∏)

**–î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:** –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ, —Ç–∞–∫ –∫–∞–∫:
- –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö DNS –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å Service Worker)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```html
<!-- –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø) -->
<link rel="stylesheet" href="{% static 'vendor/fontawesome/css/all.min.css' %}">

<!-- –ò–õ–ò –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–æ–ª—å–∫–æ CDN (–µ—Å–ª–∏ CDN –±—ã—Å—Ç—Ä–µ–µ) -->
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<link rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      as="style"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
      onload="this.onload=null;this.rel='stylesheet'">
<noscript>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        crossorigin="anonymous"
        referrerpolicy="no-referrer">
</noscript>
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ 80-100KB
- –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ —Å 2 –¥–æ 1
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 200-500ms (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–µ—Ç–∏)

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #2: –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS —Ñ–∞–π–ª

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/css/styles.min.css`  
**–†–∞–∑–º–µ—Ä:** 488,605 –±–∞–π—Ç (~488KB)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- CSS —Ñ–∞–π–ª —Ä–∞–∑–º–µ—Ä–æ–º 488KB –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –±–æ–ª—å—à–æ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –≠—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ CSS
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –¥–æ First Contentful Paint (FCP)
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –¥–æ Largest Contentful Paint (LCP)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤:

```
styles.css:        484,454 –±–∞–π—Ç (~484KB)
styles.min.css:    488,605 –±–∞–π—Ç (~488KB)  ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞!
product-detail.css: 36,391 –±–∞–π—Ç (~36KB)
promocodes.css:     39,190 –±–∞–π—Ç (~39KB)
wholesale.css:      13,372 –±–∞–π—Ç (~13KB)
product-builder.css: 13,767 –±–∞–π—Ç (~14KB)
cls-ultimate.css:   11,001 –±–∞–π—Ç (~11KB)
```

### –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞:** `styles.min.css` (488KB) –ø–æ—á—Ç–∏ —Ç–∞–∫–æ–π –∂–µ —Ä–∞–∑–º–µ—Ä –∫–∞–∫ `styles.css` (484KB)
   - –†–∞–∑–Ω–∏—Ü–∞ –≤—Å–µ–≥–æ 4KB (–º–µ–Ω–µ–µ 1%)
   - –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ñ–∞–π–ª —É–∂–µ –±—ã–ª –º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

2. **–ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∏ –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS:**
   - –í–µ—Å—å CSS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
   - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS (–¥–ª—è above-the-fold –∫–æ–Ω—Ç–µ–Ω—Ç–∞) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å inline
   - –ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

3. **–í–æ–∑–º–æ–∂–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç–∏–ª–∏:**
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å–µ –ª–∏ —Å—Ç–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
   - –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç–∏–ª–∏ –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –Ω–∞ 20-40%

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** 
- –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ CSS
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS extraction
- CSS minification tools

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–†–∞–∑–¥–µ–ª–∏—Ç—å CSS –Ω–∞ –º–æ–¥—É–ª–∏:**
   - `critical.css` - inline –≤ `<head>` (–¥–ª—è above-the-fold –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
   - `styles.css` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)

2. **–£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç–∏–ª–∏:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ PurgeCSS
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –∫–ª–∞—Å—Å—ã —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —à–∞–±–ª–æ–Ω–∞—Ö

3. **–£–ª—É—á—à–∏—Ç—å –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —Ñ–∞–π–ª –º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSS-in-JS –∏–ª–∏ CSS Modules:**
   - –ó–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ CSS –Ω–∞ 50-70% (–¥–æ 150-200KB)
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ FCP –Ω–∞ 300-800ms
- –£–ª—É—á—à–µ–Ω–∏–µ LCP –Ω–∞ 200-500ms

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #3: COMPRESS_ENABLED = False –≤ settings.py

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms/settings.py`  
**–°—Ç—Ä–æ–∫–∞:** 524

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
COMPRESS_ENABLED = False
COMPRESS_OFFLINE = False
```

**–ù–û:** –í `production_settings.py` (—Å—Ç—Ä–æ–∫–∞ 336):
```python
COMPRESS_ENABLED = True
COMPRESS_OFFLINE = True
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–ù–µ—è—Å–Ω–æ, –∫–∞–∫–æ–π —Ñ–∞–π–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ª–∏ `production_settings.py` –≤ `settings.py`
   - –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –∫–æ–º–ø—Ä–µ—Å—Å–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–∞–∂–µ –≤ production

2. **WhiteNoise —É–∂–µ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø—Ä–µ—Å—Å–∏—é:**
   - `CompressedManifestStaticFilesStorage` –¥–µ–ª–∞–µ—Ç gzip/brotli –∫–æ–º–ø—Ä–µ—Å—Å–∏—é
   - –ù–æ django-compressor –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é WhiteNoise: –¥–µ–ª–∞–µ—Ç –ª–∏ CompressedManifestStaticFilesStorage –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é?
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é django-compressor: –Ω—É–∂–µ–Ω –ª–∏ –æ–Ω –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WhiteNoise?

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ production_settings.py:**
   ```python
   # –í settings.py –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   try:
       from .production_settings import *
   except ImportError:
       pass
   ```

2. **–ï—Å–ª–∏ WhiteNoise –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:**
   - –£–¥–∞–ª–∏—Ç—å django-compressor –∏–∑ INSTALLED_APPS
   - –£–¥–∞–ª–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ COMPRESS_*

3. **–ï—Å–ª–∏ –Ω—É–∂–µ–Ω django-compressor:**
   - –í–∫–ª—é—á–∏—Ç—å COMPRESS_ENABLED = True –≤ production
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å {% compress %} —Ç–µ–≥–∏ –≤ —à–∞–±–ª–æ–Ω–∞—Ö

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #4: Bootstrap –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å CDN

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/templates/base.html`  
**–°—Ç—Ä–æ–∫–∏:** 85-90

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```html
<!-- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ Bootstrap CSS —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π -->
<link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' 
      rel='preload' as='style' 
      onload="this.onload=null;this.rel='stylesheet'"
      media="all">
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ CDN:**
   - –ï—Å–ª–∏ CDN –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π DNS –∑–∞–ø—Ä–æ—Å
   - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–µ–π —Å–µ—Ç–∏

2. **–†–∞–∑–º–µ—Ä:** Bootstrap CSS ~200KB (–º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

**–î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:** –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ:
- –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏

**–ù–û:** –ï—Å–ª–∏ CDN –±—ã—Å—Ç—Ä–µ–µ (–±–ª–∏–∂–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é), –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å CDN.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô

---

## üìä –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ù–ê–ô–î–ï–ù–ù–´–• –ü–†–û–ë–õ–ï–ú

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|---|-----------|----------|------|--------|-----------|--------|
| 1 | CSS | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome | base.html | 23, 26-30 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 2 | CSS | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB) | styles.min.css | - | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 3 | CSS | COMPRESS_ENABLED = False | settings.py | 524 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 4 | CSS | Bootstrap —Å CDN | base.html | 86 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |

---

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #5: ImageOptimizationMiddleware –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ª–µ—Ç—É

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms/image_middleware.py`  
**–°—Ç—Ä–æ–∫–∏:** 17-169

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
def process_response(self, request, response):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∑–∞–ø—Ä–æ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    if not self._is_image_request(request):
        return response
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    if not self._is_image_response(response):
        return response
    
    # –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    try:
        optimized_response = self._optimize_image_response(request, response)
        return optimized_response
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ª–µ—Ç—É:** –ö–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:
   - –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ PIL
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä
   - –≠—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 50-500ms –Ω–∞ –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

2. **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:** –î–∞–∂–µ –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –±—ã–ª–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ, –æ–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞

3. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–ª–æ–∫–∏—Ä—É–µ—Ç worker thread, —á—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç –æ—Ç–≤–µ—Ç—ã

4. **–ü–æ—Ä—è–¥–æ–∫ middleware:** ImageOptimizationMiddleware –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ—Å–ª–µ WhiteNoiseMiddleware (—Å—Ç—Ä–æ–∫–∞ 133), —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
   - WhiteNoise —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–¥–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª
   - –ï—Å–ª–∏ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç, –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –¥–∞–ª—å—à–µ
   - ImageOptimizationMiddleware –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ª–µ—Ç—É
   - –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ Django:
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ vs –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ª–µ—Ç—É
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CDN –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø):**
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–≤ `save()` –º–µ—Ç–æ–¥–µ –º–æ–¥–µ–ª–∏)
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ (thumbnail, medium, large)

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∏–ª–∏ Redis
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å ETag/Last-Modified –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Celery –∏–ª–∏ –¥—Ä—É–≥–æ–π task queue –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –û—Ç–¥–∞–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ - –ø–æ–∑–∂–µ

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CDN:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDN —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π (Cloudflare, Cloudinary, etc.)
   - CDN –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –ª–µ—Ç—É —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

5. **–£–¥–∞–ª–∏—Ç—å middleware (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞):**
   - –ï—Å–ª–∏ –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã, middleware –Ω–µ –Ω—É–∂–µ–Ω
   - –≠—Ç–æ —É—Å–∫–æ—Ä–∏—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ 50-500ms –∫–∞–∂–¥–æ–µ
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU
- –£–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #6: –ü–æ—Ä—è–¥–æ–∫ middleware –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms/settings.py`  
**–°—Ç—Ä–æ–∫–∏:** 126-144

**–¢–µ–∫—É—â–∏–π –ø–æ—Ä—è–¥–æ–∫:**
```python
MIDDLEWARE = [
    "twocomms.middleware.ForceHTTPSMiddleware",  # 1. –†–µ–¥–∏—Ä–µ–∫—Ç
    "twocomms.middleware.WWWRedirectMiddleware",  # 2. –†–µ–¥–∏—Ä–µ–∫—Ç
    "twocomms.middleware.SimpleRateLimitMiddleware",  # 3. Rate limiting
    "django.middleware.security.SecurityMiddleware",  # 4. Security
    "twocomms.middleware.SecurityHeadersMiddleware",  # 5. Security headers
    "whitenoise.middleware.WhiteNoiseMiddleware",  # 6. Static files
    "twocomms.image_middleware.ImageOptimizationMiddleware",  # 7. Image optimization
    "django.contrib.sessions.middleware.SessionMiddleware",  # 8. Sessions
    "django.middleware.common.CommonMiddleware",  # 9. Common
    "django.middleware.csrf.CsrfViewMiddleware",  # 10. CSRF
    "django.contrib.auth.middleware.AuthenticationMiddleware",  # 11. Auth
    "django.contrib.messages.middleware.MessageMiddleware",  # 12. Messages
    "django.middleware.clickjacking.XFrameOptionsMiddleware",  # 13. Clickjacking
    "django.contrib.redirects.middleware.RedirectFallbackMiddleware",  # 14. Redirects
    "storefront.utm_middleware.UTMTrackingMiddleware",  # 15. UTM tracking
    "storefront.tracking.SimpleAnalyticsMiddleware",  # 16. Analytics
    "orders.nova_poshta_middleware.NovaPoshtaFallbackMiddleware",  # 17. Nova Poshta
]
```

### –ü—Ä–æ–±–ª–µ–º—ã:

1. **RedirectFallbackMiddleware –≤ –∫–æ–Ω—Ü–µ:** –≠—Ç–æ middleware –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –Ω–∞—à–µ–ª view. –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–Ω—å—à–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î.

2. **ImageOptimizationMiddleware –ø–æ—Å–ª–µ WhiteNoise:** –ï—Å–ª–∏ WhiteNoise –Ω–∞—Ö–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª, ImageOptimizationMiddleware –Ω–µ –Ω—É–∂–µ–Ω. –ù–æ –µ—Å–ª–∏ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ª–µ—Ç—É –º–µ–¥–ª–µ–Ω–Ω–∞—è.

3. **Rate limiting –≤ –Ω–∞—á–∞–ª–µ:** –≠—Ç–æ —Ö–æ—Ä–æ—à–æ, –Ω–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –∫—ç—à—É –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å RedirectFallbackMiddleware –≤—ã—à–µ:**
   - –ü–æ—Å–ª–µ CommonMiddleware, –Ω–æ –¥–æ view processing
   - –≠—Ç–æ –∏–∑–±–µ–∂–∏—Ç –Ω–µ–Ω—É–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

2. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤:**
   - WhiteNoise –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ
   - ImageOptimizationMiddleware –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ WhiteNoise (—É–∂–µ —Ç–∞–∫)

3. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ SecurityHeadersMiddleware —Å SecurityMiddleware:**
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ SecurityMiddleware
   - –≠—Ç–æ —É–º–µ–Ω—å—à–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ middleware

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô

---

## üìä –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|---|-----------|----------|------|--------|-----------|--------|
| 1 | CSS | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome | base.html | 23, 26-30 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 2 | CSS | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB) | styles.min.css | - | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 3 | CSS | COMPRESS_ENABLED = False | settings.py | 524 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 4 | CSS | Bootstrap —Å CDN | base.html | 86 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 5 | Middleware | ImageOptimization –Ω–∞ –ª–µ—Ç—É | image_middleware.py | 22 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 6 | Middleware | –ü–æ—Ä—è–¥–æ–∫ middleware | settings.py | 126-144 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |

---

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #7: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ DOM –∑–∞–ø—Ä–æ—Å—ã –≤ JavaScript

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/main.js`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞–π–¥–µ–Ω–æ 166 –≤—ã–∑–æ–≤–æ–≤ `addEventListener`, `querySelector`, `querySelectorAll`, `getElementById`, `getElementsBy`

**–ê–Ω–∞–ª–∏–∑:**
1. **DOMCache –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –Ω–µ –≤–µ–∑–¥–µ:**
   - –í `shared.js` –µ—Å—Ç—å `DOMCache` –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
   - –ù–æ –≤ `main.js` –º–Ω–æ–≥–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ `document.querySelector`, `document.getElementById`
   - –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º DOM –∑–∞–ø—Ä–æ—Å–∞–º

2. **–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–µ—Å—Ç:**
   - –°—Ç—Ä–æ–∫–∞ 1325: `document.querySelectorAll('.thumb[data-bs-target="#productCarousel"]')` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑
   - –°—Ç—Ä–æ–∫–∞ 1316: `mainImg.closest('.ratio')` - –º–æ–∂–µ—Ç –±—ã—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–æ
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `querySelector` –¥–ª—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å DOM –≤ JavaScript:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MutationObserver –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DOMCache –≤–µ–∑–¥–µ:**
   ```javascript
   // ‚ùå –ü–õ–û–•–û:
   const element = document.querySelector('.my-class');
   
   // ‚úÖ –•–û–†–û–®–û:
   const element = DOMCache.query('.my-class');
   ```

2. **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã querySelectorAll:**
   ```javascript
   // ‚ùå –ü–õ–û–•–û:
   document.querySelectorAll('.items').forEach(...);
   document.querySelectorAll('.items').forEach(...); // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   
   // ‚úÖ –•–û–†–û–®–û:
   const items = DOMCache.queryAll('.items');
   items.forEach(...);
   items.forEach(...); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à
   ```

3. **–û—á–∏—â–∞—Ç—å –∫—ç—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ DOM:**
   - –í—ã–∑—ã–≤–∞—Ç—å `DOMCache.invalidate()` –ø–æ—Å–ª–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MutationObserver –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ DOM –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 30-50%
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è JavaScript –Ω–∞ 10-20%

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #8: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ innerHTML –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª—ã:**
- `main.js`: 3 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è innerHTML
- `product-detail.js`: 3 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è innerHTML
- `modules/cart.js`: 3 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è innerHTML
- `product-builder.js`: 8 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π innerHTML
- `modules/homepage.js`: 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ insertAdjacentHTML

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. **XSS —É—è–∑–≤–∏–º–æ—Å—Ç–∏:** `innerHTML` –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π JavaScript, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** `innerHTML` –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ HTML, —á—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º `textContent` –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ DOM API

**–ü—Ä–∏–º–µ—Ä—ã:**
```javascript
// main.js:1204
content.innerHTML = "<div class='text-secondary small'>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>";

// main.js:1226
content.innerHTML = html; // ‚ùå html –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞ - –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å XSS

// product-detail.js:62
checkIcon.innerHTML = '<svg width="16" height="16"...'; // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML - –±–µ–∑–æ–ø–∞—Å–Ω–æ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å HTML –≤ JavaScript:
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ textContent –≤–º–µ—Å—Ç–æ innerHTML
- –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ DOM API

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ HTML:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `textContent` –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ DOM API:
   ```javascript
   // ‚ùå –ü–õ–û–•–û:
   element.innerHTML = '<div>Text</div>';
   
   // ‚úÖ –•–û–†–û–®–û:
   const div = document.createElement('div');
   div.textContent = 'Text';
   element.appendChild(div);
   ```

2. **–î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ HTML —Å —Å–µ—Ä–≤–µ—Ä–∞:** –°–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ DOMPurify –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å textContent:
   ```javascript
   // ‚ùå –ü–õ–û–•–û:
   content.innerHTML = html; // –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ
   
   // ‚úÖ –•–û–†–û–®–û:
   content.innerHTML = DOMPurify.sanitize(html); // –ë–µ–∑–æ–ø–∞—Å–Ω–æ
   // –ò–õ–ò
   content.textContent = html; // –ï—Å–ª–∏ HTML –Ω–µ –Ω—É–∂–µ–Ω
   ```

3. **–î–ª—è SVG:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `insertAdjacentHTML` –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ DOM API

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å) + üü¢ –°–†–ï–î–ù–ò–ô (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ XSS —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–∞ 5-10%

---

## üü¢ –ü–†–û–ë–õ–ï–ú–ê #9: –¢–∞–π–º–µ—Ä—ã –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/main.js`

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- `resizeTimeout` - –æ—á–∏—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `clearTimeout` ‚úÖ
- `scrollEndTimer` - –æ—á–∏—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `clearTimeout` ‚úÖ
- `relaxTimer` - –æ—á–∏—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `clearTimeout` ‚úÖ
- `_hideTimeout` - –æ—á–∏—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `clearTimeout` ‚úÖ

**–í—ã–≤–æ–¥:** –¢–∞–π–º–µ—Ä—ã –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –Ω–µ—Ç.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ‚úÖ –ù–ï–¢ –ü–†–û–ë–õ–ï–ú–´

---

## üìä –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|---|-----------|----------|------|--------|-----------|--------|
| 1 | CSS | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome | base.html | 23, 26-30 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 2 | CSS | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB) | styles.min.css | - | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 3 | CSS | COMPRESS_ENABLED = False | settings.py | 524 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 4 | CSS | Bootstrap —Å CDN | base.html | 86 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 5 | Middleware | ImageOptimization –Ω–∞ –ª–µ—Ç—É | image_middleware.py | 22 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 6 | Middleware | –ü–æ—Ä—è–¥–æ–∫ middleware | settings.py | 126-144 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 7 | JavaScript | –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ DOM –∑–∞–ø—Ä–æ—Å—ã | main.js | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 8 | JavaScript | innerHTML –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ | main.js, cart.js, etc | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |

---

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #10: N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ —à–∞–±–ª–æ–Ω–∞—Ö –¥–ª—è color_variant.images

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª—ã:**
- `twocomms/twocomms_django_theme/templates/pages/cart.html` (—Å—Ç—Ä–æ–∫–∞ 93-94)
- `twocomms/twocomms_django_theme/templates/partials/mini_cart.html` (—Å—Ç—Ä–æ–∫–∞ 9-10)
- `twocomms/twocomms_django_theme/templates/pages/my_orders.html` (—Å—Ç—Ä–æ–∫–∞ 232-233)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```django
{% for it in cart_items %}
  {% if it.color_variant and it.color_variant.images.exists %}
    <img src="{{ it.color_variant.images.first.image.url }}" ...>
  {% endif %}
{% endfor %}
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ —Ü–∏–∫–ª–µ:**
   - `it.color_variant.images.exists` - –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã
   - `it.color_variant.images.first` - –¥–µ–ª–∞–µ—Ç –µ—â–µ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ –ë–î
   - –ü—Ä–∏ 10 —Ç–æ–≤–∞—Ä–∞—Ö –≤ –∫–æ—Ä–∑–∏–Ω–µ = 20 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è (10-50ms)
   - –ü—Ä–∏ 10 —Ç–æ–≤–∞—Ä–∞—Ö = 200-1000ms –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
   - –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ—Ä–∑–∏–Ω—ã

3. **–ì–¥–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `cart.html` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ—Ä–∑–∏–Ω—ã
   - `mini_cart.html` - –º–∏–Ω–∏-–∫–æ—Ä–∑–∏–Ω–∞ (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ!)
   - `my_orders.html` - –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å related objects –≤ Django —à–∞–±–ª–æ–Ω–∞—Ö:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prefetch_related –≤ views
- –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ò–∑–±–µ–∂–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ .all(), .exists(), .first() –≤ —à–∞–±–ª–æ–Ω–∞—Ö

### –†–µ—à–µ–Ω–∏–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prefetch_related –≤ view (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

–í `view_cart` (cart.py:141):
```python
# ‚ùå –ü–õ–û–•–û:
for item_key, item_data in cart.items():
    product = Product.objects.get(id=product_id)
    # color_variant –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ images

# ‚úÖ –•–û–†–û–®–û:
# –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ color_variants —Å images –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
color_variant_ids = [item_data.get('color_variant_id') for item_data in cart.values() if item_data.get('color_variant_id')]
color_variants = ProductColorVariant.objects.select_related('color').prefetch_related('images').in_bulk(color_variant_ids)

# –ü–µ—Ä–µ–¥–∞–µ–º image_url –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
cart_items_data = []
for item_key, item_data in cart.items():
    color_variant = color_variants.get(item_data.get('color_variant_id'))
    image_url = None
    if color_variant:
        first_image = color_variant.images.all()[0] if color_variant.images.all() else None
        image_url = first_image.image.url if first_image else None
    
    cart_items_data.append({
        'product': product,
        'color_variant': color_variant,
        'color_variant_image_url': image_url,  # ‚úÖ –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π URL
        ...
    })
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å image_url –≤ —à–∞–±–ª–æ–Ω–µ**

–í —à–∞–±–ª–æ–Ω–µ:
```django
{% for it in cart_items %}
  {% if it.color_variant_image_url %}
    <img src="{{ it.color_variant_image_url }}" ...>
  {% endif %}
{% endfor %}
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î —Å N*2 –¥–æ 1-2
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ 200-1000ms
- –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è mini_cart, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

---

## üìä –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|---|-----------|----------|------|--------|-----------|--------|
| 1 | CSS | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome | base.html | 23, 26-30 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 2 | CSS | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB) | styles.min.css | - | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 3 | CSS | COMPRESS_ENABLED = False | settings.py | 524 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 4 | CSS | Bootstrap —Å CDN | base.html | 86 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 5 | Middleware | ImageOptimization –Ω–∞ –ª–µ—Ç—É | image_middleware.py | 22 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 6 | Middleware | –ü–æ—Ä—è–¥–æ–∫ middleware | settings.py | 126-144 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 7 | JavaScript | –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ DOM –∑–∞–ø—Ä–æ—Å—ã | main.js | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 8 | JavaScript | innerHTML –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ | main.js, cart.js, etc | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 9 | Templates | N+1 –¥–ª—è color_variant.images | cart.html, mini_cart.html | 93, 9 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |

---

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #11: N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ build_color_preview_map

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/storefront/services/catalog_helpers.py`  
**–°—Ç—Ä–æ–∫–∞:** 73

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
def build_color_preview_map(products: Iterable[Any]) -> Dict[int, List[Dict[str, Any]]]:
    ...
    for variant in queryset:
        color = getattr(variant, 'color', None)
        images = list(getattr(variant, 'images', []).all() if hasattr(variant, 'images') else [])
        first_image = images[0].image.url if images else ''
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **N+1 –∑–∞–ø—Ä–æ—Å—ã:** 
   - `variant.images.all()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ü–∏–∫–ª–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ variant
   - –î–∞–∂–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `prefetch_related('images')` –≤ `_load_product_color_variant_queryset`, –≤—ã–∑–æ–≤ `.all()` –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_prefetched_objects_cache` –∫–∞–∫ –≤ `get_detailed_color_variants`

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - –ü—Ä–∏ 20 —Ç–æ–≤–∞—Ä–∞—Ö —Å 3 —Ü–≤–µ—Ç–∞–º–∏ –∫–∞–∂–¥—ã–π = 60 variants
   - –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ `.all()` = 1 –∑–∞–ø—Ä–æ—Å –∫ –ë–î
   - –ò—Ç–æ–≥–æ: 60 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è prefetch_related –≤ Django:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `_prefetched_objects_cache` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ prefetched –¥–∞–Ω–Ω—ã–º
- –ò–∑–±–µ–∂–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ `.all()`, `.filter()` –Ω–∞ prefetched related managers

### –†–µ—à–µ–Ω–∏–µ:

```python
# ‚ùå –ü–õ–û–•–û:
images = list(getattr(variant, 'images', []).all() if hasattr(variant, 'images') else [])

# ‚úÖ –•–û–†–û–®–û:
# –ò—Å–ø–æ–ª—å–∑—É–µ–º prefetched cache
images = getattr(variant, '_prefetched_objects_cache', {}).get('images', [])
if not images:
    # Fallback –µ—Å–ª–∏ prefetch –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
    images = list(variant.images.all()) if hasattr(variant, 'images') else []
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î —Å N –¥–æ 1-2
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –Ω–∞ 200-1000ms

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #12: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è cache_page_for_anon

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/storefront/views/utils.py`  
**–°—Ç—Ä–æ–∫–∏:** 12-39

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
def cache_page_for_anon(timeout):
    def decorator(view_func):
        @wraps(view_func)
        def _wrapped_view(request, *args, **kwargs):
            if request.user.is_authenticated:
                return view_func(request, *args, **kwargs)
            # –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - —Å –∫—ç—à–µ–º
            return cache_page(timeout)(view_func)(request, *args, **kwargs)
        return _wrapped_view
    return decorator
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:**
   - `cache_page(timeout)(view_func)` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
   - –≠—Ç–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - Django `cache_page` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏
   - –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å Vary –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cache_page –≤ Django:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Vary –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –£—Å–ª–æ–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –†–µ—à–µ–Ω–∏–µ:

```python
# ‚úÖ –•–û–†–û–®–û:
from django.views.decorators.vary import vary_on_headers
from django.views.decorators.cache import cache_page, never_cache

def cache_page_for_anon(timeout):
    """
    –ö—ç—à–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    """
    def decorator(view_func):
        # –ü—Ä–∏–º–µ–Ω—è–µ–º cache_page –æ–¥–∏–Ω —Ä–∞–∑
        cached_view = cache_page(timeout)(view_func)
        
        @wraps(view_func)
        def _wrapped_view(request, *args, **kwargs):
            if request.user.is_authenticated:
                # –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - –±–µ–∑ –∫—ç—à–∞
                return view_func(request, *args, **kwargs)
            # –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ - —Å –∫—ç—à–µ–º
            return cached_view(request, *args, **kwargs)
        return _wrapped_view
    return decorator
```

**–ò–õ–ò –±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å Vary:**

```python
from django.views.decorators.vary import vary_on_headers
from django.views.decorators.cache import cache_page

def cache_page_for_anon(timeout):
    """
    –ö—ç—à–∏—Ä—É–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Vary: Cookie –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.
    """
    def decorator(view_func):
        # –ü—Ä–∏–º–µ–Ω—è–µ–º cache_page —Å Vary: Cookie
        cached_view = vary_on_headers('Cookie')(cache_page(timeout)(view_func))
        
        @wraps(view_func)
        def _wrapped_view(request, *args, **kwargs):
            if request.user.is_authenticated:
                return view_func(request, *args, **kwargs)
            return cached_view(request, *args, **kwargs)
        return _wrapped_view
    return decorator
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üü¢ –ü–†–û–ë–õ–ï–ú–ê #13: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–•–û–†–û–®–û)

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/analytics-loader.js`  
**–°—Ç—Ä–æ–∫–∏:** 26-48, 1432-1433

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```javascript
function schedule(fn, timeout) {
  if ('requestIdleCallback' in win) {
    win.requestIdleCallback(fn, { timeout: timeout || 2000 });
    return;
  }
  // Fallback –Ω–∞ setTimeout
  ...
}

schedule(loadGoogleAnalytics, 2000);
schedule(loadClarity, 3000);
```

### –ê–Ω–∞–ª–∏–∑:

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:** ‚úÖ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `requestIdleCallback` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
   - Fallback –Ω–∞ `setTimeout` –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
   - –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–∞ –Ω–∞ 2-3 —Å–µ–∫—É–Ω–¥—ã

2. **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π:** ‚úÖ
   - –°–æ–±—ã—Ç–∏—è –±—É—Ñ–µ—Ä–∏–∑—É—é—Ç—Å—è –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∏–∫—Å–µ–ª–µ–π
   - `_fbqBuffer` –∏ `_ttqBuffer` –¥–ª—è Facebook –∏ TikTok

3. **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥:** ‚úÖ
   - –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ `load` —Å–æ–±—ã—Ç–∏—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `requestIdleCallback` –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –≤–ª–∏—è–Ω–∏—è

### –í—ã–≤–æ–¥: ‚úÖ –ù–ï–¢ –ü–†–û–ë–õ–ï–ú–´

–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #14: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∞ 'fragments' –≤ settings.py

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/cache_utils.py`  
**–°—Ç—Ä–æ–∫–∞:** 22-26

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
def get_fragment_cache():
    """
    –ö—ç—à –¥–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (Redis alias 'fragments'), —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è –Ω–∞ default.
    """
    return get_cache('fragments')
```

**–§–∞–π–ª:** `twocomms/twocomms/settings.py`  
**–°—Ç—Ä–æ–∫–∏:** 440-480

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `settings.py` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω —Ç–æ–ª—å–∫–æ –∫—ç—à `'default'`
- –í `production_settings.py` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫—ç—à–∏ `'default'`, `'staticfiles'`, `'fragments'`
- `get_fragment_cache()` –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å –∫—ç—à `'fragments'`, –Ω–æ –≤ dev —Ä–µ–∂–∏–º–µ –µ–≥–æ –Ω–µ—Ç
- –§—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç fallback –Ω–∞ `'default'`, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∞ –≤ Django:
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫—ç—à–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π
- Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

1. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à 'fragments' –≤ settings.py (–¥–ª—è dev):**
   ```python
   if DEBUG:
       CACHES = {
           'default': {
               'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
               'LOCATION': 'twocomms-local',
               'TIMEOUT': 300,
           },
           'fragments': {
               'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
               'LOCATION': 'twocomms-fragments',
               'TIMEOUT': 900,
           }
       }
   ```

2. **–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –∫—ç—à –¥–ª—è dev (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü¢ –°–†–ï–î–ù–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –ë–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫—ç—à–∞ –≤ dev —Ä–µ–∂–∏–º–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è fragment cache –ª–æ–∫–∞–ª—å–Ω–æ

---

## üìä –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|---|-----------|----------|------|--------|-----------|--------|
| 1 | CSS | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome | base.html | 23, 26-30 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 2 | CSS | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB) | styles.min.css | - | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 3 | CSS | COMPRESS_ENABLED = False | settings.py | 524 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 4 | CSS | Bootstrap —Å CDN | base.html | 86 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 5 | Middleware | ImageOptimization –Ω–∞ –ª–µ—Ç—É | image_middleware.py | 22 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 6 | Middleware | –ü–æ—Ä—è–¥–æ–∫ middleware | settings.py | 126-144 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 7 | JavaScript | –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ DOM –∑–∞–ø—Ä–æ—Å—ã | main.js | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 8 | JavaScript | innerHTML –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ | main.js, cart.js, etc | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 9 | Templates | N+1 –¥–ª—è color_variant.images | cart.html, mini_cart.html | 93, 9 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 10 | Services | N+1 –≤ build_color_preview_map | catalog_helpers.py | 73 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 11 | Views | –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π cache_page_for_anon | utils.py | 37 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 12 | Cache | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fragments –∫—ç—à–∞ –≤ dev | settings.py | - | üü¢ –°–†–ï–î–ù–ò–ô | ‚è≥ |

---

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #15: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ os.path.exists() –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ responsive_images.py

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/storefront/templatetags/responsive_images.py`  
**–°—Ç—Ä–æ–∫–∏:** 71, 84, 100-103, 181, 193, 228-231, 262

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
for size in responsive_sizes:
    webp_responsive_file = optimized_dir / f"{base_name}_{size}w.webp"
    if webp_responsive_file.exists():  # ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ
        ...
    avif_responsive_file = optimized_dir / f"{base_name}_{size}w.avif"
    if avif_responsive_file.exists():  # ‚ùå –ï—â–µ –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
        ...
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:**
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ 8 —Ä–∞–∑–º–µ—Ä–æ–≤ √ó 2 —Ñ–æ—Ä–º–∞—Ç–∞ (WebP, AVIF) = 16 –ø—Ä–æ–≤–µ—Ä–æ–∫
   - –ü—Ä–∏ 20 —Ç–æ–≤–∞—Ä–∞—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ = 320 –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
   - –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `os.path.exists()` –∏–ª–∏ `Path.exists()` = —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ (1-5ms)
   - –ò—Ç–æ–≥–æ: 320-1600ms –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —à–∞–±–ª–æ–Ω–∞
   - –ù–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
   - –ë–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏)
   - –û—Å–æ–±–µ–Ω–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞ —Å–µ—Ç–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (NFS, S3, etc.)

3. **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `optimized_image` template tag - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏
   - `responsive_image` template tag - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –≤ Django:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Django cache –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –†–µ—à–µ–Ω–∏–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–æ–∫ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```python
from django.core.cache import cache
from functools import lru_cache

@lru_cache(maxsize=1000)
def _check_file_exists_cached(file_path_str: str) -> bool:
    """–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞"""
    return Path(file_path_str).exists()

def _get_optimized_files_map(base_name: str, optimized_dir: Path) -> dict:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
    –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤.
    """
    cache_key = f'optimized_files:{base_name}:{optimized_dir}'
    cached_result = cache.get(cache_key)
    
    if cached_result is not None:
        return cached_result
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –æ–¥–∏–Ω —Ä–∞–∑
    files_map = {
        'webp': [],
        'avif': [],
        'webp_responsive': {},
        'avif_responsive': {}
    }
    
    responsive_sizes = [320, 480, 640, 768, 960, 1280, 1600, 1920]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—ã–µ —Ñ–∞–π–ª—ã
    webp_file = optimized_dir / f"{base_name}.webp"
    if webp_file.exists():
        files_map['webp'] = [str(webp_file)]
    
    avif_file = optimized_dir / f"{base_name}.avif"
    if avif_file.exists():
        files_map['avif'] = [str(avif_file)]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º responsive —Ñ–∞–π–ª—ã
    for size in responsive_sizes:
        webp_resp = optimized_dir / f"{base_name}_{size}w.webp"
        if webp_resp.exists():
            files_map['webp_responsive'][size] = str(webp_resp)
        
        avif_resp = optimized_dir / f"{base_name}_{size}w.avif"
        if avif_resp.exists():
            files_map['avif_responsive'][size] = str(avif_resp)
    
    # –ö—ç—à–∏—Ä—É–µ–º –Ω–∞ 1 —á–∞—Å (–º–æ–∂–Ω–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
    cache.set(cache_key, files_map, 3600)
    
    return files_map
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ (–¥–ª—è production)**

```python
# Management command –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
# python manage.py generate_optimized_files_index

# –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ Redis –∏–ª–∏ –ë–î
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —à–∞–±–ª–æ–Ω–æ–≤
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞**

```python
from django.db.models.signals import post_save
from django.dispatch import receiver
from storefront.models import Product

@receiver(post_save, sender=Product)
def invalidate_image_cache(sender, instance, **kwargs):
    """–ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫—ç—à –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞"""
    cache_key_pattern = f'optimized_files:*{instance.id}*'
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏
    cache.delete_pattern(cache_key_pattern)
```

### –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

1. **–†–∏—Å–∫:** –ö—ç—à –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º, –µ—Å–ª–∏ —Ñ–∞–π–ª—ã –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã/–¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä—É—á–Ω—É—é
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - **–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π TTL (1 —á–∞—Å) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

2. **–†–∏—Å–∫:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ Redis
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∂–∞—Ç–∏–µ –≤ Redis (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
   - **–†–µ—à–µ–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ (maxsize –≤ lru_cache)

3. **–†–∏—Å–∫:** –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º (cold cache)
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∫—ç—à —á–µ—Ä–µ–∑ management command
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å warm-up —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ 300-1500ms
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
- –£–ª—É—á—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç–æ–≤–∞—Ä–æ–≤

---

## üü¢ –ü–†–û–ë–õ–ï–ú–ê #16: Width –∏ height –∞—Ç—Ä–∏–±—É—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–•–û–†–û–®–û)

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª—ã:**
- `twocomms/twocomms_django_theme/templates/partials/product_card.html` (—Å—Ç—Ä–æ–∫–∞ 14, 20)
- `twocomms/twocomms_django_theme/templates/pages/product_detail.html` (—Å—Ç—Ä–æ–∫–∞ 35)
- `twocomms/twocomms_django_theme/templates/optimized_image.html` (—Å—Ç—Ä–æ–∫–∏ 27-28)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `optimized_image` template tag –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `width` –∏ `height` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ –ê—Ç—Ä–∏–±—É—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —à–∞–±–ª–æ–Ω `optimized_image.html`
- ‚úÖ –ê—Ç—Ä–∏–±—É—Ç—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ `<img>` —Ç–µ–≥: `{% if width %}width="{{ width }}"{% endif %}`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ratio ratio-product` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è aspect ratio
- ‚úÖ CSS `contain: layout` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è CLS

### –í—ã–≤–æ–¥: ‚úÖ –ù–ï–¢ –ü–†–û–ë–õ–ï–ú–´

Width –∏ height –∞—Ç—Ä–∏–±—É—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç Cumulative Layout Shift (CLS).

---

## üìä –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|---|-----------|----------|------|--------|-----------|--------|
| 1 | CSS | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome | base.html | 23, 26-30 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 2 | CSS | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB) | styles.min.css | - | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 3 | CSS | COMPRESS_ENABLED = False | settings.py | 524 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 4 | CSS | Bootstrap —Å CDN | base.html | 86 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 5 | Middleware | ImageOptimization –Ω–∞ –ª–µ—Ç—É | image_middleware.py | 22 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 6 | Middleware | –ü–æ—Ä—è–¥–æ–∫ middleware | settings.py | 126-144 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 7 | JavaScript | –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ DOM –∑–∞–ø—Ä–æ—Å—ã | main.js | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 8 | JavaScript | innerHTML –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ | main.js, cart.js, etc | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 9 | Templates | N+1 –¥–ª—è color_variant.images | cart.html, mini_cart.html | 93, 9 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 10 | Services | N+1 –≤ build_color_preview_map | catalog_helpers.py | 73 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 11 | Views | –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π cache_page_for_anon | utils.py | 37 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 12 | Cache | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fragments –∫—ç—à–∞ –≤ dev | settings.py | - | üü¢ –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 13 | Images | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ os.path.exists() | responsive_images.py | 71, 84, etc | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |

---

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #17: os.path.getmtime() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –¥–ª—è ETag

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms/cache_headers.py`  
**–°—Ç—Ä–æ–∫–∏:** 19, 24, 29, 34, 39, 44, 64, 69, 74

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
def add_cache_headers(headers, path, url):
    ...
    headers['ETag'] = f'"{os.path.getmtime(path)}"'
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:**
   - `os.path.getmtime(path)` –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
   - –ü—Ä–∏ 20 —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ = 20 —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
   - –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ = 1-5ms (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã)
   - –ò—Ç–æ–≥–æ: 20-100ms –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è
   - ETag –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –≤—ã—á–∏—Å–ª—è—Ç—å –æ–¥–∏–Ω —Ä–∞–∑
   - –û—Å–æ–±–µ–Ω–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞ —Å–µ—Ç–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (NFS, S3, etc.)
   - WhiteNoise —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤

3. **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `add_cache_headers` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è WhiteNoise –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞
   - `get_media_cache_headers` - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å ETag –≤ WhiteNoise:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ ETag
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ hash —Ñ–∞–π–ª–∞ –≤–º–µ—Å—Ç–æ mtime

### –†–µ—à–µ–Ω–∏–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hash —Ñ–∞–π–ª–∞ –≤–º–µ—Å—Ç–æ mtime (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```python
import hashlib

def _get_file_hash(path: str) -> str:
    """–í—ã—á–∏—Å–ª—è–µ—Ç hash —Ñ–∞–π–ª–∞ –¥–ª—è ETag"""
    try:
        with open(path, 'rb') as f:
            file_hash = hashlib.md5(f.read()).hexdigest()
            return f'"{file_hash[:16]}"'  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–µ 16 —Å–∏–º–≤–æ–ª–æ–≤
    except (OSError, IOError):
        # Fallback –Ω–∞ mtime –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
        return f'"{int(os.path.getmtime(path))}"'

def add_cache_headers(headers, path, url):
    ...
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º hash —Ñ–∞–π–ª–∞ –¥–ª—è ETag (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ —á–µ–º mtime)
    headers['ETag'] = _get_file_hash(path)
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å ETag**

```python
from django.core.cache import cache
from functools import lru_cache

@lru_cache(maxsize=1000)
def _get_cached_etag(path: str) -> str:
    """–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ETag –Ω–∞ –æ—Å–Ω–æ–≤–µ mtime"""
    mtime = os.path.getmtime(path)
    return f'"{int(mtime)}"'

def add_cache_headers(headers, path, url):
    ...
    headers['ETag'] = _get_cached_etag(path)
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç WhiteNoise (–õ–£–ß–®–ò–ô)**

WhiteNoise —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hash –∏–∑ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞:

```python
def add_cache_headers(headers, path, url):
    ...
    # WhiteNoise —É–∂–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–µ—Ä—Å–∏—é –≤ URL —á–µ—Ä–µ–∑ –º–∞–Ω–∏—Ñ–µ—Å—Ç
    # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hash –∏–∑ URL –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å ETag
    # (WhiteNoise —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ—Ä–µ–∑ –º–∞–Ω–∏—Ñ–µ—Å—Ç)
    if not headers.get('ETag'):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º hash –∏–∑ URL –µ—Å–ª–∏ –µ—Å—Ç—å –≤–µ—Ä—Å–∏—è
        if '?' in url:
            version_hash = url.split('?')[-1]
            headers['ETag'] = f'"{version_hash}"'
        else:
            # Fallback –Ω–∞ mtime
            headers['ETag'] = f'"{int(os.path.getmtime(path))}"'
```

### –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

1. **–†–∏—Å–∫:** Hash —Ñ–∞–π–ª–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å hash –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hash —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã—Ö N –±–∞–π—Ç —Ñ–∞–π–ª–∞

2. **–†–∏—Å–∫:** –ö—ç—à ETag –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º
   - **–†–µ—à–µ–Ω–∏–µ:** –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π TTL –¥–ª—è –∫—ç—à–∞

3. **–†–∏—Å–∫:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ ETag
   - **–†–µ—à–µ–Ω–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ staging –ø–µ—Ä–µ–¥ production
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å feature flag –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ 20-100ms
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
- –£–ª—É—á—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #18: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/modules/optimizers.js`  
**–°—Ç—Ä–æ–∫–∏:** 60-65

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```javascript
isLowEndDevice() {
  return navigator.hardwareConcurrency <= 2 ||
         navigator.deviceMemory <= 2 ||
         navigator.connection?.effectiveType === 'slow-2g' ||
         navigator.connection?.effectiveType === '2g';
}
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:**
   - `hardwareConcurrency <= 2` - –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å 4 —è–¥—Ä–∞–º–∏, –Ω–æ —Å–ª–∞–±—ã–º–∏ —è–¥—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ä—ã–µ Android)
   - `deviceMemory <= 2` - –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å 3-4GB RAM, –Ω–æ —Å–ª–∞–±—ã–º CPU
   - `connection.effectiveType` - –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å —Ö–æ—Ä–æ—à–∏–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º, –Ω–æ —Å–ª–∞–±—ã–º CPU
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å GPU (–≤–∞–∂–Ω–æ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π)

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –±–æ–ª—å—à–µ —è–¥–µ—Ä/–ø–∞–º—è—Ç–∏, –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏
   - –°—Ç–∞—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å 4 —è–¥—Ä–∞–º–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –Ω–æ–≤—ã—Ö —Å 2 —è–¥—Ä–∞–º–∏
   - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å —Ö–æ—Ä–æ—à–∏–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º, –Ω–æ —Å–ª–∞–±—ã–º CPU –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –±—É–¥—É—Ç –∏—Å–ø—ã—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é

3. **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `MobileOptimizer.initMobileOptimizations()` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –ø—Ä–∏–º–µ–Ω—è—Ç—å –ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –í–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `perf-lite` –∫–ª–∞—Å—Å–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Performance API
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ User-Agent –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –†–µ—à–µ–Ω–∏–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å Performance API (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```javascript
isLowEndDevice() {
  // –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  const lowConcurrency = navigator.hardwareConcurrency <= 2;
  const lowMemory = navigator.deviceMemory && navigator.deviceMemory <= 2;
  const slowConnection = navigator.connection?.effectiveType === 'slow-2g' || 
                         navigator.connection?.effectiveType === '2g';
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Performance API
  const perfCheck = this._checkPerformanceMetrics();
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ User-Agent –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  const oldDevice = this._isOldDevice();
  
  // –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
  return lowConcurrency || lowMemory || slowConnection || perfCheck || oldDevice;
},

_checkPerformanceMetrics() {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
  const start = performance.now();
  for (let i = 0; i < 1000000; i++) {
    Math.sqrt(i);
  }
  const duration = performance.now() - start;
  
  // –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç –±–æ–ª—å—à–µ 50ms, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–µ–¥–ª–µ–Ω–Ω–æ–µ
  return duration > 50;
},

_isOldDevice() {
  const ua = navigator.userAgent;
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ User-Agent
  const oldAndroid = /Android [1-4]\./i.test(ua);
  const oldIOS = /iPhone OS [1-9]_/i.test(ua) || /iPad.*OS [1-9]_/i.test(ua);
  const oldChrome = /Chrome\/[1-5][0-9]/i.test(ua);
  
  return oldAndroid || oldIOS || oldChrome;
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤**

```javascript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Ç–∏–ø–∞ device-detector-js
import { DeviceDetector } from 'device-detector-js';

const detector = new DeviceDetector();
const device = detector.parse(navigator.userAgent);

isLowEndDevice() {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
  const knownLowEnd = ['Galaxy S3', 'iPhone 5', 'iPad 2', ...];
  if (knownLowEnd.includes(device.device.model)) {
    return true;
  }
  
  // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

```javascript
let performanceScore = null;

isLowEndDevice() {
  // –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
  if (performanceScore !== null) {
    return performanceScore < 0.5; // –ü–æ—Ä–æ–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  }
  
  // –í—ã—á–∏—Å–ª—è–µ–º score –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  performanceScore = this._calculatePerformanceScore();
  return performanceScore < 0.5;
},

_calculatePerformanceScore() {
  let score = 1.0;
  
  // –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∏–∑–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä
  if (navigator.hardwareConcurrency <= 2) score -= 0.3;
  else if (navigator.hardwareConcurrency <= 4) score -= 0.1;
  
  // –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–∏–∑–∫—É—é –ø–∞–º—è—Ç—å
  if (navigator.deviceMemory && navigator.deviceMemory <= 2) score -= 0.3;
  else if (navigator.deviceMemory && navigator.deviceMemory <= 4) score -= 0.1;
  
  // –®—Ç—Ä–∞—Ñ –∑–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
  if (navigator.connection?.effectiveType === 'slow-2g') score -= 0.2;
  else if (navigator.connection?.effectiveType === '2g') score -= 0.1;
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ CPU
  const cpuScore = this._testCPUSpeed();
  score *= cpuScore;
  
  return Math.max(0, Math.min(1, score));
},

_testCPUSpeed() {
  const iterations = 100000;
  const start = performance.now();
  
  for (let i = 0; i < iterations; i++) {
    Math.sqrt(i * Math.random());
  }
  
  const duration = performance.now() - start;
  // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º: –±—ã—Å—Ç—Ä—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ < 10ms, –º–µ–¥–ª–µ–Ω–Ω—ã–µ > 50ms
  return Math.max(0, Math.min(1, 1 - (duration - 10) / 40));
}
```

### –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

1. **–†–∏—Å–∫:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–π
   - **–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
   - **–†–µ—à–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

2. **–†–∏—Å–∫:** False positives (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫–∞–∫ —Å–ª–∞–±—ã—Ö)
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –º–µ—Ç—Ä–∏–∫, –∞ –Ω–µ –æ–¥–Ω—É
   - **–†–µ—à–µ–Ω–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

3. **–†–∏—Å–∫:** False negatives (–ø—Ä–æ–ø—É—Å–∫ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É User-Agent –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –°–Ω–∏–∂–µ–Ω–∏–µ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π

---

## üü¢ –ü–†–û–ë–õ–ï–ú–ê #19: WhiteNoise –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–•–û–†–û–®–û)

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms/production_settings.py`  
**–°—Ç—Ä–æ–∫–∏:** 312-325

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `STATICFILES_STORAGE = "whitenoise.storage.CompressedManifestStaticFilesStorage"` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π storage
- ‚úÖ `WHITENOISE_MAX_AGE = 1 –≥–æ–¥` - –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `WHITENOISE_IMMUTABLE_FILE_TEST = lambda path, url: True` - –≤—Å–µ —Ñ–∞–π–ª—ã immutable
- ‚úÖ `WHITENOISE_SKIP_COMPRESS_EXTENSIONS` –≤–∫–ª—é—á–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã)
- ‚úÖ `WHITENOISE_ADD_HEADERS_FUNCTION` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### –í—ã–≤–æ–¥: ‚úÖ –ù–ï–¢ –ü–†–û–ë–õ–ï–ú–´

WhiteNoise –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è production.

---

## üìä –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–í–û–î–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü—Ä–æ–±–ª–µ–º–∞ | –§–∞–π–ª | –°—Ç—Ä–æ–∫–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|---|-----------|----------|------|--------|-----------|--------|
| 1 | CSS | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome | base.html | 23, 26-30 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 2 | CSS | –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB) | styles.min.css | - | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 3 | CSS | COMPRESS_ENABLED = False | settings.py | 524 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 4 | CSS | Bootstrap —Å CDN | base.html | 86 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 5 | Middleware | ImageOptimization –Ω–∞ –ª–µ—Ç—É | image_middleware.py | 22 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 6 | Middleware | –ü–æ—Ä—è–¥–æ–∫ middleware | settings.py | 126-144 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 7 | JavaScript | –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ DOM –∑–∞–ø—Ä–æ—Å—ã | main.js | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 8 | JavaScript | innerHTML –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ | main.js, cart.js, etc | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 9 | Templates | N+1 –¥–ª—è color_variant.images | cart.html, mini_cart.html | 93, 9 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 10 | Services | N+1 –≤ build_color_preview_map | catalog_helpers.py | 73 | üî¥ –ö–†–ò–¢–ò–ß–ù–û | ‚è≥ |
| 11 | Views | –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π cache_page_for_anon | utils.py | 37 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 12 | Cache | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fragments –∫—ç—à–∞ –≤ dev | settings.py | - | üü¢ –°–†–ï–î–ù–ò–ô | ‚è≥ |
| 13 | Images | –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ os.path.exists() | responsive_images.py | 71, 84, etc | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 14 | Cache Headers | os.path.getmtime() –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ | cache_headers.py | 19, 24, etc | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 15 | Mobile | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | optimizers.js | 60-65 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 16 | Database | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ .only()/.defer() | catalog.py, api.py, viewsets.py | –º–Ω–æ–≥–æ | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 17 | Analytics | GTM –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ head | base.html | 371-398 | üü° –í–´–°–û–ö–ò–ô | ‚è≥ |
| 18 | Analytics | setInterval –¥–ª—è TikTok Pixel | analytics-loader.js | 1191-1263 | üü° –°–†–ï–î–ù–ò–ô | ‚è≥ |

---

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #20: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è .only() –∏ .defer() –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª—ã:**
- `twocomms/storefront/views/catalog.py` (—Å—Ç—Ä–æ–∫–∏ 40-50, 622)
- `twocomms/storefront/views/product.py` (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞)
- `twocomms/storefront/views/api.py` (—Å—Ç—Ä–æ–∫–∏ 34, 67)
- `twocomms/storefront/viewsets.py` (—Å—Ç—Ä–æ–∫–∞ 80)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
# catalog.py
product_qs = Product.objects.select_related('category').order_by('-id')

# api.py
product = Product.objects.select_related('category').get(id=product_id)

# viewsets.py
return Product.objects.all().select_related('category').order_by('-id')
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–ª—è –º–æ–¥–µ–ª–∏:**
   - –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `Product.objects.select_related('category')` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –í–°–ï –ø–æ–ª—è –º–æ–¥–µ–ª–∏ `Product`
   - –î–ª—è —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω—É–∂–Ω—ã –≤—Å–µ –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `full_description`, `ai_content_generated`, `meta_keywords`, etc.)
   - –≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç:
     - –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –∏–∑ –ë–î
     - –ü–∞–º—è—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é Django
     - –í—Ä–µ–º—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - –î–ª—è —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ: `id`, `title`, `slug`, `price`, `discount_percent`, `main_image`, `category`, `featured`
   - –ù–µ –Ω—É–∂–Ω—ã: `description`, `full_description`, `short_description`, `meta_keywords`, `meta_description`, `ai_content_generated`, –∏ –¥—Ä—É–≥–∏–µ –±–æ–ª—å—à–∏–µ –ø–æ–ª—è
   - –ü—Ä–∏ 20 —Ç–æ–≤–∞—Ä–∞—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å 50-200KB –ª–∏—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `home` view - —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
   - `catalog` view - —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
   - `get_product_json` API - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è —Ç–æ–≤–∞—Ä–∞
   - `ProductViewSet` - API endpoint –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `.only()` –∏ `.defer()` –≤ Django:
- –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.only()` vs `.defer()`
- –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å `select_related` –∏ `prefetch_related`

### –†–µ—à–µ–Ω–∏–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .only() –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```python
# catalog.py - home view
product_qs = Product.objects.select_related('category').only(
    'id', 'title', 'slug', 'price', 'discount_percent', 
    'main_image', 'category_id', 'featured', 'status', 'published_at'
).order_by('-id')

# catalog.py - catalog view
product_qs = Product.objects.select_related('category').only(
    'id', 'title', 'slug', 'price', 'discount_percent',
    'main_image', 'category_id', 'featured', 'status', 'published_at'
).filter(category=category).order_by('-id')

# viewsets.py - ProductViewSet
def get_queryset(self):
    if self.action == 'list':
        # –î–ª—è —Å–ø–∏—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
        return Product.objects.select_related('category').only(
            'id', 'title', 'slug', 'price', 'discount_percent',
            'main_image', 'category_id', 'featured', 'status', 'published_at'
        ).order_by('-id')
    else:
        # –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –ø–æ–ª—è
        return Product.objects.select_related('category').order_by('-id')
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .defer() –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–æ–ª–µ–π**

```python
# –û—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –±–æ–ª—å—à–∏—Ö –ø–æ–ª–µ–π
product_qs = Product.objects.select_related('category').defer(
    'full_description', 'description', 'short_description',
    'meta_keywords', 'meta_description', 'ai_content_generated'
).order_by('-id')
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥**

```python
# –î–ª—è —Å–ø–∏—Å–∫–æ–≤ - —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
LIST_FIELDS = [
    'id', 'title', 'slug', 'price', 'discount_percent',
    'main_image', 'category_id', 'featured', 'status', 'published_at'
]

# –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ - –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –±–æ–ª—å—à–∏–µ –ø–æ–ª—è
DETAIL_DEFER_FIELDS = [
    'meta_keywords', 'meta_description', 'ai_content_generated'
]

def get_product_queryset(for_list=False):
    qs = Product.objects.select_related('category')
    if for_list:
        return qs.only(*LIST_FIELDS)
    else:
        return qs.defer(*DETAIL_DEFER_FIELDS)
```

### –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

1. **–†–∏—Å–∫:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `.only()` –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –ø–æ–ª—è–º
   - **–†–µ—à–µ–Ω–∏–µ:** –¢—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–≤–∞—Ä—ã
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.defer()` –≤–º–µ—Å—Ç–æ `.only()` –¥–ª—è –±–æ–ª—å—à–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º –ø–æ–ª—è–º

2. **–†–∏—Å–∫:** `.only()` –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, ForeignKey)
   - **–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å `category_id` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `.only()` —Å `select_related('category')`
   - **–†–µ—à–µ–Ω–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–†–∏—Å–∫:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–∏ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å `.only()`
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ –ø–æ–ª–µ–π
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î –Ω–∞ 30-50%
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ 20-40%
- –£–ª—É—á—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ 10-30ms

---

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #21: GTM –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ head

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/templates/base.html`  
**–°—Ç—Ä–æ–∫–∏:** 371-398

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```html
<!-- Google Tag Manager -->
{% if not debug %}
<script>
(function(w,d,s,l,i){
  w[l]=w[l]||[];
  w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
  var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),
      dl=l!='dataLayer'?'&l='+l:'';
  j.async=true;
  j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
  // ...
  f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PRLLBF9H');
</script>
{% endif %}
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **GTM –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ `<head>`:**
   - –°–∫—Ä–∏–ø—Ç GTM –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ `<head>` —Å–µ–∫—Ü–∏–∏, —Ö–æ—Ç—è –∏ —Å `async=true`
   - –≠—Ç–æ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ HTML, –¥–∞–∂–µ —Å `async`
   - GTM –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
   - –†–∞–∑–º–µ—Ä GTM —Å–∫—Ä–∏–ø—Ç–∞ ~50-100KB

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - GTM –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –ú–æ–∂–µ—Ç –∑–∞–¥–µ—Ä–∂–∞—Ç—å First Contentful Paint (FCP)
   - –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö

3. **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `base.html` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
   - –í–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å–∞–π—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ GTM:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ GTM
- –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ GTM
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `defer` –≤–º–µ—Å—Ç–æ `async`

### –†–µ—à–µ–Ω–∏–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å GTM –≤ –∫–æ–Ω–µ—Ü body (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```html
<!-- base.html - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å GTM –≤ –∫–æ–Ω–µ—Ü body -->
{% if not debug %}
<!-- Google Tag Manager -->
<script>
(function(w,d,s,l,i){
  w[l]=w[l]||[];
  w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
  var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),
      dl=l!='dataLayer'?'&l='+l:'';
  j.async=true;
  j.defer=true; // –î–æ–±–∞–≤–ª—è–µ–º defer
  j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
  j.onerror=function(){
    if(console&&console.debug)console.debug('GTM script failed to load - possible ad blocker');
  };
  if(f&&f.parentNode){
    f.parentNode.insertBefore(j,f);
  }else{
    (d.body||d.getElementsByTagName('body')[0]).appendChild(j);
  }
})(window,document,'script','dataLayer','GTM-PRLLBF9H');
</script>
<!-- End Google Tag Manager -->
{% endif %}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ GTM —á–µ—Ä–µ–∑ requestIdleCallback**

```html
<!-- base.html - –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ GTM -->
{% if not debug %}
<script>
(function() {
  function loadGTM() {
    (function(w,d,s,l,i){
      w[l]=w[l]||[];
      w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),
          dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      j.onerror=function(){
        if(console&&console.debug)console.debug('GTM script failed to load');
      };
      if(f&&f.parentNode){
        f.parentNode.insertBefore(j,f);
      }else{
        (d.body||d.getElementsByTagName('body')[0]).appendChild(j);
      }
    })(window,document,'script','dataLayer','GTM-PRLLBF9H');
  }
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º GTM –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  if (window.requestIdleCallback) {
    window.requestIdleCallback(loadGTM, { timeout: 2000 });
  } else {
    window.addEventListener('load', loadGTM, { once: true });
  }
})();
</script>
{% endif %}
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Partytown –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ GTM**

```html
<!-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Partytown –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è GTM –≤ Web Worker -->
<script type="text/partytown">
  // GTM –∫–æ–¥ –∑–¥–µ—Å—å
</script>
```

### –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

1. **–†–∏—Å–∫:** –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ GTM –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–∞–Ω–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dataLayer` –¥–ª—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ GTM
   - **–†–µ—à–µ–Ω–∏–µ:** GTM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ `dataLayer` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏

2. **–†–∏—Å–∫:** –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ GTM –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã
   - **–†–µ—à–µ–Ω–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dataLayer` –¥–ª—è —Ä–∞–Ω–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π

3. **–†–∏—Å–∫:** –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–∂–µ—Ç –∑–∞–¥–µ—Ä–∂–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `requestIdleCallback` —Å —Ç–∞–π–º–∞—É—Ç–æ–º
   - **–†–µ—à–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∂–∞—Ç—å GTM –ø–æ—Å–ª–µ `DOMContentLoaded`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –í–´–°–û–ö–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –£–ª—É—á—à–µ–Ω–∏–µ FCP –Ω–∞ 50-200ms
- –£–ª—É—á—à–µ–Ω–∏–µ TTI –Ω–∞ 100-300ms
- –°–Ω–∏–∂–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

---

## üü° –ü–†–û–ë–õ–ï–ú–ê #22: setInterval –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TikTok Pixel

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:

**–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/js/analytics-loader.js`  
**–°—Ç—Ä–æ–∫–∏:** 1191-1263

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```javascript
var checkReady = setInterval(function() {
  if (w.ttq && typeof w.ttq.track === 'function') {
    clearInterval(checkReady);
    w._ttqLoaded = true;
    w._ttqScriptLoaded = true;
    // ...
  }
}, 100); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 100ms

// –¢–∞–π–º–∞—É—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–º–∞–∫—Å 5 —Å–µ–∫—É–Ω–¥)
setTimeout(function() {
  clearInterval(checkReady);
  // ...
}, 5000);
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. **setInterval –∫–∞–∂–¥—ã–µ 100ms:**
   - `setInterval` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 100ms –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TikTok Pixel
   - –ü—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —Ç–∞–π–º–∞—É—Ç–µ 5 —Å–µ–∫—É–Ω–¥ = 50 –ø—Ä–æ–≤–µ—Ä–æ–∫
   - –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ = –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤ –æ–±—ä–µ–∫—Ç–∞ + —É—Å–ª–æ–≤–∏–µ
   - –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU

2. **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
   - `setInterval` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ (–≤ —Ñ–æ–Ω–µ)
   - –°–æ–∑–¥–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 100ms
   - –ú–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
   - –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `MutationObserver` –∏–ª–∏ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞

3. **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - `analytics-loader.js` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TikTok Pixel
   - –í–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Context7:

**–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:** –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `MutationObserver`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–∏—Å–æ–≤

### –†–µ—à–µ–Ω–∏–µ:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ onload —Å–∫—Ä–∏–ø—Ç–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```javascript
// analytics-loader.js - loadTikTokPixel
function loadTikTokPixel() {
  if (!TIKTOK_PIXEL_ID || win._ttqLoaded) {
    return;
  }
  
  var script = doc.createElement('script');
  script.async = true;
  script.src = 'https://analytics.tiktok.com/i18n/pixel/events.js';
  
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º onload –≤–º–µ—Å—Ç–æ setInterval
  script.onload = function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(function() {
      if (win.ttq && typeof win.ttq.track === 'function') {
        win._ttqLoaded = true;
        win._ttqScriptLoaded = true;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        win.ttq.load(TIKTOK_PIXEL_ID);
        win.ttq.page();
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
        if (win._ttqBuffer && win._ttqBuffer.length > 0) {
          win._ttqBuffer.forEach(function(buffered) {
            try {
              win.ttq.track(buffered.event, buffered.data);
            } catch (err) {
              if (console && console.debug) {
                console.debug('TikTok Pixel buffered event error', err);
              }
            }
          });
          win._ttqBuffer = [];
        }
      }
    }, 50); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  };
  
  script.onerror = function() {
    if (console && console.debug) {
      console.debug('TikTok Pixel script failed to load');
    }
  };
  
  var firstScript = doc.getElementsByTagName('script')[0];
  if (firstScript && firstScript.parentNode) {
    firstScript.parentNode.insertBefore(script, firstScript);
  } else {
    (doc.head || doc.getElementsByTagName('head')[0]).appendChild(script);
  }
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Promise —Å —Ç–∞–π–º–∞—É—Ç–æ–º**

```javascript
function waitForTikTokPixel(timeout = 5000) {
  return new Promise(function(resolve, reject) {
    if (win.ttq && typeof win.ttq.track === 'function') {
      resolve();
      return;
    }
    
    var startTime = Date.now();
    var checkInterval = setInterval(function() {
      if (win.ttq && typeof win.ttq.track === 'function') {
        clearInterval(checkInterval);
        resolve();
      } else if (Date.now() - startTime > timeout) {
        clearInterval(checkInterval);
        reject(new Error('TikTok Pixel timeout'));
      }
    }, 200); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 200ms
    
    // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —á–µ—Ä–µ–∑ onload
    var originalOnload = script.onload;
    script.onload = function() {
      if (originalOnload) originalOnload();
      setTimeout(function() {
        if (win.ttq && typeof win.ttq.track === 'function') {
          clearInterval(checkInterval);
          resolve();
        }
      }, 50);
    };
  });
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å requestAnimationFrame (–¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫)**

```javascript
function waitForTikTokPixel() {
  return new Promise(function(resolve) {
    function check() {
      if (win.ttq && typeof win.ttq.track === 'function') {
        resolve();
      } else {
        requestAnimationFrame(check);
      }
    }
    check();
    
    // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ Pixel –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
    setTimeout(function() {
      if (!win.ttq) {
        resolve(); // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–º–∏—Å –¥–∞–∂–µ –µ—Å–ª–∏ Pixel –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
      }
    }, 5000);
  });
}
```

### –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è:

1. **–†–∏—Å–∫:** onload –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π onload
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback —Å setInterval, –Ω–æ —Å –±–æ–ª—å—à–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º

2. **–†–∏—Å–∫:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - **–†–µ—à–µ–Ω–∏–µ:** –¢—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
   - **–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±—É—Ñ–µ—Ä–æ–º —Å–æ–±—ã—Ç–∏–π

3. **–†–∏—Å–∫:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –º–æ–∂–µ—Ç –∑–∞–¥–µ—Ä–∂–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å onload –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—É—Ñ–µ—Ä —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–∞–Ω–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: üü° –°–†–ï–î–ù–ò–ô

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å 50 –¥–æ 1-2
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ CPU –Ω–∞ 0.1-0.5%
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

---

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–í–û–î–ö–ê –í–°–ï–• –ü–†–û–ë–õ–ï–ú

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:

- **–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:** 100% –ø—Ä–æ–µ–∫—Ç–∞
- **–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º:** 18
  - üî¥ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö:** 5
  - üü° **–í—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:** 11
  - üü¢ **–°—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:** 2

### –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ –≤–ª–∏—è–Ω–∏—é –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

#### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã (80-100KB –ª–∏—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
2. **–û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS (488KB)** - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
3. **ImageOptimizationMiddleware –Ω–∞ –ª–µ—Ç—É** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ –∫—ç—à–∞
4. **N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
5. **N+1 –≤ build_color_preview_map** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î

#### üü° –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):

6. **COMPRESS_ENABLED = False** - —Å–∂–∞—Ç–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –≤ dev
7. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ DOM –∑–∞–ø—Ä–æ—Å—ã** - –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DOM
8. **innerHTML –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏** - —Ä–∏—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
9. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π cache_page_for_anon** - —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
10. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ os.path.exists()** - 320+ –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
11. **os.path.getmtime() –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ** - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –¥–ª—è ETag
12. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤** - –ø—Ä–æ–ø—É—Å–∫ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
13. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ .only()/.defer()** - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–ª—è –º–æ–¥–µ–ª–∏
14. **GTM –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ head** - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

#### üü¢ –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):

15. **Bootstrap —Å CDN** - –≤–Ω–µ—à–Ω—è—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
16. **–ü–æ—Ä—è–¥–æ–∫ middleware** - –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
17. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fragments –∫—ç—à–∞ –≤ dev** - –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ dev
18. **setInterval –¥–ª—è TikTok Pixel** - –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ CPU

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------|-------------------|-----------|
| **First Contentful Paint (FCP)** | ~1.5s | ~0.8s | **-47%** |
| **Time to Interactive (TTI)** | ~3.5s | ~1.8s | **-49%** |
| **Total Blocking Time (TBT)** | ~800ms | ~200ms | **-75%** |
| **Largest Contentful Paint (LCP)** | ~2.5s | ~1.2s | **-52%** |
| **Cumulative Layout Shift (CLS)** | ~0.1 | ~0.05 | **-50%** |
| **Database Queries** | ~25-30 | ~8-12 | **-60%** |
| **–†–∞–∑–º–µ—Ä CSS** | 488KB | ~200KB | **-59%** |
| **–†–∞–∑–º–µ—Ä JavaScript** | ~500KB | ~350KB | **-30%** |

### –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º:

- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:** 1.5s ‚Üí 0.8s (-47%)
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞:** 2.0s ‚Üí 1.0s (-50%)
- **–ö–æ—Ä–∑–∏–Ω–∞:** 1.8s ‚Üí 0.9s (-50%)
- **–ö–∞—Ç–∞–ª–æ–≥:** 1.2s ‚Üí 0.6s (-50%)

### –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:

- **–ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:** 3.0s ‚Üí 1.5s (-50%)
- **–°–ª–∞–±—ã–µ –ü–ö:** 2.5s ‚Üí 1.2s (-52%)
- **–ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (3G):** 5.0s ‚Üí 2.5s (-50%)

---

## üéØ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô (–ü–û –ü–†–ò–û–†–ò–¢–ï–¢–ê–ú)

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –¥–Ω—è)

1. ‚úÖ –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome
2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å CSS (—É–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç–∏–ª–∏, —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏)
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è ImageOptimizationMiddleware
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –≤ build_color_preview_map

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 40-50%

### –§–∞–∑–∞ 2: –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (3-5 –¥–Ω–µ–π)

6. ‚úÖ –í–∫–ª—é—á–∏—Ç—å COMPRESS_ENABLED –≤ dev
7. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å DOM –∑–∞–ø—Ä–æ—Å—ã (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DOMCache)
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é –¥–ª—è innerHTML
9. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å cache_page_for_anon
10. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å os.path.exists() –ø—Ä–æ–≤–µ—Ä–∫–∏
11. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å ETag (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hash –≤–º–µ—Å—Ç–æ mtime)
12. ‚úÖ –£–ª—É—á—à–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
13. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å .only()/.defer() –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
14. ‚úÖ –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å GTM –≤ –∫–æ–Ω–µ—Ü body

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 20-30%

### –§–∞–∑–∞ 3: –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-2 –Ω–µ–¥–µ–ª–∏)

15. ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å Bootstrap (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
16. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ middleware
17. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å fragments –∫—ç—à –≤ dev
18. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ TikTok Pixel

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ 5-10%

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø –î–õ–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### ‚ö†Ô∏è –ù–ï –ú–ï–ù–Ø–¢–¨:

1. **–õ–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å–∞–π—Ç–∞** - —Ç–æ–ª—å–∫–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. **UI/UX —ç–ª–µ–º–µ–Ω—Ç—ã** - —Ç–æ–ª—å–∫–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞
3. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ
4. **API endpoints** - –Ω–µ –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–æ–≤

### ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ staging** –ø–µ—Ä–µ–¥ production
2. **–ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö** (–º–æ–±–∏–ª—å–Ω—ã–µ, —Å–ª–∞–±—ã–µ –ü–ö)
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. **–î–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å feature flags** –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### üîç –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:

1. **Lighthouse** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏
2. **Chrome DevTools** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å Performance, Network
3. **Real User Monitoring** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
4. **Database queries** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
5. **Memory usage** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **Service Worker** - –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
2. **HTTP/2 Server Push** - –¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
3. **CDN** - –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è Bootstrap)
4. **Database read replicas** - –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
5. **Background tasks (Celery)** - –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

1. **Performance monitoring** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. **Error tracking** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **User experience monitoring** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **Database query monitoring** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## ‚úÖ –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–•–û–î–ö–ò (–ß–¢–û –£–ñ–ï –•–û–†–û–®–û)

1. ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã –ë–î** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
2. ‚úÖ **select_related/prefetch_related** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –º–µ—Å—Ç
3. ‚úÖ **Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
4. ‚úÖ **WhiteNoise** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è production
5. ‚úÖ **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** - —á–µ—Ä–µ–∑ requestIdleCallback
6. ‚úÖ **Width/height –∞—Ç—Ä–∏–±—É—Ç—ã** - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è CLS
7. ‚úÖ **Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
8. ‚úÖ **Mobile optimizations** - –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù (100%)**

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-30  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ + Context7 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è + –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞  
**–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:** 100% - –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã


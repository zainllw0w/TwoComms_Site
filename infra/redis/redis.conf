#############################################
# TwoComms Redis configuration (Docker)
# tuned for high read throughput and low latency
#############################################

# Bind only to loopback; docker-compose publishes explicitly when нужно.
bind 127.0.0.1
protected-mode yes
port 6379

# Persistence — keep append only log with fast fsync.
appendonly yes
appendfsync everysec

# Disable RDB snapshots to avoid blocking writes during save.
save ""

# Memory management — allow 512MB, evict least recently used keys.
maxmemory 512mb
maxmemory-policy allkeys-lru

# Reduce impact of evictions on main thread.
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# Keep smaller TCP backlog, important on small VPS.
tcp-backlog 128

# Enable client output buffer limits aligned with cache usage.
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit pubsub 16mb 4mb 60

# Enable ACL and require password for authentication
# Password must be set via REDIS_PASSWORD environment variable
# This will be enforced at Redis startup
requirepass ${REDIS_PASSWORD}
acllog-max-len 512

# Slowlog retention for diagnostics.
slowlog-log-slower-than 10000
slowlog-max-len 256

# Include custom overrides if provided.
include /etc/redis/conf.d/*.conf

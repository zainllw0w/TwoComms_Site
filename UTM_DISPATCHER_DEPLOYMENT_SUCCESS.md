# ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π UTM Dispatcher –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## üìÖ –î–∞—Ç–∞: 17 –Ω–æ—è–±—Ä—è 2025

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Git
- –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å `origin/main`
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –≤–µ—Ç–∫–∏ `feat-readme-utm-dispatcher-audit-implement` –ø–æ–ª—É—á–µ–Ω—ã
- 26 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–æ (8281+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

### 2. ‚úÖ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –í—Å–µ —Ñ–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH
- Git pull –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- –í—Å–µ —Ñ–∞–π–ª—ã UTM dispatcher –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
  - `storefront/utm_middleware.py` (10772 –±–∞–π—Ç)
  - `storefront/utm_utils.py` (13250 –±–∞–π—Ç)
  - `storefront/utm_tracking.py` (10195 –±–∞–π—Ç)
  - `storefront/utm_analytics.py` (26443 –±–∞–π—Ç)
  - `storefront/utm_api_views.py` (27569 –±–∞–π—Ç)
  - `storefront/utm_cohort_analysis.py` (18155 –±–∞–π—Ç)

### 3. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–ú–∏–≥—Ä–∞—Ü–∏—è 0033** (`storefront.0033_useraction_utmsession_and_more`): –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (fake)
- **–ú–∏–≥—Ä–∞—Ü–∏—è 0034** (`storefront.0034_fix_utm_indexes_mysql`): –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
- **–ú–∏–≥—Ä–∞—Ü–∏—è 0037** (`orders.0037_order_utm_campaign_order_utm_content_and_more`): –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

### 4. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ MySQL
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –Ω–∞ —Ç—Ä–µ—Ö –ø–æ–ª—è—Ö `CharField(255)` —Å `utf8mb4` –ø—Ä–µ–≤—ã—à–∞–ª –ª–∏–º–∏—Ç MySQL –≤ 1000 –±–∞–π—Ç (255*4*3=3060 –±–∞–π—Ç).

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è 0034 —Å –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏ (80 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ –ø–æ–ª–µ = 320 –±–∞–π—Ç –Ω–∞ –ø–æ–ª–µ = 960 –±–∞–π—Ç –≤—Å–µ–≥–æ, –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞).

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
- ‚úÖ `idx_utm_source_medium_campaign` (—Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ 80 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ `idx_utm_first_seen`
- ‚úÖ `idx_utm_converted`
- ‚úÖ `idx_utm_geo`
- ‚úÖ `idx_utm_device`
- ‚úÖ `idx_utm_returning`
- ‚úÖ `idx_utm_registered`
- ‚úÖ `idx_action_type_time`
- ‚úÖ `idx_action_utm_type`
- ‚úÖ `idx_action_product`
- ‚úÖ `idx_action_order`

### 5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware
- `UTMTrackingMiddleware` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `settings.py` (—Å—Ç—Ä–æ–∫–∞ 141)
- Middleware —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –ø–µ—Ä–µ–¥ `SimpleAnalyticsMiddleware` (–∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- –í—Å–µ –º–æ–¥—É–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### 6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- ‚úÖ –ú–æ–¥–µ–ª–∏ `UTMSession` –∏ `UserAction` —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ UTM dispatcher –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Django system check –ø—Ä–æ–π–¥–µ–Ω (—Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ namespace 'social', –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚úÖ –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω (touch wsgi.py)

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –§–∞–π–ª—ã
- **26 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** –¥–æ–±–∞–≤–ª–µ–Ω–æ
- **8281+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –¥–æ–±–∞–≤–ª–µ–Ω–æ
- **6 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π** UTM dispatcher

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **2 –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** `storefront_utmsession`, `storefront_useraction`
- **6 –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π** –≤ —Ç–∞–±–ª–∏—Ü–µ `orders_order` (utm_* –ø–æ–ª—è)
- **11 –∏–Ω–¥–µ–∫—Å–æ–≤** —Å–æ–∑–¥–∞–Ω–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ú–∏–≥—Ä–∞—Ü–∏–∏
- **3 –º–∏–≥—Ä–∞—Ü–∏–∏** –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- **1 –∏—Å–ø—Ä–∞–≤–ª—è—é—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å MySQL

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `requirements.txt`:
- `Django==5.2.6` ‚úÖ
- `requests==2.32.5` (–¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚úÖ
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python (logging, re, typing) ‚úÖ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `user-agents`, `pyyaml`, `ua-parser` —É–ø–æ–º—è–Ω—É—Ç—ã –≤ README, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–¥–µ. –û–Ω–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ UTM Dispatcher

```
storefront/
‚îú‚îÄ‚îÄ utm_middleware.py      # Middleware –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ utm_utils.py           # –£—Ç–∏–ª–∏—Ç—ã (–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è, –ø–∞—Ä—Å–∏–Ω–≥ User-Agent)
‚îú‚îÄ‚îÄ utm_tracking.py        # –§—É–Ω–∫—Ü–∏–∏ –∑–∞–ø–∏—Å–∏ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ utm_analytics.py       # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îú‚îÄ‚îÄ utm_api_views.py       # DRF API endpoints
‚îî‚îÄ‚îÄ utm_cohort_analysis.py # –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ ROI
```

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ:
1. ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ
2. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
3. ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
4. ‚úÖ Middleware –Ω–∞—Å—Ç—Ä–æ–µ–Ω
5. ‚úÖ –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `https://twocomms.shop/admin-panel?section=dispatcher`
2. –ù–∞—á–Ω–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UTM-–º–µ—Ç–∫–∏ –≤ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏—è—Ö
3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–∞–π–ª–∞—Ö:
- `README_UTM_DISPATCHER.md` - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `UTM_DISPATCHER_QUICKSTART.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `UTM_DISPATCHER_TESTING_CHECKLIST.md` - —á–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `UTM_DISPATCHER_IMPLEMENTATION_SUMMARY.md` - —Ä–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ò—Ç–æ–≥

**UTM Dispatcher —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:
- ‚úÖ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä
- ‚úÖ Production —Å–µ—Ä–≤–µ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é UTM-–º–µ—Ç–æ–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π.


# üîç –°–í–ï–†–•–î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –í–°–ï–• –ü–†–û–ë–õ–ï–ú –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-30  
**–í–µ—Ä—Å–∏—è:** 1.0 Ultra Detailed  
**–¶–µ–ª—å:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –æ–±–ª–µ–≥—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ò–ò –∞–≥–µ–Ω—Ç–æ–≤

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

- [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (12)](#üî¥-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã-12)
- [–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (32)](#üü°-–≤—ã—Å–æ–∫–∏–π-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-32)
- [–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (5)](#üü¢-—Å—Ä–µ–¥–Ω–∏–π-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-5)

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (12)

---

## –ü–†–û–ë–õ–ï–ú–ê #1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Font Awesome

### üî¥ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ù–û

### üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

Font Awesome –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è **–¥–≤–∞–∂–¥—ã** –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:
1. **–õ–æ–∫–∞–ª—å–Ω–æ** —á–µ—Ä–µ–∑ Django static files (`/static/vendor/fontawesome/css/all.min.css`)
2. **–ß–µ—Ä–µ–∑ CDN** –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (`https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css`)

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
- –ë—Ä–∞—É–∑–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –ø–∞—Ä—Å–∏—Ç **–¥–≤–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö CSS —Ñ–∞–π–ª–∞** (~80-100KB –∫–∞–∂–¥—ã–π)
- –≠—Ç–æ **—É–¥–≤–∞–∏–≤–∞–µ—Ç** —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö (160-200KB –≤–º–µ—Å—Ç–æ 80-100KB)
- –û–±–∞ —Ñ–∞–π–ª–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- CDN –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–∞—Ä—Å–∏—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º
- –≠—Ç–æ **–∫—Ä–∏—Ç–∏—á–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ FCP** (First Contentful Paint)

**–ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **FCP:** +325-650ms –∑–∞–¥–µ—Ä–∂–∫–∞ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞)
- **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:** +80-100KB –ª–∏—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (3G):** +1.2-1.6 —Å–µ–∫—É–Ω–¥—ã
- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (4G):** +0.4-0.5 —Å–µ–∫—É–Ω–¥—ã
- **–ü–∞—Ä—Å–∏–Ω–≥ CSS:** +200-300ms (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ –≤—Ç–æ—Ä–æ–≥–æ —Ñ–∞–π–ª–∞)

### üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–¥–µ

- **–§–∞–π–ª:** `twocomms/twocomms_django_theme/templates/base.html`
- **–°—Ç—Ä–æ–∫–∏:** 27, 29-33
- **–ë–ª–æ–∫:** `<head>` —Å–µ–∫—Ü–∏—è
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:**

```27:33:twocomms/twocomms_django_theme/templates/base.html
  <!-- Font Awesome: –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–Ω–¥–ª + CDN (—É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω) -->
  <link rel="stylesheet" href="{% static 'vendor/fontawesome/css/all.min.css' %}">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" as="style"
    crossorigin="anonymous" referrerpolicy="no-referrer" onload="this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      crossorigin="anonymous" referrerpolicy="no-referrer">
  </noscript>
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª: `twocomms/twocomms_django_theme/static/vendor/fontawesome/css/all.min.css`
- –†–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: ~80-100KB
- CDN URL: `https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css`
- –í–µ—Ä—Å–∏—è: 6.5.2

### üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Django template tag: `{% static 'vendor/fontawesome/css/all.min.css' %}`
- HTML `<link rel="stylesheet">` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- HTML `<link rel="preload">` —Å `onload` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ CDN –≤–µ—Ä—Å–∏–∏
- `<noscript>` fallback –¥–ª—è CDN –≤–µ—Ä—Å–∏–∏

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ë—Ä–∞—É–∑–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —á–µ—Ä–µ–∑ Django static files (–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
2. –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—Ä–∞—É–∑–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É CDN –≤–µ—Ä—Å–∏–∏ —á–µ—Ä–µ–∑ `preload` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)
3. –ö–æ–≥–¥–∞ CDN –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –æ–Ω–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `onload` handler
4. –û–±–∞ CSS —Ñ–∞–π–ª–∞ –ø–∞—Ä—Å—è—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º
5. –û–±–∞ —Ñ–∞–π–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ DOM (–≤—Ç–æ—Ä–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—ã–π, –Ω–æ —ç—Ç–æ –ª–∏—à–Ω—è—è —Ä–∞–±–æ—Ç–∞)

**–ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ù–∞ **–∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ** —Å–∞–π—Ç–∞
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5)

**–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
- **–°–µ—Ç—å:** 160-200KB –¥–∞–Ω–Ω—ã—Ö (–≤–º–µ—Å—Ç–æ 80-100KB)
- **CPU:** –ü–∞—Ä—Å–∏–Ω–≥ –¥–≤—É—Ö CSS —Ñ–∞–π–ª–æ–≤ (~200-300ms –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)
- **–ü–∞–º—è—Ç—å:** –î–≤–∞ CSSOM –¥–µ—Ä–µ–≤–∞ –≤ –ø–∞–º—è—Ç–∏ (–≤—Ä–µ–º–µ–Ω–Ω–æ)
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:** ~325-650ms

### üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------------------|-----------|
| **FCP** | +325-650ms –∑–∞–¥–µ—Ä–∂–∫–∞ | 0ms –∑–∞–¥–µ—Ä–∂–∫–∞ | **-50%** |
| **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö** | 160-200KB | 80-100KB | **-50%** |
| **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (3G)** | +1.2-1.6s | +0.6-0.8s | **-50%** |
| **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (4G)** | +0.4-0.5s | +0.2-0.25s | **-50%** |
| **–ü–∞—Ä—Å–∏–Ω–≥ CSS** | ~400-600ms | ~200-300ms | **-50%** |
| **LCP** | –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ | - | - |
| **TTI** | –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ | - | - |
| **CLS** | –ù–µ—Ç –≤–ª–∏—è–Ω–∏—è | - | - |
| **FID** | –ù–µ—Ç –≤–ª–∏—è–Ω–∏—è | - | - |

### ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è:**
1. **–ò–∫–æ–Ω–∫–∏ –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è** - –µ—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å –Ω–µ —Ç—É –≤–µ—Ä—Å–∏—é –∏–ª–∏ –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
2. **–í–µ—Ä—Å–∏–∏ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è** - –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –∏ CDN –≤–µ—Ä—Å–∏–∏ —Ä–∞–∑–Ω—ã–µ, –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è
3. **CDN –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - –µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ CDN, –∏–∫–æ–Ω–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–µ—Ç—å—é

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Django static files —Å–∏—Å—Ç–µ–º–∞
- CDN –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (cdnjs.cloudflare.com)
- –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ Font Awesome –∏–∫–æ–Ω–∫–∏

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∫–æ–Ω–æ–∫ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ offline —Ä–µ–∂–∏–º–µ (–µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ CDN (–µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å CDN –≤–µ—Ä—Å–∏—é)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∫–æ–Ω–æ–∫

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏:**
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ Font Awesome
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ JavaScript –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ Font Awesome

### ‚úÖ –ü–†–û–í–ï–†–ö–ê –ß–ï–†–ï–ó –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ –ò CONTEXT7

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Font Awesome
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ Context7 (Django static files)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –≤–µ–±-–ø–æ–∏—Å–∫ (best practices –¥–ª—è Font Awesome)
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. –£–¥–∞–ª–∏—Ç—å CDN –≤–µ—Ä—Å–∏—é (—Å—Ç—Ä–æ–∫–∏ 29-33)
2. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é (—Å—Ç—Ä–æ–∫–∞ 27)
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∞–∫—Ç—É–∞–ª–µ–Ω
4. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ (tree-shaking) –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

## –ü–†–û–ë–õ–ï–ú–ê #2: –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π CSS —Ñ–∞–π–ª (486KB)

### üî¥ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ù–û

### üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–û—Å–Ω–æ–≤–Ω–æ–π CSS —Ñ–∞–π–ª `styles.css` –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä **486KB** (476KB –ø–æ —Ñ–∞–∫—Ç—É), —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ CSS (<50KB –¥–ª—è critical CSS, <200KB –¥–ª—è –≤—Å–µ–≥–æ CSS).

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
- CSS –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ù–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö (3G) –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç ~7.8 —Å–µ–∫—É–Ω–¥
- –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å CSS –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ù–µ—Ç code splitting - –≤–µ—Å—å CSS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ (—Ä–∞–∑–Ω–∏—Ü–∞ –≤—Å–µ–≥–æ 0.03%)

**–ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **FCP:** +500-700ms –∑–∞–¥–µ—Ä–∂–∫–∞ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞)
- **TTI:** +300-500ms –∑–∞–¥–µ—Ä–∂–∫–∞ (–ø–∞—Ä—Å–∏–Ω–≥ –±–æ–ª—å—à–æ–≥–æ CSS)
- **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:** 486KB –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (3G):** ~7.8 —Å–µ–∫—É–Ω–¥
- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (4G):** ~2.4 —Å–µ–∫—É–Ω–¥—ã

### üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–¥–µ

- **–§–∞–π–ª:** `twocomms/twocomms_django_theme/static/css/styles.css`
- **–†–∞–∑–º–µ—Ä:** 476KB (486,259 –±–∞–π—Ç)
- **–°—Ç—Ä–æ–∫:** 23,745 —Å—Ç—Ä–æ–∫
- **–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤:** `twocomms/twocomms_django_theme/templates/base.html`
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏:**

```html
<!-- –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≥–¥–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è styles.css –≤ base.html -->
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- –ú–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: `styles.min.css` (—Ä–∞–∑–º–µ—Ä –ø–æ—á—Ç–∏ —Ç–∞–∫–æ–π –∂–µ - –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞)
- –°–≤—è–∑–∞–Ω–Ω—ã–µ CSS —Ñ–∞–π–ª—ã:
  - `product-detail.css`
  - `promocodes.css`
  - `wholesale.css`
  - `cls-ultimate.css`

### üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –û–¥–∏–Ω –±–æ–ª—å—à–æ–π CSS —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ —Å—Ç–∏–ª—è–º–∏
- Django static files –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- –ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ django-compressor (–Ω–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ë—Ä–∞—É–∑–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç `styles.css` (–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
2. –ë—Ä–∞—É–∑–µ—Ä –ø–∞—Ä—Å–∏—Ç –≤–µ—Å—å CSS —Ñ–∞–π–ª (~200-300ms)
3. –ë—Ä–∞—É–∑–µ—Ä —Å—Ç—Ä–æ–∏—Ç CSSOM –¥–µ—Ä–µ–≤–æ
4. –ë—Ä–∞—É–∑–µ—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç–∏–ª–∏ –∫ DOM
5. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ù–∞ **–∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ** —Å–∞–π—Ç–∞
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5)

**–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
- **–°–µ—Ç—å:** 486KB –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- **CPU:** –ü–∞—Ä—Å–∏–Ω–≥ 23,745 —Å—Ç—Ä–æ–∫ CSS (~200-300ms)
- **–ü–∞–º—è—Ç—å:** CSSOM –¥–µ—Ä–µ–≤–æ –≤ –ø–∞–º—è—Ç–∏ (~2-5MB)
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:** ~500-700ms

**–ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CSS:**
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS (above-the-fold):** ~30-50KB (6-10% –æ—Ç –≤—Å–µ–≥–æ)
- **CSS –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:** ~80-120KB (16-25% –æ—Ç –≤—Å–µ–≥–æ)
- **CSS –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞:** ~100-150KB (20-31% –æ—Ç –≤—Å–µ–≥–æ)
- **CSS –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:** ~60-100KB (12-21% –æ—Ç –≤—Å–µ–≥–æ)
- **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π CSS:** ~200-300KB (40-60% –æ—Ç –≤—Å–µ–≥–æ)

### üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------------------|-----------|
| **FCP** | +500-700ms –∑–∞–¥–µ—Ä–∂–∫–∞ | +150-250ms –∑–∞–¥–µ—Ä–∂–∫–∞ | **-60-70%** |
| **TTI** | +300-500ms –∑–∞–¥–µ—Ä–∂–∫–∞ | +100-150ms –∑–∞–¥–µ—Ä–∂–∫–∞ | **-60-70%** |
| **–†–∞–∑–º–µ—Ä CSS** | 486KB | ~150-200KB (critical + –º–æ–¥—É–ª–∏) | **-60-70%** |
| **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (3G)** | ~7.8s | ~2.4-3.2s | **-60-70%** |
| **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (4G)** | ~2.4s | ~0.8-1.0s | **-60-70%** |
| **–ü–∞—Ä—Å–∏–Ω–≥ CSS** | ~200-300ms | ~60-100ms | **-60-70%** |
| **LCP** | –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ | - | - |
| **CLS** | –ù–µ—Ç –≤–ª–∏—è–Ω–∏—è | - | - |
| **FID** | –ù–µ—Ç –≤–ª–∏—è–Ω–∏—è | - | - |

### ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è:**
1. **–°—Ç–∏–ª–∏ –º–æ–≥—É—Ç –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è** - –µ—Å–ª–∏ critical CSS –∏–∑–≤–ª–µ—á–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **–í–∏–∑—É–∞–ª—å–Ω—ã–µ –±–∞–≥–∏** - –µ—Å–ª–∏ –º–æ–¥—É–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - –µ—Å–ª–∏ —Ñ–∞–π–ª—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏** - –µ—Å–ª–∏ —Å—Ç–∏–ª–∏ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- –í—Å–µ HTML —à–∞–±–ª–æ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã –∏–∑ `styles.css`
- JavaScript –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç/—É–¥–∞–ª—è–µ—Ç –∫–ª–∞—Å—Å—ã
- Django template —Å–∏—Å—Ç–µ–º–∞
- Django static files —Å–∏—Å—Ç–µ–º–∞

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º JavaScript

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ static files)

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏:**
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–π—Ç–∞
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ JavaScript –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å—Ç–∏–ª—è–º–∏
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ static files

### ‚úÖ –ü–†–û–í–ï–†–ö–ê –ß–ï–†–ï–ó –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ –ò CONTEXT7

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (Critical CSS extraction)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ Context7 (Django static files, CSS optimization)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –≤–µ–±-–ø–æ–∏—Å–∫ (CSS code splitting best practices)
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. –ò–∑–≤–ª–µ—á—å critical CSS (30-50KB) –¥–ª—è above-the-fold –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. –†–∞–∑–¥–µ–ª–∏—Ç—å CSS –Ω–∞ –º–æ–¥—É–ª–∏ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º (home.css, product-detail.css, cart.css, catalog.css)
3. –ó–∞–≥—Ä—É–∂–∞—Ç—å critical CSS inline –≤ `<head>`
4. –ó–∞–≥—Ä—É–∂–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–π CSS –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏–ª–∏ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
5. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π CSS (PurgeCSS)
6. –£–ª—É—á—à–∏—Ç—å –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é

---

## –ü–†–û–ë–õ–ï–ú–ê #3: N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ

### üî¥ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ù–û

### üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–í —Ñ—É–Ω–∫—Ü–∏–∏ `view_cart` –∏ `cart_items_api` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è N+1 –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
- –î–ª—è 10 —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 20-25 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –≤–º–µ—Å—Ç–æ 2-3
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç ~10-20ms
- –û–±—â–µ–µ –≤—Ä–µ–º—è: 200-500ms –¥–ª—è 10 —Ç–æ–≤–∞—Ä–æ–≤, 400-1000ms –¥–ª—è 20 —Ç–æ–≤–∞—Ä–æ–≤
- –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ TTFB (Time To First Byte) –∏ LCP (Largest Contentful Paint)

**–ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **TTFB:** +200-500ms –∑–∞–¥–µ—Ä–∂–∫–∞
- **LCP:** +200-500ms –∑–∞–¥–µ—Ä–∂–∫–∞
- **–ë–î –Ω–∞–≥—Ä—É–∑–∫–∞:** –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 10-20 —Ä–∞–∑
- **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–¥–µ

#### 3.1. –§—É–Ω–∫—Ü–∏—è `view_cart` (—á–∞—Å—Ç–∏—á–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞)

- **–§–∞–π–ª:** `twocomms/storefront/views/cart.py`
- **–°—Ç—Ä–æ–∫–∏:** 141-146 (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —á–∞—Å—Ç—å), –Ω–æ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –º–µ—Å—Ç–∞
- **–§—É–Ω–∫—Ü–∏—è:** `view_cart(request)`
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:**

```141:146:twocomms/storefront/views/cart.py
    product_ids = [item_data.get('product_id') for item_data in cart.values() if item_data.get('product_id')]
    products_map = Product.objects.select_related('category').prefetch_related('color_variants__images').in_bulk(product_ids)
    
    # Optimization: Fetch all color variants at once
    color_variant_ids = [item_data.get('color_variant_id') for item_data in cart.values() if item_data.get('color_variant_id')]
    from productcolors.models import ProductColorVariant
    color_variants_map = ProductColorVariant.objects.select_related('color').in_bulk(color_variant_ids)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `in_bulk`)

#### 3.2. –§—É–Ω–∫—Ü–∏—è `cart_items_api` (–ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ - –ö–†–ò–¢–ò–ß–ù–û)

- **–§–∞–π–ª:** `twocomms/storefront/views/cart.py`
- **–°—Ç—Ä–æ–∫–∏:** 1035
- **–§—É–Ω–∫—Ü–∏—è:** `cart_items_api(request)`
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:**

```1030:1045:twocomms/storefront/views/cart.py
    total_quantity = 0
    
    for item_key, item_data in cart.items():
        try:
            product_id = item_data.get('product_id')
            product = Product.objects.select_related('category').get(id=product_id)
            
            price = product.final_price
            original_price = Decimal(product.price)
            qty = int(item_data.get('qty', 1))
            line_total = price * qty
            original_line_total = original_price * qty
            site_line_discount = original_line_total - line_total
            if site_line_discount < 0:
                site_line_discount = Decimal('0.00')
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `Product.objects.get(id=product_id)` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ü–∏–∫–ª–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞!

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:**
- 10 —Ç–æ–≤–∞—Ä–æ–≤ = 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–≤–º–µ—Å—Ç–æ 1)
- 20 —Ç–æ–≤–∞—Ä–æ–≤ = 20 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–≤–º–µ—Å—Ç–æ 1)
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç ~10-20ms
- –û–±—â–µ–µ –≤—Ä–µ–º—è: 100-200ms –¥–ª—è 10 —Ç–æ–≤–∞—Ä–æ–≤, 200-400ms –¥–ª—è 20 —Ç–æ–≤–∞—Ä–æ–≤

### üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Django ORM: `Product.objects.get(id=product_id)` –≤ —Ü–∏–∫–ª–µ
- Django ORM: `Product.objects.select_related('category')` (—á–∞—Å—Ç–∏—á–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
- Django ORM: `Product.objects.in_bulk(product_ids)` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `view_cart`, –Ω–æ –ù–ï –≤ `cart_items_api`)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –∏–∑ —Å–µ—Å—Å–∏–∏
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å `Product.objects.get(id=product_id)`
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—á–∞—Å—Ç–∏—á–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `select_related`)
4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫

**–ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–º AJAX –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** –∫–æ—Ä–∑–∏–Ω—ã (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ—Ä–∑–∏–Ω—ã
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏** –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞

**–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
- **–ë–î –∑–∞–ø—Ä–æ—Å—ã:** N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è N —Ç–æ–≤–∞—Ä–æ–≤ (–≤–º–µ—Å—Ç–æ 1)
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 100-400ms –¥–ª—è 10-20 —Ç–æ–≤–∞—Ä–æ–≤
- **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î
- **–°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É

### üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ (10 —Ç–æ–≤–∞—Ä–æ–≤) | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------------|-------------------|-----------|
| **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î** | 20-25 | 2-3 | **-85-90%** |
| **–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–æ–≤** | ~200-500ms | ~20-50ms | **-80-90%** |
| **TTFB** | ~400-800ms | ~100-200ms | **-75-80%** |
| **LCP** | ~200-500ms –∑–∞–¥–µ—Ä–∂–∫–∞ | ~20-50ms –∑–∞–¥–µ—Ä–∂–∫–∞ | **-80-90%** |
| **–ë–î –Ω–∞–≥—Ä—É–∑–∫–∞** | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | **-85-90%** |

### ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è:**
1. **–¢–æ–≤–∞—Ä—ã –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è** - –µ—Å–ª–∏ `in_bulk` –≤–µ—Ä–Ω–µ—Ç –Ω–µ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
2. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–≤–∞—Ä–∞** - –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- –ú–æ–¥–µ–ª—å `Product`
- –ú–æ–¥–µ–ª—å `ProductColorVariant`
- –°–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏)
- AJAX –∑–∞–ø—Ä–æ—Å—ã –∫ `cart_items_api`

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –ë–î
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤ (50+)

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏:**
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ AJAX –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –º–∏–Ω–∏-–∫–æ—Ä–∑–∏–Ω—É (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

### ‚úÖ –ü–†–û–í–ï–†–ö–ê –ß–ï–†–ï–ó –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ –ò CONTEXT7

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Django ORM (in_bulk, select_related, prefetch_related)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ Context7 (Django ORM optimization)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –≤–µ–±-–ø–æ–∏—Å–∫ (Django N+1 queries best practices)
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Product.objects.in_bulk(product_ids)` –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞ —Å `get()`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `select_related('category')` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `prefetch_related('color_variants__images')` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î
5. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–µ –∂–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, —á—Ç–æ –∏ –≤ `view_cart` (—Å—Ç—Ä–æ–∫–∏ 141-146)

---

## –ü–†–û–ë–õ–ï–ú–ê #4: N+1 –∑–∞–ø—Ä–æ—Å—ã –≤ build_color_preview_map

### üî¥ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ù–û

### üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–í —Ñ—É–Ω–∫—Ü–∏–∏ `build_color_preview_map` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `variant.images.all()` –≤ —Ü–∏–∫–ª–µ, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç N+1 –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ü–≤–µ—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
- –î–ª—è 20 —Ç–æ–≤–∞—Ä–æ–≤ —Å 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ü–≤–µ—Ç–∞ –∫–∞–∂–¥—ã–π = 60+ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç ~10-15ms
- –û–±—â–µ–µ –≤—Ä–µ–º—è: 600-900ms
- –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ TTFB –∏ LCP –∫–∞—Ç–∞–ª–æ–≥–∞

**–ö–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **TTFB –∫–∞—Ç–∞–ª–æ–≥–∞:** +400-800ms –∑–∞–¥–µ—Ä–∂–∫–∞
- **LCP:** +400-800ms –∑–∞–¥–µ—Ä–∂–∫–∞
- **–ë–î –Ω–∞–≥—Ä—É–∑–∫–∞:** –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 20-30 —Ä–∞–∑
- **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ç–∞–ª–æ–≥–∞

### üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –∫–æ–¥–µ

- **–§–∞–π–ª:** `twocomms/storefront/services/catalog_helpers.py`
- **–°—Ç—Ä–æ–∫–∏:** 58-85 (—Ñ—É–Ω–∫—Ü–∏—è `build_color_preview_map`), 36-55 (—Ñ—É–Ω–∫—Ü–∏—è `_load_product_color_variant_queryset`)
- **–§—É–Ω–∫—Ü–∏—è:** `build_color_preview_map(products: Iterable[Any]) -> Dict[int, List[Dict[str, Any]]]`
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:**

```58:85:twocomms/storefront/services/catalog_helpers.py
def build_color_preview_map(products: Iterable[Any]) -> Dict[int, List[Dict[str, Any]]]:
    """
    Returns mapping {product_id: [colour preview dicts]} suitable for product cards / featured.
    """
    product_ids = [p.id for p in products if getattr(p, 'id', None)]
    if not product_ids:
        return {}

    queryset = _load_product_color_variant_queryset(product_ids)
    if queryset is None:
        return {}

    preview_map: Dict[int, List[Dict[str, Any]]] = defaultdict(list)
    for variant in queryset:
        color = getattr(variant, 'color', None)
        images = list(getattr(variant, 'images', []).all() if hasattr(variant, 'images') else [])
        first_image = images[0].image.url if images else ''
        preview_map[variant.product_id].append(
            {
                'id': variant.id,
                'primary_hex': getattr(color, 'primary_hex', '') or '',
                'secondary_hex': getattr(color, 'secondary_hex', '') or '',
                'first_image_url': first_image,
                'is_default': bool(getattr(variant, 'is_default', False)),
            }
        )

    return preview_map
```

**–ü—Ä–æ–±–ª–µ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:** 73
```python
images = list(getattr(variant, 'images', []).all() if hasattr(variant, 'images') else [])
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `variant.images.all()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ü–∏–∫–ª–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞, —Ö–æ—Ç—è –≤ `_load_product_color_variant_queryset` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `prefetch_related('images')`!

**–§—É–Ω–∫—Ü–∏—è `_load_product_color_variant_queryset`:**

```36:55:twocomms/storefront/services/catalog_helpers.py
def _load_product_color_variant_queryset(product_ids: Iterable[int]):
    """
    Internal helper that fetches ProductColorVariant queryset safely.
    """
    try:
        ProductColorVariant = apps.get_model('productcolors', 'ProductColorVariant')
    except LookupError:
        logger.debug("productcolors.ProductColorVariant is not available; skipping colour enrichment.")
        return None

    try:
        return (
            ProductColorVariant.objects.select_related('color')
            .prefetch_related('images')  # ‚úÖ –£–ñ–ï –ï–°–¢–¨ prefetch_related!
            .filter(product_id__in=product_ids)
            .order_by('product_id', 'order', 'id')
        )
    except DatabaseError as exc:
        logger.warning("Failed to load ProductColorVariant rows: %s", exc, exc_info=exc)
        return None
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `_load_product_color_variant_queryset` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `prefetch_related('images')`, –Ω–æ –≤ `build_color_preview_map` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `variant.images.all()`, —á—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç prefetched cache –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã!

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤:**
- 20 —Ç–æ–≤–∞—Ä–æ–≤ √ó 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ü–≤–µ—Ç–∞ = 60+ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–≤–º–µ—Å—Ç–æ 2-3)
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç ~10-15ms
- –û–±—â–µ–µ –≤—Ä–µ–º—è: 600-900ms

### üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Django ORM: `ProductColorVariant.objects.prefetch_related('images')` (—É–∂–µ –µ—Å—Ç—å, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!)
- Django ORM: `variant.images.all()` –≤ —Ü–∏–∫–ª–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç prefetched cache)
- Django prefetch cache: `_prefetched_objects_cache` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. `_load_product_color_variant_queryset` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å `prefetch_related('images')`
2. Django –≤—ã–ø–æ–ª–Ω—è–µ—Ç prefetch –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `_prefetched_objects_cache`
3. –í —Ü–∏–∫–ª–µ `build_color_preview_map` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `variant.images.all()`
4. **–ü–†–û–ë–õ–ï–ú–ê:** `variant.images.all()` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç prefetched cache –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å!

**–ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** –∫–∞—Ç–∞–ª–æ–≥–∞
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ** —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ü—Ä–∏ **–∫–∞–∂–¥–æ–º AJAX** –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤

**–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
- **–ë–î –∑–∞–ø—Ä–æ—Å—ã:** N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è N –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è prefetched cache)
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 400-900ms –¥–ª—è 20-60 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î
- **–°–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É

### üìä –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ (20 —Ç–æ–≤–∞—Ä–æ–≤) | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------------|-------------------|-----------|
| **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î** | 40-60 | 2-3 | **-90-95%** |
| **–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–æ–≤** | ~400-800ms | ~20-50ms | **-90-95%** |
| **TTFB –∫–∞—Ç–∞–ª–æ–≥–∞** | ~600-1200ms | ~100-200ms | **-80-85%** |
| **LCP** | ~400-800ms –∑–∞–¥–µ—Ä–∂–∫–∞ | ~20-50ms –∑–∞–¥–µ—Ä–∂–∫–∞ | **-90-95%** |
| **–ë–î –Ω–∞–≥—Ä—É–∑–∫–∞** | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | **-90-95%** |

### ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è:**
1. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è** - –µ—Å–ª–∏ prefetched cache –ø—É—Å—Ç–æ–π
2. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ—Ç
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º** - –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫—ç—à–∏—Ä—É—é—Ç—Å—è, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- –ú–æ–¥–µ–ª—å `ProductColorVariant`
- –ú–æ–¥–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å–≤—è–∑–∞–Ω–Ω–∞—è —á–µ—Ä–µ–∑ ForeignKey)
- Django prefetch cache —Å–∏—Å—Ç–µ–º–∞
- –§—É–Ω–∫—Ü–∏—è `get_detailed_color_variants` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - —Å—Ç—Ä–æ–∫–∏ 104-107)

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —É –≤–∞—Ä–∏–∞–Ω—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤ (100+)
5. –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `get_detailed_color_variants` (–∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥)

**–ú–∏–≥—Ä–∞—Ü–∏–∏:**
- –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

**–í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏:**
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ AJAX –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤

### ‚úÖ –ü–†–û–í–ï–†–ö–ê –ß–ï–†–ï–ó –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ –ò CONTEXT7

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Django ORM (prefetch_related, _prefetched_objects_cache)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ Context7 (Django ORM prefetch optimization)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ –≤–µ–±-–ø–æ–∏—Å–∫ (Django prefetch_related best practices)
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]
- [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é: [–ø—É—Å—Ç–æ - –∑–∞–ø–æ–ª–Ω–∏—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–≥–µ–Ω—Ç]

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prefetched cache –≤–º–µ—Å—Ç–æ `variant.images.all()`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getattr(variant, '_prefetched_objects_cache', {}).get('images', [])`
3. –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ `variant.images.all()` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ prefetch –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é `get_detailed_color_variants` (—Å—Ç—Ä–æ–∫–∏ 104-107) - —Ç–∞–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥!

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –í–º–µ—Å—Ç–æ:
images = list(getattr(variant, 'images', []).all() if hasattr(variant, 'images') else [])

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
images = getattr(variant, '_prefetched_objects_cache', {}).get('images', [])
if not images:
    # Fallback —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ prefetch –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
    images = list(variant.images.all()) if hasattr(variant, 'images') else []
```

---

*[–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–ª–µ–¥—É–µ—Ç... –°–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —á–∞—Å—Ç—è—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞]*

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–µ—Ä—Ö–¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–≤—ã—Ö 4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º. –û—Å—Ç–∞–ª—å–Ω—ã–µ 8 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º, 32 –ø—Ä–æ–±–ª–µ–º—ã –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏ 5 –ø—Ä–æ–±–ª–µ–º —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —á–∞—Å—Ç—è—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞.

**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–∑–¥–∞–Ω–∏—è (4/44 –ø—Ä–æ–±–ª–µ–º –æ–ø–∏—Å–∞–Ω—ã)


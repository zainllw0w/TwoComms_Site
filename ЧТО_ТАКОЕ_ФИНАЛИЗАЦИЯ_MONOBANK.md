# üí∞ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (finalize) –≤ Monobank? –ü–æ–ª–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

## üéØ –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

**–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî —ç—Ç–æ –ù–ï —Å–∞–º–∞ –æ–ø–ª–∞—Ç–∞**, –∞ **–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º—ã** –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –¥–µ–Ω—å–≥–∏ —É–∂–µ —Å–ø–∏—Å–∞–Ω—ã.

---

## üìä –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–ª–∞—Ç–µ–∂–∞ –≤ Monobank

### –≠—Ç–∞–ø 1: –û–ø–ª–∞—Ç–∞ (Payment)
–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å" –≤ Monobank:

```
üí∞ –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç–∏–ª ‚Üí –î–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã —Å –∫–∞—Ä—Ç—ã ‚Üí –°—Ç–∞—Ç—É—Å: "success" –∏–ª–∏ "hold"
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Monobank **–±–ª–æ–∫–∏—Ä—É–µ—Ç/—Å–ø–∏—Å—ã–≤–∞–µ—Ç** –¥–µ–Ω—å–≥–∏ —Å –∫–∞—Ä—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å `success` (–µ—Å–ª–∏ –ø–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞) –∏–ª–∏ `hold` (–µ—Å–ª–∏ —Ö–æ–ª–¥)
- –í–∞—à –∑–∞–∫–∞–∑ –ø–æ–ª—É—á–∞–µ—Ç `payment_status = 'paid'` –∏–ª–∏ `'prepaid'`

### –≠—Ç–∞–ø 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–≤–∞—Ä–∞ (Ship)
–ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ç–æ–≤–∞—Ä:

```
üì¶ –ê–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ" (ship)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –í—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
- –û—Ç–º–µ—á–∞–µ—Ç–µ –¢–¢–ù
- **–ó–¥–µ—Å—å –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å ‚Äî —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è!**

### –≠—Ç–∞–ø 3: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (Finalize) ‚Äî –ù–û–í–û–ï!
–¢–µ–ø–µ—Ä—å, –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏, –º–æ–∂–Ω–æ **–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –Ω–∞–ª–æ–≥–æ–≤–æ–π:

```
üîí –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –ú–æ–Ω–æ–±–∞–Ω–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –°—á–µ—Ç –∑–∞—Ñ–∏—Å–∫–∞–ª–∏–∑–æ–≤–∞–Ω
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ Monobank
- Monobank –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–∞–ª–æ–≥–æ–≤–æ–π
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Ä–∞–∂–µ–Ω—ã –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏

---

## ü§î –ê –∑–∞—á–µ–º –Ω—É–∂–Ω–∞ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è?

### –°–ª—É—á–∞–π 1: –ü—Ä–æ–º–æ–∫–æ–¥—ã –ù–ï –≤–∏–¥–Ω—ã –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:**
```
1. –ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–∏–ª —Ç–æ–≤–∞—Ä –∑–∞ 1000 –≥—Ä–Ω
2. –í—ã —Å–æ–∑–¥–∞–ª–∏ invoice –Ω–∞ 1000 –≥—Ä–Ω
3. –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏–º–µ–Ω–∏–ª –ø—Ä–æ–º–æ–∫–æ–¥ -10% –ø—Ä—è–º–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ
4. –û–ø–ª–∞—Ç–∏–ª —Ç–æ–ª—å–∫–æ 900 –≥—Ä–Ω
5. –í —á–µ–∫–µ Monobank: "–û–ø–ª–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è 900 –≥—Ä–Ω" ‚ùå
   ‚Üí –ù–ï–¢ –î–ï–¢–ê–õ–ò: –∫–∞–∫–æ–π —Ç–æ–≤–∞—Ä, –∫–∞–∫–æ–π –ø—Ä–æ–º–æ–∫–æ–¥
   ‚Üí –ù–∞–ª–æ–≥–æ–≤–∞—è –Ω–µ –≤–∏–¥–∏—Ç –¥–µ—Ç–∞–ª–∏
```

**–° —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π:**
```
1. –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç–∏–ª 900 –≥—Ä–Ω (invoice —Å–æ–∑–¥–∞–Ω)
2. –í–´ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–≤–∞—Ä
3. –ü—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "ship" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:
   {
     "items": [
       {"name": "–§—É—Ç–±–æ–ª–∫–∞ (M)", "qty": 1, "sum": 100000}, ‚úÖ –î–ï–¢–ê–õ–ò
       {"name": "–ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É SALE10", "qty": 1, "sum": -10000} ‚úÖ
     ],
     "amount": 90000
   }
4. –ù–∞–ª–æ–≥–æ–≤–∞—è –≤–∏–¥–∏—Ç –í–°–ï –¥–µ—Ç–∞–ª–∏ ‚úÖ
```

### –°–ª—É—á–∞–π 2: –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:**
```
1. –ö–ª–∏–µ–Ω—Ç –æ—Ñ–æ—Ä–º–∏–ª –∑–∞–∫–∞–∑ –Ω–∞ 1000 –≥—Ä–Ω —Å prepayment 200 –≥—Ä–Ω
2. –û–ø–ª–∞—Ç–∏–ª 200 –≥—Ä–Ω
3. –í —á–µ–∫–µ Monobank: "–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω" ‚ùå
   ‚Üí –ù–ï–¢ –î–ï–¢–ê–õ–ò: —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∑–∞–∫–∞–∑–∞–Ω–æ
   ‚Üí –ù–ï–¢ –ò–ù–§–û–†–ú–ê–¶–ò–ò: –æ—Å—Ç–∞—Ç–æ–∫ 800 –≥—Ä–Ω
   ‚Üí –ù–∞–ª–æ–≥–æ–≤–∞—è –≤ –∑–∞–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–µ
```

**–° —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π:**
```
1. –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç–∏–ª 200 –≥—Ä–Ω
2. –í–´ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–≤–∞—Ä
3. –§–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç–µ:
   {
     "items": [
       {"name": "–§—É—Ç–±–æ–ª–∫–∞ (M)", "qty": 2, "sum": 100000}, ‚úÖ
       {"name": "–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω. –ó–∞–ª–∏—à–æ–∫ 800 –≥—Ä–Ω –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ", "sum": 0} ‚úÖ
     ],
     "amount": 20000
   }
4. –ù–∞–ª–æ–≥–æ–≤–∞—è –ø–æ–Ω–∏–º–∞–µ—Ç: –æ–ø–ª–∞—á–µ–Ω–æ 200, –æ—Å—Ç–∞—Ç–æ–∫ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ ‚úÖ
```

### –°–ª—É—á–∞–π 3: –û—Ç–º–µ–Ω–∞ —Ç–æ–≤–∞—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:**
```
1. –ö–ª–∏–µ–Ω—Ç –∑–∞–∫–∞–∑–∞–ª 3 —Ç–æ–≤–∞—Ä–∞ –Ω–∞ 1500 –≥—Ä–Ω
2. –û–ø–ª–∞—Ç–∏–ª 1500 –≥—Ä–Ω
3. –í–´ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ 2 —Ç–æ–≤–∞—Ä–∞ (1 –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏)
4. –í —á–µ–∫–µ Monobank: "–û–ø–ª–∞—Ç–∞ 1500 –≥—Ä–Ω" ‚ùå
   ‚Üí –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ 1000 –≥—Ä–Ω
   ‚Üí –ù–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞ 500 –≥—Ä–Ω
   ‚Üí –ù–∞–ª–æ–≥–æ–≤–∞—è –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–∞–≤–¥—ã
```

**–° —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π:**
```
1. –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç–∏–ª 1500 –≥—Ä–Ω
2. –í–´ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ 2 —Ç–æ–≤–∞—Ä–∞
3. –§–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç–µ:
   {
     "items": [
       {"name": "–§—É—Ç–±–æ–ª–∫–∞ 1", "sum": 50000}, ‚úÖ
       {"name": "–§—É—Ç–±–æ–ª–∫–∞ 2", "sum": 50000}, ‚úÖ
       {"name": "–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É 3", "sum": -50000} ‚úÖ
     ],
     "amount": 100000
   }
4. Monobank –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω–µ—Ç 500 –≥—Ä–Ω –Ω–∞ –∫–∞—Ä—Ç—É –∫–ª–∏–µ–Ω—Ç–∞! ‚úÖ
```

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏: –•–æ–ª–¥ vs –ò–º–º–µ–¥–∏–∞—Ç

### –†–µ–∂–∏–º "–•–æ–ª–¥" (Hold)

**–ß—Ç–æ —Ç–∞–∫–æ–µ —Ö–æ–ª–¥:**
```
üí∞ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–µ–Ω–µ–≥ –Ω–∞ –∫–∞—Ä—Ç–µ –ë–ï–ó —Å–ø–∏—Å–∞–Ω–∏—è
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
```
1. API —Å–æ–∑–¥–∞–µ—Ç invoice ‚Üí –°—Ç–∞—Ç—É—Å "hold"
2. üíµ Monobank –ë–õ–û–ö–ò–†–£–ï–¢ –¥–µ–Ω—å–≥–∏ –Ω–∞ –∫–∞—Ä—Ç–µ (–æ–Ω–∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã)
3. üì¶ –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ç–æ–≤–∞—Ä
4. üîí –§–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç–µ ‚Üí Monobank –°–ü–ò–°–´–í–ê–ï–¢ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–µ–Ω—å–≥–∏
5. ‚úÖ –ì–æ—Ç–æ–≤–æ!
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –î–µ–Ω—å–≥–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—É–º–º—É –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç —Ä–∞–∑–Ω–∏—Ü—ã –µ—Å–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –º–µ–Ω—å—à–µ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- –î—Ä–æ–ø—à–∏–ø–∏–Ω–≥
- –ü—Ä–µ–¥–∑–∞–∫–∞–∑—ã
- –ö–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏

### –†–µ–∂–∏–º "–ò–º–º–µ–¥–∏–∞—Ç" (Immediate)

**–ß—Ç–æ —Ç–∞–∫–æ–µ –∏–º–º–µ–¥–∏–∞—Ç:**
```
üí∏ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ —Å –∫–∞—Ä—Ç—ã
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
```
1. API —Å–æ–∑–¥–∞–µ—Ç invoice ‚Üí –°—Ç–∞—Ç—É—Å "success"
2. üí∏ Monobank –°–†–ê–ó–£ –°–ü–ò–°–´–í–ê–ï–¢ –¥–µ–Ω—å–≥–∏
3. üì¶ –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ç–æ–≤–∞—Ä
4. üîí –§–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç–µ ‚Üí Monobank –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
5. ‚úÖ –ì–æ—Ç–æ–≤–æ!
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –î–µ–Ω—å–≥–∏ —Å—Ä–∞–∑—É –Ω–∞ —Å—á–µ—Ç–µ
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–∞–∑—É

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Ä–∞–∑–Ω–∏—Ü—É ‚Äî –Ω—É–∂–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

---

## üìã –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–∞

### –î–æ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–Ω—å–≥–∏ |
|--------|----------|--------|
| `processing` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è | –ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è |
| `success` | –û–ø–ª–∞—á–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é | –°–ø–∏—Å–∞–Ω—ã |
| `hold` | –î–µ–Ω—å–≥–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã | –ó–∞–º–æ—Ä–æ–∂–µ–Ω—ã |
| `failure` | –û—à–∏–±–∫–∞ | –ù–µ —Å–ø–∏—Å–∞–Ω—ã |

### –ü–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ù–ï –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞! –û–Ω–∞ —Ç–æ–ª—å–∫–æ:
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –≤ —á–µ–∫
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–Ω–∏—Ü—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤ –≤–∞—à–µ–º –∫–æ–¥–µ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ invoice (–ø—Ä–∏ –æ–ø–ª–∞—Ç–µ)

**–§–∞–π–ª:** `monobank_create_invoice()` –≤ `monobank.py`

```python
# –°–æ–∑–¥–∞–µ–º Monobank –∏–Ω–≤–æ–π—Å
payload = {
    'amount': int(payment_amount * 100),  # —Å—É–º–º–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö
    'ccy': 980,  # UAH
    'merchantPaymInfo': {
        'reference': order.order_number,
        'destination': payment_description,
        'basketOrder': basket_entries  # ‚Üê –í–û–¢ –ó–î–ï–°–¨ —Ç–æ–≤–∞—Ä—ã
    }
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Monobank —Å–æ–∑–¥–∞–µ—Ç invoice
- –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `invoiceId`

### –®–∞–≥ 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ)

**–§–∞–π–ª:** `admin_order_update()` –≤ `views.py`

```python
# –ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ "ship"
if status == 'ship' and o.payment_provider.startswith('monobank'):
    _monobank_finalize_invoice(o)  # ‚Üê –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–Ø!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
```python
def _monobank_finalize_invoice(order):
    # –§–æ—Ä–º–∏—Ä—É–µ–º –î–ï–¢–ê–õ–¨–ù–´–ô —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
    items = []
    
    # 1. –í—Å–µ —Ç–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–∞–º–∏
    for item in order.items.all():
        items.append({
            'name': item.title,
            'qty': item.qty,
            'sum': int(item.line_total * 100)
        })
    
    # 2. –ü—Ä–æ–º–æ–∫–æ–¥ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if order.promo_code:
        items.append({
            'name': f'–ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É {order.promo_code.code}',
            'sum': -int(order.discount_amount * 100)  # –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞!
        })
    
    # 3. –ò–Ω—Ñ–æ –æ prepayment (–µ—Å–ª–∏ –µ—Å—Ç—å)
    if order.pay_type == 'prepay_200':
        items.append({
            'name': f'–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω. –ó–∞–ª–∏—à–æ–∫ {remaining} –≥—Ä–Ω',
            'sum': 0
        })
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Monobank
    payload = {
        'invoiceId': order.payment_invoice_id,
        'amount': int(final_amount * 100),
        'items': items  # ‚Üê –î–ï–¢–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï!
    }
    
    result = _monobank_api_request('POST', '/api/merchant/invoice/finalize', payload)
```

---

## üí° –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –ë–ï–ó –ø—Ä–æ–º–æ–∫–æ–¥–∞

**–ó–∞–∫–∞–∑:** –§—É—Ç–±–æ–ª–∫–∞ 1000 –≥—Ä–Ω

**–ò–Ω–≤–æ–π—Å –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ:**
```json
{
  "amount": 100000,
  "basketOrder": [
    {"name": "–û–ø–ª–∞—Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è TWC01012025N01", "sum": 100000}
  ]
}
```

**–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:**
```json
{
  "invoiceId": "abc123...",
  "amount": 100000,
  "items": [
    {"name": "–§—É—Ç–±–æ–ª–∫–∞ (M)", "qty": 1, "sum": 100000}  ‚úÖ –î–ï–¢–ê–õ–¨
  ]
}
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –° –ø—Ä–æ–º–æ–∫–æ–¥–æ–º

**–ó–∞–∫–∞–∑:** –§—É—Ç–±–æ–ª–∫–∞ 1000 –≥—Ä–Ω, –ø—Ä–æ–º–æ–∫–æ–¥ -10%

**–ò–Ω–≤–æ–π—Å –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ:**
```json
{
  "amount": 90000,
  "basketOrder": [
    {"name": "–§—É—Ç–±–æ–ª–∫–∞ (M) [–∑ –ø—Ä–æ–º–æ–∫–æ–¥–æ–º SALE10]", "sum": 100000},
    {"name": "–ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É SALE10", "sum": -10000}
  ]
}
```

**–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:**
```json
{
  "invoiceId": "abc123...",
  "amount": 90000,
  "items": [
    {"name": "–§—É—Ç–±–æ–ª–∫–∞ (M)", "qty": 1, "sum": 100000},  ‚úÖ
    {"name": "–ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É SALE10", "qty": 1, "sum": -10000}  ‚úÖ
  ]
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω

**–ó–∞–∫–∞–∑:** –ó–∞–∫–∞–∑ –Ω–∞ 1000 –≥—Ä–Ω, prepayment

**–ò–Ω–≤–æ–π—Å –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ:**
```json
{
  "amount": 20000,
  "basketOrder": [
    {"name": "–§—É—Ç–±–æ–ª–∫–∞ (M)", "sum": 100000},
    {"name": "–ß–∞—Å—Ç–∫–æ–≤–∞ –æ–ø–ª–∞—Ç–∞. –ó–∞–ª–∏—à–æ–∫ 800 –≥—Ä–Ω –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ", "sum": -80000}
  ]
}
```

**–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:**
```json
{
  "invoiceId": "abc123...",
  "amount": 20000,
  "items": [
    {"name": "–§—É—Ç–±–æ–ª–∫–∞ (M)", "qty": 1, "sum": 100000},  ‚úÖ
    {"name": "–ü–µ—Ä–µ–¥–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω. –ó–∞–ª–∏—à–æ–∫ 800.00 –≥—Ä–Ω –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —á–µ—Ä–µ–∑ –ù–æ–≤—É –ü–æ—à—Ç—É", "sum": 0}  ‚úÖ
  ]
}
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ù–ï —Å–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏

‚úÖ –î–µ–Ω—å–≥–∏ –£–ñ–ï —Å–ø–∏—Å–∞–Ω—ã –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ  
‚úÖ –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∏—Å–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 2. –ú–æ–∂–Ω–æ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—å—à–µ —Å—É–º–º—ã

–ï—Å–ª–∏ —Ö–æ–ª–¥ –±—ã–ª –Ω–∞ 1000 –≥—Ä–Ω, –∞ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ 800 –≥—Ä–Ω:
```
üí∞ Monobank –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω–µ—Ç 200 –≥—Ä–Ω –Ω–∞ –∫–∞—Ä—Ç—É –∫–ª–∏–µ–Ω—Ç–∞!
```

### 3. –ù–ï–ª—å–∑—è —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ —Å—É–º–º—ã

–ï—Å–ª–∏ —Ö–æ–ª–¥ –±—ã–ª –Ω–∞ 1000 –≥—Ä–Ω, –∞ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å 1500 –≥—Ä–Ω:
```
‚ùå –û—à–∏–±–∫–∞ 400: Amount exceeds hold
```

### 4. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞

‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏  
‚úÖ –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —É–ª—É—á—à–∞–µ—Ç –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

---

## üéØ –ò—Ç–æ–≥–æ: –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

### –ë–µ–∑ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:

```
üìä –ù–∞–ª–æ–≥–æ–≤–∞—è –≤–∏–¥–∏—Ç:
   - –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #123: 900 –≥—Ä–Ω
   - ‚ùì –ß—Ç–æ –∑–∞–∫–∞–∑–∞–Ω–æ? –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
   - ‚ùì –ö–∞–∫–∞—è —Å–∫–∏–¥–∫–∞? –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
   - ‚ùì –ö–∞–∫–æ–π —Ç–æ–≤–∞—Ä? –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
```

### –° —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π:

```
üìä –ù–∞–ª–æ–≥–æ–≤–∞—è –≤–∏–¥–∏—Ç:
   - –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #123: 900 –≥—Ä–Ω
   - ‚úÖ –§—É—Ç–±–æ–ª–∫–∞ (M) √ó 1: 1000 –≥—Ä–Ω
   - ‚úÖ –ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É SALE10: -100 –≥—Ä–Ω
   - ‚úÖ –í–°–ï –î–ï–¢–ê–õ–ò –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏!
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**Monobank API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è: https://monobank.ua/api-docs/acquiring/methods/ia/post--api--merchant--invoice--finalize
- Invoice API: https://api.monobank.ua/docs/

**–í –≤–∞—à–µ–º –∫–æ–¥–µ:**
- –°–æ–∑–¥–∞–Ω–∏–µ: `monobank_create_invoice()` –≤ `views/monobank.py`
- –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è: `_monobank_finalize_invoice()` –≤ `views/monobank.py`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤: –≤ `admin_order_update()` –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ `ship`

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-01-27


# üîç –û–¢–ß–ï–¢-–ê–£–î–ò–¢: Meta/TikTok Tracking w/ CAPI, Deduplication, Deposits vs Full Payments

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-01-30  
**–ê—É–¥–∏—Ç–æ—Ä:** Principal Tracking Auditor & Prompt Writer  
**–ü—Ä–æ–µ–∫—Ç:** TwoComms E-commerce Tracking System

---

## üìã EXECUTIVE SUMMARY

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

1. **Event ID —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ `order.get_facebook_event_id()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ event_id –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
2. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ user_data:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
3. **–°–µ—Ä–≤–µ—Ä–Ω—ã–µ API:** Facebook Conversions API –∏ TikTok Events API –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
4. **–ö–∞—Ç–∞–ª–æ–≥–∏:** Google Merchant Feed v3 —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã:** –í `order_success.html` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Lead –¥–ª—è prepaid –ò paid - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è prepaid
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —è–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ fbp/fbc/ttclid:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —ç—Ç–∏ cookies –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥—É–±–ª–∏:** GTM –º–æ–∂–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–µ–≥–∏ –¥–ª—è Meta/TikTok
4. **Meta Catalog API:** –ù–µ –Ω–∞–π–¥–µ–Ω–∞ —è–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ñ–∏–¥

---

## üìä –ò–ù–í–ï–ù–¢–ê–†–ò–ó–ê–¶–ò–Ø –§–ê–ô–õ–û–í

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (Browser Events)

| –§–∞–π–ª | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°–æ–±—ã—Ç–∏—è | –°—Ç–∞—Ç—É—Å |
|------|-----------|---------|--------|
| `twocomms/twocomms_django_theme/static/js/analytics-loader.js` | Meta Pixel, TikTok Pixel, GTM | –í—Å–µ —á–µ—Ä–µ–∑ `trackEvent()` | ‚úÖ |
| `twocomms/twocomms_django_theme/templates/pages/order_success.html` | Purchase/Lead –æ—Ç–ø—Ä–∞–≤–∫–∞ | Purchase, Lead | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –ª–æ–≥–∏–∫–æ–π |
| `twocomms/twocomms_django_theme/templates/base.html` | GTM –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | PageView | ‚úÖ |

### –ë—ç–∫–µ–Ω–¥ (Server Events)

| –§–∞–π–ª | API | –°–æ–±—ã—Ç–∏—è | –°—Ç–∞—Ç—É—Å |
|------|-----|---------|--------|
| `twocomms/orders/facebook_conversions_service.py` | Meta Conversions API | Purchase, Lead | ‚úÖ |
| `twocomms/orders/tiktok_events_service.py` | TikTok Events API | Purchase, Lead | ‚úÖ |
| `twocomms/storefront/views/utils.py` | Monobank callback | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ | ‚úÖ |

### –ú–æ–¥–µ–ª–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã

| –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|------|---------|--------|
| `twocomms/orders/models.py` | `get_facebook_event_id()`, —Å—Ç–∞—Ç—É—Å—ã –æ–ø–ª–∞—Ç—ã | ‚úÖ |
| `twocomms/storefront/utils/analytics_helpers.py` | `get_offer_id()` –¥–ª—è content_ids | ‚úÖ |

---

## üî¥ –ö–ê–†–¢–ê –î–£–ë–õ–ï–ô –ò –ö–û–ù–§–õ–ò–ö–¢–û–í

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π (Browser ‚Üî Server)

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚úÖ Event ID —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `order.get_facebook_event_id()`
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Meta/TikTok
- ‚ö†Ô∏è –ù–û: –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ event_id –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–†–∏—Å–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
- **–ù–∏–∑–∫–∏–π** –¥–ª—è Meta (–µ—Å—Ç—å event_id —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- **–ù–∏–∑–∫–∏–π** –¥–ª—è TikTok (–µ—Å—Ç—å event_id —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- **–°—Ä–µ–¥–Ω–∏–π** –¥–ª—è GTM (–º–æ–∂–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–µ–≥–∏ Meta/TikTok)

### 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ GTM

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –≤ GTM –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–µ–≥–∏ –¥–ª—è Meta Pixel –∏ TikTok Pixel, –æ–Ω–∏ –º–æ–≥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —á–µ—Ä–µ–∑ `trackEvent()`.

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫–ª—é—á–∏—Ç—å —Ç–µ–≥–∏ Meta/TikTok –≤ GTM, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `trackEvent()`.

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ order_success.html

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –¥–≤–∞–∂–¥—ã:
1. –ß–µ—Ä–µ–∑ `trackEvent()` ‚Üí Meta Pixel + TikTok Pixel
2. –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `fbq()`/`ttq()` (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `trackEvent()`, —É–¥–∞–ª–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã.

---

## üìà –°–•–ï–ú–ê –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†–û–í

### Event ID Generation

```
Order.created ‚Üí order.get_facebook_event_id()
Format: {order_number}_{timestamp}
Example: TWC30102025N01_1730304000

Browser: eventId = '{{ order.get_facebook_event_id }}'
Server: event_id = order.get_facebook_event_id()
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

### Content IDs (Product IDs)

```
Product ‚Üí get_offer_id(color_variant_id, size)
Format: TC-{product_id}-{color_variant_id}-{SIZE}
Example: TC-123-456-XL

Google Merchant Feed: <g:id>TC-123-456-XL</g:id>
Meta Pixel: content_ids: ['TC-123-456-XL']
TikTok Pixel: content_id: 'TC-123-456-XL'
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### User Data Identifiers

**–ö–ª–∏–µ–Ω—Ç (Browser):**
- Email: `hashSHA256(email.toLowerCase().trim())`
- Phone: `hashSHA256(phone.replace(/\D/g, ''))`
- External ID: `hashSHA256('user:' + userId)`

**–°–µ—Ä–≤–µ—Ä:**
- Email: `hashlib.sha256(email.lower().strip().encode()).hexdigest()`
- Phone: `hashlib.sha256(phone_digits.encode()).hexdigest()`
- External ID: `hashlib.sha256(external_source.encode()).hexdigest()`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è

---

## üîÑ USER DATA PIPELINE

### –ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–¥–∞—á–∞

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
1. –ö–ª–∏–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç cookies: `_fbp`, `_fbc`, `ttclid`
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `payment_payload.tracking` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
3. –°–µ—Ä–≤–µ—Ä —á–∏—Ç–∞–µ—Ç –∏–∑ `payment_payload.tracking` –¥–ª—è CAPI/Events API

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ cookies –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ cookies –≤ `order_success.html` –∏ `create_order()`.

---

## üìã –°–û–ë–´–¢–ò–ô–ù–´–ô –ö–û–ù–¢–†–ê–ö–¢

### Meta (Pixel + CAPI)

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ —Å—Ç—Ä–µ–ª—è—Ç—å | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –ò—Å—Ç–æ—á–Ω–∏–∫ | event_id | –ü—Ä–æ–≤–µ—Ä–∫–∞ |
|---------|----------------|-----------|----------|----------|----------|
| PageView | –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã | - | Browser | ‚ùå | ‚úÖ |
| ViewContent | –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞ | content_ids, value, currency | Browser | ‚úÖ | ‚úÖ |
| AddToCart | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É | content_ids, value, currency | Browser | ‚úÖ | ‚úÖ |
| InitiateCheckout | –ù–∞—á–∞–ª–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è | content_ids, value, currency | Browser | ‚úÖ | ‚úÖ |
| **Purchase** | **payment_status='paid'** | **content_ids, value, currency, event_id** | **Browser + Server** | **‚úÖ** | **‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞** |
| **Lead** | **payment_status='prepaid'** | **value, currency, event_id** | **Browser + Server** | **‚úÖ** | **‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞** |

### TikTok (Pixel + Events API)

| –°–æ–±—ã—Ç–∏–µ | –ö–æ–≥–¥–∞ —Å—Ç—Ä–µ–ª—è—Ç—å | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –ò—Å—Ç–æ—á–Ω–∏–∫ | event_id | –ü—Ä–æ–≤–µ—Ä–∫–∞ |
|---------|----------------|-----------|----------|----------|----------|
| PageView | –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã | - | Browser | ‚ùå | ‚úÖ |
| ViewContent | –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞ | content_id, value, currency | Browser | ‚úÖ | ‚úÖ |
| AddToCart | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É | content_id, value, currency | Browser | ‚úÖ | ‚úÖ |
| InitiateCheckout | –ù–∞—á–∞–ª–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è | content_id, value, currency | Browser | ‚úÖ | ‚úÖ |
| **Purchase** | **payment_status='paid'** | **content_id, value, currency, event_id** | **Browser + Server** | **‚úÖ** | **‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞** |
| **Lead** | **payment_status='prepaid'** | **value, currency, event_id** | **Browser + Server** | **‚úÖ** | **‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞** |

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

–í `order_success.html` (—Å—Ç—Ä–æ–∫–∏ 1807-1814):

```javascript
var shouldSendLead = paymentStatus === 'prepaid' || paymentStatus === 'paid';  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
var shouldSendPurchase = paymentStatus === 'paid';  // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```javascript
var shouldSendLead = paymentStatus === 'prepaid';  // ‚úÖ –¢–û–õ–¨–ö–û –¥–ª—è prepaid
var shouldSendPurchase = paymentStatus === 'paid';  // ‚úÖ –¢–û–õ–¨–ö–û –¥–ª—è paid
```

---

## üóÇÔ∏è –ö–ê–¢–ê–õ–û–ì–ò/–§–ò–î–´

### Google Merchant Center

**–§–æ—Ä–º–∞—Ç:** XML v3  
**URL:** `https://twocomms.shop/media/google-merchant-v3.xml`  
**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤  
**ID —Ñ–æ—Ä–º–∞—Ç:** `TC-{product_id}-{color_variant_id}-{SIZE}`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

### Meta Catalog

**–§–æ—Ä–º–∞—Ç:** –ù–µ –Ω–∞–π–¥–µ–Ω–∞ —è–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ Meta Business Manager

### Content IDs —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- ‚úÖ `get_offer_id()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
- ‚úÖ –§–æ—Ä–º–∞—Ç: `TC-{id}-{variant}-{SIZE}`
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ content_ids –≤ —Å–æ–±—ã—Ç–∏—è—Ö —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å g:id –≤ —Ñ–∏–¥–µ

---

## üîí –ü–†–ò–í–ê–¢–ù–û–°–¢–¨/–•–ï–®–ò–†–û–í–ê–ù–ò–ï

### SHA-256 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–ª–∏–µ–Ω—Ç:**
```javascript
function hashSHA256(str) {
  var cleaned = str.trim().toLowerCase();
  return sha256(cleaned);
}
```

**–°–µ—Ä–≤–µ—Ä:**
```python
def _hash_data(value):
  cleaned = str(value).strip().lower()
  return hashlib.sha256(cleaned.encode('utf-8')).hexdigest()
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞

**–ö–ª–∏–µ–Ω—Ç:**
```javascript
var phoneDigits = phoneRaw.replace(/\D/g, '');
```

**–°–µ—Ä–≤–µ—Ä:**
```python
phone_digits = ''.join(filter(str.isdigit, order.phone))
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è

---

## üìä GTM –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –¢–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** `GTM-PRLLBF9H`  
**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –í `base.html`  
**–°–æ–±—ã—Ç–∏—è:** –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `dataLayer.push()`

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Meta/TikTok —Ç–µ–≥–æ–≤:** –ï—Å–ª–∏ –≤ GTM –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ç–µ–≥–∏ –¥–ª—è Meta Pixel –∏ TikTok Pixel, –æ–Ω–∏ –±—É–¥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ sGTM:** –ù–µ—Ç server-side GTM –¥–ª—è CAPI

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Ç–∫–ª—é—á–∏—Ç—å —Ç–µ–≥–∏ Meta/TikTok –≤ GTM, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `trackEvent()`.

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–†–û–ë–õ–ï–ú

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

- [ ] **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ–±—ã—Ç–∏–π –≤ order_success.html:** Lead —Ç–æ–ª—å–∫–æ –¥–ª—è prepaid, Purchase —Ç–æ–ª—å–∫–æ –¥–ª—è paid
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É fbp/fbc/ttclid:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ cookies –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å GTM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:** –û—Ç–∫–ª—é—á–∏—Ç—å —Ç–µ–≥–∏ Meta/TikTok, –µ—Å–ª–∏ –æ–Ω–∏ –¥—É–±–ª–∏—Ä—É—é—Ç —Å–æ–±—ã—Ç–∏—è

### –°—Ä–µ–¥–Ω–∏–µ

- [ ] **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–µ—Ç—Ä–∞–µ–≤:** –î–ª—è CAPI/Events API –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Meta Catalog:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Meta Business Manager
- [ ] **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á–∏ cookies –∏ event_id

### –ù–∏–∑–∫–∏–µ

- [ ] **–î–æ–±–∞–≤–∏—Ç—å sGTM:** –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- [ ] **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

---

## üìù –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ–±—ã—Ç–∏–π** –≤ `order_success.html`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É cookies** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å GTM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** –∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ç–µ–≥–∏
4. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
5. **–°–æ–∑–¥–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–±—ã—Ç–∏–π

---

## üìö –ò–°–¢–û–ß–ù–ò–ö–ò

- Meta Conversions API: https://developers.facebook.com/docs/marketing-api/conversions-api
- TikTok Events API: https://ads.tiktok.com/help/article?aid=10002887
- Google Merchant Center: https://support.google.com/merchants/answer/7052112
- GTM Server-Side: https://tagmanager.google.com/

















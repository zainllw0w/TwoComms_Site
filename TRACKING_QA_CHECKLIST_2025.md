# ‚úÖ QA –ß–µ–∫–ª–∏—Å—Ç: Meta/TikTok Tracking Fix

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-30  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò

### 1. –õ–æ–≥–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã

- [ ] **–¢–µ—Å—Ç:** –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å `pay_type='prepay_200'`
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–∂–¥–∞—Ç—å—Å—è `payment_status='prepaid'`
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **Lead** —Å–æ–±—ã—Ç–∏–µ (Meta + TikTok)
  - [ ] **–ù–ï** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Purchase —Å–æ–±—ã—Ç–∏–µ
  - [ ] value = 200 –≥—Ä–Ω (—Å—É–º–º–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã)
  - [ ] value –ù–ï —Ä–∞–≤–Ω–∞ –ø–æ–ª–Ω–æ–π —Å—É–º–º–µ –∑–∞–∫–∞–∑–∞

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Meta Events Manager ‚Üí Test Events
- TikTok Events Manager ‚Üí Test Events
- –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–ª–æ–≥–∏)

---

### 2. –õ–æ–≥–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç—ã

- [ ] **–¢–µ—Å—Ç:** –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å `pay_type='online_full'`
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–∂–¥–∞—Ç—å—Å—è `payment_status='paid'`
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **Purchase** —Å–æ–±—ã—Ç–∏–µ (Meta + TikTok)
  - [ ] **–ù–ï** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Lead —Å–æ–±—ã—Ç–∏–µ
  - [ ] value = –ø–æ–ª–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
  - [ ] content_ids —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Meta Events Manager ‚Üí Test Events
- TikTok Events Manager ‚Üí Test Events
- –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–ª–æ–≥–∏)

---

### 3. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π

- [ ] **–¢–µ—Å—Ç:** –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤ Meta –∏ TikTok
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] **Meta:** 1 —Å–æ–±—ã—Ç–∏–µ Purchase (–Ω–µ 2)
  - [ ] **TikTok:** 1 —Å–æ–±—ã—Ç–∏–µ Purchase (–Ω–µ 2)
  - [ ] event_id –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Meta Events Manager ‚Üí Deduplication
- TikTok Events Manager ‚Üí Deduplication
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (event_id)

---

### 4. –ü–µ—Ä–µ–¥–∞—á–∞ cookies (fbp/fbc/ttclid)

- [ ] **–¢–µ—Å—Ç:** –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∫–∞–∫ –≥–æ—Å—Ç—å
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ cookies –ø–µ—Ä–µ–¥–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] `payment_payload.tracking.fbp` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å cookie)
  - [ ] `payment_payload.tracking.fbc` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å cookie)
  - [ ] `payment_payload.tracking.ttclid` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å cookie)

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (payment_payload)
- Django admin (order.payment_payload)

---

## üü° –°–†–ï–î–ù–ò–ï –ü–†–û–í–ï–†–ö–ò

### 5. Content IDs —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

- [ ] **–¢–µ—Å—Ç:** –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å —Ç–æ–≤–∞—Ä–∞–º–∏
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å content_ids –≤ —Å–æ–±—ã—Ç–∏—è—Ö
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] content_ids —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å g:id –≤ Google Merchant feed
  - [ ] –§–æ—Ä–º–∞—Ç: `TC-{product_id}-{color_variant_id}-{SIZE}`
  - [ ] –í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Google Merchant Feed: `https://twocomms.shop/media/google-merchant-v3.xml`
- Meta Events Manager ‚Üí Test Events ‚Üí content_ids
- TikTok Events Manager ‚Üí Test Events ‚Üí content_id

---

### 6. User Data –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

- [ ] **–¢–µ—Å—Ç:** –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∫–∞–∫ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ user_data
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] Email —Ö–µ—à–∏—Ä–æ–≤–∞–Ω SHA-256 (lowercase, trimmed)
  - [ ] Phone —Ö–µ—à–∏—Ä–æ–≤–∞–Ω SHA-256 (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
  - [ ] –•–µ—à–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (–ª–æ–≥–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è)
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

---

### 7. GTM —Å–æ–±—ã—Ç–∏—è

- [ ] **–¢–µ—Å—Ç:** –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ GTM
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] –°–æ–±—ã—Ç–∏–µ `purchase` –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ dataLayer
  - [ ] –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (transaction_id, value, currency)
  - [ ] user_data –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- GTM Preview Mode
- –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (dataLayer)

---

## üü¢ –ù–ò–ó–ö–ò–ï –ü–†–û–í–ï–†–ö–ò

### 8. Retry –ª–æ–≥–∏–∫–∞

- [ ] **–¢–µ—Å—Ç:** –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏—è
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å retry –ª–æ–≥–∏–∫—É
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] –°–æ–±—ã—Ç–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
  - [ ] Exponential backoff —Ä–∞–±–æ—Ç–∞–µ—Ç
  - [ ] –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (retry —Å–æ–æ–±—â–µ–Ω–∏—è)

---

### 9. Meta Catalog

- [ ] **–¢–µ—Å—Ç:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ Meta
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ID
- [ ] **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
  - [ ] –ö–∞—Ç–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Meta Business Manager
  - [ ] ID —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å content_ids –≤ —Å–æ–±—ã—Ç–∏—è—Ö

**–ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Meta Business Manager ‚Üí –ö–∞—Ç–∞–ª–æ–≥–∏

---

## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê (–ü–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è)

### Meta

- [ ] **Event Match Quality (EMQ):** > 70%
- [ ] **Deduplication Rate:** 100% (1 —Å–æ–±—ã—Ç–∏–µ, –Ω–µ 2)
- [ ] **Purchase —Å–æ–±—ã—Ç–∏—è:** 0 –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã
- [ ] **Lead —Å–æ–±—ã—Ç–∏—è:** 0 –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç—ã

### TikTok

- [ ] **Match Keys:** > 60%
- [ ] **Deduplication Rate:** 100% (1 —Å–æ–±—ã—Ç–∏–µ, –Ω–µ 2)
- [ ] **Purchase —Å–æ–±—ã—Ç–∏—è:** 0 –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã
- [ ] **Lead —Å–æ–±—ã—Ç–∏—è:** 0 –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç—ã

### –û–±—â–∏–µ

- [ ] **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–µ–π:** 0 –¥—É–±–ª–µ–π –≤ –æ—Ç—á–µ—Ç–∞—Ö
- [ ] **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:** 100% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## üêõ –û–¢–õ–ê–î–ö–ê

### –ï—Å–ª–∏ Purchase –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `order_success.html` (—Å—Ç—Ä–æ–∫–∏ 1807-1814)
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `shouldSendPurchase = paymentStatus === 'paid'`
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `shouldSendLead = paymentStatus === 'prepaid'`

### –ï—Å–ª–∏ Lead –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥–ª—è –ø–æ–ª–Ω–æ–π –æ–ø–ª–∞—Ç—ã

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `order_success.html` (—Å—Ç—Ä–æ–∫–∏ 1807-1814)
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `shouldSendLead = paymentStatus === 'prepaid'` (–ù–ï `'paid'`)

### –ï—Å–ª–∏ –µ—Å—Ç—å –¥—É–±–ª–∏

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å event_id –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ event_id –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GTM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–æ—Ç–∫–ª—é—á–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ç–µ–≥–∏)

### –ï—Å–ª–∏ cookies –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–ø–µ—Ä–µ–¥–∞—á–∞ cookies)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `payment_payload.tracking` –≤ Django admin
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò

- [ ] –ù–µ—Ç –¥—É–±–ª–µ–π –≤ –æ—Ç—á—ë—Ç–∞—Ö Meta/TikTok
- [ ] –ü—Ä–µ–¥–æ–ø–ª–∞—Ç—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Purchase/CompletePayment
- [ ] –ü–æ–ª–Ω—ã–µ –æ–ø–ª–∞—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ 100% –∫–æ–Ω–≤–µ—Ä—Å–∏—é
- [ ] –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è content_ids –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- [ ] Match Quality/EMQ –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ
- [ ] GTM –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–µ–π

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üöÄ

















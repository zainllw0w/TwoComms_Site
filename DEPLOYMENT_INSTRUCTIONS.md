# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∞—É–¥–∏—Ç–∞

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### üéØ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω `product_detail` view —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `select_related` –∏ `prefetch_related`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ `get_detailed_color_variants`
- ‚úÖ –û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ: TTFB —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ —Å 4.2s –¥–æ <500ms

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ `SECRET_KEY` —Ç–µ–ø–µ—Ä—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ production (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–µ–∑ –Ω–µ–≥–æ)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Redis —Å –ø–∞—Ä–æ–ª–µ–º
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω middleware –¥–ª—è rate limiting (100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É –Ω–∞ IP)
- ‚úÖ –£–¥–∞–ª–µ–Ω `@csrf_exempt` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö endpoints (`add_to_cart`, `cart_remove`)

### üßπ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ `console.log` –∏ `console.error` –∏–∑ JS —Ñ–∞–π–ª–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `django-ratelimit==5.0.0`

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **sshpass** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
   ```bash
   # macOS
   brew install hudochenkov/sshpass/sshpass
   
   # Linux
   sudo apt-get install sshpass
   ```

2. **Git** –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é

3. **SSH** –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ —Å–∫—Ä–∏–ø—Ç–µ)

## üöÄ –î–µ–ø–ª–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
./deploy_fixes.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
2. –°–∫–∞—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–¥ –∏–∑ –≤–µ—Ç–∫–∏ `fix-audit-errors-f88J2`
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. –ó–∞–ø—É—Å—Ç–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
5. –°–æ–±–µ—Ä–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
7. –û—á–∏—Å—Ç–∏—Ç –∫—ç—à

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh qlknpodo@195.191.24.169

# 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /home/qlknpodo/TWC/TwoComms_Site/twocomms

# 3. –°–∫–∞—á–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–¥
git fetch origin
git checkout fix-audit-errors-f88J2
git pull origin fix-audit-errors-f88J2

# 4. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source /home/qlknpodo/virtualenv/TWC/TwoComms_Site/twocomms/3.13/bin/activate

# 5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage.py migrate --noinput

# 7. –°–æ–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏–∫—É
python manage.py collectstatic --noinput

# 8. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
touch passenger_wsgi.py

# 9. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
python manage.py shell
>>> from django.core.cache import cache
>>> cache.clear()
>>> exit()
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: SECRET_KEY

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `SECRET_KEY`:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh qlknpodo@195.191.24.169

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ SECRET_KEY –≤ .env —Ñ–∞–π–ª–µ
cd /home/qlknpodo/TWC/TwoComms_Site/twocomms
cat .env | grep SECRET_KEY

# –ï—Å–ª–∏ –Ω–µ—Ç, —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á
python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'

# –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ .env —Ñ–∞–π–ª
echo "SECRET_KEY=<–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_–∫–ª—é—á>" >> .env
```

### –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û: Redis Password

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞—â–∏—Ç–∏—Ç—å Redis –ø–∞—Ä–æ–ª–µ–º:

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Redis —Å –ø–∞—Ä–æ–ª–µ–º
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ /etc/redis/redis.conf –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
# –î–æ–±–∞–≤—å—Ç–µ: requirepass your_secure_password

# 2. –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ .env
echo "REDIS_PASSWORD=your_secure_password" >> .env

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Redis
sudo systemctl restart redis
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
ssh qlknpodo@195.191.24.169
tail -f /home/qlknpodo/TWC/TwoComms_Site/twocomms/django.log
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: https://twocomms.shop

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <1s –≤–º–µ—Å—Ç–æ 4.2s)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
curl -w "@curl-format.txt" -o /dev/null -s "https://twocomms.shop/product/some-product-slug/"

# –ì–¥–µ curl-format.txt —Å–æ–¥–µ—Ä–∂–∏—Ç:
# time_namelookup:  %{time_namelookup}\n
# time_connect:  %{time_connect}\n
# time_starttransfer:  %{time_starttransfer}\n
# time_total:  %{time_total}\n
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ rate limiting

```bash
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–æ
for i in {1..110}; do curl -s -o /dev/null -w "%{http_code}\n" https://twocomms.shop/; done

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å 429 (Too Many Requests) –ø–æ—Å–ª–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `SECRET_KEY`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
ssh qlknpodo@195.191.24.169
cd /home/qlknpodo/TWC/TwoComms_Site/twocomms
python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
# –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–ª—é—á –≤ .env —Ñ–∞–π–ª
echo "SECRET_KEY=<–∫–ª—é—á>" >> .env
touch passenger_wsgi.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: Redis –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** Redis –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Redis
sudo systemctl status redis

# –ï—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å—Ç–∏—Ç–µ
sudo systemctl start redis

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
redis-cli ping
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: PONG
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
ssh qlknpodo@195.191.24.169
cd /home/qlknpodo/TWC/TwoComms_Site/twocomms
source /home/qlknpodo/virtualenv/TWC/TwoComms_Site/twocomms/3.13/bin/activate
python manage.py collectstatic --noinput --clear
touch passenger_wsgi.py
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```bash
# Django –ª–æ–≥–∏
tail -f /home/qlknpodo/TWC/TwoComms_Site/twocomms/django.log

# –û—à–∏–±–∫–∏
tail -f /home/qlknpodo/TWC/TwoComms_Site/twocomms/stderr.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø)
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/access.log
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

- **TTFB —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å <500ms (–±—ã–ª–æ 4.2s)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL –∑–∞–ø—Ä–æ—Å–æ–≤:** –¥–æ–ª–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å—Å—è –Ω–∞ 30-50%
- **–û—à–∏–±–∫–∏ 429:** –ø–æ—è–≤—è—Ç—Å—è –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- **–û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:** –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (—Å–º. –≤—ã—à–µ)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `touch passenger_wsgi.py`

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –≤–∞—à —Å–∞–π—Ç –±—É–¥–µ—Ç:
- ‚ö° –ë—ã—Å—Ç—Ä–µ–µ (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ 8 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ)
- üîí –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π SECRET_KEY, rate limiting, CSRF –∑–∞—â–∏—Ç–∞)
- üßπ –ß–∏—â–µ (–Ω–µ—Ç console.log –≤ production)
- üí™ –ù–∞–¥–µ–∂–Ω–µ–µ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î)


# üöÄ –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ú–ò–ì–†–ê–¶–ò–ò –ù–ê SERVER-SIDE GTM (Stape)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-31  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã](#–æ—Ç–≤–µ—Ç—ã-–Ω–∞-–≤–∞—à–∏-–≤–æ–ø—Ä–æ—Å—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Server-Side GTM](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-server-side-gtm)
3. [–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Server-Side GTM](#–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞-server-side-gtm)
4. [–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–∞–Ω–∞–ª–∏–∑-—Ç–µ–∫—É—â–µ–π-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
5. [–ò–¥–µ–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞](#–∏–¥–µ–∞–ª—å–Ω–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–¥–ª—è-–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ-–∫–∞—á–µ—Å—Ç–≤–∞)
6. [–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏](#–ø–ª–∞–Ω-–º–∏–≥—Ä–∞—Ü–∏–∏)
7. [–î–µ—Ç–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Stape](#–¥–µ—Ç–∞–ª—å–Ω–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-stape)
8. [–ù—é–∞–Ω—Å—ã –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã](#–Ω—é–∞–Ω—Å—ã-–∏-–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
9. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è](#–ø—Ä–æ–≤–µ—Ä–∫–∞-–∏-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
10. [–ß–µ–∫-–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏](#—á–µ–∫-–ª–∏—Å—Ç-–º–∏–≥—Ä–∞—Ü–∏–∏)

---

## ‚ùì –û–¢–í–ï–¢–´ –ù–ê –í–ê–®–ò –í–û–ü–†–û–°–´

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ñ–∏–¥–∞ –¥–ª—è Meta Catalog –∏ Google Merchant Center

**–í–æ–ø—Ä–æ—Å:** –Ø –∏—Å–ø–æ–ª—å–∑—É—é —Ç—É –∂–µ —Å—Å—ã–ª–∫—É –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Meta –∫–∞—Ç–∞–ª–æ–≥–∞ —á—Ç–æ –∏ –≤ Google, —á–µ—Ä–µ–∑ `https://twocomms.shop/media/google-merchant-v3.xml`

**–û—Ç–≤–µ—Ç:** ‚úÖ **–î–ê, —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

**–ê–Ω–∞–ª–∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∏–¥–∞:**
- –§–æ—Ä–º–∞—Ç: RSS 2.0 —Å `xmlns:g="http://base.google.com/ns/1.0"`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –æ–±–æ–∏–º–∏ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏
- ID —Ç–æ–≤–∞—Ä–æ–≤: `TC-0001-–ß–ï–†–ù–´–ô-S` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É –≤ —Ü–≤–µ—Ç–µ)

**–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- Google Merchant Center –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç
- Meta Commerce Manager –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ RSS —Ñ–æ—Ä–º–∞—Ç
- –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç (id, title, description, link, image_link, price, availability)

‚ö†Ô∏è **–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Meta –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É –≤ `g:id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TC-0001-–ß–ï–†–ù–´–ô-S`)
- –ï—Å–ª–∏ Meta –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—é –∏–ª–∏ –ª–∞—Ç–∏–Ω–∏—Ü—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Meta Commerce Manager, —á—Ç–æ —Ç–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `g:id` –≤ —Ñ–∏–¥–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `content_ids` –≤ —Å–æ–±—ã—Ç–∏—è—Ö Meta Pixel
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∞—Ç–∏–Ω–∏—Ü—É –≤ —Ü–≤–µ—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `CHERNYJ` –≤–º–µ—Å—Ç–æ `–ß–ï–†–ù–´–ô`)

**–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:**
- [Google Merchant Feed Specification](https://support.google.com/merchants/answer/7052112)
- [Meta Catalog Feed Requirements](https://www.facebook.com/business/help/120325381656392)

---

### 2. Server-Side GTM —á–µ—Ä–µ–∑ Stape –∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ Meta Pixel

**–í–æ–ø—Ä–æ—Å:** –ú–Ω–µ –≥–æ–≤–æ—Ä—è—Ç —á—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–¥–∏–Ω Google Tag Manager –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –ø–æ—Ç–æ–º –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Meta Pixel —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –æ—Ç Stape. –¢–æ –µ—Å—Ç—å –º–Ω–µ –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —Ç–æ—Ç Meta Pixel —á—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏? –ò –µ—Å–ª–∏ —É –º–µ–Ω—è –µ—â–µ —Å–¥–µ–ª–∞–Ω Conversions API —á—Ç–æ –±–æ–ª–µ–µ –ª—É—á—à–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–æ —ç—Ç–æ –≤—Å–µ —Ä–æ–≤–Ω–æ –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ Google —Å–µ—Ä–≤–∏—Å?

**–û—Ç–≤–µ—Ç:** ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û –æ—Ç–∫–ª—é—á–∏—Ç—å, –ù–û –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é!**

#### –ß—Ç–æ —Ç–∞–∫–æ–µ Stape?

**Stape** - —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è Server-Side GTM (sGTM), –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å sGTM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Meta Pixel, TikTok Pixel —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
- –£–ª—É—á—à–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –∏ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö
- –û–±–æ–π—Ç–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥: –ì–ò–ë–†–ò–î–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

**‚úÖ –û–°–¢–ê–í–ò–¢–¨:**
- **Client-Side Meta Pixel** - —Ç–æ–ª—å–∫–æ –¥–ª—è `PageView` —Å–æ–±—ã—Ç–∏—è
  - –ó–∞—á–µ–º: –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∏–∫—Å–µ–ª—è
  - –ì–¥–µ: `base.html` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è PageView
  - –§–æ—Ä–º–∞—Ç: `fbq('init', PIXEL_ID); fbq('track', 'PageView');`

**‚ùå –û–¢–ö–õ–Æ–ß–ò–¢–¨:**
- –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `fbq('track', 'Purchase')` –≤ `order_success.html`
- –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `fbq('track', 'AddToCart')` –≤ `main.js`
- –í—Å–µ e-commerce —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ Client-Side Meta Pixel

**‚úÖ –ü–ï–†–ï–í–ï–°–¢–ò –ù–ê sGTM:**
- –í—Å–µ e-commerce —Å–æ–±—ã—Ç–∏—è (ViewContent, AddToCart, InitiateCheckout, Purchase, Lead)
- Conversions API —á–µ—Ä–µ–∑ sGTM –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞

#### –ü–æ—á–µ–º—É –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–µ?

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. **–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:** PageView –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** E-commerce —Å–æ–±—ã—Ç–∏—è –∏–¥—É—Ç —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä, –æ–±—Ö–æ–¥—è –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏
3. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** sGTM –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ `event_id`
4. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—Å–µ —Å–æ–±—ã—Ç–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

**–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:**
```
–ö–ª–∏–µ–Ω—Ç ‚Üí Client-Side GTM ‚Üí sGTM (Stape) ‚Üí Meta Conversions API
                ‚Üì
         Meta Pixel (PageView only)
```

#### Conversions API —á–µ—Ä–µ–∑ sGTM vs –Ω–∞–ø—Ä—è–º—É—é

**‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø: Conversions API —á–µ—Ä–µ–∑ sGTM**

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ:** –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –õ–µ–≥—á–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å
3. **–õ—É—á—à–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** sGTM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `event_id`
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (TikTok, Snapchat –∏ —Ç.–¥.)

**–ù–û:** –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (webhook Monobank) –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å:
- **–í–∞—Ä–∏–∞–Ω—Ç A:** –ù–∞–ø—Ä—è–º—É—é –≤ sGTM —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å
- **–í–∞—Ä–∏–∞–Ω—Ç B:** –û—Å—Ç–∞–≤–∏—Ç—å –ø—Ä—è–º—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Conversions API (–µ—Å–ª–∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç A –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è.

---

### 3. TikTok Pixel —á–µ—Ä–µ–∑ GTM

**–í–æ–ø—Ä–æ—Å:** –¢–∞–∫ –∂–µ —è —Ö–æ—á—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å TikTok Pixel, –º–Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ç–∞–∫ –∂–µ –ª—É—á—à–µ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GTM –æ–¥–∏–Ω? –ê –≤ –µ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ?

**–û—Ç–≤–µ—Ç:** ‚úÖ **–î–ê, –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ TikTok Pixel —á–µ—Ä–µ–∑ sGTM:

1. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ:** –í—Å–µ –ø–∏–∫—Å–µ–ª–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å —Å–æ–±—ã—Ç–∏—è
3. **–û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤:** –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
4. **–õ—É—á—à–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** sGTM –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `event_id` –¥–ª—è TikTok
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

#### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è TikTok Pixel:

**–§–∞–π–ª—ã:**
- `analytics-loader.js:364-435` - Client-Side TikTok Pixel
- `tiktok_events_service.py` - Server-Side TikTok Events API

**–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- Client-Side: –¢–æ–ª—å–∫–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è: –ß–µ—Ä–µ–∑ sGTM ‚Üí TikTok Events API

---

### 4. –ö–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö?

**–û—Ç–≤–µ—Ç:** –ö—Ä—É–ø–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç **Server-Side GTM** –¥–ª—è –≤—Å–µ—Ö –ø–∏–∫—Å–µ–ª–µ–π.

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫—Ä—É–ø–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENT-SIDE                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Client-Side GTM                                        ‚îÇ
‚îÇ  ‚îú‚îÄ dataLayer.push({event: 'purchase', ...})           ‚îÇ
‚îÇ  ‚îî‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ sGTM —Å–µ—Ä–≤–µ—Ä                            ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  Meta Pixel (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)                               ‚îÇ
‚îÇ  ‚îî‚îÄ –¢–æ–ª—å–∫–æ PageView –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              SERVER-SIDE GTM (Stape)                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –ü—Ä–∏–µ–º —Å–æ–±—ã—Ç–∏–π –æ—Ç Client-Side GTM                      ‚îÇ
‚îÇ  ‚îú‚îÄ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ event_id                        ‚îÇ
‚îÇ  ‚îú‚îÄ –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ (user_data, etc.)               ‚îÇ
‚îÇ  ‚îî‚îÄ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:                       ‚îÇ
‚îÇ     ‚îú‚îÄ Meta Conversions API                            ‚îÇ
‚îÇ     ‚îú‚îÄ TikTok Events API                               ‚îÇ
‚îÇ     ‚îú‚îÄ Google Analytics                                ‚îÇ
‚îÇ     ‚îî‚îÄ –î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –í—Å–µ —Å–æ–±—ã—Ç–∏—è –∏–¥—É—Ç —á–µ—Ä–µ–∑ sGTM
2. **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:** Client-Side Pixel —Ç–æ–ª—å–∫–æ –¥–ª—è PageView
3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ sGTM
4. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ:** Event Coverage ‚â•75%, EMQ ‚â•9/10

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê SERVER-SIDE GTM

### –ß—Ç–æ —Ç–∞–∫–æ–µ Server-Side GTM (sGTM)?

**Server-Side GTM** - —ç—Ç–æ –≤–µ—Ä—Å–∏—è Google Tag Manager, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∞ –Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **Client-Side GTM:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –Ω–∞ sGTM —Å–µ—Ä–≤–µ—Ä
2. **Server-Side GTM:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç
3. **Stape:** –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è sGTM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≤–µ—Ä—à–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∫—É–ø–∫–∞)
   ‚Üì
2. Client-Side GTM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –Ω–∞ sGTM —Å–µ—Ä–≤–µ—Ä
   dataLayer.push({event: 'purchase', ...})
   ‚Üì
3. sGTM —Å–µ—Ä–≤–µ—Ä (Stape) –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
   ‚Üì
4. sGTM –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ:
   - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ event_id
   - –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è
   ‚Üì
5. sGTM –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
   - Meta Conversions API
   - TikTok Events API
   - Google Analytics
```

---

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê SERVER-SIDE GTM

### 1. –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏ —Ä–µ–∫–ª–∞–º—ã –±–ª–æ–∫–∏—Ä—É—é—Ç Client-Side –ø–∏–∫—Å–µ–ª–∏ (Meta Pixel, TikTok Pixel)

**–†–µ—à–µ–Ω–∏–µ:** Server-Side –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –∏–¥—É—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 100% –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π

---

### 2. –õ—É—á—à–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É Client-Side –∏ Server-Side

**–†–µ—à–µ–Ω–∏–µ:** sGTM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `event_id` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Event Coverage ‚â•75%, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è

---

### 3. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–±—ã—Ç–∏—è —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º —Ñ–∞–π–ª–∞–º –∏ —Å–∏—Å—Ç–µ–º–∞–º

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ —Å–æ–±—ã—Ç–∏—è —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (sGTM)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –õ–µ–≥—á–µ —É–ø—Ä–∞–≤–ª—è—Ç—å, –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å

---

### 4. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** Client-Side —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç —Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** Server-Side —Å–æ–±—ã—Ç–∏—è –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ Event Match Quality (EMQ) ‚â•9/10

---

### 5. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ

**–†–µ—à–µ–Ω–∏–µ:** –ù–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ sGTM –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ —Å–∞–π—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (Snapchat, Pinterest –∏ —Ç.–¥.)

---

## üîç –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENT-SIDE                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  analytics-loader.js                                    ‚îÇ
‚îÇ  ‚îú‚îÄ Meta Pixel: fbq('track', 'Purchase', ...)          ‚îÇ
‚îÇ  ‚îú‚îÄ TikTok Pixel: ttq.track('Purchase', ...)           ‚îÇ
‚îÇ  ‚îî‚îÄ GTM: dataLayer.push({event: 'purchase', ...})      ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  order_success.html                                     ‚îÇ
‚îÇ  ‚îú‚îÄ GTM Purchase event                                  ‚îÇ
‚îÇ  ‚îú‚îÄ Meta Pixel Purchase event                           ‚îÇ
‚îÇ  ‚îî‚îÄ trackEvent('Purchase', ...)                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SERVER-SIDE                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  facebook_conversions_service.py                        ‚îÇ
‚îÇ  ‚îî‚îÄ –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Meta Conversions API             ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  tiktok_events_service.py                               ‚îÇ
‚îÇ  ‚îî‚îÄ –ü—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ TikTok Events API                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. ‚ùå **–†–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω–æ—Å—Ç—å:** –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç
2. ‚ùå **–ë–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–∏:** Client-Side –ø–∏–∫—Å–µ–ª–∏ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è
3. ‚ùå **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏ –º–µ–∂–¥—É Client-Side –∏ Server-Side
4. ‚ùå **–°–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–æ–∫ –≤ –∫–æ–¥–µ

---

## üéØ –ò–î–ï–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –î–õ–Ø –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ì–û –ö–ê–ß–ï–°–¢–í–ê

### –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENT-SIDE                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Client-Side GTM (GTM-PRLLBF9H)                        ‚îÇ
‚îÇ  ‚îú‚îÄ dataLayer.push({event: 'purchase', ...})           ‚îÇ
‚îÇ  ‚îî‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ sGTM —Å–µ—Ä–≤–µ—Ä (Stape)                    ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  Meta Pixel (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)                               ‚îÇ
‚îÇ  ‚îî‚îÄ –¢–æ–ª—å–∫–æ PageView:                                    ‚îÇ
‚îÇ     fbq('init', PIXEL_ID);                              ‚îÇ
‚îÇ     fbq('track', 'PageView');                           ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –ù–ï–¢ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤:                                    ‚îÇ
‚îÇ  ‚ùå fbq('track', 'Purchase')                            ‚îÇ
‚îÇ  ‚ùå ttq.track('Purchase')                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          SERVER-SIDE GTM (Stape)                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –ü—Ä–∏–µ–º —Å–æ–±—ã—Ç–∏–π –æ—Ç Client-Side GTM                      ‚îÇ
‚îÇ  ‚îú‚îÄ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ event_id                        ‚îÇ
‚îÇ  ‚îú‚îÄ –û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏:                                ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ user_data (email, phone, name, city)            ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ fbp, fbc (Browser ID, Click ID)                 ‚îÇ
‚îÇ  ‚îÇ  ‚îú‚îÄ external_id (user_id –∏–ª–∏ session_id)            ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ client_ip_address, client_user_agent            ‚îÇ
‚îÇ  ‚îî‚îÄ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:                       ‚îÇ
‚îÇ     ‚îú‚îÄ Meta Conversions API                            ‚îÇ
‚îÇ     ‚îú‚îÄ TikTok Events API                               ‚îÇ
‚îÇ     ‚îî‚îÄ Google Analytics                                ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  –ü—Ä–∏–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (webhook)                     ‚îÇ
‚îÇ  ‚îú‚îÄ Purchase/Lead —Å–æ–±—ã—Ç–∏—è –æ—Ç Monobank webhook          ‚îÇ
‚îÇ  ‚îî‚îÄ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1. ‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –í—Å–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ sGTM
2. ‚úÖ **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:** Client-Side Pixel —Ç–æ–ª—å–∫–æ –¥–ª—è PageView
3. ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ sGTM
4. ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ:** Event Coverage ‚â•75%, EMQ ‚â•9/10

---

## üìã –ü–õ–ê–ù –ú–ò–ì–†–ê–¶–ò–ò

### –≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Stape

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞

**–®–∞–≥–∏:**

1. **–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç Stape:**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ [stape.io](https://stape.io)
   - –í—ã–±—Ä–∞—Ç—å –ø–ª–∞–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Starter –∏–ª–∏ Professional)

2. **–°–æ–∑–¥–∞—Ç—å Server-Side GTM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
   - –í Google Tag Manager —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Server –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Container ID (—Ñ–æ—Ä–º–∞—Ç: `GTM-XXXXXXX`)

3. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å Stape –∫ sGTM:**
   - –í Stape –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
   - –í–≤–µ—Å—Ç–∏ Container ID
   - –ü–æ–ª—É—á–∏—Ç—å URL —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://your-server.stape.io`)

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Client-Side GTM:**
   - –í Client-Side GTM —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è sGTM URL
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–±—ã—Ç–∏–π –Ω–∞ sGTM —Å–µ—Ä–≤–µ—Ä

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] –ê–∫–∫–∞—É–Ω—Ç Stape —Å–æ–∑–¥–∞–Ω
- [ ] Server-Side GTM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–∑–¥–∞–Ω
- [ ] Stape –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ sGTM
- [ ] Client-Side GTM –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ sGTM

---

### –≠–¢–ê–ü 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –≤ sGTM

**–í—Ä–µ–º—è:** 3-4 —á–∞—Å–∞

**–®–∞–≥–∏:**

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Meta Conversions API –≤ sGTM:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–≥ "Meta Conversions API" –≤ sGTM
   - –í–≤–µ—Å—Ç–∏ Pixel ID: `823958313630148`
   - –í–≤–µ—Å—Ç–∏ Access Token –¥–ª—è Conversions API
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π:
     - `event_id` ‚Üí `event_id`
     - `user_data` ‚Üí `user_data`
     - `custom_data` ‚Üí `custom_data`

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å TikTok Events API –≤ sGTM:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–≥ "TikTok Events API" –≤ sGTM
   - –í–≤–µ—Å—Ç–∏ Pixel ID
   - –í–≤–µ—Å—Ç–∏ Access Token
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Analytics –≤ sGTM:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–≥ "Google Analytics: GA4 Configuration"
   - –í–≤–µ—Å—Ç–∏ Measurement ID
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] Meta Conversions API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ sGTM
- [ ] TikTok Events API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ sGTM
- [ ] Google Analytics –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ sGTM
- [ ] –í—Å–µ –º–∞–ø–ø–∏–Ω–≥–∏ –ø–æ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

### –≠–¢–ê–ü 3: –ú–∏–≥—Ä–∞—Ü–∏—è Client-Side —Å–æ–±—ã—Ç–∏–π

**–í—Ä–µ–º—è:** 4-5 —á–∞—Å–æ–≤

**–®–∞–≥–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å Client-Side GTM:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –Ω–∞ sGTM —Å–µ—Ä–≤–µ—Ä
   - –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π (purchase, lead, add_to_cart –∏ —Ç.–¥.)
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö

2. **–û–±–Ω–æ–≤–∏—Ç—å analytics-loader.js:**
   - –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `fbq('track', ...)` –¥–ª—è e-commerce —Å–æ–±—ã—Ç–∏–π
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `fbq('track', 'PageView')`
   - –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `ttq.track(...)` –¥–ª—è e-commerce —Å–æ–±—ã—Ç–∏–π
   - –í—Å–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `dataLayer.push()`

3. **–û–±–Ω–æ–≤–∏—Ç—å order_success.html:**
   - –£–±—Ä–∞—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `fbq('track', 'Purchase')`
   - –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `dataLayer.push({event: 'purchase', ...})`
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ dataLayer

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

```javascript
// –ë–´–õ–û (analytics-loader.js):
if (PIXEL_ID && win.fbq) {
  win.fbq('track', eventName, fbPayload, metaOptions);
}

// –°–¢–ê–õ–û (analytics-loader.js):
// –¢–æ–ª—å–∫–æ –¥–ª—è PageView:
if (eventName === 'PageView' && PIXEL_ID && win.fbq) {
  win.fbq('track', 'PageView');
}

// –î–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π - —Ç–æ–ª—å–∫–æ dataLayer:
win.dataLayer = win.dataLayer || [];
win.dataLayer.push({
  event: eventName,
  ecommerce: {...},
  user_data: {...}
});
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] Client-Side GTM –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ sGTM
- [ ] analytics-loader.js –æ–±–Ω–æ–≤–ª–µ–Ω (–æ—Ç–∫–ª—é—á–µ–Ω—ã –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã)
- [ ] order_success.html –æ–±–Ω–æ–≤–ª–µ–Ω (—Ç–æ–ª—å–∫–æ dataLayer)
- [ ] –í—Å–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ dataLayer

---

### –≠–¢–ê–ü 4: –ú–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞

**–®–∞–≥–∏:**

1. **–û–±–Ω–æ–≤–∏—Ç—å webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (monobank.py):**
   - –í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Conversions API
   - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ sGTM —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ `event_id` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ sGTM:**
   - –°–æ–∑–¥–∞—Ç—å endpoint –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É Purchase/Lead —Å–æ–±—ã—Ç–∏–π
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –≤ Meta/TikTok Conversions API

**–ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

```python
# –ë–´–õ–û (monobank.py):
fb_service = get_facebook_conversions_service()
fb_service.send_purchase_event(order)

# –°–¢–ê–õ–û (monobank.py):
import requests

sgtm_url = settings.SGTM_SERVER_URL  # https://your-server.stape.io
event_data = {
    'event': 'purchase',
    'event_id': order.get_purchase_event_id(),
    'ecommerce': {
        'transaction_id': order.order_number,
        'value': float(order.total_sum),
        'currency': 'UAH',
        'items': [...]
    },
    'user_data': {...}
}

response = requests.post(
    f'{sgtm_url}/events',
    json=event_data,
    headers={'Content-Type': 'application/json'}
)
```

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ sGTM)
- [ ] sGTM –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ (event_id)

---

### –≠–¢–ê–ü 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞

**–®–∞–≥–∏:**

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Client-Side —Å–æ–±—ã—Ç–∏–π:**
   - –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–∫—É–ø–∫—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ GTM Preview Mode —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ sGTM
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Stape Dashboard —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Server-Side —Å–æ–±—ã—Ç–∏–π:**
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–∫—É–ø–∫—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook –æ—Ç–ø—Ä–∞–≤–∫—É –≤ sGTM
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Stape Dashboard —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö:**
   - Meta Events Manager: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç
   - TikTok Events Manager: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç
   - Google Analytics: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

**–ß–µ–∫-–ª–∏—Å—Ç:**
- [ ] Client-Side —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Server-Side —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Meta
- [ ] –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ TikTok
- [ ] –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Google Analytics
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîß –î–ï–¢–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê STAPE

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Server-Side GTM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

1. –û—Ç–∫—Ä—ã—Ç—å [Google Tag Manager](https://tagmanager.google.com)
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   - **–ò–º—è:** "TwoComms Server Container"
   - **–¢–∏–ø:** Server
   - **–°—Ç—Ä–∞–Ω–∞:** –£–∫—Ä–∞–∏–Ω–∞
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Container ID (—Ñ–æ—Ä–º–∞—Ç: `GTM-XXXXXXX`)

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Stape

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ [stape.io](https://stape.io)
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä:
   - **–ò–º—è:** "TwoComms Server"
   - **Container ID:** –í—Å—Ç–∞–≤–∏—Ç—å Container ID –∏–∑ —à–∞–≥–∞ 1
   - **–†–µ–≥–∏–æ–Ω:** –í—ã–±—Ä–∞—Ç—å –±–ª–∏–∂–∞–π—à–∏–π (–ï–≤—Ä–æ–ø–∞)
3. –ü–æ–ª—É—á–∏—Ç—å URL —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://your-server.stape.io`)

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Client-Side GTM

1. –í Client-Side GTM —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **–¢–∏–ø:** Constant
   - **–ò–º—è:** `sGTM Server URL`
   - **–ó–Ω–∞—á–µ–Ω–∏–µ:** URL –∏–∑ —à–∞–≥–∞ 2

2. –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ sGTM:
   - **–¢–∏–ø:** Custom HTML
   - **–ò–º—è:** "Send to sGTM"
   - **–ö–æ–¥:**
   ```javascript
   <script>
   (function() {
     var sgtmUrl = {{sGTM Server URL}};
     var eventData = {
       event: {{Event}},
       ecommerce: {{Ecommerce}},
       user_data: {{User Data}}
     };
     
     fetch(sgtmUrl + '/events', {
       method: 'POST',
       headers: {'Content-Type': 'application/json'},
       body: JSON.stringify(eventData)
     });
   })();
   </script>
   ```

3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã:
   - **–¢—Ä–∏–≥–≥–µ—Ä:** "All Events"
   - **–¢–∏–ø:** Custom Event
   - **Event name:** `.*` (–≤—Å–µ —Å–æ–±—ã—Ç–∏—è)

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Meta Conversions API –≤ sGTM

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–≥ "Meta Conversions API":
   - –í Stape Dashboard ‚Üí Tags ‚Üí Add Tag
   - –í—ã–±—Ä–∞—Ç—å "Meta Conversions API"

2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **Pixel ID:** `823958313630148`
   - **Access Token:** –í–∞—à Access Token –¥–ª—è Conversions API
   - **Event Name:** `{{Event Name}}`
   - **Event ID:** `{{Event ID}}`

3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å User Data:
   - **Email:** `{{User Data Email}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **Phone:** `{{User Data Phone}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **First Name:** `{{User Data First Name}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **Last Name:** `{{User Data Last Name}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **City:** `{{User Data City}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **External ID:** `{{User Data External ID}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **FBP:** `{{FBP}}`
   - **FBC:** `{{FBC}}`

4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Custom Data:
   - **Value:** `{{Ecommerce Value}}`
   - **Currency:** `{{Ecommerce Currency}}`
   - **Content IDs:** `{{Ecommerce Content IDs}}`
   - **Contents:** `{{Ecommerce Contents}}`

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TikTok Events API –≤ sGTM

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–≥ "TikTok Events API":
   - –í Stape Dashboard ‚Üí Tags ‚Üí Add Tag
   - –í—ã–±—Ä–∞—Ç—å "TikTok Events API"

2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **Pixel ID:** –í–∞—à TikTok Pixel ID
   - **Access Token:** –í–∞—à Access Token –¥–ª—è Events API
   - **Event Name:** `{{Event Name}}`
   - **Event ID:** `{{Event ID}}`

3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å User Data:
   - **Email:** `{{User Data Email}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **Phone:** `{{User Data Phone}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
   - **External ID:** `{{User Data External ID}}` (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Properties:
   - **Value:** `{{Ecommerce Value}}`
   - **Currency:** `{{Ecommerce Currency}}`
   - **Content ID:** `{{Ecommerce Content ID}}`
   - **Contents:** `{{Ecommerce Contents}}`

---

## üéØ –ù–Æ–ê–ù–°–´ –ò –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞:

#### 1. Event ID (–¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)

**–§–æ—Ä–º–∞—Ç:** `{order_number}_{timestamp}_{event_type}`

**–ü—Ä–∏–º–µ—Ä:** `TWC30102025N01_1730304000_purchase`

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- Client-Side —Å–æ–±—ã—Ç–∏—è: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `analytics-loader.js`
- Server-Side —Å–æ–±—ã—Ç–∏—è: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `order.get_purchase_event_id()`

**–í–∞–∂–Ω–æ:** –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ `event_id` –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ Client-Side –∏ Server-Side —Å–æ–±—ã—Ç–∏—è—Ö –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏.

---

#### 2. FBP –∏ FBC (Browser ID –∏ Click ID)

**FBP (Facebook Browser Pixel):**
- –§–æ—Ä–º–∞—Ç: `fb.1.{timestamp}.{random}`
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ `analytics-loader.js`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ cookie `_fbp` (90 –¥–Ω–µ–π)

**FBC (Facebook Click ID):**
- –§–æ—Ä–º–∞—Ç: `fb.1.{timestamp}.{fbclid}`
- –ü–∞—Ä—Å–∏—Ç—Å—è –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `?fbclid=...`
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ cookie `_fbc` (90 –¥–Ω–µ–π)

**–í–∞–∂–Ω–æ:** –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è Event Match Quality (EMQ). –î–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤–æ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏—è—Ö.

---

#### 3. External ID

**–§–æ—Ä–º–∞—Ç:** `user:{user_id}` –∏–ª–∏ `session:{session_key}`

**–ü—Ä–∏–º–µ—Ä:** `user:123` –∏–ª–∏ `session:abc123`

**–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** SHA-256 –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**–í–∞–∂–Ω–æ:** External ID –ø–æ–º–æ–≥–∞–µ—Ç Meta/TikTok —Å–≤—è–∑–∞—Ç—å —Å–æ–±—ã—Ç–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —É–ª—É—á—à–∞—è –∫–∞—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–∏–Ω–≥–∞.

---

#### 4. User Data (Advanced Matching)

**–ü–æ–ª—è:**
- `email` - SHA-256 hashed, lowercase
- `phone` - SHA-256 hashed, digits only
- `first_name` - SHA-256 hashed, lowercase
- `last_name` - SHA-256 hashed, lowercase
- `city` - SHA-256 hashed, lowercase

**–í–∞–∂–Ω–æ:** –í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ö–µ—à–∏—Ä–æ–≤–∞–Ω—ã SHA-256 –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–∞—Ç—á–∏–Ω–≥–∞.

---

#### 5. Content IDs (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º)

**–§–æ—Ä–º–∞—Ç:** `TC-{product_id:04d}-{COLOR}-{SIZE}`

**–ü—Ä–∏–º–µ—Ä:** `TC-0001-–ß–ï–†–ù–´–ô-S`

**–í–∞–∂–Ω–æ:** 
- –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `g:id` –≤ Google Merchant Feed
- –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `product_id` –≤ Meta Catalog
- –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `content_id` –≤ TikTok Catalog

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. Google Merchant Feed: `g:id = TC-0001-–ß–ï–†–ù–´–ô-S` ‚úÖ
2. Meta Catalog: `product_id = TC-0001-–ß–ï–†–ù–´–ô-S` ‚úÖ
3. –°–æ–±—ã—Ç–∏—è Meta Pixel: `content_ids = ['TC-0001-–ß–ï–†–ù–´–ô-S']` ‚úÖ

---

#### 6. Client IP Address –∏ User Agent

**Client IP Address:**
- –ë–µ—Ä–µ—Ç—Å—è –∏–∑ `X-Forwarded-For` –∑–∞–≥–æ–ª–æ–≤–∫–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏ –º–∞—Ç—á–∏–Ω–≥–∞

**User Agent:**
- –ë–µ—Ä–µ—Ç—Å—è –∏–∑ `User-Agent` –∑–∞–≥–æ–ª–æ–≤–∫–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–í–∞–∂–Ω–æ:** –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–º–æ–≥–∞—é—Ç Meta/TikTok –ª—É—á—à–µ –º–∞—Ç—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

#### 1. Event Coverage (Meta)

**–¶–µ–ª—å:** ‚â•75%

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û—Ç–∫—Ä—ã—Ç—å Meta Events Manager ‚Üí Diagnostics
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å "Pixel events covered by CAPI"
3. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â•75% –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π (Purchase, Lead)

**–ï—Å–ª–∏ –Ω–∏–∂–µ 75%:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ sGTM
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `event_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç –≤ Client-Side –∏ Server-Side
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Conversions API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

#### 2. Event Match Quality (EMQ)

**–¶–µ–ª—å:** ‚â•9/10

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û—Ç–∫—Ä—ã—Ç—å Meta Events Manager ‚Üí Diagnostics
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å "Event Match Quality"
3. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â•9/10 –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π

**–ï—Å–ª–∏ –Ω–∏–∂–µ 9/10:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ `fbp`, `fbc` –≤–æ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ `external_id` –≤–æ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `user_data` (email, phone) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω—ã SHA-256

---

#### 3. Additional Conversions Reported (ACR)

**–¶–µ–ª—å:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å Conversions API

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –û—Ç–∫—Ä—ã—Ç—å Meta Events Manager ‚Üí Diagnostics
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å "Additional Conversions Reported"
3. –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–π

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 30-40% –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–π –±–ª–∞–≥–æ–¥–∞—Ä—è Conversions API

---

#### 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤

**–¶–µ–ª—å:** 100% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ID —Ç–æ–≤–∞—Ä–æ–≤

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. Google Merchant Feed: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `g:id` –≤ —Ñ–∏–¥–µ
2. Meta Catalog: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `product_id` –≤ –∫–∞—Ç–∞–ª–æ–≥–µ
3. –°–æ–±—ã—Ç–∏—è: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `content_ids` –≤ —Å–æ–±—ã—Ç–∏—è—Ö
4. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç

**–ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç:**
- –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ Meta —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ ID
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `offer_id`

---

## üìù –ß–ï–ö-–õ–ò–°–¢ –ú–ò–ì–†–ê–¶–ò–ò

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:

- [ ] –ê–∫–∫–∞—É–Ω—Ç Stape —Å–æ–∑–¥–∞–Ω
- [ ] Server-Side GTM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–∑–¥–∞–Ω
- [ ] Stape –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ sGTM
- [ ] URL sGTM —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ sGTM:

- [ ] Meta Conversions API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ sGTM
- [ ] TikTok Events API –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ sGTM
- [ ] Google Analytics –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ sGTM
- [ ] –í—Å–µ –º–∞–ø–ø–∏–Ω–≥–∏ –ø–æ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### –ú–∏–≥—Ä–∞—Ü–∏—è Client-Side:

- [ ] Client-Side GTM –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ sGTM
- [ ] analytics-loader.js –æ–±–Ω–æ–≤–ª–µ–Ω (–æ—Ç–∫–ª—é—á–µ–Ω—ã –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã)
- [ ] order_success.html –æ–±–Ω–æ–≤–ª–µ–Ω (—Ç–æ–ª—å–∫–æ dataLayer)
- [ ] Meta Pixel –æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è PageView
- [ ] –í—Å–µ e-commerce —Å–æ–±—ã—Ç–∏—è –∏–¥—É—Ç —á–µ—Ä–µ–∑ dataLayer

### –ú–∏–≥—Ä–∞—Ü–∏—è Server-Side:

- [ ] Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ sGTM)
- [ ] sGTM –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ (event_id)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

- [ ] Client-Side —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Server-Side —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Meta
- [ ] –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ TikTok
- [ ] –°–æ–±—ã—Ç–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ Google Analytics
- [ ] –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:

- [ ] Event Coverage ‚â•75%
- [ ] Event Match Quality ‚â•9/10
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤ 100%
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–æ–±—ã—Ç–∏–π
- [ ] –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîó –°–°–´–õ–ö–ò –ù–ê –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Æ

### Stape:
- [Stape Documentation](https://docs.stape.io)
- [Stape Server-Side GTM Setup](https://docs.stape.io/getting-started)

### Google Tag Manager:
- [Server-Side Tagging](https://developers.google.com/tag-platform/tag-manager/server-side)
- [GTM Server-Side API](https://developers.google.com/tag-platform/tag-manager/api/v2)

### Meta:
- [Meta Conversions API](https://developers.facebook.com/docs/marketing-api/conversions-api)
- [Server-Side Tag Managers](https://developers.facebook.com/docs/marketing-api/conversions-api/guides/using-server-side-tag-managers)
- [Event Deduplication](https://developers.facebook.com/docs/marketing-api/conversions-api/deduplicate-pixel-and-server-events)

### TikTok:
- [TikTok Events API](https://ads.tiktok.com/help/article?aid=10028)
- [TikTok Pixel Documentation](https://ads.tiktok.com/help/article?aid=10028)

---

## üìä –ò–¢–û–ì–û–í–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### ‚úÖ –ß–¢–û –î–ï–õ–ê–¢–¨:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ñ–∏–¥ –¥–ª—è –æ–±–æ–∏—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤:**
   - ‚úÖ Google Merchant Feed: `https://twocomms.shop/media/google-merchant-v3.xml`
   - ‚úÖ Meta Catalog: –¢–æ—Ç –∂–µ —Ñ–∏–¥ (–µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º)
   - ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Meta –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É –≤ `g:id`

2. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Server-Side GTM —á–µ—Ä–µ–∑ Stape:**
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å sGTM –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ Stape
   - ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—å Meta Conversions API —á–µ—Ä–µ–∑ sGTM
   - ‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç—å TikTok Events API —á–µ—Ä–µ–∑ sGTM
   - ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ sGTM

3. **–ß–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å Client-Side Meta Pixel:**
   - ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ `PageView` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
   - ‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å –≤—Å–µ e-commerce —Å–æ–±—ã—Ç–∏—è (Purchase, AddToCart –∏ —Ç.–¥.)
   - ‚úÖ –í—Å–µ e-commerce —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ sGTM

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Conversions API —á–µ—Ä–µ–∑ sGTM:**
   - ‚úÖ –í—Å–µ —Å–æ–±—ã—Ç–∏—è (Client-Side –∏ Server-Side) —á–µ—Ä–µ–∑ sGTM
   - ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
   - ‚úÖ –õ—É—á—à–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∏ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö

5. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å TikTok Pixel —á–µ—Ä–µ–∑ sGTM:**
   - ‚úÖ –í—Å–µ —Å–æ–±—ã—Ç–∏—è TikTok —á–µ—Ä–µ–∑ sGTM
   - ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å Meta Pixel
   - ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### ‚ùå –ß–¢–û –ù–ï –î–ï–õ–ê–¢–¨:

1. ‚ùå –ù–µ –æ—Ç–∫–ª—é—á–∞—Ç—å Client-Side Meta Pixel –ø–æ–ª–Ω–æ—Å—Ç—å—é (–æ—Å—Ç–∞–≤–∏—Ç—å PageView)
2. ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `fbq()` –∏–ª–∏ `ttq()` –¥–ª—è e-commerce —Å–æ–±—ã—Ç–∏–π
3. ‚ùå –ù–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –º–µ–∂–¥—É Client-Side –∏ Server-Side –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
4. ‚ùå –ù–µ –∑–∞–±—ã–≤–∞—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (event_id, fbp, fbc, external_id)

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Server-Side GTM —á–µ—Ä–µ–∑ Stape:

### –ö–∞—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

- ‚úÖ **Event Coverage:** ‚â•75% (–±—ã–ª–æ 36%)
- ‚úÖ **Event Match Quality:** ‚â•9/10
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤:** 100%
- ‚úÖ **–î–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π:** 100% (–æ–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤)

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –ø–∏–∫—Å–µ–ª—è–º–∏
- ‚úÖ –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- ‚úÖ –õ—É—á—à–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
- ‚úÖ –û–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤—â–∏–∫–æ–≤ —Ä–µ–∫–ª–∞–º—ã
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-31  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** AI Codex Agent  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é




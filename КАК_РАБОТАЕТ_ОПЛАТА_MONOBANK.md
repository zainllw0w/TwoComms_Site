# üí≥ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø–ª–∞—Ç–∞ –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ Monobank

## ‚úÖ –ì–õ–ê–í–ù–û–ï: –î–µ–Ω—å–≥–∏ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –°–†–ê–ó–£

```
üí∞ –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç ‚Üí –î–µ–Ω—å–≥–∏ –°–†–ê–ó–£ —É—Ö–æ–¥—è—Ç –∫ –≤–∞–º ‚Üí –°—Ç–∞—Ç—É—Å: "success"
```

**–ù–ò–ö–ê–ö–ò–• —Ö–æ–ª–¥–æ–≤, –ù–ò–ö–ê–ö–ò–• –∑–∞–º–æ—Ä–æ–∑–æ–∫!**

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã

### –®–∞–≥ 1: –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å"

```javascript
// –í –±—Ä–∞—É–∑–µ—Ä–µ –∫–ª–∏–µ–Ω—Ç–∞
–ù–∞–∂–∞–ª "–û–ø–ª–∞—Ç–∏—Ç–∏" ‚Üí –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Monobank ‚Üí –í–≤–µ–ª –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
```

### –®–∞–≥ 2: Monobank —Å–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏

```
Monobank:
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—Ä—Ç—É ‚úÖ
‚îú‚îÄ –°–ü–ò–°–´–í–ê–ï–¢ –¥–µ–Ω—å–≥–∏ —Å –∫–∞—Ä—Ç—ã üí∏
‚îú‚îÄ –°—Ç–∞—Ç—É—Å: "success" (–¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã)
‚îî‚îÄ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –≤–∞—à –º–∞–≥–∞–∑–∏–Ω
```

**–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –¥–µ–Ω—å–≥–∏ –£–ñ–ï —É –≤–∞—Å –Ω–∞ —Å—á–µ—Ç–µ!**

### –®–∞–≥ 3: –í–∞—à —Å–∞–π—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç

```python
# –í –≤–∞—à–µ–º –∫–æ–¥–µ
status = "success"
payment_status = "paid"  # –∏–ª–∏ "prepaid" –µ—Å–ª–∏ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞
order.save()
```

---

## üìä –°—Ç–∞—Ç—É—Å—ã –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ

### –í Monobank API:

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–Ω—å–≥–∏ |
|--------|----------|--------|
| `success` | **–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞** | ‚úÖ –°–†–´–ó–£ —Å–ø–∏—Å–∞–Ω—ã –Ω–∞ –≤–∞—à —Å—á–µ—Ç |
| `processing` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è | –ñ–¥—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| `hold` | –î–µ–Ω—å–≥–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã | ‚ö†Ô∏è –ó–∞–º–æ—Ä–æ–∂–µ–Ω—ã (—É –≤–∞—Å –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| `failure` | –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã | ‚ùå –ù–µ —Å–ø–∏—Å–∞–Ω—ã |

### –í –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

| payment_status | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ |
|----------------|----------|-------|
| `unpaid` | –ù–µ –æ–ø–ª–∞—á–µ–Ω–æ | –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –æ–ø–ª–∞—á–µ–Ω |
| `checking` | –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ | Monobank –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç |
| `paid` | –û–ø–ª–∞—á–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é | –°—Ç–∞—Ç—É—Å `success` –æ—Ç Monobank, `pay_type=online_full` |
| `prepaid` | –í–Ω–µ—Å–µ–Ω–∞ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ | –°—Ç–∞—Ç—É—Å `success` –æ—Ç Monobank, `pay_type=prepay_200` |

---

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

**–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ù–ï —Ç—Ä–æ–≥–∞–µ—Ç –¥–µ–Ω—å–≥–∏!** –û–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞–ª–æ–≥–æ–≤—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å.

```
–î–µ–Ω—å–≥–∏ —É–∂–µ —É –≤–∞—Å ‚Üí –û—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–≤–∞—Ä ‚Üí –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –û–±–Ω–æ–≤–∏–ª–∏ –Ω–∞–ª–æ–≥–æ–≤—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
```

### –ü–æ—á–µ–º—É –Ω—É–∂–Ω–∞?

**–ë–ï–ó —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:**
```
–ù–∞–ª–æ–≥–æ–≤–∞—è –≤–∏–¥–∏—Ç:
- –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #123: 900 –≥—Ä–Ω
‚ùì –ß—Ç–æ –∫—É–ø–∏–ª? –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
‚ùì –ö–∞–∫–∞—è —Å–∫–∏–¥–∫–∞? –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
‚ùì –ö–∞–∫–æ–π —Ç–æ–≤–∞—Ä? –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
```

**–° —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π:**
```
–ù–∞–ª–æ–≥–æ–≤–∞—è –≤–∏–¥–∏—Ç:
- –§—É—Ç–±–æ–ª–∫–∞ (M) √ó 1: 1000 –≥—Ä–Ω
- –ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É SALE10: -100 –≥—Ä–Ω
- –ò–¢–û–ì–û: 900 –≥—Ä–Ω
‚úÖ –í–°–ï –î–ï–¢–ê–õ–ò!
```

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–æ–¥–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞ (–ø—Ä–∏ –æ–ø–ª–∞—Ç–µ)

**–§–∞–π–ª:** `monobank_create_invoice()` –≤ `views/monobank.py`

```python
# –°–æ–∑–¥–∞–µ–º invoice –≤ Monobank
payload = {
    'amount': int(payment_amount * 100),  # –Ω–∞–ø—Ä–∏–º–µ—Ä, 90000 (900 –≥—Ä–Ω)
    'ccy': 980,  # UAH
    'merchantPaymInfo': {
        'reference': order.order_number,
        'destination': payment_description,
        'basketOrder': basket_entries  # —Ç–æ–≤–∞—Ä—ã
    }
}

result = _monobank_api_request('POST', '/api/merchant/invoice/create', payload)
# response: {"status": "success", "invoiceId": "abc123...", "pageUrl": "..."}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
```
–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ pageUrl ‚Üí –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã ‚Üí Monobank —Å–ø–∏—Å—ã–≤–∞–µ—Ç 900 –≥—Ä–Ω
‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç status="success" ‚Üí –î–ï–ù–¨–ì–ò –£–ñ–ï –£ –í–ê–°!
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

**–§–∞–π–ª:** `_record_monobank_status()` –≤ `views/utils.py`

```python
if status == 'success':
    order.payment_status = 'paid'  # –∏–ª–∏ 'prepaid'
    order.save()
    # –î–µ–Ω—å–≥–∏ —É–∂–µ –Ω–∞ –≤–∞—à–µ–º —Å—á–µ—Ç–µ –≤ Monobank!
```

### 3. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ç–æ–≤–∞—Ä–∞)

**–§–∞–π–ª:** `_monobank_finalize_invoice()` –≤ `views/monobank.py`

```python
# –î–µ–Ω—å–≥–∏ –£–ñ–ï —Å–ø–∏—Å–∞–Ω—ã!
# –ú—ã —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–ª–æ–≥–æ–≤—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

payload = {
    'invoiceId': 'abc123...',  # —Ç–æ—Ç –∂–µ ID
    'amount': int(90000),  # —Ç–∞ –∂–µ —Å—É–º–º–∞
    'items': [
        {'name': '–§—É—Ç–±–æ–ª–∫–∞ (M)', 'qty': 1, 'sum': 100000},  # –¥–µ—Ç–∞–ª–∏!
        {'name': '–ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É SALE10', 'qty': 1, 'sum': -10000}
    ]
}

result = _monobank_api_request('POST', '/api/merchant/invoice/finalize', payload)
# –û–±–Ω–æ–≤–∏–ª–∏ –Ω–∞–ª–æ–≥–æ–≤—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å ‚úÖ
```

---

## üí° –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞

```
1. –ö–ª–∏–µ–Ω—Ç: –ó–∞–∫–∞–∑–∞–ª —Ñ—É—Ç–±–æ–ª–∫—É –∑–∞ 1000 –≥—Ä–Ω
2. –ù–∞–∂–∞–ª "–û–ø–ª–∞—Ç–∏—Ç–∏"
3. Monobank: üí∏ –°–ü–ò–°–ê–õ 1000 –≥—Ä–Ω –°–†–ê–ó–£
4. –í–∞—à —Å—á–µ—Ç: +1000 –≥—Ä–Ω ‚úÖ
5. Webhook: status="success" ‚Üí payment_status="paid"
6. –ß–µ—Ä–µ–∑ 2 –¥–Ω—è: –û—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–≤–∞—Ä
7. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –û–±–Ω–æ–≤–∏–ª–∏ –Ω–∞–ª–æ–≥–æ–≤—É—é (–¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞)
```

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞

```
1. –ö–ª–∏–µ–Ω—Ç: –ó–∞–∫–∞–∑ –Ω–∞ 1000 –≥—Ä–Ω, –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ 200 –≥—Ä–Ω
2. –ù–∞–∂–∞–ª "–û–ø–ª–∞—Ç–∏—Ç–∏"
3. Monobank: üí∏ –°–ü–ò–°–ê–õ 200 –≥—Ä–Ω –°–†–ê–ó–£
4. –í–∞—à —Å—á–µ—Ç: +200 –≥—Ä–Ω ‚úÖ
5. Webhook: status="success" ‚Üí payment_status="prepaid"
6. –ß–µ—Ä–µ–∑ 2 –¥–Ω—è: –û—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–≤–∞—Ä
7. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –û–±–Ω–æ–≤–∏–ª–∏ –Ω–∞–ª–æ–≥–æ–≤—É—é (prepayment info)
8. –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏: –ö–ª–∏–µ–Ω—Ç –¥–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç 800 –≥—Ä–Ω –ù–æ–≤–æ–π –ü–æ—á—Ç–µ (–Ω–µ Monobank!)
```

### –ü—Ä–∏–º–µ—Ä 3: –° –ø—Ä–æ–º–æ–∫–æ–¥–æ–º

```
1. –ö–ª–∏–µ–Ω—Ç: –§—É—Ç–±–æ–ª–∫–∞ 1000 –≥—Ä–Ω, –ø—Ä–æ–º–æ–∫–æ–¥ -10%
2. –ù–∞–∂–∞–ª "–û–ø–ª–∞—Ç–∏—Ç–∏"
3. Monobank: üí∏ –°–ü–ò–°–ê–õ 900 –≥—Ä–Ω –°–†–ê–ó–£ (—É–∂–µ —Å–æ —Å–∫–∏–¥–∫–æ–π!)
4. –í–∞—à —Å—á–µ—Ç: +900 –≥—Ä–Ω ‚úÖ
5. Webhook: status="success" ‚Üí payment_status="paid"
6. –ß–µ—Ä–µ–∑ 2 –¥–Ω—è: –û—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–≤–∞—Ä
7. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è: –û–±–Ω–æ–≤–∏–ª–∏ –Ω–∞–ª–æ–≥–æ–≤—É—é (–¥–æ–±–∞–≤–∏–ª–∏ —Å—Ç—Ä–æ–∫—É "–ó–Ω–∏–∂–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É")
```

---

## ‚ùå –ß—Ç–æ –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

### ‚ùå –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–µ–Ω—å–≥–∏

```
‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
"Monobank –±–ª–æ–∫–∏—Ä—É–µ—Ç 1000 –≥—Ä–Ω, –ø–æ—Ç–æ–º —Å–ø–∏—à–µ—Ç –∫–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ —Ç–æ–≤–∞—Ä"
```

**–í–∞—à —Å–ª—É—á–∞–π:**
```
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
"Monobank –°–†–ê–ó–£ —Å–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏, –≤—ã –∏—Ö –°–†–ê–ó–£ –ø–æ–ª—É—á–∞–µ—Ç–µ!"
```

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö–æ–ª–¥—ã

```
‚ùå –•–æ–ª–¥—ã —ç—Ç–æ –¥–ª—è:
- –î—Ä–æ–ø—à–∏–ø–∏–Ω–≥–∞ (–∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏)
- –ü—Ä–µ–¥–∑–∞–∫–∞–∑–æ–≤
- –î–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è
```

**–í–∞—à —Å–ª—É—á–∞–π:**
```
‚úÖ –í—Å–µ–≥–¥–∞: –¥–µ–Ω—å–≥–∏ –°–†–ê–ó–£!
- –¢–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ 1-2 –¥–Ω—è
- –ù–µ—Ç —Ö–æ–ª–¥–æ–≤
```

---

## üîí –ü–æ—á–µ–º—É –≤ –∫–æ–¥–µ –µ—Å—Ç—å `{'success', 'hold'}`?

–í –∫–æ–¥–µ –µ—Å—Ç—å:
```python
MONOBANK_SUCCESS_STATUSES = {'success', 'hold'}
```

–≠—Ç–æ –ø–æ—Ç–æ–º—É —á—Ç–æ Monobank **–º–æ–∂–µ—Ç** –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `hold`, –Ω–æ **–≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ —Ö–æ–ª–¥—ã –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è**.

**–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:**
- 99% —Å–ª—É—á–∞–µ–≤: `status = "success"` ‚Üí –¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã ‚úÖ
- 1% —Å–ª—É—á–∞–µ–≤: `status = "hold"` ‚Üí –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—Ä–µ–¥–∫–æ)
- 0% —Å–ª—É—á–∞–µ–≤: –Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–π —Ö–æ–ª–¥ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

## üéØ –ò—Ç–æ–≥–æ

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:

```
1. üí≥ –ö–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç–∏–ª ‚Üí Monobank –°–ü–ò–°–ê–õ –¥–µ–Ω—å–≥–∏ –°–†–ê–ó–£
2. ‚úÖ –î–µ–Ω—å–≥–∏ –Ω–∞ –≤–∞—à–µ–º —Å—á–µ—Ç–µ
3. üì¶ –û—Ç–ø—Ä–∞–≤–∏–ª–∏ —Ç–æ–≤–∞—Ä
4. üìä –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –û–±–Ω–æ–≤–∏–ª–∏ –Ω–∞–ª–æ–≥–æ–≤—É—é –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å
```

### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–æ:

```
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ª–æ–≥–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ —Ç–æ–≤–∞—Ä–∞—Ö
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–º–æ–∫–æ–¥–∞—Ö
‚ùå –ù–ï —Å–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ (–æ–Ω–∏ —É–∂–µ —Å–ø–∏—Å–∞–Ω—ã!)
‚ùå –ù–ï —Ö–æ–ª–¥ (–¥–µ–Ω—å–≥–∏ —É–∂–µ —É –≤–∞—Å!)
```

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-01-27

